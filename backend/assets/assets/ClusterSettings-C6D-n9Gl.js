import{p as I,h as O,r as o,b as B,j as e,A as g,I as m,G as r,L as D,T as J,d,S as x,n as c,f as C}from"./index-WNtVvHA-.js";import{u as k}from"./useMutation-sASNt-63.js";import{d as h}from"./index-Cz0at21k.js";import{C as u}from"./Container-BfaQJNWL.js";import{B as p}from"./Button-DQvu1NvV.js";import{C as q}from"./Card-CRhLQh1L.js";import{T as t}from"./Tabs-DTC-fz9p.js";import{B as j}from"./Badge-CNnytMob.js";import{I as b}from"./IconDeviceFloppy-BBJkynWm.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";function W(){const{id:i}=I(),L=O(),[f,S]=o.useState(""),[y,v]=o.useState(""),[n,T]=o.useState(!1),{data:a,isLoading:P,error:z,refetch:N}=B({queryKey:["cluster",i,"settings",n],queryFn:()=>C.getClusterSettings(i,n),enabled:!!i});o.useState(()=>{a&&(S(JSON.stringify(a.persistent||{},null,2)),v(JSON.stringify(a.transient||{},null,2)))});const l=k({mutationFn:s=>C.updateClusterSettings(i,s),onSuccess:()=>{L.invalidateQueries({queryKey:["cluster",i,"settings"]}),c.show({title:"Success",message:"Cluster settings updated successfully",color:"green"}),N()},onError:s=>{c.show({title:"Error",message:`Failed to update cluster settings: ${s.message}`,color:"red"})}}),w=()=>{try{const s=JSON.parse(f);l.mutate({persistent:s})}catch(s){c.show({title:"Error",message:`Invalid JSON: ${s.message}`,color:"red"})}},E=()=>{try{const s=JSON.parse(y);l.mutate({transient:s})}catch(s){c.show({title:"Error",message:`Invalid JSON: ${s.message}`,color:"red"})}};return i?P?e.jsx(u,{size:"xl",children:e.jsx(r,{justify:"center",mt:"xl",children:e.jsx(D,{size:"lg"})})}):z?e.jsx(u,{size:"xl",children:e.jsxs(g,{icon:e.jsx(m,{size:16}),title:"Error",color:"red",children:["Failed to load cluster settings: ",z.message]})}):e.jsxs(u,{size:"xl",py:"md",children:[e.jsxs(r,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(J,{order:2,children:"Cluster Settings"}),e.jsx(d,{size:"sm",c:"dimmed",children:"Configure cluster behavior and performance"})]}),e.jsxs(p,{variant:n?"filled":"light",onClick:()=>T(!n),children:[n?"Hide":"Show"," Defaults"]})]}),e.jsx(g,{icon:e.jsx(m,{size:16}),title:"Important",color:"blue",mb:"md",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(d,{size:"sm",children:[e.jsx("strong",{children:"Persistent settings:"})," Survive cluster restarts and apply across all nodes"]}),e.jsxs(d,{size:"sm",children:[e.jsx("strong",{children:"Transient settings:"})," Do not survive cluster restarts"]}),e.jsx(d,{size:"sm",children:"Transient settings take precedence over persistent settings."})]})}),e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsxs(t,{defaultValue:"persistent",children:[e.jsxs(t.List,{children:[e.jsx(t.Tab,{value:"persistent",children:e.jsxs(r,{gap:"xs",children:["Persistent Settings",e.jsx(j,{size:"sm",variant:"light",color:"blue",children:"Permanent"})]})}),e.jsx(t.Tab,{value:"transient",children:e.jsxs(r,{gap:"xs",children:["Transient Settings",e.jsx(j,{size:"sm",variant:"light",color:"orange",children:"Temporary"})]})}),n&&e.jsx(t.Tab,{value:"defaults",children:e.jsxs(r,{gap:"xs",children:["Default Settings",e.jsx(j,{size:"sm",variant:"light",color:"gray",children:"Read-only"})]})})]}),e.jsx(t.Panel,{value:"persistent",pt:"md",children:e.jsxs(x,{gap:"md",children:[e.jsx(h,{height:"500px",defaultLanguage:"json",value:f,onChange:s=>S(s||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}}),e.jsx(r,{justify:"flex-end",children:e.jsx(p,{leftSection:e.jsx(b,{size:16}),onClick:w,loading:l.isPending,children:"Save Persistent Settings"})})]})}),e.jsx(t.Panel,{value:"transient",pt:"md",children:e.jsxs(x,{gap:"md",children:[e.jsx(h,{height:"500px",defaultLanguage:"json",value:y,onChange:s=>v(s||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}}),e.jsx(r,{justify:"flex-end",children:e.jsx(p,{leftSection:e.jsx(b,{size:16}),onClick:E,loading:l.isPending,children:"Save Transient Settings"})})]})}),n&&e.jsx(t.Panel,{value:"defaults",pt:"md",children:e.jsx(h,{height:"500px",defaultLanguage:"json",value:JSON.stringify((a==null?void 0:a.defaults)||{},null,2),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,readOnly:!0}})})]})})]}):e.jsx(u,{size:"xl",children:e.jsx(g,{icon:e.jsx(m,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{W as ClusterSettingsPage};
