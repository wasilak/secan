import{V as R,K as w,r as v,k as I,j as e,A as T,I as S,G as p,$ as M,l as P,m,a8 as C,S as q,a0 as k,n as s,N as F,L as b,o as y,R as E}from"./index-RjraDOoV.js";import{u as O}from"./useMutation-D4vePse3.js";import{C as g}from"./Container-DzknpHr1.js";import{B as A}from"./Button-WXeFq9kF.js";import{C as W}from"./Card-BjE8Etao.js";import{B as z}from"./Badge-BzBHlL8m.js";import{I as N}from"./IconTrash-1LBY73qN.js";import{u as B}from"./use-form-C6GdrToZ.js";import{T as f}from"./TextInput-L1ZfrTJe.js";import{M as K}from"./MultiSelect-sIsjk2lt.js";import{T as $}from"./Textarea-D2efpRbZ.js";import{S as Q}from"./Switch-CUZ8IGMT.js";import"./InputsGroupFieldset-BE8SnQBj.js";function re(){const{id:t}=R(),o=w(),[j,d]=v.useState(!1),{data:c,isLoading:l,error:u}=I({queryKey:["cluster",t,"aliases"],queryFn:()=>y.getAliases(t),enabled:!!t}),{data:x}=I({queryKey:["cluster",t,"indices"],queryFn:()=>y.getIndices(t),enabled:!!t}),i=O({mutationFn:({index:r,alias:n})=>y.deleteAlias(t,r,n),onSuccess:()=>{o.invalidateQueries({queryKey:["cluster",t,"aliases"]}),b.show({title:"Success",message:"Alias deleted successfully",color:"green"})},onError:r=>{b.show({title:"Error",message:`Failed to delete alias: ${r.message}`,color:"red"})}});if(!t)return e.jsx(g,{size:"xl",children:e.jsx(T,{icon:e.jsx(S,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})});if(l)return e.jsx(g,{size:"xl",children:e.jsx(p,{justify:"center",mt:"xl",children:e.jsx(M,{size:"lg"})})});if(u)return e.jsx(g,{size:"xl",children:e.jsxs(T,{icon:e.jsx(S,{size:16}),title:"Error",color:"red",children:["Failed to load aliases: ",u.message]})});const h=(c==null?void 0:c.reduce((r,n)=>(r[n.alias]||(r[n.alias]=[]),r[n.alias].push(n),r),{}))||{};return e.jsxs(g,{size:"xl",py:"md",children:[e.jsxs(p,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(P,{order:2,children:"Index Aliases"}),e.jsx(m,{size:"sm",c:"dimmed",children:"Manage index aliases for zero-downtime migrations and logical groupings"})]}),e.jsx(A,{leftSection:e.jsx(C,{size:16}),onClick:()=>d(!0),children:"Create Alias"})]}),e.jsx(W,{shadow:"sm",padding:"lg",children:Object.keys(h).length===0?e.jsxs(q,{gap:"md",align:"center",py:"xl",children:[e.jsx(m,{c:"dimmed",children:"No aliases found"}),e.jsx(A,{leftSection:e.jsx(C,{size:16}),onClick:()=>d(!0),children:"Create Alias"})]}):e.jsx(k,{children:e.jsxs(s,{striped:!0,highlightOnHover:!0,children:[e.jsx(s.Thead,{children:e.jsxs(s.Tr,{children:[e.jsx(s.Th,{children:"Alias"}),e.jsx(s.Th,{children:"Indices"}),e.jsx(s.Th,{children:"Filter"}),e.jsx(s.Th,{children:"Routing"}),e.jsx(s.Th,{children:"Write Index"}),e.jsx(s.Th,{children:"Actions"})]})}),e.jsx(s.Tbody,{children:Object.entries(h).map(([r,n])=>e.jsxs(s.Tr,{children:[e.jsx(s.Td,{children:e.jsx(m,{size:"sm",fw:500,children:r})}),e.jsx(s.Td,{children:e.jsx(p,{gap:"xs",children:n.map(a=>e.jsx(z,{size:"sm",variant:"light",children:a.index},a.index))})}),e.jsx(s.Td,{children:e.jsx(m,{size:"xs",c:"dimmed",children:n[0].filter||"None"})}),e.jsx(s.Td,{children:e.jsx(m,{size:"xs",c:"dimmed",children:n[0].routing||"None"})}),e.jsx(s.Td,{children:n.some(a=>a.isWriteIndex)&&e.jsx(z,{size:"sm",color:"blue",children:"Yes"})}),e.jsx(s.Td,{children:e.jsx(p,{gap:"xs",children:n.map(a=>e.jsx(F,{color:"red",variant:"subtle",onClick:()=>{confirm(`Delete alias "${r}" from index "${a.index}"?`)&&i.mutate({index:a.index,alias:r})},loading:i.isPending,children:e.jsx(N,{size:16})},a.index))})})]},r))})]})})}),e.jsx(J,{opened:j,onClose:()=>d(!1),clusterId:t,availableIndices:(x==null?void 0:x.map(r=>r.name))||[]})]})}function J({opened:t,onClose:o,clusterId:j,availableIndices:d}){const c=w(),l=B({initialValues:{alias:"",indices:[],filter:void 0,routing:void 0,indexRouting:void 0,searchRouting:void 0,isWriteIndex:!1},validate:{alias:i=>i?i.startsWith("_")||i.startsWith("-")||i.startsWith("+")?"Alias name cannot start with _, -, or +":i.includes(" ")||i.includes(",")||i.includes("#")?"Alias name cannot contain spaces, commas, or #":null:"Alias name is required",indices:i=>i.length===0?"At least one index is required":null}}),u=O({mutationFn:i=>{const h={...i};if(i.filter)try{h.filter=JSON.parse(i.filter)}catch{throw new Error("Invalid JSON in filter field")}return y.createAlias(j,h)},onSuccess:()=>{c.invalidateQueries({queryKey:["cluster",j,"aliases"]}),b.show({title:"Success",message:"Alias created successfully",color:"green"}),l.reset(),o()},onError:i=>{b.show({title:"Error",message:`Failed to create alias: ${i.message}`,color:"red"})}}),x=l.onSubmit(i=>{u.mutate(i)});return e.jsx(E,{opened:t,onClose:o,title:"Create Alias",size:"lg",children:e.jsx("form",{onSubmit:x,children:e.jsxs(q,{gap:"md",children:[e.jsx(f,{label:"Alias Name",placeholder:"my-alias",required:!0,...l.getInputProps("alias")}),e.jsx(K,{label:"Indices",placeholder:"Select indices",data:d,searchable:!0,required:!0,...l.getInputProps("indices")}),e.jsx($,{label:"Filter (JSON)",placeholder:'{"term": {"user": "kimchy"}}',description:"Optional filter to apply to the alias",minRows:3,...l.getInputProps("filter")}),e.jsx(f,{label:"Routing",placeholder:"1",description:"Optional routing value for both index and search operations",...l.getInputProps("routing")}),e.jsx(f,{label:"Index Routing",placeholder:"1",description:"Optional routing value for index operations only",...l.getInputProps("indexRouting")}),e.jsx(f,{label:"Search Routing",placeholder:"1,2",description:"Optional routing value for search operations only",...l.getInputProps("searchRouting")}),e.jsx(Q,{label:"Is Write Index",description:"Mark this as the write index for the alias",...l.getInputProps("isWriteIndex",{type:"checkbox"})}),e.jsxs(p,{justify:"flex-end",mt:"md",children:[e.jsx(A,{variant:"subtle",onClick:o,children:"Cancel"}),e.jsx(A,{type:"submit",loading:u.isPending,children:"Create Alias"})]})]})})})}export{re as Aliases};
