import{O as E,H as I,r as o,k as J,j as e,A as g,I as m,G as r,X as B,l as d,S as x,af as h,J as c,m as C}from"./index-t_DKJJHX.js";import{u as D}from"./useMutation-71ZWvBuQ.js";import{C as u}from"./Container-B2DCW7ow.js";import{T as k}from"./Title-ClywU4KH.js";import{B as p}from"./Button-BjQmuLCB.js";import{C as q}from"./Card-Cljo_TPy.js";import{T as t}from"./Tabs-B4N-hzH9.js";import{B as j}from"./Badge-B3QISO9x.js";import{I as b}from"./IconDeviceFloppy-BG8Hazaf.js";import"./get-safe-id-Bp3H8K0-.js";function X(){const{id:i}=E(),L=I(),[f,S]=o.useState(""),[y,v]=o.useState(""),[n,T]=o.useState(!1),{data:a,isLoading:P,error:z,refetch:N}=J({queryKey:["cluster",i,"settings",n],queryFn:()=>C.getClusterSettings(i,n),enabled:!!i});o.useState(()=>{a&&(S(JSON.stringify(a.persistent||{},null,2)),v(JSON.stringify(a.transient||{},null,2)))});const l=D({mutationFn:s=>C.updateClusterSettings(i,s),onSuccess:()=>{L.invalidateQueries({queryKey:["cluster",i,"settings"]}),c.show({title:"Success",message:"Cluster settings updated successfully",color:"green"}),N()},onError:s=>{c.show({title:"Error",message:`Failed to update cluster settings: ${s.message}`,color:"red"})}}),w=()=>{try{const s=JSON.parse(f);l.mutate({persistent:s})}catch(s){c.show({title:"Error",message:`Invalid JSON: ${s.message}`,color:"red"})}},O=()=>{try{const s=JSON.parse(y);l.mutate({transient:s})}catch(s){c.show({title:"Error",message:`Invalid JSON: ${s.message}`,color:"red"})}};return i?P?e.jsx(u,{size:"xl",children:e.jsx(r,{justify:"center",mt:"xl",children:e.jsx(B,{size:"lg"})})}):z?e.jsx(u,{size:"xl",children:e.jsxs(g,{icon:e.jsx(m,{size:16}),title:"Error",color:"red",children:["Failed to load cluster settings: ",z.message]})}):e.jsxs(u,{size:"xl",py:"md",children:[e.jsxs(r,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(k,{order:2,children:"Cluster Settings"}),e.jsx(d,{size:"sm",c:"dimmed",children:"Configure cluster behavior and performance"})]}),e.jsxs(p,{variant:n?"filled":"light",onClick:()=>T(!n),children:[n?"Hide":"Show"," Defaults"]})]}),e.jsx(g,{icon:e.jsx(m,{size:16}),title:"Important",color:"blue",mb:"md",children:e.jsxs(x,{gap:"xs",children:[e.jsxs(d,{size:"sm",children:[e.jsx("strong",{children:"Persistent settings:"})," Survive cluster restarts and apply across all nodes"]}),e.jsxs(d,{size:"sm",children:[e.jsx("strong",{children:"Transient settings:"})," Do not survive cluster restarts"]}),e.jsx(d,{size:"sm",children:"Transient settings take precedence over persistent settings."})]})}),e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsxs(t,{defaultValue:"persistent",children:[e.jsxs(t.List,{children:[e.jsx(t.Tab,{value:"persistent",children:e.jsxs(r,{gap:"xs",children:["Persistent Settings",e.jsx(j,{size:"sm",variant:"light",color:"blue",children:"Permanent"})]})}),e.jsx(t.Tab,{value:"transient",children:e.jsxs(r,{gap:"xs",children:["Transient Settings",e.jsx(j,{size:"sm",variant:"light",color:"orange",children:"Temporary"})]})}),n&&e.jsx(t.Tab,{value:"defaults",children:e.jsxs(r,{gap:"xs",children:["Default Settings",e.jsx(j,{size:"sm",variant:"light",color:"gray",children:"Read-only"})]})})]}),e.jsx(t.Panel,{value:"persistent",pt:"md",children:e.jsxs(x,{gap:"md",children:[e.jsx(h,{height:"500px",defaultLanguage:"json",value:f,onChange:s=>S(s||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}}),e.jsx(r,{justify:"flex-end",children:e.jsx(p,{leftSection:e.jsx(b,{size:16}),onClick:w,loading:l.isPending,children:"Save Persistent Settings"})})]})}),e.jsx(t.Panel,{value:"transient",pt:"md",children:e.jsxs(x,{gap:"md",children:[e.jsx(h,{height:"500px",defaultLanguage:"json",value:y,onChange:s=>v(s||""),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}}),e.jsx(r,{justify:"flex-end",children:e.jsx(p,{leftSection:e.jsx(b,{size:16}),onClick:O,loading:l.isPending,children:"Save Transient Settings"})})]})}),n&&e.jsx(t.Panel,{value:"defaults",pt:"md",children:e.jsx(h,{height:"500px",defaultLanguage:"json",value:JSON.stringify((a==null?void 0:a.defaults)||{},null,2),options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,readOnly:!0}})})]})})]}):e.jsx(u,{size:"xl",children:e.jsx(g,{icon:e.jsx(m,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{X as ClusterSettingsPage};
