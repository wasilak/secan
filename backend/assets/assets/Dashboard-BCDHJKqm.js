import{c as $,u as H,a as A,r as y,b as U,j as e,S as v,T as S,C as R,L as V,d as C,A as T,I as k,G as D,e as n,f as E,U as B,g as F}from"./index-WNtVvHA-.js";import{u as M}from"./accessibility-D9P_g1rw.js";import{I as O}from"./IconRefresh-D3kGgJ_q.js";import{B as P}from"./Badge-CNnytMob.js";var q=$("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),G=$("selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);function K(a){switch(a){case"green":return"green";case"yellow":return"yellow";case"red":return"red";case"unreachable":return"gray";default:return"gray"}}function N(a){switch(a){case"green":return 3;case"yellow":return 2;case"red":return 1;case"unreachable":return 0;default:return 0}}function Q(a,l,t){return t?[...a].sort((h,i)=>{let s,o;return l==="health"?(s=N(h.health),o=N(i.health)):(s=h[l],o=i[l]),typeof s=="string"&&typeof o=="string"?t==="asc"?s.localeCompare(o):o.localeCompare(s):typeof s=="number"&&typeof o=="number"?t==="asc"?s-o:o-s:0}):a}function x({column:a,currentColumn:l,direction:t,onSort:f,children:h}){const i=l===a,s=i?`Sorted ${t==="asc"?"ascending":"descending"}`:"Not sorted";return e.jsx(n.Th,{children:e.jsxs(B,{onClick:()=>f(a),style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},"aria-label":`Sort by ${h}, ${s}`,children:[e.jsx(C,{fw:500,children:h}),i&&t==="asc"&&e.jsx(q,{size:14,"aria-hidden":"true"}),i&&t==="desc"&&e.jsx(F,{size:14,"aria-hidden":"true"}),!i&&e.jsx(G,{size:14,opacity:.5,"aria-hidden":"true"})]})})}function Z(){const a=H(),{preferences:l}=A(),{announce:t,announceError:f}=M(),[h,i]=y.useState([]),[s,o]=y.useState(null),[d,b]=y.useState(null),{data:c,isLoading:I,error:p}=U({queryKey:["clusters"],queryFn:()=>E.getClusters(),refetchInterval:l.refreshInterval});y.useEffect(()=>{I?t("Loading clusters"):p?f("Failed to load cluster list"):c&&t(`Loaded ${c.length} cluster${c.length!==1?"s":""}`)},[I,p,c,t,f]),y.useEffect(()=>{if(!c||c.length===0){i([]);return}const r=async()=>{const L=await Promise.all(c.map(async g=>{try{const m=await E.getClusterHealth(g.id);return{id:g.id,name:g.name,health:m.status,nodes:m.numberOfNodes,shards:m.activeShards,indices:0,documents:0}}catch(m){return{id:g.id,name:g.name,health:"unreachable",nodes:0,shards:0,indices:0,documents:0,error:m instanceof Error?m.message:"Unknown error"}}}));i(L)};r();const j=setInterval(r,l.refreshInterval);return()=>clearInterval(j)},[c,l.refreshInterval]);const u=r=>{s===r?d==="asc"?(b("desc"),t(`Sorted by ${r} descending`)):d==="desc"&&(b(null),o(null),t("Sort removed")):(o(r),b("asc"),t(`Sorted by ${r} ascending`))},w=r=>{a(`/cluster/${r}`)},z=Q(h,s,d);return I?e.jsxs(v,{gap:"md",p:"md",children:[e.jsx(S,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(R,{h:200,children:e.jsxs(v,{align:"center",gap:"md",children:[e.jsx(V,{size:"lg"}),e.jsx(C,{c:"dimmed",children:"Loading clusters..."})]})})]}):p?e.jsxs(v,{gap:"md",p:"md",children:[e.jsx(S,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(T,{icon:e.jsx(k,{size:16}),title:"Error loading clusters",color:"red",children:p instanceof Error?p.message:"Failed to load cluster list"})]}):!c||c.length===0?e.jsxs(v,{gap:"md",p:"md",children:[e.jsx(S,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(T,{icon:e.jsx(k,{size:16}),title:"No clusters configured",color:"blue",children:"No Elasticsearch or OpenSearch clusters are configured. Please check your configuration file."})]}):e.jsxs(v,{gap:"md",p:"md",children:[e.jsxs(D,{justify:"space-between",wrap:"wrap",children:[e.jsx(S,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsxs(D,{gap:"xs",children:[e.jsx(O,{size:16,"aria-hidden":"true"}),e.jsxs(C,{size:"sm",c:"dimmed","aria-live":"polite",children:["Auto-refresh: ",l.refreshInterval/1e3,"s"]})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(n,{highlightOnHover:!0,striped:!0,role:"table","aria-label":"Cluster overview table",style:{minWidth:"600px"},children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(x,{column:"name",currentColumn:s,direction:d,onSort:u,children:"Cluster Name"}),e.jsx(x,{column:"health",currentColumn:s,direction:d,onSort:u,children:"Health"}),e.jsx(x,{column:"nodes",currentColumn:s,direction:d,onSort:u,children:"Nodes"}),e.jsx(x,{column:"shards",currentColumn:s,direction:d,onSort:u,children:"Shards"}),e.jsx(x,{column:"indices",currentColumn:s,direction:d,onSort:u,children:"Indices"}),e.jsx(x,{column:"documents",currentColumn:s,direction:d,onSort:u,children:"Documents"})]})}),e.jsx(n.Tbody,{children:z.map(r=>e.jsxs(n.Tr,{onClick:()=>w(r.id),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),w(r.id))},"aria-label":`View details for cluster ${r.name}`,children:[e.jsxs(n.Td,{children:[e.jsx(C,{fw:500,children:r.name}),r.error&&e.jsx(C,{size:"xs",c:"dimmed",role:"alert",children:r.error})]}),e.jsx(n.Td,{children:e.jsx(P,{color:K(r.health),variant:"filled","aria-label":`Health status: ${r.health}`,children:r.health})}),e.jsx(n.Td,{children:r.nodes}),e.jsx(n.Td,{children:r.shards}),e.jsx(n.Td,{children:r.indices}),e.jsx(n.Td,{children:r.documents.toLocaleString()})]},r.id))})]})})]})}export{Z as Dashboard};
