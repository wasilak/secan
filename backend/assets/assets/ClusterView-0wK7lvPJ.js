import{q as is,a as Le,s as ze,j as e,P as De,r as M,t as as,v as Ne,w as ls,e as me,x as ke,y as E,o as A,M as z,T as re,z as le,D as os,E as ds,F as Te,S as v,m as a,G as b,H as xe,h as Fe,J as cs,K as ge,k as oe,A as ee,I as ne,L as We,N as Ke,B as ve,O as Ae,Q as hs,R as pe,V as Qe,i as us,l as ms,W as Se,X as Ee,n as o,Y as qe}from"./index-mfSqI9w6.js";import{u as X}from"./useMutation-DCd4ycQJ.js";import{u as Je}from"./useWatermarks-Dm84b7Db.js";import{u as xs}from"./accessibility-zMzSv7ly.js";import{I as gs}from"./IconDeviceFloppy-BLzA7tUs.js";import{I as ps}from"./IconTrash-BuA0Osa9.js";import{T as be}from"./TextInput-BnNr3IMK.js";import{B as te}from"./Button-C5lya5i8.js";import{N as js}from"./NumberInput-DZdKmTgD.js";import{C as we}from"./Container-CJlNw-32.js";import{S as I}from"./Skeleton-CqkQKTPT.js";import{C as J}from"./Card-Bd80AX5X.js";import{B as H}from"./Badge-vaax2k94.js";import{T as W}from"./Tabs-CGbYISat.js";import{I as fs}from"./IconCheck-DB-vQB9u.js";import{G as Z}from"./Grid-BD4XcBGs.js";import{I as Ve,a as de,b as Ze,c as Ye,C as ue}from"./IconMinimize-y8tbX_Vo.js";import{M as Ie}from"./MultiSelect-46_FRsGI.js";import{I as ys,a as vs}from"./IconSortDescending-C0dWt5uz.js";import"./get-safe-id-Bp3H8K0-.js";import"./InputsGroupFieldset-CWT1Iz9M.js";const[Ss,Xe]=is("HoverCard component was not found in the tree"),bs={};function es(s){const{children:n,onMouseEnter:t,onMouseLeave:h,...d}=Le("HoverCardDropdown",bs,s),f=Xe(),m=ze(t,f.openDropdown),u=ze(h,f.closeDropdown);return e.jsx(De.Dropdown,{onMouseEnter:m,onMouseLeave:u,...d,children:n})}es.displayName="@mantine/core/HoverCardDropdown";const Cs={refProp:"ref"},ss=M.forwardRef((s,n)=>{const{children:t,refProp:h,eventPropsWrapperName:d,...f}=Le("HoverCardTarget",Cs,s);if(!as(t))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const m=Xe(),u=ze(t.props.onMouseEnter,m.openDropdown),y=ze(t.props.onMouseLeave,m.closeDropdown),$={onMouseEnter:u,onMouseLeave:y};return e.jsx(De.Target,{refProp:h,ref:n,...f,children:M.cloneElement(t,d?{[d]:$}:$)})});ss.displayName="@mantine/core/HoverCardTarget";const ws={openDelay:0,closeDelay:150,initiallyOpened:!1};function he(s){const{children:n,onOpen:t,onClose:h,openDelay:d,closeDelay:f,initiallyOpened:m,...u}=Le("HoverCard",ws,s),[y,{open:$,close:D}]=Ne(m,{onClose:h,onOpen:t}),{openDropdown:F,closeDropdown:T}=ls({open:$,close:D,openDelay:d,closeDelay:f});return e.jsx(Ss,{value:{openDropdown:F,closeDropdown:T},children:e.jsx(De,{...u,opened:y,__staticSelector:"HoverCard",children:n})})}he.displayName="@mantine/core/HoverCard";he.Target=ss;he.Dropdown=es;he.extend=s=>s;var zs=me("chart-bar","IconChartBar",[["path",{d:"M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20l14 0",key:"svg-3"}]]),rs=me("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Ts=me("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Is=me("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),ks=me("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]),Ue=me("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function Me(s,n=300){const[t,h]=M.useState(s);return M.useEffect(()=>{const d=setTimeout(()=>{h(s)},n);return()=>{clearTimeout(d)}},[s,n]),t}function Es({clusterId:s,index:n}){const t=ke(),{announceSuccess:h,announceError:d}=xs(),[f,{open:m,close:u}]=Ne(!1),[y,{open:$,close:D}]=Ne(!1),[F,T]=M.useState(""),[P,q]=M.useState(1),g=X({mutationFn:()=>A.openIndex(s,n.name),onMutate:()=>{E.show({id:`open-${n.name}`,title:"Opening index",message:`Opening index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`open-${n.name}`,title:"Success",message:`Index ${n.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),h(`Index ${n.name} opened successfully`),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:j=>{E.update({id:`open-${n.name}`,title:"Error",message:`Failed to open index: ${j.message}`,color:"red",loading:!1,autoClose:5e3}),d(`Failed to open index: ${j.message}`)}}),i=X({mutationFn:()=>A.closeIndex(s,n.name),onMutate:()=>{E.show({id:`close-${n.name}`,title:"Closing index",message:`Closing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`close-${n.name}`,title:"Success",message:`Index ${n.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:j=>{E.update({id:`close-${n.name}`,title:"Error",message:`Failed to close index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),S=X({mutationFn:()=>A.deleteIndex(s,n.name),onMutate:()=>{E.show({id:`delete-${n.name}`,title:"Deleting index",message:`Deleting index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`delete-${n.name}`,title:"Success",message:`Index ${n.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]}),u(),T("")},onError:j=>{E.update({id:`delete-${n.name}`,title:"Error",message:`Failed to delete index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),R=X({mutationFn:j=>A.forceMergeIndex(s,n.name,j),onMutate:()=>{E.show({id:`forcemerge-${n.name}`,title:"Force merging index",message:`Force merging index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`forcemerge-${n.name}`,title:"Success",message:`Index ${n.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),D(),q(1)},onError:j=>{E.update({id:`forcemerge-${n.name}`,title:"Error",message:`Failed to force merge index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),U=X({mutationFn:()=>A.clearCacheIndex(s,n.name),onMutate:()=>{E.show({id:`clearcache-${n.name}`,title:"Clearing cache",message:`Clearing cache for index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`clearcache-${n.name}`,title:"Success",message:`Cache cleared for index ${n.name}`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{E.update({id:`clearcache-${n.name}`,title:"Error",message:`Failed to clear cache: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),c=X({mutationFn:()=>A.refreshIndex(s,n.name),onMutate:()=>{E.show({id:`refresh-${n.name}`,title:"Refreshing index",message:`Refreshing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`refresh-${n.name}`,title:"Success",message:`Index ${n.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{E.update({id:`refresh-${n.name}`,title:"Error",message:`Failed to refresh index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),C=X({mutationFn:()=>A.flushIndex(s,n.name),onMutate:()=>{E.show({id:`flush-${n.name}`,title:"Flushing index",message:`Flushing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{E.update({id:`flush-${n.name}`,title:"Success",message:`Index ${n.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{E.update({id:`flush-${n.name}`,title:"Error",message:`Failed to flush index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),N=()=>{F===n.name&&S.mutate()},G=()=>{const j=typeof P=="number"?P:parseInt(P,10);!isNaN(j)&&j>0&&R.mutate(j)};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{shadow:"md",width:200,children:[e.jsx(z.Target,{children:e.jsx(re,{label:"Index operations",children:e.jsx(le,{variant:"subtle",color:"gray","aria-label":`Operations for index ${n.name}`,children:e.jsx(rs,{size:16,"aria-hidden":"true"})})})}),e.jsxs(z.Dropdown,{children:[e.jsx(z.Label,{children:"Index Operations"}),n.status==="close"?e.jsx(z.Item,{leftSection:e.jsx(ks,{size:14,"aria-hidden":"true"}),onClick:()=>g.mutate(),disabled:g.isPending,children:"Open Index"}):e.jsx(z.Item,{leftSection:e.jsx(Is,{size:14,"aria-hidden":"true"}),onClick:()=>i.mutate(),disabled:i.isPending,children:"Close Index"}),e.jsx(z.Item,{leftSection:e.jsx(os,{size:14,"aria-hidden":"true"}),onClick:()=>c.mutate(),disabled:c.isPending,children:"Refresh"}),e.jsx(z.Item,{leftSection:e.jsx(gs,{size:14,"aria-hidden":"true"}),onClick:()=>C.mutate(),disabled:C.isPending,children:"Flush"}),e.jsx(z.Item,{leftSection:e.jsx(Ts,{size:14,"aria-hidden":"true"}),onClick:()=>U.mutate(),disabled:U.isPending,children:"Clear Cache"}),e.jsx(z.Item,{leftSection:e.jsx(ds,{size:14,"aria-hidden":"true"}),onClick:$,children:"Force Merge"}),e.jsx(z.Divider,{}),e.jsx(z.Item,{leftSection:e.jsx(ps,{size:14,"aria-hidden":"true"}),color:"red",onClick:m,children:"Delete Index"})]})]}),e.jsx(Te,{opened:f,onClose:()=>{u(),T("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(v,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(a,{span:!0,fw:700,children:n.name}),"? This action cannot be undone."]}),e.jsx(a,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(be,{placeholder:n.name,value:F,onChange:j=>T(j.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(b,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{u(),T("")},children:"Cancel"}),e.jsx(te,{color:"red",onClick:N,disabled:F!==n.name||S.isPending,loading:S.isPending,"aria-label":`Delete index ${n.name}`,children:"Delete"})]})]})}),e.jsx(Te,{opened:y,onClose:()=>{D(),q(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(v,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(a,{span:!0,fw:700,children:n.name})," to reduce the number of segments."]}),e.jsx(js,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:P,onChange:q,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(b,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{D(),q(1)},children:"Cancel"}),e.jsx(te,{onClick:G,disabled:R.isPending,loading:R.isPending,"aria-label":`Force merge index ${n.name}`,children:"Force Merge"})]})]})})]})}function _e(s){var n;if(console.error("Error occurred:",s),s&&typeof s=="object"&&"name"in s&&s.name==="ApiClientError"&&"message"in s&&"statusCode"in s){const t=s;if(t.error){const h=Be(t.error);if(h)return{error:"elasticsearch_error",message:h,statusCode:t.statusCode,details:t.error}}return{error:"api_error",message:t.message,statusCode:t.statusCode,details:t.error}}if(s&&typeof s=="object"&&"response"in s){const t=s.response;if(t!=null&&t.data){const h=Be(t.data);return{error:t.data.error||"api_error",message:h||t.data.message||"An error occurred",details:t.data.details,statusCode:t.status,requestId:(n=t.headers)==null?void 0:n["x-request-id"]}}return{error:"http_error",message:`HTTP ${(t==null?void 0:t.status)||"Unknown"}: ${(t==null?void 0:t.statusText)||"Request failed"}`,statusCode:t==null?void 0:t.status}}if(s&&typeof s=="object"&&"message"in s){const t=s;return t.message.includes("Network")||t.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:t.message}:{error:"error",message:t.message,details:t.stack}}return typeof s=="string"?{error:"error",message:s}:{error:"unknown_error",message:"An unexpected error occurred",details:s}}function Be(s){const n=s;if(n.error&&typeof n.error=="object"){const t=n.error;if(t.reason&&typeof t.reason=="string"){let h=`Elasticsearch: ${t.reason}`;if(t.type&&typeof t.type=="string"&&(h=`Elasticsearch (${t.type}): ${t.reason}`),t.root_cause&&Array.isArray(t.root_cause)&&t.root_cause.length>0){const d=t.root_cause[0];d.reason&&d.reason!==t.reason&&(h+=`
Root cause: ${d.reason}`)}return h}}if("details"in n&&n.details&&typeof n.details=="object"){const t=n.details;if(t.error&&typeof t.error=="object"){const h=t.error;if(h.reason&&typeof h.reason=="string"){let d=`Elasticsearch: ${h.reason}`;if(h.type&&typeof h.type=="string"&&(d=`Elasticsearch (${h.type}): ${h.reason}`),h.root_cause&&Array.isArray(h.root_cause)&&h.root_cause.length>0){const f=h.root_cause[0];f.reason&&f.reason!==h.reason&&(d+=`
Root cause: ${f.reason}`)}return d}}}return null}function He(s,n){if(!s.trim())return`${n} cannot be empty`;try{return JSON.parse(s),null}catch(t){return t.message}}function Pe(s){const n=["creation_date","provided_name","uuid","version"],t=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],h=[...n,...t],d={};for(const[f,m]of Object.entries(s))if(f==="index"){const u=m,y={};for(const[$,D]of Object.entries(u))h.includes($)||(y[$]=D);Object.keys(y).length>0&&(d[f]=y)}else h.includes(f)||(d[f]=m);return d}function Ms(){const s=xe(),n=Fe(),t=ke(),{resolvedTheme:h}=cs(),[d,f]=ge(),m=s.id,u=d.get("index")||s.indexName,y=d.get("indexTab")||d.get("tab")||"settings";M.useEffect(()=>{if(d.has("index")&&!d.has("indexTab")){const w=new URLSearchParams(d);w.set("indexTab","settings"),f(w,{replace:!0})}},[d,f]);const[$,D]=M.useState(""),[F,T]=M.useState(""),[P,q]=M.useState(null),[g,i]=M.useState(null),[S,R]=M.useState(null),[U,c]=M.useState(!1),[C,N]=M.useState(!1),[G,j]=M.useState(null),[K,V]=M.useState(!1),[Q,ie]=M.useState(null);M.useEffect(()=>{y==="stats"&&!G&&!K&&(V(!0),ie(null),A.proxyRequest(m,"GET",`/${u}/_stats`).then(w=>{j(w)}).catch(w=>{ie(w instanceof Error?w.message:"Failed to fetch stats")}).finally(()=>{V(!1)}))},[y,m,u,G,K]);const{data:O,isLoading:B,error:l}=oe({queryKey:["cluster",m,"index",u,"settings"],queryFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const _=(await A.proxyRequest(m,"GET",`/${u}/_settings`))[u];return _==null?void 0:_.settings},enabled:!!m&&!!u}),{data:r,isLoading:p,error:x}=oe({queryKey:["cluster",m,"index",u,"mappings"],queryFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const _=(await A.proxyRequest(m,"GET",`/${u}/_mapping`))[u];return _==null?void 0:_.mappings},enabled:!!m&&!!u});M.useEffect(()=>{if(O){const w=Pe(O);D(JSON.stringify(w,null,2)),c(!1)}},[O]),M.useEffect(()=>{r&&(T(JSON.stringify(r,null,2)),N(!1))},[r]);const L=X({mutationFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const w=[];if(U){const _=He($,"Settings");if(_)throw q(_),new Error(`Invalid settings JSON: ${_}`);const $e=JSON.parse($),ts=Pe($e);w.push(A.proxyRequest(m,"PUT",`/${u}/_settings`,ts))}if(C){const _=He(F,"Mappings");if(_)throw i(_),new Error(`Invalid mappings JSON: ${_}`);const $e=JSON.parse(F);w.push(A.proxyRequest(m,"PUT",`/${u}/_mapping`,$e))}await Promise.all(w)},onSuccess:()=>{t.invalidateQueries({queryKey:["cluster",m,"index",u]}),t.invalidateQueries({queryKey:["cluster",m,"indices"]});const w=[];U&&w.push("settings"),C&&w.push("mappings"),E.show({title:"Success",message:`Index ${w.join(" and ")} updated successfully`,color:"green",icon:e.jsx(fs,{size:16})}),c(!1),N(!1),R(null)},onError:w=>{const _=_e(w);R(_.message)}}),k=w=>{D(w||""),q(null),R(null),c(!0)},ae=w=>{T(w||""),i(null),R(null),N(!0)},je=()=>{q(null),i(null),R(null),L.mutate()},Ce=()=>{if(O){const w=Pe(O);D(JSON.stringify(w,null,2)),c(!1)}r&&(T(JSON.stringify(r,null,2)),N(!1)),q(null),i(null),R(null)},fe=w=>{if(w){const _=new URLSearchParams(d);d.has("index")?_.set("indexTab",w):_.set("tab",w),f(_)}},ce=B||p,ye=l||x,Re=U||C;if(!m||!u)return e.jsx(we,{size:"xl",children:e.jsx(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(ce)return e.jsxs(we,{size:"xl",py:"md",children:[e.jsxs(b,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(I,{height:32,width:200,mb:"xs"}),e.jsx(I,{height:20,width:150})]}),e.jsx(I,{height:36,width:120})]}),e.jsxs(v,{gap:"md",children:[e.jsx(I,{height:48,width:"100%"}),e.jsx(J,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(I,{height:400})})]})]});if(ye){const w=_e(ye);return e.jsxs(we,{size:"xl",py:"md",children:[e.jsx(ee,{icon:e.jsx(ne,{size:16}),title:"Error Loading Index",color:"red",children:w.message}),e.jsx(te,{variant:"default",onClick:()=>n(`/cluster/${m}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(we,{size:"xl",py:"md",style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(b,{justify:"space-between",mb:"md",children:[e.jsx(b,{gap:"xs",children:e.jsx(H,{size:"lg",variant:"light",color:"blue",children:u})}),!d.has("index")&&e.jsx(te,{variant:"default",onClick:()=>n(`/cluster/${m}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(v,{gap:"md",style:{flex:1,overflow:"auto"},children:[e.jsxs(W,{value:y,onChange:fe,children:[e.jsxs(W.List,{children:[e.jsx(W.Tab,{value:"settings",leftSection:e.jsx(We,{size:16}),children:"Settings"}),e.jsx(W.Tab,{value:"mappings",leftSection:e.jsx(Ke,{size:16}),children:"Mappings"}),e.jsx(W.Tab,{value:"stats",leftSection:e.jsx(zs,{size:16}),children:"Stats"})]}),e.jsx(W.Panel,{value:"settings",pt:"md",children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(v,{gap:"md",children:e.jsxs(ve,{children:[e.jsxs(b,{gap:"xs",mb:"xs",children:[e.jsx(a,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(he,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(he.Target,{children:e.jsx(ve,{component:"span",style:{cursor:"help"},c:"blue.6",children:e.jsx(Ue,{size:16})})}),e.jsxs(he.Dropdown,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(a,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx(ve,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(Ae,{height:"500px",defaultLanguage:"json",value:$,onChange:k,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),P&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:P})]})})})}),e.jsx(W.Panel,{value:"mappings",pt:"md",children:e.jsxs(v,{gap:"md",children:[e.jsx(ee,{icon:e.jsx(Ue,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(v,{gap:"md",children:e.jsxs(ve,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx(ve,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(Ae,{height:"500px",defaultLanguage:"json",value:F,onChange:ae,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),g&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:g})]})})})]})}),e.jsx(W.Panel,{value:"stats",pt:"md",children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(v,{gap:"md",children:e.jsxs("div",{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Statistics (Read-only)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Detailed statistics for this index"}),K?e.jsx(b,{justify:"center",py:"xl",children:e.jsx(hs,{})}):Q?e.jsx(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:Q}):G?e.jsx(pe,{h:500,children:e.jsx(Qe,{block:!0,children:JSON.stringify(G,null,2)})}):null]})})})})]}),S&&e.jsx(ee,{icon:e.jsx(ne,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>R(null),children:e.jsx(a,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:S})}),e.jsxs(b,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:Ce,disabled:!Re||L.isPending,children:"Reset"}),e.jsx(te,{onClick:je,loading:L.isPending,disabled:!Re,children:L.isPending?"Saving...":"Save Changes"})]})]})]})}function Oe(s){switch(s){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function Y(s){if(s===0)return"0 B";const n=1024,t=["B","KB","MB","GB","TB"],h=Math.floor(Math.log(s)/Math.log(n));return`${(s/Math.pow(n,h)).toFixed(2)} ${t[h]}`}function se(s,n){return n===0?0:Math.round(s/n*100)}function Ge(s){switch(s){case"green":return"transparent";case"yellow":return"rgba(250, 176, 5, 0.15)";case"red":return"rgba(250, 82, 82, 0.15)";default:return"transparent"}}function rr(){var ie;const{id:s}=xe(),n=us(),[t,h]=ge(),{getColor:d}=Je(s),f=t.get("tab")||"overview",m=t.get("index"),u=t.get("indexTab"),[y,$]=M.useState(!1),[D,F]=M.useState(null);M.useEffect(()=>{m?(F(decodeURIComponent(m)),$(!0)):($(!1),F(null))},[m]);const T=(O,B)=>{const l=new URLSearchParams(t);l.set("index",encodeURIComponent(O)),B?l.set("indexTab",B):l.delete("indexTab"),h(l)},P=()=>{const O=new URLSearchParams(t);O.delete("index"),O.delete("indexTab"),h(O)},q=O=>{if(O){const B=new URLSearchParams(t);B.set("tab",O),m&&B.set("index",m),u&&B.set("indexTab",u),h(B)}},g=O=>{const B=new URLSearchParams;B.set("tab",O),h(B)},{data:i,isLoading:S,error:R}=oe({queryKey:["cluster",s,"stats"],queryFn:()=>A.getClusterStats(s),refetchInterval:n,enabled:!!s}),{data:U,isLoading:c,error:C}=oe({queryKey:["cluster",s,"nodes"],queryFn:()=>A.getNodes(s),refetchInterval:n,enabled:!!s}),{data:N,isLoading:G,error:j}=oe({queryKey:["cluster",s,"indices"],queryFn:()=>A.getIndices(s),refetchInterval:n,enabled:!!s}),{data:K,isLoading:V,error:Q}=oe({queryKey:["cluster",s,"shards"],queryFn:()=>A.getShards(s),refetchInterval:n,enabled:!!s});return s?S?e.jsxs(v,{p:"md",gap:"md",children:[e.jsx(I,{height:40,radius:"sm"}),e.jsxs(Z,{children:[e.jsx(Z.Col,{span:{base:12,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(I,{height:80,radius:"md"})})}),e.jsx(Z.Col,{span:{base:12,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(I,{height:80,radius:"md"})})}),e.jsx(Z.Col,{span:{base:12,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(I,{height:80,radius:"md"})})}),e.jsx(Z.Col,{span:{base:12,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsx(I,{height:80,radius:"md"})})})]}),e.jsx(I,{height:400,radius:"md"})]}):R?e.jsx(v,{p:"md",children:e.jsxs(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",R.message]})}):e.jsxs(v,{gap:"md",p:"md",children:[e.jsx(b,{justify:"space-between",wrap:"wrap",children:e.jsxs("div",{children:[e.jsx(ms,{order:1,className:"text-responsive-xl",children:(i==null?void 0:i.clusterName)||s}),e.jsx(a,{size:"sm",c:"dimmed",children:"Cluster Overview"})]})}),e.jsx(Se,{value:100,color:Oe((i==null?void 0:i.health)||"red"),size:"sm",radius:"xs","aria-label":`Cluster health: ${(i==null?void 0:i.health)||"unknown"}`}),e.jsxs(Z,{children:[e.jsx(Z.Col,{span:{base:12,sm:6,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("nodes"),children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfNodes)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(Z.Col,{span:{base:12,sm:6,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("indices"),children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfIndices)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[((ie=i==null?void 0:i.numberOfDocuments)==null?void 0:ie.toLocaleString())||0," documents"]})]})})}),e.jsx(Z.Col,{span:{base:12,sm:6,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("shards"),children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.activeShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.activePrimaryShards)||0," primary"]})]})})}),e.jsx(Z.Col,{span:{base:12,sm:6,md:3},children:e.jsx(J,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("shards"),children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(a,{size:"xl",fw:700,c:i!=null&&i.unassignedShards?"red":void 0,children:(i==null?void 0:i.unassignedShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.relocatingShards)||0," relocating"]})]})})})]}),((i==null?void 0:i.memoryTotal)||(i==null?void 0:i.diskTotal))&&e.jsxs(Z,{children:[(i==null?void 0:i.memoryTotal)&&e.jsx(Z.Col,{span:{base:12,md:6},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(Se,{value:se(i.memoryUsed||0,i.memoryTotal),color:d(se(i.memoryUsed||0,i.memoryTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[Y(i.memoryUsed||0)," / ",Y(i.memoryTotal)," (",se(i.memoryUsed||0,i.memoryTotal),"%)"]})]})})}),(i==null?void 0:i.diskTotal)&&e.jsx(Z.Col,{span:{base:12,md:6},children:e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(Se,{value:se(i.diskUsed||0,i.diskTotal),color:d(se(i.diskUsed||0,i.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[Y(i.diskUsed||0)," / ",Y(i.diskTotal)," (",se(i.diskUsed||0,i.diskTotal),"%)"]})]})})})]}),e.jsx(J,{shadow:"sm",padding:"lg",children:e.jsxs(W,{value:f,onChange:q,children:[e.jsxs(W.List,{children:[e.jsx(W.Tab,{value:"overview",children:"Overview"}),e.jsxs(W.Tab,{value:"nodes",children:["Nodes (",(U==null?void 0:U.length)||0,")"]}),e.jsxs(W.Tab,{value:"indices",children:["Indices (",(N==null?void 0:N.length)||0,")"]}),e.jsxs(W.Tab,{value:"shards",children:["Shards (",(K==null?void 0:K.length)||0,")"]})]}),e.jsx(W.Panel,{value:"overview",pt:"md",children:e.jsx(Ns,{nodes:U,indices:N,shards:K,loading:c||G||V,error:C||j||Q,openIndexModal:T})}),e.jsx(W.Panel,{value:"nodes",pt:"md",children:e.jsx($s,{nodes:U,loading:c,error:C})}),e.jsx(W.Panel,{value:"indices",pt:"md",children:e.jsx(Ps,{indices:N,loading:G,error:j,openIndexModal:T})}),e.jsx(W.Panel,{value:"shards",pt:"md",children:e.jsx(Ls,{shards:K,loading:V,error:Q})})]})}),D&&e.jsx(Te,{opened:y,onClose:P,size:"90%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column",padding:0},content:{display:"flex",flexDirection:"column"}},withCloseButton:!0,children:e.jsx("div",{style:{flex:1,overflow:"auto",padding:"var(--mantine-spacing-md)"},children:e.jsx(Ms,{})})})]}):e.jsx(v,{p:"md",children:e.jsx(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function $s({nodes:s,loading:n,error:t}){var q;const{id:h}=xe(),d=Fe(),[f,m]=ge(),{getColor:u}=Je(h),y=f.get("nodesSearch")||"",$=((q=f.get("roles"))==null?void 0:q.split(",").filter(Boolean))||[],D=Me(y,300),F=(g,i)=>{const S=new URLSearchParams(f);g!==void 0&&(g?S.set("nodesSearch",g):S.delete("nodesSearch")),i!==void 0&&(i.length>0?S.set("roles",i.join(",")):S.delete("roles")),m(S)},T=Array.from(new Set((s==null?void 0:s.flatMap(g=>g.roles))||[])),P=s==null?void 0:s.filter(g=>{var R;const i=g.name.toLowerCase().includes(D.toLowerCase())||((R=g.ip)==null?void 0:R.toLowerCase().includes(D.toLowerCase())),S=$.length===0||$.some(U=>g.roles.includes(U));return i&&S});return n?e.jsxs(v,{gap:"xs",children:[e.jsx(I,{height:60,radius:"sm"}),e.jsx(I,{height:60,radius:"sm"}),e.jsx(I,{height:60,radius:"sm"})]}):t?e.jsxs(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",t.message]}):!s||s.length===0?e.jsx(a,{c:"dimmed",children:"No nodes found"}):e.jsxs(v,{gap:"md",children:[e.jsxs(b,{children:[e.jsx(be,{placeholder:"Search nodes...",leftSection:e.jsx(Ee,{size:16}),value:y,onChange:g=>F(g.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(Ie,{placeholder:"Filter by roles",data:T,value:$,onChange:g=>F(void 0,g),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),P&&P.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(pe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Roles"}),e.jsx(o.Th,{children:"Heap Usage"}),e.jsx(o.Th,{children:"Disk Usage"}),e.jsx(o.Th,{children:"CPU"})]})}),e.jsx(o.Tbody,{children:P==null?void 0:P.map(g=>e.jsxs(o.Tr,{style:{cursor:"pointer"},onClick:()=>d(`/cluster/${h}/nodes/${g.id}`),children:[e.jsxs(o.Td,{children:[e.jsx(a,{size:"sm",fw:500,children:g.name}),g.ip&&e.jsx(a,{size:"xs",c:"dimmed",children:g.ip})]}),e.jsx(o.Td,{children:e.jsx(b,{gap:"xs",children:g.roles.map(i=>e.jsx(H,{size:"sm",variant:"light",children:i},i))})}),e.jsx(o.Td,{children:e.jsxs(v,{gap:4,children:[e.jsx(Se,{value:se(g.heapUsed,g.heapMax),color:u(se(g.heapUsed,g.heapMax)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[Y(g.heapUsed)," / ",Y(g.heapMax)]})]})}),e.jsx(o.Td,{children:e.jsxs(v,{gap:4,children:[e.jsx(Se,{value:se(g.diskUsed,g.diskTotal),color:u(se(g.diskUsed,g.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[Y(g.diskUsed)," / ",Y(g.diskTotal)]})]})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:g.cpuPercent!==void 0?`${g.cpuPercent}%`:"N/A"})})]},g.id))})]})})]})}function Ps({indices:s,loading:n,error:t,openIndexModal:h}){var O,B;const{id:d}=xe(),f=Fe(),m=ke(),[u,y]=ge(),$=u.get("indicesSearch")||"",D=((O=u.get("health"))==null?void 0:O.split(",").filter(Boolean))||[],F=((B=u.get("status"))==null?void 0:B.split(",").filter(Boolean))||[],T=u.get("expanded")==="true",P=u.get("sort")!=="desc",q=u.get("affected")==="true",g=Me($,300),{data:i}=oe({queryKey:["cluster",d,"shards"],queryFn:()=>A.getShards(d),enabled:!!d}),{data:S}=oe({queryKey:["cluster",d,"settings"],queryFn:async()=>await A.proxyRequest(d,"GET","/_cluster/settings"),enabled:!!d}),R=(()=>{var fe,ce;if(!S)return!0;const l=S.transient,r=S.persistent,p=l==null?void 0:l.cluster,x=r==null?void 0:r.cluster,L=p==null?void 0:p.routing,k=x==null?void 0:x.routing,ae=(fe=L==null?void 0:L.allocation)==null?void 0:fe.enable,je=(ce=k==null?void 0:k.allocation)==null?void 0:ce.enable;return(ae||je||"all")==="all"})(),U=X({mutationFn:()=>A.proxyRequest(d,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{m.invalidateQueries({queryKey:["cluster",d,"settings"]}),E.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:l=>{E.show({title:"Error",message:`Failed to enable shard allocation: ${l.message}`,color:"red"})}}),c=X({mutationFn:l=>A.proxyRequest(d,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":l}}),onSuccess:()=>{m.invalidateQueries({queryKey:["cluster",d,"settings"]}),E.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:l=>{E.show({title:"Error",message:`Failed to disable shard allocation: ${l.message}`,color:"red"})}}),C=(l,r,p)=>{const x=new URLSearchParams(u);l!==void 0&&(l?x.set("indicesSearch",l):x.delete("indicesSearch")),r!==void 0&&(r.length>0?x.set("health",r.join(",")):x.delete("health")),p!==void 0&&(p.length>0?x.set("status",p.join(",")):x.delete("status")),y(x)},N=(l,r)=>{const p=new URLSearchParams(u);r===""||r===!1?p.delete(l):p.set(l,String(r)),y(p)},G=(i==null?void 0:i.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}))||{},j=(i==null?void 0:i.filter(l=>l.state==="UNASSIGNED"))||[],K=j.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}),V=l=>(G[l]||[]).some(p=>p.state==="UNASSIGNED"||p.state==="RELOCATING"||p.state==="INITIALIZING");let Q=s==null?void 0:s.filter(l=>{const r=l.name.toLowerCase().includes(g.toLowerCase()),p=D.length===0||D.includes(l.health),x=F.length===0||F.includes(l.status),L=!q||V(l.name);return r&&p&&x&&L});if(Q&&(Q=[...Q].sort((l,r)=>P?l.name.localeCompare(r.name):r.name.localeCompare(l.name))),n)return e.jsxs(v,{gap:"xs",children:[e.jsx(I,{height:60,radius:"sm"}),e.jsx(I,{height:60,radius:"sm"}),e.jsx(I,{height:60,radius:"sm"})]});if(t)return e.jsxs(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",t.message]});if(!s||s.length===0)return e.jsxs(v,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No indices found"}),d&&e.jsx(te,{leftSection:e.jsx(qe,{size:16}),onClick:()=>f(`/cluster/${d}/indices/create`),children:"Create Index"})]});const ie=j.length>0;return e.jsxs(v,{gap:"md",children:[e.jsxs(b,{justify:"space-between",wrap:"wrap",children:[e.jsxs(b,{children:[R?e.jsxs(z,{shadow:"md",width:200,children:[e.jsx(z.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:c.isPending,children:e.jsx(Ve,{size:20})})})}),e.jsxs(z.Dropdown,{children:[e.jsx(z.Label,{children:"Disable Allocation"}),e.jsx(z.Item,{onClick:()=>c.mutate("none"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(z.Item,{onClick:()=>c.mutate("primaries"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(z.Item,{onClick:()=>c.mutate("new_primaries"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>U.mutate(),loading:U.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:T?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>N("expanded",!T),children:T?e.jsx(Ze,{size:20}):e.jsx(Ye,{size:20})})}),e.jsx(re,{label:P?"Sort descending":"Sort ascending",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>N("sort",P?"desc":"asc"),children:P?e.jsx(ys,{size:20}):e.jsx(vs,{size:20})})})]}),e.jsxs(b,{style:{flex:1},children:[e.jsx(be,{placeholder:"Search indices...",leftSection:e.jsx(Ee,{size:16}),value:$,onChange:l=>C(l.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(Ie,{placeholder:"Health",data:["green","yellow","red"],value:D,onChange:l=>C(void 0,l,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(Ie,{placeholder:"Status",data:["open","close"],value:F,onChange:l=>C(void 0,void 0,l),clearable:!0,style:{maxWidth:150}}),ie&&e.jsx(ue,{label:"Show only affected",checked:q,onChange:l=>N("affected",l.currentTarget.checked),size:"sm"})]}),d&&e.jsx(te,{leftSection:e.jsx(qe,{size:16}),onClick:()=>f(`/cluster/${d}/indices/create`),children:"Create Index"})]}),Q&&Q.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(pe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Health"}),e.jsx(o.Th,{children:"Status"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"}),e.jsx(o.Th,{children:"Shards"}),T&&e.jsx(o.Th,{children:"Primaries"}),T&&e.jsx(o.Th,{children:"Replicas"}),e.jsx(o.Th,{children:"Unassigned"}),e.jsx(o.Th,{children:"Actions"})]})}),e.jsx(o.Tbody,{children:Q==null?void 0:Q.map(l=>{var x;const r=((x=K[l.name])==null?void 0:x.length)||0,p=r>0;return e.jsxs(o.Tr,{style:{cursor:"pointer",backgroundColor:p?"rgba(250, 82, 82, 0.1)":void 0},onClick:()=>h(l.name),children:[e.jsx(o.Td,{children:e.jsxs(v,{gap:2,children:[e.jsx(a,{size:"sm",fw:500,style:{textDecoration:"underline"},children:l.name}),T&&V(l.name)&&e.jsx(H,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(o.Td,{children:e.jsx(H,{size:"sm",color:Oe(l.health),children:l.health})}),e.jsx(o.Td,{children:e.jsx(H,{size:"sm",variant:"light",color:l.status==="open"?"green":"gray",children:l.status})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.docsCount.toLocaleString()})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:Y(l.storeSize)})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:T?`${l.primaryShards+l.replicaShards}`:`${l.primaryShards}p / ${l.replicaShards}r`})}),T&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.primaryShards})}),T&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.replicaShards})}),e.jsx(o.Td,{children:r>0?e.jsx(H,{size:"sm",color:"red",variant:"filled",children:r}):e.jsx(a,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(o.Td,{onClick:L=>L.stopPropagation(),children:e.jsxs(b,{gap:"xs",children:[d&&e.jsx(Es,{clusterId:d,index:l}),e.jsxs(z,{shadow:"md",width:200,children:[e.jsx(z.Target,{children:e.jsx(le,{variant:"subtle",color:"gray",children:e.jsx(rs,{size:16})})}),e.jsxs(z.Dropdown,{children:[e.jsx(z.Label,{children:"Index Management"}),e.jsx(z.Item,{leftSection:e.jsx(We,{size:14}),onClick:L=>{L.stopPropagation(),h(l.name,"settings")},children:"Settings"}),e.jsx(z.Item,{leftSection:e.jsx(Ke,{size:14}),onClick:L=>{L.stopPropagation(),h(l.name,"mappings")},children:"Mappings"})]})]})]})})]},l.name)})})]})})]})}function ns({shard:s,opened:n,onClose:t,clusterId:h}){const[d,f]=M.useState(null),[m,u]=M.useState(!1);return M.useEffect(()=>{n&&s?(u(!0),f(null),console.log("Fetching shard stats:",{clusterId:h,index:s.index,shard:s.shard}),A.getShardStats(h,s.index,s.shard).then(y=>{console.log("Received shard stats:",y),f(y)}).catch(y=>{console.error("Failed to fetch shard stats:",y),f(s)}).finally(()=>{u(!1)})):n||(f(null),u(!1))},[n,s==null?void 0:s.index,s==null?void 0:s.shard,h]),s?e.jsx(Te,{opened:n,onClose:t,title:e.jsxs(b,{gap:"xs",children:[e.jsx(a,{size:"lg",fw:600,children:"Shard Details:"}),e.jsx(H,{size:"lg",variant:"light",color:"blue",children:s.index}),e.jsx(a,{size:"lg",c:"dimmed",children:"/"}),e.jsxs(H,{size:"lg",variant:"filled",color:"cyan",children:["#",s.shard]}),e.jsx(H,{size:"lg",variant:s.primary?"filled":"light",color:s.primary?"green":"gray",children:s.primary?"Primary":"Replica"})]}),size:"80%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"}},children:e.jsx(pe,{style:{flex:1},children:m?e.jsxs(v,{gap:"xs",children:[e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,width:"70%",radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,width:"50%",radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,radius:"xs"}),e.jsx(I,{height:20,width:"80%",radius:"xs"})]}):e.jsx(Qe,{block:!0,children:JSON.stringify(d||s,null,2)})})}):null}function Ns({nodes:s,indices:n,shards:t,loading:h,error:d,openIndexModal:f}){const{id:m}=xe(),u=ke(),[y,$]=ge(),[D,F]=M.useState(null),[T,P]=M.useState(!1),q=y.get("overviewSearch")||"",g=y.get("showClosed")==="true",i=y.get("showSpecial")==="true",S=y.get("overviewExpanded")==="true",R=y.get("overviewAffected")==="true",U=Me(q,300),c=r=>{F(r),P(!0)},C=(r,p)=>{const x=new URLSearchParams(y);p===""||p===!1?x.delete(r):x.set(r,String(p)),$(x)},{data:N}=oe({queryKey:["cluster",m,"settings"],queryFn:async()=>await A.proxyRequest(m,"GET","/_cluster/settings"),enabled:!!m}),G=(()=>{var ce,ye;if(!N)return!0;const r=N.transient,p=N.persistent,x=r==null?void 0:r.cluster,L=p==null?void 0:p.cluster,k=x==null?void 0:x.routing,ae=L==null?void 0:L.routing,je=(ce=k==null?void 0:k.allocation)==null?void 0:ce.enable,Ce=(ye=ae==null?void 0:ae.allocation)==null?void 0:ye.enable;return(je||Ce||"all")==="all"})(),j=X({mutationFn:()=>A.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",m,"settings"]}),E.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:r=>{E.show({title:"Error",message:`Failed to enable shard allocation: ${r.message}`,color:"red"})}}),K=X({mutationFn:r=>A.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":r}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",m,"settings"]}),E.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:r=>{E.show({title:"Error",message:`Failed to disable shard allocation: ${r.message}`,color:"red"})}});if(h)return e.jsxs(v,{gap:"xs",children:[e.jsx(I,{height:40,radius:"sm"}),e.jsx(I,{height:200,radius:"sm"})]});if(d)return e.jsxs(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",d.message]});if(!s||!n||!t||s.length===0||n.length===0)return e.jsx(v,{gap:"md",align:"center",py:"xl",children:e.jsx(a,{c:"dimmed",children:"No shard allocation data available"})});const V=t.filter(r=>r.state==="UNASSIGNED"),Q=V.reduce((r,p)=>(r[p.index]||(r[p.index]=[]),r[p.index].push(p),r),{}),ie=r=>t.filter(x=>x.index===r).some(x=>x.state==="UNASSIGNED"||x.state==="RELOCATING"||x.state==="INITIALIZING");let O=n.filter(r=>{const p=r.name.toLowerCase().includes(U.toLowerCase()),x=g||r.status==="open",L=i||!r.name.startsWith("."),k=!R||ie(r.name);return p&&x&&L&&k});const B=new Map;s.forEach(r=>{B.set(r.id,r.name),B.set(r.name,r.name),r.ip&&B.set(r.ip,r.name)});const l=new Map;return t.forEach(r=>{if(!r.node)return;const p=B.get(r.node);if(!p)return;l.has(p)||l.set(p,new Map);const x=l.get(p);x.has(r.index)||x.set(r.index,[]),x.get(r.index).push(r)}),e.jsxs(v,{gap:"md",children:[e.jsx(ns,{shard:D,opened:T,onClose:()=>P(!1),clusterId:m}),e.jsxs(b,{justify:"space-between",wrap:"wrap",children:[e.jsxs(b,{children:[G?e.jsxs(z,{shadow:"md",width:200,children:[e.jsx(z.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:K.isPending,children:e.jsx(Ve,{size:20})})})}),e.jsxs(z.Dropdown,{children:[e.jsx(z.Label,{children:"Disable Allocation"}),e.jsx(z.Item,{onClick:()=>K.mutate("none"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(z.Item,{onClick:()=>K.mutate("primaries"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(z.Item,{onClick:()=>K.mutate("new_primaries"),children:e.jsxs(b,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>j.mutate(),loading:j.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:S?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>C("overviewExpanded",!S),children:S?e.jsx(Ze,{size:20}):e.jsx(Ye,{size:20})})})]}),e.jsxs(b,{style:{flex:1},children:[e.jsx(be,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(Ee,{size:16}),value:q,onChange:r=>C("overviewSearch",r.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(b,{gap:"md",children:[e.jsx(ue,{label:`closed (${n.filter(r=>r.status!=="open").length})`,checked:g,onChange:r=>C("showClosed",r.currentTarget.checked),size:"sm"}),e.jsx(ue,{label:`special (${n.filter(r=>r.name.startsWith(".")).length})`,checked:i,onChange:r=>C("showSpecial",r.currentTarget.checked),size:"sm"}),V.length>0&&e.jsx(ue,{label:"Show only affected",checked:R,onChange:r=>C("overviewAffected",r.currentTarget.checked),size:"sm"}),e.jsxs(a,{size:"sm",c:"dimmed",children:[O.length," of ",n.length]})]})]})]}),e.jsxs(b,{gap:"md",children:[e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:s.length})," nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:O.length})," indices"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:t.length})," shards"]}),V.length>0&&e.jsxs(H,{color:"red",variant:"filled",children:[V.length," unassigned"]})]}),e.jsx(pe,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(o,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),O.map(r=>e.jsx(o.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(v,{gap:4,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:p=>{p.stopPropagation(),f(r.name)},children:r.name}),e.jsxs(b,{gap:4,justify:"center",children:[e.jsxs(H,{size:"xs",color:Oe(r.health),variant:"dot",children:[r.primaryShards,"Ã—",r.replicaShards+1]}),e.jsx(a,{size:"xs",c:"dimmed",children:Y(r.storeSize)})]})]})},r.name))]})}),e.jsxs(o.Tbody,{children:[V.length>0&&e.jsxs(o.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(v,{gap:2,children:[e.jsx(a,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(H,{size:"xs",color:"red",variant:"filled",children:V.length})]})}),O.map(r=>{const p=Q[r.name]||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Ge(r.health)},children:p.length>0?e.jsx(b,{gap:2,justify:"center",wrap:"wrap",children:p.map((x,L)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",x.shard]}),e.jsxs("div",{children:["Type: ",x.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",x.state]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:x.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)",cursor:"pointer"},onClick:()=>c(x),children:x.shard})},`unassigned-${x.index}-${x.shard}-${L}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${r.name}`)})]}),s.map(r=>{const p=l.get(r.name);return e.jsxs(o.Tr,{children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(v,{gap:4,children:[e.jsx(b,{gap:4,children:e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,children:r.name})}),e.jsx(a,{size:"xs",c:"dimmed",truncate:"end",title:r.ip,children:r.ip}),S&&e.jsxs(e.Fragment,{children:[e.jsx(b,{gap:4,wrap:"wrap",children:r.roles.map(x=>e.jsx(H,{size:"xs",variant:"light",color:"gray",children:x},x))}),e.jsxs(b,{gap:4,wrap:"wrap",children:[e.jsx(H,{size:"xs",color:"teal",variant:"filled",children:r.id.substring(0,8)}),e.jsx(H,{size:"xs",color:"teal",variant:"filled",children:r.roles.length}),e.jsx(H,{size:"xs",color:"teal",variant:"filled",children:Y(r.heapMax)}),e.jsx(H,{size:"xs",color:"teal",variant:"filled",children:Y(r.diskTotal)}),r.cpuPercent!==void 0&&e.jsxs(H,{size:"xs",color:"teal",variant:"filled",children:[r.cpuPercent,"%"]})]})]})]})}),O.map(x=>{const L=(p==null?void 0:p.get(x.name))||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Ge(x.health)},children:L.length>0?e.jsx(b,{gap:2,justify:"center",wrap:"wrap",children:L.map((k,ae)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",k.shard]}),e.jsxs("div",{children:["Type: ",k.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",k.state]}),e.jsxs("div",{children:["Node: ",k.node||"N/A"]}),k.docs!==void 0&&k.docs!==null&&e.jsxs("div",{children:["Docs: ",k.docs.toLocaleString()]}),k.store!==void 0&&k.store!==null&&e.jsxs("div",{children:["Size: ",Y(k.store)]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:k.state==="STARTED"?k.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":k.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:k.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)",cursor:"pointer"},onClick:()=>c(k),children:k.shard})},`${k.shard}-${k.primary}-${ae}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`${r.id}-${x.name}`)})]},r.id)})]})]})})})]})}function Ls({shards:s,loading:n,error:t}){var U;const{id:h}=xe(),[d,f]=ge(),[m,u]=M.useState(!1),[y,$]=M.useState(null),D=d.get("shardsSearch")||"",F=((U=d.get("shardStates"))==null?void 0:U.split(",").filter(Boolean))||[],T=d.get("primaryOnly")==="true",P=d.get("replicaOnly")==="true",q=Me(D,300),g=c=>{$(c),u(!0)},i=(c,C,N,G)=>{const j=new URLSearchParams(d);c!==void 0&&(c?j.set("shardsSearch",c):j.delete("shardsSearch")),C!==void 0&&(C.length>0?j.set("shardStates",C.join(",")):j.delete("shardStates")),N!==void 0&&(N?(j.set("primaryOnly","true"),j.delete("replicaOnly")):j.delete("primaryOnly")),G!==void 0&&(G?(j.set("replicaOnly","true"),j.delete("primaryOnly")):j.delete("replicaOnly")),f(j)},S=s==null?void 0:s.filter(c=>{var j;const C=c.index.toLowerCase().includes(q.toLowerCase())||((j=c.node)==null?void 0:j.toLowerCase().includes(q.toLowerCase())),N=F.length===0||F.includes(c.state),G=!T&&!P||T&&c.primary||P&&!c.primary;return C&&N&&G});if(n)return e.jsxs(v,{gap:"xs",children:[e.jsx(I,{height:40,radius:"sm"}),e.jsx(I,{height:200,radius:"sm"})]});if(t)return e.jsxs(ee,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",t.message]});if(!s||s.length===0)return e.jsx(a,{c:"dimmed",children:"No shards found"});const R=(S||[]).reduce((c,C)=>(c[C.state]||(c[C.state]=[]),c[C.state].push(C),c),{});return e.jsxs(v,{gap:"md",children:[e.jsxs(b,{wrap:"wrap",children:[e.jsx(be,{placeholder:"Search by index or node...",leftSection:e.jsx(Ee,{size:16}),value:D,onChange:c=>i(c.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(Ie,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:F,onChange:c=>i(void 0,c,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(b,{gap:"md",children:[e.jsx(ue,{label:"Primary only",checked:T,onChange:c=>i(void 0,void 0,c.currentTarget.checked,void 0),size:"sm"}),e.jsx(ue,{label:"Replica only",checked:P,onChange:c=>i(void 0,void 0,void 0,c.currentTarget.checked),size:"sm"})]})]}),e.jsx(Z,{children:Object.entries(R).map(([c,C])=>e.jsx(Z.Col,{span:{base:12,sm:6,md:3},children:e.jsx(J,{shadow:"sm",padding:"md",children:e.jsxs(v,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:c}),e.jsx(a,{size:"xl",fw:700,children:C.length})]})})},c))}),S&&S.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(pe,{children:[e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Index"}),e.jsx(o.Th,{children:"Shard"}),e.jsx(o.Th,{children:"Type"}),e.jsx(o.Th,{children:"State"}),e.jsx(o.Th,{children:"Node"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"})]})}),e.jsx(o.Tbody,{children:S==null?void 0:S.slice(0,100).map((c,C)=>{const N=c.state==="UNASSIGNED";return e.jsxs(o.Tr,{style:{backgroundColor:N?"rgba(250, 82, 82, 0.1)":void 0,cursor:"pointer"},onClick:()=>g(c),children:[e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:c.index})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:c.shard})}),e.jsx(o.Td,{children:e.jsx(H,{size:"sm",variant:"light",color:c.primary?"blue":"gray",children:c.primary?"Primary":"Replica"})}),e.jsx(o.Td,{children:e.jsx(H,{size:"sm",color:c.state==="STARTED"?"green":c.state==="UNASSIGNED"?"red":"yellow",children:c.state})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:c.node||"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:c.docs!==void 0&&c.docs!==null?c.docs.toLocaleString():"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:c.store!==void 0&&c.store!==null?Y(c.store):"N/A"})})]},`${c.index}-${c.shard}-${C}`)})})]}),S&&S.length>100&&e.jsxs(a,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",S.length," shards"]})]}),y&&e.jsx(ns,{opened:m,onClose:()=>{u(!1),$(null)},shard:y,clusterId:h})]})}export{rr as ClusterView};
