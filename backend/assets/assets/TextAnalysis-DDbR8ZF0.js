import{O as K,r as n,k as P,j as e,A as b,I as C,G as x,l as r,L as M,S as m,af as S,a2 as H,X as Q,J as L,m as v}from"./index-D9p-S4j3.js";import{u as X}from"./useMutation-Dnl0VJUE.js";import{C as N}from"./Container-BLElaGDI.js";import{T as U}from"./Title-BgPKmf03.js";import{B as _}from"./Button-DhtsN_8-.js";import{C as A}from"./Card-DjT2VkHf.js";import{T as Y}from"./Textarea-CJdVKR3A.js";import{A as p}from"./Accordion-C_RjnDrU.js";import{T as F}from"./TextInput-D7fWum6L.js";import{B as $}from"./Badge-DSLwXx2x.js";import{T as t}from"./Table-HE1s7VT4.js";import{C as Z}from"./Code-B9-vXWcv.js";import"./get-safe-id-Bp3H8K0-.js";const V=["standard","simple","whitespace","stop","keyword","pattern","language","fingerprint"];function xe(){const{id:l}=K(),[f,w]=n.useState(""),[k,I]=n.useState("standard"),[u,O]=n.useState(!1),[i,E]=n.useState(""),[g,y]=n.useState(""),[a,R]=n.useState(""),[d,q]=n.useState(""),[o,B]=n.useState(""),{data:z}=P({queryKey:["cluster",l,"indices"],queryFn:()=>v.getIndices(l),enabled:!!l&&u}),{data:T}=P({queryKey:["cluster",l,"index",i,"fields"],queryFn:()=>v.getIndexFields(l,i),enabled:!!l&&!!i&&u}),c=X({mutationFn:s=>v.analyzeText(l,s),onError:s=>{L.show({title:"Error",message:`Failed to analyze text: ${s.message}`,color:"red"})}}),D=()=>{if(!f.trim()){L.show({title:"Error",message:"Please enter text to analyze",color:"red"});return}const s={text:f};u&&i&&g?(s.index=i,s.field=g):a||d||o?(a&&(s.tokenizer=a),d&&(s.filter=d.split(",").map(h=>h.trim()).filter(Boolean)),o&&(s.charFilter=o.split(",").map(h=>h.trim()).filter(Boolean))):s.analyzer=k,c.mutate(s)},G=()=>{w(""),I("standard"),O(!1),E(""),y(""),R(""),q(""),B(""),c.reset()};return l?e.jsxs(N,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(U,{order:2,children:"Text Analysis"}),e.jsx(r,{size:"sm",c:"dimmed",children:"Test and debug search analysis chains"})]}),e.jsx(_,{leftSection:e.jsx(M,{size:16}),variant:"light",onClick:G,children:"Reset"})]}),e.jsxs(m,{gap:"md",children:[e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsx(Y,{label:"Text to Analyze",placeholder:"Enter text to analyze...",value:f,onChange:s=>w(s.currentTarget.value),minRows:4,maxRows:8,required:!0}),e.jsxs(x,{grow:!0,align:"flex-start",children:[e.jsx(S,{label:"Analyzer",placeholder:"Select analyzer",value:k,onChange:s=>I(s||"standard"),data:V,disabled:u||!!a}),e.jsx(S,{label:"Use Field Analyzer",placeholder:"Select index",value:i,onChange:s=>{E(s||""),y(""),O(!!s)},data:(z==null?void 0:z.map(s=>({value:s.name,label:s.name})))||[],searchable:!0,clearable:!0,disabled:!!a}),i&&e.jsx(S,{label:"Field",placeholder:"Select field",value:g,onChange:s=>y(s||""),data:(T==null?void 0:T.fields.filter(s=>s.analyzer||s.type==="text").map(s=>({value:s.name,label:`${s.name} (${s.analyzer||"default"})`})))||[],searchable:!0,clearable:!0})]}),e.jsx(p,{variant:"contained",children:e.jsxs(p.Item,{value:"custom",children:[e.jsx(p.Control,{children:e.jsx(r,{size:"sm",fw:500,children:"Custom Analyzer Definition"})}),e.jsx(p.Panel,{children:e.jsxs(m,{gap:"sm",children:[e.jsx(b,{icon:e.jsx(C,{size:16}),color:"blue",variant:"light",children:e.jsx(r,{size:"sm",children:"Define a custom analyzer by specifying tokenizer and filters. This will override the selected analyzer."})}),e.jsx(F,{label:"Tokenizer",placeholder:"e.g., standard, whitespace, keyword",value:a,onChange:s=>R(s.currentTarget.value)}),e.jsx(F,{label:"Token Filters (comma-separated)",placeholder:"e.g., lowercase, stop, snowball",value:d,onChange:s=>q(s.currentTarget.value)}),e.jsx(F,{label:"Character Filters (comma-separated)",placeholder:"e.g., html_strip, mapping",value:o,onChange:s=>B(s.currentTarget.value)})]})})]})}),e.jsx(x,{justify:"flex-end",children:e.jsx(_,{leftSection:e.jsx(H,{size:16}),onClick:D,loading:c.isPending,children:"Analyze"})})]})}),c.data&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(U,{order:3,children:"Analysis Results"}),e.jsxs($,{size:"lg",variant:"light",children:[c.data.tokens.length," tokens"]})]}),(a||d||o)&&e.jsx(b,{icon:e.jsx(C,{size:16}),color:"blue",variant:"light",children:e.jsxs(m,{gap:"xs",children:[e.jsx(r,{size:"sm",fw:500,children:"Analyzer Chain:"}),o&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Char Filters:"})," ",o]}),a&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Tokenizer:"})," ",a]}),d&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Token Filters:"})," ",d]})]})}),e.jsxs(t,{striped:!0,highlightOnHover:!0,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Position"}),e.jsx(t.Th,{children:"Token"}),e.jsx(t.Th,{children:"Type"}),e.jsx(t.Th,{children:"Start Offset"}),e.jsx(t.Th,{children:"End Offset"}),e.jsx(t.Th,{children:"Attributes"})]})}),e.jsx(t.Tbody,{children:c.data.tokens.map((s,h)=>e.jsxs(t.Tr,{children:[e.jsx(t.Td,{children:e.jsx($,{variant:"light",children:s.position})}),e.jsx(t.Td,{children:e.jsx(Z,{children:s.token})}),e.jsx(t.Td,{children:e.jsx(r,{size:"sm",c:"dimmed",children:s.type})}),e.jsx(t.Td,{children:s.startOffset}),e.jsx(t.Td,{children:s.endOffset}),e.jsx(t.Td,{children:Object.entries(s).filter(([j])=>!["token","startOffset","endOffset","type","position","positionLength"].includes(j)).map(([j,J])=>e.jsxs(r,{size:"xs",c:"dimmed",children:[j,": ",JSON.stringify(J)]},j))})]},h))})]})]})}),c.isPending&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(x,{justify:"center",children:[e.jsx(Q,{size:"lg"}),e.jsx(r,{children:"Analyzing text..."})]})})]})]}):e.jsx(N,{size:"xl",children:e.jsx(b,{icon:e.jsx(C,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{xe as TextAnalysisPage};
