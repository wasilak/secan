import{r as n,k as N,W as U,j as e,X as G,c as B,K as $,a as J,f as _,D as j,T as W,S as M,Y as H,G as x,d as f,Z as A,A as X,I as Y,E,F as T,P as K}from"./index-BZ5qcqgZ.js";import{C as Z}from"./Container-B0S22S8r.js";import{G as z}from"./Grid-B-E8KiU0.js";import{B as Q}from"./Button-524yZMYQ.js";import{B as O}from"./Badge-DoCvKydO.js";import{I as V}from"./IconTrash-CzwGVaIA.js";import{I as ee}from"./IconClock-BSwM3_HA.js";const se={multiple:!1},D=n.forwardRef((l,t)=>{const{onChange:a,children:i,multiple:d,accept:C,name:h,form:u,resetRef:b,disabled:k,capture:w,inputProps:v,...p}=N("FileButton",se,l),m=n.useRef(null),S=()=>{var y;!k&&((y=m.current)==null||y.click())},I=y=>{a(d?Array.from(y.currentTarget.files):y.currentTarget.files[0]||null)};return U(b,()=>{m.current&&(m.current.value="")}),e.jsxs(e.Fragment,{children:[e.jsx("input",{style:{display:"none"},type:"file",accept:C,multiple:d,onChange:I,ref:G(t,m),name:h,form:u,capture:w,...v}),i({onClick:S,...p})]})});D.displayName="@mantine/core/FileButton";var te=B("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),re=B("player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]),oe=B("upload","IconUpload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);function ne(l){const t=l.trim().split(`
`);if(t.length===0)return null;const i=t[0].trim().split(/\s+/);if(i.length<2)return null;const d=i[0].toUpperCase(),C=i[1];if(!["GET","POST","PUT","DELETE","HEAD","PATCH"].includes(d))return null;const u=t.slice(1).join(`
`).trim();return{method:d,path:C,body:u||void 0}}function le(l){try{return JSON.stringify(l,null,2)}catch{return String(l)}}function me(){const{id:l}=$(),{preferences:t,updatePreference:a}=J(),[i,d]=n.useState("GET _cluster/health"),[C,h]=n.useState(""),[u,b]=n.useState(null),[k,w]=n.useState(!1),[v,p]=n.useState(null),m=100,S=n.useCallback(async()=>{if(!l)return;const s=ne(i);if(!s){p("Invalid request format. Use: METHOD endpoint");return}w(!0),p(null),h(""),b(null);try{let r;if(s.body)try{r=JSON.parse(s.body)}catch{p("Invalid JSON in request body"),w(!1);return}const c=await _.proxyRequest(l,s.method,s.path,r),o=le(c);h(o),b(200);const P=[{timestamp:Date.now(),method:s.method,path:s.path,body:s.body,response:o},...t.restConsoleHistory].slice(0,m);a("restConsoleHistory",P),j.show({title:"Success",message:"Request executed successfully",color:"green"})}catch(r){const c=r,o=c.message||"Request failed";p(o),b(c.status||0),h(o),j.show({title:"Error",message:o,color:"red"})}finally{w(!1)}},[l,i,t.restConsoleHistory,a]),I=n.useCallback(s=>{const r=s.body?`${s.method} ${s.path}
${s.body}`:`${s.method} ${s.path}`;d(r),s.response&&h(s.response)},[]),L=n.useCallback(()=>{a("restConsoleHistory",[]),j.show({title:"History Cleared",message:"Request history has been cleared",color:"blue"})},[a]),y=n.useCallback(()=>{const s=JSON.stringify(t.restConsoleHistory,null,2),r=new Blob([s],{type:"application/json"}),c=URL.createObjectURL(r),o=document.createElement("a");o.href=c,o.download=`cerebro-rest-history-${Date.now()}.json`,o.click(),URL.revokeObjectURL(c),j.show({title:"Exported",message:"Request history exported successfully",color:"green"})},[t.restConsoleHistory]),F=n.useCallback(s=>{if(!s)return;const r=new FileReader;r.onload=c=>{var o;try{const R=(o=c.target)==null?void 0:o.result,g=JSON.parse(R);if(!Array.isArray(g))throw new Error("Invalid format: expected array");const q=[...g,...t.restConsoleHistory].slice(0,m);a("restConsoleHistory",q),j.show({title:"Imported",message:`Imported ${g.length} requests`,color:"green"})}catch(R){const g=R;j.show({title:"Import Failed",message:g.message||"Failed to import history",color:"red"})}},r.readAsText(s)},[t.restConsoleHistory,a]);return e.jsxs(Z,{size:"xl",py:"md",children:[e.jsxs(W,{order:2,mb:"md",children:["REST Console - Cluster: ",l]}),e.jsxs(z,{gutter:"md",children:[e.jsx(z.Col,{span:{base:12,md:8},children:e.jsxs(M,{gap:"md",children:[e.jsxs(H,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"xs",children:[e.jsx(f,{fw:500,children:"Request"}),e.jsx(Q,{leftSection:e.jsx(re,{size:16}),onClick:S,loading:k,size:"sm",children:"Execute"})]}),e.jsx(f,{size:"xs",c:"dimmed",mb:"xs",children:"Format: METHOD endpoint (e.g., GET _cluster/health)"}),e.jsx(A,{height:"200px",defaultLanguage:"plaintext",value:i,onChange:s=>d(s||""),theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:"on"}})]}),v&&e.jsx(X,{icon:e.jsx(Y,{size:16}),title:"Error",color:"red",withCloseButton:!0,onClose:()=>p(null),children:v}),e.jsxs(H,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsx(x,{justify:"space-between",mb:"xs",children:e.jsxs(x,{gap:"xs",children:[e.jsx(f,{fw:500,children:"Response"}),u!==null&&e.jsx(O,{color:u>=200&&u<300?"green":"red",variant:"light",children:u})]})}),e.jsx(A,{height:"400px",defaultLanguage:"json",value:C,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:"on"}})]})]})}),e.jsx(z.Col,{span:{base:12,md:4},children:e.jsxs(H,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsx(f,{fw:500,children:"History"}),e.jsxs(x,{gap:"xs",children:[e.jsx(D,{onChange:F,accept:"application/json",children:s=>e.jsx(E,{label:"Import",children:e.jsx(T,{...s,variant:"subtle",size:"sm",children:e.jsx(oe,{size:16})})})}),e.jsx(E,{label:"Export",children:e.jsx(T,{onClick:y,variant:"subtle",size:"sm",disabled:t.restConsoleHistory.length===0,children:e.jsx(te,{size:16})})}),e.jsx(E,{label:"Clear History",children:e.jsx(T,{onClick:L,variant:"subtle",size:"sm",color:"red",disabled:t.restConsoleHistory.length===0,children:e.jsx(V,{size:16})})})]})]}),e.jsx(K,{h:600,children:e.jsx(M,{gap:"xs",children:t.restConsoleHistory.length===0?e.jsx(f,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No history yet"}):t.restConsoleHistory.map((s,r)=>e.jsxs(H,{p:"xs",withBorder:!0,style:{cursor:"pointer"},onClick:()=>I(s),children:[e.jsxs(x,{justify:"space-between",gap:"xs",children:[e.jsx(O,{size:"sm",variant:"light",children:s.method}),e.jsxs(x,{gap:4,children:[e.jsx(ee,{size:12}),e.jsx(f,{size:"xs",c:"dimmed",children:new Date(s.timestamp).toLocaleTimeString()})]})]}),e.jsx(f,{size:"sm",mt:4,lineClamp:1,children:s.path})]},r))})})]})})]})]})}export{me as RestConsole};
