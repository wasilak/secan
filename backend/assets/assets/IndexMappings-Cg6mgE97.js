import{k as q,u as F,f as T,ah as J,r as l,a as O,j as e,G as m,L,T as R,b as r,S as w,n as v,e as z}from"./index-DcfaDkqY.js";import{u as A}from"./useMutation-zlYX3-He.js";import{F as P}from"./index-Bp5zV2Ec.js";import{C as c}from"./Container-DMlcQyHq.js";import{A as p,I as g}from"./IconAlertCircle-Dcc7bj5k.js";import{B as h}from"./Button-Bkll3Rdy.js";import{I as $}from"./IconInfoCircle-Bcd8keq_.js";import{C as B}from"./Card-shqYZ03S.js";import{I as D}from"./IconCheck-7oMzkFxH.js";function Q(s){if(!s.trim())return"Mappings cannot be empty";try{return JSON.parse(s),null}catch(n){return n.message}}function Z(){const{id:s,indexName:n}=q(),C=F(),j=T(),{resolvedTheme:I}=J(),[u,x]=l.useState(""),[f,a]=l.useState(null),[y,o]=l.useState(!1),{data:t,isLoading:M,error:b}=O({queryKey:["cluster",s,"index",n,"mappings"],queryFn:async()=>{if(!s||!n)throw new Error("Cluster ID and index name are required");return await z.proxyRequest(s,"GET",`/${n}/_mapping`)},enabled:!!s&&!!n});l.useEffect(()=>{t&&(x(JSON.stringify(t,null,2)),o(!1))},[t]);const d=A({mutationFn:async()=>{if(!s||!n)throw new Error("Cluster ID and index name are required");const i=Q(u);if(i)throw a(i),new Error(`Invalid mappings JSON: ${i}`);const N=JSON.parse(u);await z.proxyRequest(s,"PUT",`/${n}/_mapping`,N)},onSuccess:()=>{j.invalidateQueries({queryKey:["cluster",s,"index",n,"mappings"]}),j.invalidateQueries({queryKey:["cluster",s,"indices"]}),v.show({title:"Success",message:`Mappings for index "${n}" updated successfully`,color:"green",icon:e.jsx(D,{size:16})}),o(!1)},onError:i=>{v.show({title:"Error",message:i.message||"Failed to update mappings",color:"red",icon:e.jsx(g,{size:16})})}}),S=i=>{x(i||""),a(null),o(!0)},E=()=>{a(null),d.mutate()},k=()=>{t&&(x(JSON.stringify(t,null,2)),a(null),o(!1))};return!s||!n?e.jsx(c,{size:"xl",children:e.jsx(p,{icon:e.jsx(g,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})}):M?e.jsx(c,{size:"xl",children:e.jsx(m,{justify:"center",mt:"xl",children:e.jsx(L,{size:"lg"})})}):b?e.jsx(c,{size:"xl",children:e.jsxs(p,{icon:e.jsx(g,{size:16}),title:"Error",color:"red",children:["Failed to load index mappings: ",b.message]})}):e.jsxs(c,{size:"xl",py:"md",children:[e.jsxs(m,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(R,{order:1,children:"Index Mappings"}),e.jsx(r,{size:"sm",c:"dimmed",children:n})]}),e.jsx(h,{variant:"default",onClick:()=>C(`/cluster/${s}/indices`),children:"Back to Indices"})]}),e.jsxs(w,{gap:"md",children:[e.jsx(p,{icon:e.jsx($,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted.",e.jsx("br",{}),"• You can only ",e.jsx("strong",{children:"add new fields"})," to the mappings",e.jsx("br",{}),'• Field types cannot be changed once set (e.g., cannot change from "text" to "keyword")',e.jsx("br",{}),"• Fields cannot be removed from mappings",e.jsx("br",{}),"• To change field types, you must reindex your data into a new index with the correct mappings"]})}),e.jsx(B,{shadow:"sm",padding:"lg",children:e.jsxs(w,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(r,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(r,{size:"xs",c:"dimmed",mb:"sm",children:'Add new fields to the mappings below and click "Update Mappings" to apply changes'}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(P,{height:"500px",defaultLanguage:"json",value:u,onChange:S,theme:I==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),f&&e.jsx(r,{size:"sm",c:"red",mt:"xs",children:f})]}),e.jsx(p,{color:"blue",title:"Common Field Types",children:e.jsxs(r,{size:"sm",children:["• ",e.jsx("strong",{children:"text"}),": Full-text searchable fields (analyzed)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"keyword"}),": Exact-value fields (not analyzed, used for filtering, sorting, aggregations)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"integer, long, short, byte"}),": Numeric integer types",e.jsx("br",{}),"• ",e.jsx("strong",{children:"float, double"}),": Floating-point numeric types",e.jsx("br",{}),"• ",e.jsx("strong",{children:"boolean"}),": True/false values",e.jsx("br",{}),"• ",e.jsx("strong",{children:"date"}),": Date/time values",e.jsx("br",{}),"• ",e.jsx("strong",{children:"object"}),": JSON objects (nested fields)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"nested"}),": Array of objects with independent querying"]})}),e.jsxs(m,{justify:"flex-end",children:[e.jsx(h,{variant:"default",onClick:k,disabled:!y||d.isPending,children:"Reset"}),e.jsx(h,{onClick:E,loading:d.isPending,disabled:!y,children:d.isPending?"Updating...":"Update Mappings"})]})]})})]})]})}export{Z as IndexMappings};
