import{q as ls,a as Le,s as Te,j as e,P as Fe,r as E,t as os,v as De,w as ds,e as xe,x as Ee,y as k,o as R,M as C,T as re,z as le,D as cs,E as hs,F as Ie,S as w,m as a,G as f,H as ge,h as Oe,J as us,K as pe,k as oe,A as Y,I as ne,B as ue,l as Ke,N as Qe,O as Je,Q as qe,L as je,R as fe,V as Ve,i as ms,W as Me,n as o,X as Ue}from"./index-BkCsPiHX.js";import{u as Z}from"./useMutation-BONZKTDO.js";import{u as Ze}from"./useWatermarks-DqPwh6cF.js";import{u as xs}from"./accessibility-Bn8lKtCG.js";import{I as gs}from"./IconDeviceFloppy-CE6yPKfa.js";import{I as ps}from"./IconTrash-Dvtvc9wU.js";import{T as Ce}from"./TextInput-CeffpIRX.js";import{B as te}from"./Button-DqgZGZc-.js";import{N as js}from"./NumberInput-B7cERuDQ.js";import{C as ze}from"./Container-SynUn5pH.js";import{S as J,I as Xe,a as de,b as Ye,c as es,C as me}from"./IconMinimize-oipgRsnQ.js";import{C as X}from"./Card-87qFB92N.js";import{T as G}from"./Tabs-fTfkdKcR.js";import{I as fs}from"./IconCheck-BLr-cI6M.js";import{P as be}from"./Progress-DwfKaG7p.js";import{G as ee}from"./Grid-Ck1YAfRA.js";import{B}from"./Badge-Dz3BWBUi.js";import{M as ke}from"./MultiSelect-C2tB8emt.js";import{I as ys,a as vs}from"./IconSortDescending-Ce8EqRMc.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputsGroupFieldset-Bmfbo541.js";import"./get-safe-id-Bp3H8K0-.js";const[Ss,ss]=ls("HoverCard component was not found in the tree"),bs={};function rs(s){const{children:n,onMouseEnter:t,onMouseLeave:h,...c}=Le("HoverCardDropdown",bs,s),y=ss(),m=Te(t,y.openDropdown),u=Te(h,y.closeDropdown);return e.jsx(Fe.Dropdown,{onMouseEnter:m,onMouseLeave:u,...c,children:n})}rs.displayName="@mantine/core/HoverCardDropdown";const Cs={refProp:"ref"},ns=E.forwardRef((s,n)=>{const{children:t,refProp:h,eventPropsWrapperName:c,...y}=Le("HoverCardTarget",Cs,s);if(!os(t))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const m=ss(),u=Te(t.props.onMouseEnter,m.openDropdown),v=Te(t.props.onMouseLeave,m.closeDropdown),M={onMouseEnter:u,onMouseLeave:v};return e.jsx(Fe.Target,{refProp:h,ref:n,...y,children:E.cloneElement(t,c?{[c]:M}:M)})});ns.displayName="@mantine/core/HoverCardTarget";const ws={openDelay:0,closeDelay:150,initiallyOpened:!1};function he(s){const{children:n,onOpen:t,onClose:h,openDelay:c,closeDelay:y,initiallyOpened:m,...u}=Le("HoverCard",ws,s),[v,{open:M,close:D}]=De(m,{onClose:h,onOpen:t}),{openDropdown:L,closeDropdown:z}=ds({open:M,close:D,openDelay:c,closeDelay:y});return e.jsx(Ss,{value:{openDropdown:L,closeDropdown:z},children:e.jsx(Fe,{...u,opened:v,__staticSelector:"HoverCard",children:n})})}he.displayName="@mantine/core/HoverCard";he.Target=ns;he.Dropdown=rs;he.extend=s=>s;var zs=xe("chart-bar","IconChartBar",[["path",{d:"M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20l14 0",key:"svg-3"}]]),ts=xe("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Ts=xe("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Is=xe("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),ks=xe("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]),_e=xe("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function $e(s,n=300){const[t,h]=E.useState(s);return E.useEffect(()=>{const c=setTimeout(()=>{h(s)},n);return()=>{clearTimeout(c)}},[s,n]),t}function Es({clusterId:s,index:n}){const t=Ee(),{announceSuccess:h,announceError:c}=xs(),[y,{open:m,close:u}]=De(!1),[v,{open:M,close:D}]=De(!1),[L,z]=E.useState(""),[$,A]=E.useState(1),g=Z({mutationFn:()=>R.openIndex(s,n.name),onMutate:()=>{k.show({id:`open-${n.name}`,title:"Opening index",message:`Opening index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`open-${n.name}`,title:"Success",message:`Index ${n.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),h(`Index ${n.name} opened successfully`),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:j=>{k.update({id:`open-${n.name}`,title:"Error",message:`Failed to open index: ${j.message}`,color:"red",loading:!1,autoClose:5e3}),c(`Failed to open index: ${j.message}`)}}),i=Z({mutationFn:()=>R.closeIndex(s,n.name),onMutate:()=>{k.show({id:`close-${n.name}`,title:"Closing index",message:`Closing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`close-${n.name}`,title:"Success",message:`Index ${n.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:j=>{k.update({id:`close-${n.name}`,title:"Error",message:`Failed to close index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),S=Z({mutationFn:()=>R.deleteIndex(s,n.name),onMutate:()=>{k.show({id:`delete-${n.name}`,title:"Deleting index",message:`Deleting index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`delete-${n.name}`,title:"Success",message:`Index ${n.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]}),u(),z("")},onError:j=>{k.update({id:`delete-${n.name}`,title:"Error",message:`Failed to delete index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),O=Z({mutationFn:j=>R.forceMergeIndex(s,n.name,j),onMutate:()=>{k.show({id:`forcemerge-${n.name}`,title:"Force merging index",message:`Force merging index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`forcemerge-${n.name}`,title:"Success",message:`Index ${n.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),D(),A(1)},onError:j=>{k.update({id:`forcemerge-${n.name}`,title:"Error",message:`Failed to force merge index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),q=Z({mutationFn:()=>R.clearCacheIndex(s,n.name),onMutate:()=>{k.show({id:`clearcache-${n.name}`,title:"Clearing cache",message:`Clearing cache for index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`clearcache-${n.name}`,title:"Success",message:`Cache cleared for index ${n.name}`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{k.update({id:`clearcache-${n.name}`,title:"Error",message:`Failed to clear cache: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),d=Z({mutationFn:()=>R.refreshIndex(s,n.name),onMutate:()=>{k.show({id:`refresh-${n.name}`,title:"Refreshing index",message:`Refreshing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`refresh-${n.name}`,title:"Success",message:`Index ${n.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{k.update({id:`refresh-${n.name}`,title:"Error",message:`Failed to refresh index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),b=Z({mutationFn:()=>R.flushIndex(s,n.name),onMutate:()=>{k.show({id:`flush-${n.name}`,title:"Flushing index",message:`Flushing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`flush-${n.name}`,title:"Success",message:`Index ${n.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:j=>{k.update({id:`flush-${n.name}`,title:"Error",message:`Failed to flush index: ${j.message}`,color:"red",loading:!1,autoClose:5e3})}}),P=()=>{L===n.name&&S.mutate()},H=()=>{const j=typeof $=="number"?$:parseInt($,10);!isNaN(j)&&j>0&&O.mutate(j)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Index operations",children:e.jsx(le,{variant:"subtle",color:"gray","aria-label":`Operations for index ${n.name}`,children:e.jsx(ts,{size:16,"aria-hidden":"true"})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Index Operations"}),n.status==="close"?e.jsx(C.Item,{leftSection:e.jsx(ks,{size:14,"aria-hidden":"true"}),onClick:()=>g.mutate(),disabled:g.isPending,children:"Open Index"}):e.jsx(C.Item,{leftSection:e.jsx(Is,{size:14,"aria-hidden":"true"}),onClick:()=>i.mutate(),disabled:i.isPending,children:"Close Index"}),e.jsx(C.Item,{leftSection:e.jsx(cs,{size:14,"aria-hidden":"true"}),onClick:()=>d.mutate(),disabled:d.isPending,children:"Refresh"}),e.jsx(C.Item,{leftSection:e.jsx(gs,{size:14,"aria-hidden":"true"}),onClick:()=>b.mutate(),disabled:b.isPending,children:"Flush"}),e.jsx(C.Item,{leftSection:e.jsx(Ts,{size:14,"aria-hidden":"true"}),onClick:()=>q.mutate(),disabled:q.isPending,children:"Clear Cache"}),e.jsx(C.Item,{leftSection:e.jsx(hs,{size:14,"aria-hidden":"true"}),onClick:M,children:"Force Merge"}),e.jsx(C.Divider,{}),e.jsx(C.Item,{leftSection:e.jsx(ps,{size:14,"aria-hidden":"true"}),color:"red",onClick:m,children:"Delete Index"})]})]}),e.jsx(Ie,{opened:y,onClose:()=>{u(),z("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(w,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(a,{span:!0,fw:700,children:n.name}),"? This action cannot be undone."]}),e.jsx(a,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(Ce,{placeholder:n.name,value:L,onChange:j=>z(j.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{u(),z("")},children:"Cancel"}),e.jsx(te,{color:"red",onClick:P,disabled:L!==n.name||S.isPending,loading:S.isPending,"aria-label":`Delete index ${n.name}`,children:"Delete"})]})]})}),e.jsx(Ie,{opened:v,onClose:()=>{D(),A(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(w,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(a,{span:!0,fw:700,children:n.name})," to reduce the number of segments."]}),e.jsx(js,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:$,onChange:A,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{D(),A(1)},children:"Cancel"}),e.jsx(te,{onClick:H,disabled:O.isPending,loading:O.isPending,"aria-label":`Force merge index ${n.name}`,children:"Force Merge"})]})]})})]})}function Be(s){var n;if(console.error("Error occurred:",s),s&&typeof s=="object"&&"name"in s&&s.name==="ApiClientError"&&"message"in s&&"statusCode"in s){const t=s;if(t.error){const h=He(t.error);if(h)return{error:"elasticsearch_error",message:h,statusCode:t.statusCode,details:t.error}}return{error:"api_error",message:t.message,statusCode:t.statusCode,details:t.error}}if(s&&typeof s=="object"&&"response"in s){const t=s.response;if(t!=null&&t.data){const h=He(t.data);return{error:t.data.error||"api_error",message:h||t.data.message||"An error occurred",details:t.data.details,statusCode:t.status,requestId:(n=t.headers)==null?void 0:n["x-request-id"]}}return{error:"http_error",message:`HTTP ${(t==null?void 0:t.status)||"Unknown"}: ${(t==null?void 0:t.statusText)||"Request failed"}`,statusCode:t==null?void 0:t.status}}if(s&&typeof s=="object"&&"message"in s){const t=s;return t.message.includes("Network")||t.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:t.message}:{error:"error",message:t.message,details:t.stack}}return typeof s=="string"?{error:"error",message:s}:{error:"unknown_error",message:"An unexpected error occurred",details:s}}function He(s){const n=s;if(n.error&&typeof n.error=="object"){const t=n.error;if(t.reason&&typeof t.reason=="string"){let h=`Elasticsearch: ${t.reason}`;if(t.type&&typeof t.type=="string"&&(h=`Elasticsearch (${t.type}): ${t.reason}`),t.root_cause&&Array.isArray(t.root_cause)&&t.root_cause.length>0){const c=t.root_cause[0];c.reason&&c.reason!==t.reason&&(h+=`
Root cause: ${c.reason}`)}return h}}if("details"in n&&n.details&&typeof n.details=="object"){const t=n.details;if(t.error&&typeof t.error=="object"){const h=t.error;if(h.reason&&typeof h.reason=="string"){let c=`Elasticsearch: ${h.reason}`;if(h.type&&typeof h.type=="string"&&(c=`Elasticsearch (${h.type}): ${h.reason}`),h.root_cause&&Array.isArray(h.root_cause)&&h.root_cause.length>0){const y=h.root_cause[0];y.reason&&y.reason!==h.reason&&(c+=`
Root cause: ${y.reason}`)}return c}}}return null}function Ge(s,n){if(!s.trim())return`${n} cannot be empty`;try{return JSON.parse(s),null}catch(t){return t.message}}function Ne(s){const n=["creation_date","provided_name","uuid","version"],t=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],h=[...n,...t],c={};for(const[y,m]of Object.entries(s))if(y==="index"){const u=m,v={};for(const[M,D]of Object.entries(u))h.includes(M)||(v[M]=D);Object.keys(v).length>0&&(c[y]=v)}else h.includes(y)||(c[y]=m);return c}function Ms(){const s=ge(),n=Oe(),t=Ee(),{resolvedTheme:h}=us(),[c,y]=pe(),m=s.id,u=c.get("index")||s.indexName,v=c.get("indexTab")||c.get("tab")||"settings",[M,D]=E.useState(""),[L,z]=E.useState(""),[$,A]=E.useState(null),[g,i]=E.useState(null),[S,O]=E.useState(null),[q,d]=E.useState(!1),[b,P]=E.useState(!1),[H,j]=E.useState(null),[W,Q]=E.useState(!1),[K,ie]=E.useState(null);E.useEffect(()=>{v==="stats"&&!H&&!W&&(Q(!0),ie(null),R.proxyRequest(m,"GET",`/${u}/_stats`).then(I=>{j(I)}).catch(I=>{ie(I instanceof Error?I.message:"Failed to fetch stats")}).finally(()=>{Q(!1)}))},[v,m,u,H,W]);const{data:F,isLoading:_,error:l}=oe({queryKey:["cluster",m,"index",u,"settings"],queryFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const U=(await R.proxyRequest(m,"GET",`/${u}/_settings`))[u];return U==null?void 0:U.settings},enabled:!!m&&!!u}),{data:r,isLoading:p,error:x}=oe({queryKey:["cluster",m,"index",u,"mappings"],queryFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const U=(await R.proxyRequest(m,"GET",`/${u}/_mapping`))[u];return U==null?void 0:U.mappings},enabled:!!m&&!!u});E.useEffect(()=>{if(F){const I=Ne(F);D(JSON.stringify(I,null,2)),d(!1)}},[F]),E.useEffect(()=>{r&&(z(JSON.stringify(r,null,2)),P(!1))},[r]);const N=Z({mutationFn:async()=>{if(!m||!u)throw new Error("Cluster ID and index name are required");const I=[];if(q){const U=Ge(M,"Settings");if(U)throw A(U),new Error(`Invalid settings JSON: ${U}`);const Pe=JSON.parse(M),as=Ne(Pe);I.push(R.proxyRequest(m,"PUT",`/${u}/_settings`,as))}if(b){const U=Ge(L,"Mappings");if(U)throw i(U),new Error(`Invalid mappings JSON: ${U}`);const Pe=JSON.parse(L);I.push(R.proxyRequest(m,"PUT",`/${u}/_mapping`,Pe))}await Promise.all(I)},onSuccess:()=>{t.invalidateQueries({queryKey:["cluster",m,"index",u]}),t.invalidateQueries({queryKey:["cluster",m,"indices"]});const I=[];q&&I.push("settings"),b&&I.push("mappings"),k.show({title:"Success",message:`Index ${I.join(" and ")} updated successfully`,color:"green",icon:e.jsx(fs,{size:16})}),d(!1),P(!1),O(null)},onError:I=>{const U=Be(I);O(U.message)}}),T=I=>{D(I||""),A(null),O(null),d(!0)},ae=I=>{z(I||""),i(null),O(null),P(!0)},ye=()=>{A(null),i(null),O(null),N.mutate()},we=()=>{if(F){const I=Ne(F);D(JSON.stringify(I,null,2)),d(!1)}r&&(z(JSON.stringify(r,null,2)),P(!1)),A(null),i(null),O(null)},ve=I=>{if(I){const U=new URLSearchParams(c);c.has("index")?U.set("indexTab",I):U.set("tab",I),y(U)}},ce=_||p,Se=l||x,Ae=q||b;if(!m||!u)return e.jsx(ze,{size:"xl",children:e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(ce)return e.jsxs(ze,{size:"xl",py:"md",children:[e.jsxs(f,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(J,{height:32,width:200,mb:"xs"}),e.jsx(J,{height:20,width:150})]}),e.jsx(J,{height:36,width:120})]}),e.jsxs(w,{gap:"md",children:[e.jsx(J,{height:48,width:"100%"}),e.jsx(X,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(J,{height:400})})]})]});if(Se){const I=Be(Se);return e.jsxs(ze,{size:"xl",py:"md",children:[e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error Loading Index",color:"red",children:I.message}),e.jsx(te,{variant:"default",onClick:()=>n(`/cluster/${m}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(ze,{size:"xl",py:"md",style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(f,{justify:"space-between",mb:"md",children:[e.jsxs(ue,{children:[e.jsx(Ke,{order:1,children:"Edit Index"}),e.jsx(a,{size:"sm",c:"dimmed",children:u})]}),!c.has("index")&&e.jsx(te,{variant:"default",onClick:()=>n(`/cluster/${m}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(w,{gap:"md",style:{flex:1,overflow:"auto"},children:[e.jsxs(G,{value:v,onChange:ve,children:[e.jsxs(G.List,{children:[e.jsx(G.Tab,{value:"settings",leftSection:e.jsx(Qe,{size:16}),children:"Settings"}),e.jsx(G.Tab,{value:"mappings",leftSection:e.jsx(Je,{size:16}),children:"Mappings"}),e.jsx(G.Tab,{value:"stats",leftSection:e.jsx(zs,{size:16}),children:"Stats"})]}),e.jsx(G.Panel,{value:"settings",pt:"md",children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs(ue,{children:[e.jsxs(f,{gap:"xs",mb:"xs",children:[e.jsx(a,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(he,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(he.Target,{children:e.jsx(ue,{component:"span",style:{cursor:"help"},c:"blue.6",children:e.jsx(_e,{size:16})})}),e.jsxs(he.Dropdown,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(a,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx(ue,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(qe,{height:"500px",defaultLanguage:"json",value:M,onChange:T,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),$&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:$})]})})})}),e.jsx(G.Panel,{value:"mappings",pt:"md",children:e.jsxs(w,{gap:"md",children:[e.jsx(Y,{icon:e.jsx(_e,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs(ue,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx(ue,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(qe,{height:"500px",defaultLanguage:"json",value:L,onChange:ae,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),g&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:g})]})})})]})}),e.jsx(G.Panel,{value:"stats",pt:"md",children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs("div",{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Statistics (Read-only)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Detailed statistics for this index"}),W?e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})}):K?e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:K}):H?e.jsx(fe,{h:500,children:e.jsx(Ve,{block:!0,children:JSON.stringify(H,null,2)})}):null]})})})})]}),S&&e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>O(null),children:e.jsx(a,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:S})}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:we,disabled:!Ae||N.isPending,children:"Reset"}),e.jsx(te,{onClick:ye,loading:N.isPending,disabled:!Ae,children:N.isPending?"Saving...":"Save Changes"})]})]})]})}function Re(s){switch(s){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function V(s){if(s===0)return"0 B";const n=1024,t=["B","KB","MB","GB","TB"],h=Math.floor(Math.log(s)/Math.log(n));return`${(s/Math.pow(n,h)).toFixed(2)} ${t[h]}`}function se(s,n){return n===0?0:Math.round(s/n*100)}function We(s){switch(s){case"green":return"transparent";case"yellow":return"rgba(250, 176, 5, 0.15)";case"red":return"rgba(250, 82, 82, 0.15)";default:return"transparent"}}function nr(){var ie;const{id:s}=ge(),n=ms(),[t,h]=pe(),{getColor:c}=Ze(s),y=t.get("tab")||"overview",m=t.get("index"),u=t.get("indexTab"),[v,M]=E.useState(!1),[D,L]=E.useState(null);E.useEffect(()=>{m?(L(decodeURIComponent(m)),M(!0)):(M(!1),L(null))},[m]);const z=(F,_)=>{const l=new URLSearchParams(t);l.set("index",encodeURIComponent(F)),_?l.set("indexTab",_):l.delete("indexTab"),h(l)},$=()=>{const F=new URLSearchParams(t);F.delete("index"),F.delete("indexTab"),h(F)},A=F=>{if(F){const _=new URLSearchParams(t);_.set("tab",F),m&&_.set("index",m),u&&_.set("indexTab",u),h(_)}},g=F=>{const _=new URLSearchParams;_.set("tab",F),h(_)},{data:i,isLoading:S,error:O}=oe({queryKey:["cluster",s,"stats"],queryFn:()=>R.getClusterStats(s),refetchInterval:n,enabled:!!s}),{data:q,isLoading:d,error:b}=oe({queryKey:["cluster",s,"nodes"],queryFn:()=>R.getNodes(s),refetchInterval:n,enabled:!!s}),{data:P,isLoading:H,error:j}=oe({queryKey:["cluster",s,"indices"],queryFn:()=>R.getIndices(s),refetchInterval:n,enabled:!!s}),{data:W,isLoading:Q,error:K}=oe({queryKey:["cluster",s,"shards"],queryFn:()=>R.getShards(s),refetchInterval:n,enabled:!!s});return s?S?e.jsx(w,{p:"md",children:e.jsx(f,{justify:"center",mt:"xl",children:e.jsx(je,{size:"lg"})})}):O?e.jsx(w,{p:"md",children:e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",O.message]})}):e.jsxs(w,{gap:"md",p:"md",children:[e.jsx(f,{justify:"space-between",wrap:"wrap",children:e.jsxs("div",{children:[e.jsx(Ke,{order:1,className:"text-responsive-xl",children:(i==null?void 0:i.clusterName)||s}),e.jsx(a,{size:"sm",c:"dimmed",children:"Cluster Overview"})]})}),e.jsx(be,{value:100,color:Re((i==null?void 0:i.health)||"red"),size:"sm",radius:"xs","aria-label":`Cluster health: ${(i==null?void 0:i.health)||"unknown"}`}),e.jsxs(ee,{children:[e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("nodes"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfNodes)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("indices"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfIndices)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[((ie=i==null?void 0:i.numberOfDocuments)==null?void 0:ie.toLocaleString())||0," documents"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("shards"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.activeShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.activePrimaryShards)||0," primary"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>g("shards"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(a,{size:"xl",fw:700,c:i!=null&&i.unassignedShards?"red":void 0,children:(i==null?void 0:i.unassignedShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.relocatingShards)||0," relocating"]})]})})})]}),((i==null?void 0:i.memoryTotal)||(i==null?void 0:i.diskTotal))&&e.jsxs(ee,{children:[(i==null?void 0:i.memoryTotal)&&e.jsx(ee.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(be,{value:se(i.memoryUsed||0,i.memoryTotal),color:c(se(i.memoryUsed||0,i.memoryTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(i.memoryUsed||0)," / ",V(i.memoryTotal)," (",se(i.memoryUsed||0,i.memoryTotal),"%)"]})]})})}),(i==null?void 0:i.diskTotal)&&e.jsx(ee.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(be,{value:se(i.diskUsed||0,i.diskTotal),color:c(se(i.diskUsed||0,i.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(i.diskUsed||0)," / ",V(i.diskTotal)," (",se(i.diskUsed||0,i.diskTotal),"%)"]})]})})})]}),e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(G,{value:y,onChange:A,children:[e.jsxs(G.List,{children:[e.jsx(G.Tab,{value:"overview",children:"Overview"}),e.jsxs(G.Tab,{value:"nodes",children:["Nodes (",(q==null?void 0:q.length)||0,")"]}),e.jsxs(G.Tab,{value:"indices",children:["Indices (",(P==null?void 0:P.length)||0,")"]}),e.jsxs(G.Tab,{value:"shards",children:["Shards (",(W==null?void 0:W.length)||0,")"]})]}),e.jsx(G.Panel,{value:"overview",pt:"md",children:e.jsx(Ns,{nodes:q,indices:P,shards:W,loading:d||H||Q,error:b||j||K,openIndexModal:z})}),e.jsx(G.Panel,{value:"nodes",pt:"md",children:e.jsx($s,{nodes:q,loading:d,error:b})}),e.jsx(G.Panel,{value:"indices",pt:"md",children:e.jsx(Ps,{indices:P,loading:H,error:j,openIndexModal:z})}),e.jsx(G.Panel,{value:"shards",pt:"md",children:e.jsx(Ds,{shards:W,loading:Q,error:K})})]})}),D&&e.jsx(Ie,{opened:v,onClose:$,size:"90%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column",padding:0},content:{display:"flex",flexDirection:"column"}},withCloseButton:!0,children:e.jsx("div",{style:{flex:1,overflow:"auto",padding:"var(--mantine-spacing-md)"},children:e.jsx(Ms,{})})})]}):e.jsx(w,{p:"md",children:e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function $s({nodes:s,loading:n,error:t}){var A;const{id:h}=ge(),c=Oe(),[y,m]=pe(),{getColor:u}=Ze(h),v=y.get("nodesSearch")||"",M=((A=y.get("roles"))==null?void 0:A.split(",").filter(Boolean))||[],D=$e(v,300),L=(g,i)=>{const S=new URLSearchParams(y);g!==void 0&&(g?S.set("nodesSearch",g):S.delete("nodesSearch")),i!==void 0&&(i.length>0?S.set("roles",i.join(",")):S.delete("roles")),m(S)},z=Array.from(new Set((s==null?void 0:s.flatMap(g=>g.roles))||[])),$=s==null?void 0:s.filter(g=>{var O;const i=g.name.toLowerCase().includes(D.toLowerCase())||((O=g.ip)==null?void 0:O.toLowerCase().includes(D.toLowerCase())),S=M.length===0||M.some(q=>g.roles.includes(q));return i&&S});return n?e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})}):t?e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",t.message]}):!s||s.length===0?e.jsx(a,{c:"dimmed",children:"No nodes found"}):e.jsxs(w,{gap:"md",children:[e.jsxs(f,{children:[e.jsx(Ce,{placeholder:"Search nodes...",leftSection:e.jsx(Me,{size:16}),value:v,onChange:g=>L(g.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(ke,{placeholder:"Filter by roles",data:z,value:M,onChange:g=>L(void 0,g),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),$&&$.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(fe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Roles"}),e.jsx(o.Th,{children:"Heap Usage"}),e.jsx(o.Th,{children:"Disk Usage"}),e.jsx(o.Th,{children:"CPU"})]})}),e.jsx(o.Tbody,{children:$==null?void 0:$.map(g=>e.jsxs(o.Tr,{style:{cursor:"pointer"},onClick:()=>c(`/cluster/${h}/nodes/${g.id}`),children:[e.jsxs(o.Td,{children:[e.jsx(a,{size:"sm",fw:500,children:g.name}),g.ip&&e.jsx(a,{size:"xs",c:"dimmed",children:g.ip})]}),e.jsx(o.Td,{children:e.jsx(f,{gap:"xs",children:g.roles.map(i=>e.jsx(B,{size:"sm",variant:"light",children:i},i))})}),e.jsx(o.Td,{children:e.jsxs(w,{gap:4,children:[e.jsx(be,{value:se(g.heapUsed,g.heapMax),color:u(se(g.heapUsed,g.heapMax)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(g.heapUsed)," / ",V(g.heapMax)]})]})}),e.jsx(o.Td,{children:e.jsxs(w,{gap:4,children:[e.jsx(be,{value:se(g.diskUsed,g.diskTotal),color:u(se(g.diskUsed,g.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(g.diskUsed)," / ",V(g.diskTotal)]})]})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:g.cpuPercent!==void 0?`${g.cpuPercent}%`:"N/A"})})]},g.id))})]})})]})}function Ps({indices:s,loading:n,error:t,openIndexModal:h}){var F,_;const{id:c}=ge(),y=Oe(),m=Ee(),[u,v]=pe(),M=u.get("indicesSearch")||"",D=((F=u.get("health"))==null?void 0:F.split(",").filter(Boolean))||[],L=((_=u.get("status"))==null?void 0:_.split(",").filter(Boolean))||[],z=u.get("expanded")==="true",$=u.get("sort")!=="desc",A=u.get("affected")==="true",g=$e(M,300),{data:i}=oe({queryKey:["cluster",c,"shards"],queryFn:()=>R.getShards(c),enabled:!!c}),{data:S}=oe({queryKey:["cluster",c,"settings"],queryFn:async()=>await R.proxyRequest(c,"GET","/_cluster/settings"),enabled:!!c}),O=(()=>{var ve,ce;if(!S)return!0;const l=S.transient,r=S.persistent,p=l==null?void 0:l.cluster,x=r==null?void 0:r.cluster,N=p==null?void 0:p.routing,T=x==null?void 0:x.routing,ae=(ve=N==null?void 0:N.allocation)==null?void 0:ve.enable,ye=(ce=T==null?void 0:T.allocation)==null?void 0:ce.enable;return(ae||ye||"all")==="all"})(),q=Z({mutationFn:()=>R.proxyRequest(c,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{m.invalidateQueries({queryKey:["cluster",c,"settings"]}),k.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:l=>{k.show({title:"Error",message:`Failed to enable shard allocation: ${l.message}`,color:"red"})}}),d=Z({mutationFn:l=>R.proxyRequest(c,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":l}}),onSuccess:()=>{m.invalidateQueries({queryKey:["cluster",c,"settings"]}),k.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:l=>{k.show({title:"Error",message:`Failed to disable shard allocation: ${l.message}`,color:"red"})}}),b=(l,r,p)=>{const x=new URLSearchParams(u);l!==void 0&&(l?x.set("indicesSearch",l):x.delete("indicesSearch")),r!==void 0&&(r.length>0?x.set("health",r.join(",")):x.delete("health")),p!==void 0&&(p.length>0?x.set("status",p.join(",")):x.delete("status")),v(x)},P=(l,r)=>{const p=new URLSearchParams(u);r===""||r===!1?p.delete(l):p.set(l,String(r)),v(p)},H=(i==null?void 0:i.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}))||{},j=(i==null?void 0:i.filter(l=>l.state==="UNASSIGNED"))||[],W=j.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}),Q=l=>(H[l]||[]).some(p=>p.state==="UNASSIGNED"||p.state==="RELOCATING"||p.state==="INITIALIZING");let K=s==null?void 0:s.filter(l=>{const r=l.name.toLowerCase().includes(g.toLowerCase()),p=D.length===0||D.includes(l.health),x=L.length===0||L.includes(l.status),N=!A||Q(l.name);return r&&p&&x&&N});if(K&&(K=[...K].sort((l,r)=>$?l.name.localeCompare(r.name):r.name.localeCompare(l.name))),n)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(t)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",t.message]});if(!s||s.length===0)return e.jsxs(w,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No indices found"}),c&&e.jsx(te,{leftSection:e.jsx(Ue,{size:16}),onClick:()=>y(`/cluster/${c}/indices/create`),children:"Create Index"})]});const ie=j.length>0;return e.jsxs(w,{gap:"md",children:[e.jsxs(f,{justify:"space-between",wrap:"wrap",children:[e.jsxs(f,{children:[O?e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:d.isPending,children:e.jsx(Xe,{size:20})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Disable Allocation"}),e.jsx(C.Item,{onClick:()=>d.mutate("none"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(C.Item,{onClick:()=>d.mutate("primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(C.Item,{onClick:()=>d.mutate("new_primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>q.mutate(),loading:q.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:z?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>P("expanded",!z),children:z?e.jsx(Ye,{size:20}):e.jsx(es,{size:20})})}),e.jsx(re,{label:$?"Sort descending":"Sort ascending",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>P("sort",$?"desc":"asc"),children:$?e.jsx(ys,{size:20}):e.jsx(vs,{size:20})})})]}),e.jsxs(f,{style:{flex:1},children:[e.jsx(Ce,{placeholder:"Search indices...",leftSection:e.jsx(Me,{size:16}),value:M,onChange:l=>b(l.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ke,{placeholder:"Health",data:["green","yellow","red"],value:D,onChange:l=>b(void 0,l,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(ke,{placeholder:"Status",data:["open","close"],value:L,onChange:l=>b(void 0,void 0,l),clearable:!0,style:{maxWidth:150}}),ie&&e.jsx(me,{label:"Show only affected",checked:A,onChange:l=>P("affected",l.currentTarget.checked),size:"sm"})]}),c&&e.jsx(te,{leftSection:e.jsx(Ue,{size:16}),onClick:()=>y(`/cluster/${c}/indices/create`),children:"Create Index"})]}),K&&K.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(fe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Health"}),e.jsx(o.Th,{children:"Status"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"}),e.jsx(o.Th,{children:"Shards"}),z&&e.jsx(o.Th,{children:"Primaries"}),z&&e.jsx(o.Th,{children:"Replicas"}),e.jsx(o.Th,{children:"Unassigned"}),e.jsx(o.Th,{children:"Actions"})]})}),e.jsx(o.Tbody,{children:K==null?void 0:K.map(l=>{var x;const r=((x=W[l.name])==null?void 0:x.length)||0,p=r>0;return e.jsxs(o.Tr,{style:{cursor:"pointer",backgroundColor:p?"rgba(250, 82, 82, 0.1)":void 0},onClick:()=>h(l.name),children:[e.jsx(o.Td,{children:e.jsxs(w,{gap:2,children:[e.jsx(a,{size:"sm",fw:500,style:{textDecoration:"underline"},children:l.name}),z&&Q(l.name)&&e.jsx(B,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",color:Re(l.health),children:l.health})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",variant:"light",color:l.status==="open"?"green":"gray",children:l.status})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.docsCount.toLocaleString()})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:V(l.storeSize)})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:z?`${l.primaryShards+l.replicaShards}`:`${l.primaryShards}p / ${l.replicaShards}r`})}),z&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.primaryShards})}),z&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.replicaShards})}),e.jsx(o.Td,{children:r>0?e.jsx(B,{size:"sm",color:"red",variant:"filled",children:r}):e.jsx(a,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(o.Td,{onClick:N=>N.stopPropagation(),children:e.jsxs(f,{gap:"xs",children:[c&&e.jsx(Es,{clusterId:c,index:l}),e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(le,{variant:"subtle",color:"gray",children:e.jsx(ts,{size:16})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Index Management"}),e.jsx(C.Item,{leftSection:e.jsx(Qe,{size:14}),onClick:N=>{N.stopPropagation(),h(l.name,"settings")},children:"Settings"}),e.jsx(C.Item,{leftSection:e.jsx(Je,{size:14}),onClick:N=>{N.stopPropagation(),h(l.name,"mappings")},children:"Mappings"})]})]})]})})]},l.name)})})]})})]})}function is({shard:s,opened:n,onClose:t,clusterId:h}){const[c,y]=E.useState(null),[m,u]=E.useState(!1);return E.useEffect(()=>{n&&s?(u(!0),y(null),console.log("Fetching shard stats:",{clusterId:h,index:s.index,shard:s.shard}),R.getShardStats(h,s.index,s.shard).then(v=>{console.log("Received shard stats:",v),y(v)}).catch(v=>{console.error("Failed to fetch shard stats:",v),y(s)}).finally(()=>{u(!1)})):n||(y(null),u(!1))},[n,s==null?void 0:s.index,s==null?void 0:s.shard,h]),s?e.jsx(Ie,{opened:n,onClose:t,title:e.jsxs(f,{gap:"xs",children:[e.jsx(a,{size:"lg",fw:600,children:"Shard Details:"}),e.jsx(B,{size:"lg",variant:"light",color:"blue",children:s.index}),e.jsx(a,{size:"lg",c:"dimmed",children:"/"}),e.jsxs(B,{size:"lg",variant:"filled",color:"cyan",children:["#",s.shard]}),e.jsx(B,{size:"lg",variant:s.primary?"filled":"light",color:s.primary?"green":"gray",children:s.primary?"Primary":"Replica"})]}),size:"80%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"}},children:e.jsx(fe,{style:{flex:1},children:m?e.jsxs(w,{gap:"xs",children:[e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"70%",radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"50%",radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"80%",radius:"xs"})]}):e.jsx(Ve,{block:!0,children:JSON.stringify(c||s,null,2)})})}):null}function Ns({nodes:s,indices:n,shards:t,loading:h,error:c,openIndexModal:y}){const{id:m}=ge(),u=Ee(),[v,M]=pe(),[D,L]=E.useState(null),[z,$]=E.useState(!1),A=v.get("overviewSearch")||"",g=v.get("showClosed")==="true",i=v.get("showSpecial")==="true",S=v.get("overviewExpanded")==="true",O=v.get("overviewAffected")==="true",q=$e(A,300),d=r=>{L(r),$(!0)},b=(r,p)=>{const x=new URLSearchParams(v);p===""||p===!1?x.delete(r):x.set(r,String(p)),M(x)},{data:P}=oe({queryKey:["cluster",m,"settings"],queryFn:async()=>await R.proxyRequest(m,"GET","/_cluster/settings"),enabled:!!m}),H=(()=>{var ce,Se;if(!P)return!0;const r=P.transient,p=P.persistent,x=r==null?void 0:r.cluster,N=p==null?void 0:p.cluster,T=x==null?void 0:x.routing,ae=N==null?void 0:N.routing,ye=(ce=T==null?void 0:T.allocation)==null?void 0:ce.enable,we=(Se=ae==null?void 0:ae.allocation)==null?void 0:Se.enable;return(ye||we||"all")==="all"})(),j=Z({mutationFn:()=>R.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",m,"settings"]}),k.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:r=>{k.show({title:"Error",message:`Failed to enable shard allocation: ${r.message}`,color:"red"})}}),W=Z({mutationFn:r=>R.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":r}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",m,"settings"]}),k.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:r=>{k.show({title:"Error",message:`Failed to disable shard allocation: ${r.message}`,color:"red"})}});if(h)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(c)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",c.message]});if(!s||!n||!t||s.length===0||n.length===0)return e.jsx(w,{gap:"md",align:"center",py:"xl",children:e.jsx(a,{c:"dimmed",children:"No shard allocation data available"})});const Q=t.filter(r=>r.state==="UNASSIGNED"),K=Q.reduce((r,p)=>(r[p.index]||(r[p.index]=[]),r[p.index].push(p),r),{}),ie=r=>t.filter(x=>x.index===r).some(x=>x.state==="UNASSIGNED"||x.state==="RELOCATING"||x.state==="INITIALIZING");let F=n.filter(r=>{const p=r.name.toLowerCase().includes(q.toLowerCase()),x=g||r.status==="open",N=i||!r.name.startsWith("."),T=!O||ie(r.name);return p&&x&&N&&T});const _=new Map;s.forEach(r=>{_.set(r.id,r.name),_.set(r.name,r.name),r.ip&&_.set(r.ip,r.name)});const l=new Map;return t.forEach(r=>{if(!r.node)return;const p=_.get(r.node);if(!p)return;l.has(p)||l.set(p,new Map);const x=l.get(p);x.has(r.index)||x.set(r.index,[]),x.get(r.index).push(r)}),e.jsxs(w,{gap:"md",children:[e.jsx(is,{shard:D,opened:z,onClose:()=>$(!1),clusterId:m}),e.jsxs(f,{justify:"space-between",wrap:"wrap",children:[e.jsxs(f,{children:[H?e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:W.isPending,children:e.jsx(Xe,{size:20})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Disable Allocation"}),e.jsx(C.Item,{onClick:()=>W.mutate("none"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(C.Item,{onClick:()=>W.mutate("primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(C.Item,{onClick:()=>W.mutate("new_primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>j.mutate(),loading:j.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:S?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>b("overviewExpanded",!S),children:S?e.jsx(Ye,{size:20}):e.jsx(es,{size:20})})})]}),e.jsxs(f,{style:{flex:1},children:[e.jsx(Ce,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(Me,{size:16}),value:A,onChange:r=>b("overviewSearch",r.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(f,{gap:"md",children:[e.jsx(me,{label:`closed (${n.filter(r=>r.status!=="open").length})`,checked:g,onChange:r=>b("showClosed",r.currentTarget.checked),size:"sm"}),e.jsx(me,{label:`special (${n.filter(r=>r.name.startsWith(".")).length})`,checked:i,onChange:r=>b("showSpecial",r.currentTarget.checked),size:"sm"}),Q.length>0&&e.jsx(me,{label:"Show only affected",checked:O,onChange:r=>b("overviewAffected",r.currentTarget.checked),size:"sm"}),e.jsxs(a,{size:"sm",c:"dimmed",children:[F.length," of ",n.length]})]})]})]}),e.jsxs(f,{gap:"md",children:[e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:s.length})," nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:F.length})," indices"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:t.length})," shards"]}),Q.length>0&&e.jsxs(B,{color:"red",variant:"filled",children:[Q.length," unassigned"]})]}),e.jsx(fe,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(o,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),F.map(r=>e.jsx(o.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(w,{gap:4,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:p=>{p.stopPropagation(),y(r.name)},children:r.name}),e.jsxs(f,{gap:4,justify:"center",children:[e.jsxs(B,{size:"xs",color:Re(r.health),variant:"dot",children:[r.primaryShards,"Ã—",r.replicaShards+1]}),e.jsx(a,{size:"xs",c:"dimmed",children:V(r.storeSize)})]})]})},r.name))]})}),e.jsxs(o.Tbody,{children:[Q.length>0&&e.jsxs(o.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(w,{gap:2,children:[e.jsx(a,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(B,{size:"xs",color:"red",variant:"filled",children:Q.length})]})}),F.map(r=>{const p=K[r.name]||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:We(r.health)},children:p.length>0?e.jsx(f,{gap:2,justify:"center",wrap:"wrap",children:p.map((x,N)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",x.shard]}),e.jsxs("div",{children:["Type: ",x.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",x.state]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:x.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)",cursor:"pointer"},onClick:()=>d(x),children:x.shard})},`unassigned-${x.index}-${x.shard}-${N}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${r.name}`)})]}),s.map(r=>{const p=l.get(r.name);return e.jsxs(o.Tr,{children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(w,{gap:4,children:[e.jsx(f,{gap:4,children:e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,children:r.name})}),e.jsx(a,{size:"xs",c:"dimmed",truncate:"end",title:r.ip,children:r.ip}),S&&e.jsxs(e.Fragment,{children:[e.jsx(f,{gap:4,wrap:"wrap",children:r.roles.map(x=>e.jsx(B,{size:"xs",variant:"light",color:"gray",children:x},x))}),e.jsxs(f,{gap:4,wrap:"wrap",children:[e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:r.id.substring(0,8)}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:r.roles.length}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:V(r.heapMax)}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:V(r.diskTotal)}),r.cpuPercent!==void 0&&e.jsxs(B,{size:"xs",color:"teal",variant:"filled",children:[r.cpuPercent,"%"]})]})]})]})}),F.map(x=>{const N=(p==null?void 0:p.get(x.name))||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:We(x.health)},children:N.length>0?e.jsx(f,{gap:2,justify:"center",wrap:"wrap",children:N.map((T,ae)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",T.shard]}),e.jsxs("div",{children:["Type: ",T.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",T.state]}),e.jsxs("div",{children:["Node: ",T.node||"N/A"]}),T.docs!==void 0&&T.docs!==null&&e.jsxs("div",{children:["Docs: ",T.docs.toLocaleString()]}),T.store!==void 0&&T.store!==null&&e.jsxs("div",{children:["Size: ",V(T.store)]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:T.state==="STARTED"?T.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":T.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:T.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)",cursor:"pointer"},onClick:()=>d(T),children:T.shard})},`${T.shard}-${T.primary}-${ae}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`${r.id}-${x.name}`)})]},r.id)})]})]})})})]})}function Ds({shards:s,loading:n,error:t}){var q;const{id:h}=ge(),[c,y]=pe(),[m,u]=E.useState(!1),[v,M]=E.useState(null),D=c.get("shardsSearch")||"",L=((q=c.get("shardStates"))==null?void 0:q.split(",").filter(Boolean))||[],z=c.get("primaryOnly")==="true",$=c.get("replicaOnly")==="true",A=$e(D,300),g=d=>{M(d),u(!0)},i=(d,b,P,H)=>{const j=new URLSearchParams(c);d!==void 0&&(d?j.set("shardsSearch",d):j.delete("shardsSearch")),b!==void 0&&(b.length>0?j.set("shardStates",b.join(",")):j.delete("shardStates")),P!==void 0&&(P?(j.set("primaryOnly","true"),j.delete("replicaOnly")):j.delete("primaryOnly")),H!==void 0&&(H?(j.set("replicaOnly","true"),j.delete("primaryOnly")):j.delete("replicaOnly")),y(j)},S=s==null?void 0:s.filter(d=>{var j;const b=d.index.toLowerCase().includes(A.toLowerCase())||((j=d.node)==null?void 0:j.toLowerCase().includes(A.toLowerCase())),P=L.length===0||L.includes(d.state),H=!z&&!$||z&&d.primary||$&&!d.primary;return b&&P&&H});if(n)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(t)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",t.message]});if(!s||s.length===0)return e.jsx(a,{c:"dimmed",children:"No shards found"});const O=(S||[]).reduce((d,b)=>(d[b.state]||(d[b.state]=[]),d[b.state].push(b),d),{});return e.jsxs(w,{gap:"md",children:[e.jsxs(f,{wrap:"wrap",children:[e.jsx(Ce,{placeholder:"Search by index or node...",leftSection:e.jsx(Me,{size:16}),value:D,onChange:d=>i(d.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ke,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:L,onChange:d=>i(void 0,d,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(f,{gap:"md",children:[e.jsx(me,{label:"Primary only",checked:z,onChange:d=>i(void 0,void 0,d.currentTarget.checked,void 0),size:"sm"}),e.jsx(me,{label:"Replica only",checked:$,onChange:d=>i(void 0,void 0,void 0,d.currentTarget.checked),size:"sm"})]})]}),e.jsx(ee,{children:Object.entries(O).map(([d,b])=>e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"md",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:d}),e.jsx(a,{size:"xl",fw:700,children:b.length})]})})},d))}),S&&S.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(fe,{children:[e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Index"}),e.jsx(o.Th,{children:"Shard"}),e.jsx(o.Th,{children:"Type"}),e.jsx(o.Th,{children:"State"}),e.jsx(o.Th,{children:"Node"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"})]})}),e.jsx(o.Tbody,{children:S==null?void 0:S.slice(0,100).map((d,b)=>{const P=d.state==="UNASSIGNED";return e.jsxs(o.Tr,{style:{backgroundColor:P?"rgba(250, 82, 82, 0.1)":void 0,cursor:"pointer"},onClick:()=>g(d),children:[e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.index})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.shard})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",variant:"light",color:d.primary?"blue":"gray",children:d.primary?"Primary":"Replica"})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",color:d.state==="STARTED"?"green":d.state==="UNASSIGNED"?"red":"yellow",children:d.state})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.node||"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.docs!==void 0&&d.docs!==null?d.docs.toLocaleString():"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.store!==void 0&&d.store!==null?V(d.store):"N/A"})})]},`${d.index}-${d.shard}-${b}`)})})]}),S&&S.length>100&&e.jsxs(a,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",S.length," shards"]})]}),v&&e.jsx(is,{opened:m,onClose:()=>{u(!1),M(null)},shard:v,clusterId:h})]})}export{nr as ClusterView};
