import{k as B,u as R,f as A,ah as D,r as i,j as e,G as S,T as V,b as r,S as j,n as I,e as W}from"./index-CNRDdsta.js";import{u as G}from"./useMutation-CaYU4g6S.js";import{F as w}from"./index-B2MvUyVx.js";import{C as z}from"./Container-BPUIqV2j.js";import{A as m,I as N}from"./IconAlertCircle-xt26jQrX.js";import{C as Q}from"./Card-C05VjDzn.js";import{T as t}from"./Tabs-BHKmf67I.js";import{T as K}from"./TextInput-BB78TaU7.js";import{B as T}from"./Button-C40bJwZS.js";import{I as U}from"./IconCheck-BIfakJXs.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputBase-CzYGjzOL.js";function H(s){if(!s)return"Index name is required";if(s==="."||s==="..")return'Index name cannot be "." or ".."';if(s.startsWith("-")||s.startsWith("_")||s.startsWith("+"))return"Index name cannot start with -, _, or +";if(s!==s.toLowerCase())return"Index name must be lowercase";const a=["\\","/","*","?",'"',"<",">","|"," ",",","#"];for(const l of a)if(s.includes(l))return`Index name cannot contain "${l}"`;return new Blob([s]).size>255?"Index name cannot be longer than 255 bytes":null}function E(s){if(!s.trim())return null;try{return JSON.parse(s),null}catch(a){return a.message}}function ce(){const{id:s}=B(),a=R(),l=A(),{resolvedTheme:C}=D(),[o,k]=i.useState(""),[d,L]=i.useState(`{
  "number_of_shards": 1,
  "number_of_replicas": 1
}`),[c,M]=i.useState(`{
  "properties": {
    
  }
}`),[_,J]=i.useState("basic"),[O,x]=i.useState(null),[v,h]=i.useState(null),[y,p]=i.useState(null),u=G({mutationFn:async()=>{if(!s)throw new Error("Cluster ID is required");const n=H(o);if(n)throw x(n),new Error(n);const g=E(d);if(g)throw h(g),new Error(`Invalid settings JSON: ${g}`);const f=E(c);if(f)throw p(f),new Error(`Invalid mappings JSON: ${f}`);const b={};d.trim()&&(b.settings=JSON.parse(d)),c.trim()&&(b.mappings=JSON.parse(c)),await W.proxyRequest(s,"PUT",`/${o}`,b)},onSuccess:()=>{l.invalidateQueries({queryKey:["cluster",s,"indices"]}),I.show({title:"Success",message:`Index "${o}" created successfully`,color:"green",icon:e.jsx(U,{size:16})}),a(`/cluster/${s}/indices/${o}/settings`)},onError:n=>{I.show({title:"Error",message:n.message||"Failed to create index",color:"red",icon:e.jsx(N,{size:16})})}}),P=()=>{x(null),h(null),p(null),u.mutate()},$=n=>{k(n),x(null)},q=n=>{L(n||""),h(null)},F=n=>{M(n||""),p(null)};return s?e.jsxs(z,{size:"xl",py:"md",children:[e.jsx(S,{justify:"space-between",mb:"md",children:e.jsxs("div",{children:[e.jsx(V,{order:1,children:"Create Index"}),e.jsx(r,{size:"sm",c:"dimmed",children:"Create a new index with custom settings and mappings"})]})}),e.jsxs(Q,{shadow:"sm",padding:"lg",children:[e.jsxs(t,{value:_,onChange:J,children:[e.jsxs(t.List,{children:[e.jsx(t.Tab,{value:"basic",children:"Basic"}),e.jsx(t.Tab,{value:"settings",children:"Settings"}),e.jsx(t.Tab,{value:"mappings",children:"Mappings"})]}),e.jsx(t.Panel,{value:"basic",pt:"md",children:e.jsxs(j,{gap:"md",children:[e.jsx(K,{label:"Index Name",placeholder:"my-index",description:"Lowercase only, cannot contain special characters",value:o,onChange:n=>$(n.currentTarget.value),error:O,required:!0}),e.jsx(m,{color:"blue",title:"Index Naming Rules",children:e.jsxs(r,{size:"sm",children:["• Must be lowercase",e.jsx("br",{}),'• Cannot contain: \\ / * ? " < > | (space) , #',e.jsx("br",{}),"• Cannot start with: - _ +",e.jsx("br",{}),'• Cannot be "." or ".."',e.jsx("br",{}),"• Maximum 255 bytes"]})})]})}),e.jsx(t.Panel,{value:"settings",pt:"md",children:e.jsxs(j,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(r,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),e.jsx(r,{size:"xs",c:"dimmed",mb:"sm",children:"Configure index settings such as number of shards and replicas"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(w,{height:"300px",defaultLanguage:"json",value:d,onChange:q,theme:C==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),v&&e.jsx(r,{size:"sm",c:"red",mt:"xs",children:v})]}),e.jsx(m,{color:"blue",title:"Settings Information",children:e.jsxs(r,{size:"sm",children:["Settings define index behavior such as:",e.jsx("br",{}),"• number_of_shards: Number of primary shards (cannot be changed after creation)",e.jsx("br",{}),"• number_of_replicas: Number of replica shards (can be changed later)",e.jsx("br",{}),"• analysis: Custom analyzers, tokenizers, and filters"]})})]})}),e.jsx(t.Panel,{value:"mappings",pt:"md",children:e.jsxs(j,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(r,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(r,{size:"xs",c:"dimmed",mb:"sm",children:"Define field types and properties for your documents"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(w,{height:"300px",defaultLanguage:"json",value:c,onChange:F,theme:C==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),y&&e.jsx(r,{size:"sm",c:"red",mt:"xs",children:y})]}),e.jsx(m,{color:"blue",title:"Mappings Information",children:e.jsxs(r,{size:"sm",children:["Mappings define how documents and their fields are stored and indexed:",e.jsx("br",{}),"• Field types: text, keyword, integer, date, boolean, etc.",e.jsx("br",{}),"• Field properties: analyzer, index, store, etc.",e.jsx("br",{}),"• Note: Field types cannot be changed after creation"]})})]})})]}),e.jsxs(S,{justify:"flex-end",mt:"xl",children:[e.jsx(T,{variant:"default",onClick:()=>a(`/cluster/${s}/indices`),disabled:u.isPending,children:"Cancel"}),e.jsx(T,{onClick:P,loading:u.isPending,disabled:!o.trim(),children:u.isPending?"Creating...":"Create Index"})]})]})]}):e.jsx(z,{size:"xl",children:e.jsx(m,{icon:e.jsx(N,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{ce as IndexCreate};
