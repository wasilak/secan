import{i as le,k as ce,l as ue,j as e,B as me,n as ge,o as pe,a1 as P,c as he,K as fe,u as xe,y as ye,a0 as je,N as be,r as m,b as U,A as w,I as J,G as A,S as E,T as Se,d as l,R as ve,V as we,Z as G,D as Ee,f as R}from"./index-CKEEiM42.js";import{u as _e}from"./useMutation-CO3iVMfo.js";import{C as T}from"./Container-C5dWeq5w.js";import{C as B}from"./Card-Cle4VCtu.js";import{B as $}from"./Button-DiTwUudv.js";import{T as y}from"./Tabs-DJpASEWb.js";import{I as Ce}from"./IconCheck-CcZ1kRpk.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";var Z={root:"m_18320242","skeleton-fade":"m_299c329c"};const ke={visible:!0,animate:!0},Ie=ge((t,{width:r,height:s,radius:n,circle:a})=>({root:{"--skeleton-height":P(s),"--skeleton-width":a?P(s):P(r),"--skeleton-radius":a?"1000px":n===void 0?void 0:pe(n)}})),p=le((t,r)=>{const s=ce("Skeleton",ke,t),{classNames:n,className:a,style:d,styles:h,unstyled:j,vars:c,width:g,height:f,circle:_,visible:C,radius:b,animate:k,mod:x,...I}=s,u=ue({name:"Skeleton",classes:Z,props:s,className:a,style:d,classNames:n,styles:h,unstyled:j,vars:c,varsResolver:Ie});return e.jsx(me,{ref:r,...u("root"),mod:[{visible:C,animate:k},x],...I})});p.classes=Z;p.displayName="@mantine/core/Skeleton";var Q=he("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function V(t){var r;if(console.error("Error occurred:",t),t&&typeof t=="object"&&"name"in t&&t.name==="ApiClientError"&&"message"in t&&"statusCode"in t){const s=t;if(s.error){const n=H(s.error);if(n)return{error:"elasticsearch_error",message:n,statusCode:s.statusCode,details:s.error}}return{error:"api_error",message:s.message,statusCode:s.statusCode,details:s.error}}if(t&&typeof t=="object"&&"response"in t){const s=t.response;if(s!=null&&s.data){const n=H(s.data);return{error:s.data.error||"api_error",message:n||s.data.message||"An error occurred",details:s.data.details,statusCode:s.status,requestId:(r=s.headers)==null?void 0:r["x-request-id"]}}return{error:"http_error",message:`HTTP ${(s==null?void 0:s.status)||"Unknown"}: ${(s==null?void 0:s.statusText)||"Request failed"}`,statusCode:s==null?void 0:s.status}}if(t&&typeof t=="object"&&"message"in t){const s=t;return s.message.includes("Network")||s.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:s.message}:{error:"error",message:s.message,details:s.stack}}return typeof t=="string"?{error:"error",message:t}:{error:"unknown_error",message:"An unexpected error occurred",details:t}}function H(t){const r=t;if(r.error&&typeof r.error=="object"){const s=r.error;if(s.reason&&typeof s.reason=="string"){let n=`Elasticsearch: ${s.reason}`;if(s.type&&typeof s.type=="string"&&(n=`Elasticsearch (${s.type}): ${s.reason}`),s.root_cause&&Array.isArray(s.root_cause)&&s.root_cause.length>0){const a=s.root_cause[0];a.reason&&a.reason!==s.reason&&(n+=`
Root cause: ${a.reason}`)}return n}}if("details"in r&&r.details&&typeof r.details=="object"){const s=r.details;if(s.error&&typeof s.error=="object"){const n=s.error;if(n.reason&&typeof n.reason=="string"){let a=`Elasticsearch: ${n.reason}`;if(n.type&&typeof n.type=="string"&&(a=`Elasticsearch (${n.type}): ${n.reason}`),n.root_cause&&Array.isArray(n.root_cause)&&n.root_cause.length>0){const d=n.root_cause[0];d.reason&&d.reason!==n.reason&&(a+=`
Root cause: ${d.reason}`)}return a}}}return null}function Y(t,r){if(!t.trim())return`${r} cannot be empty`;try{return JSON.parse(t),null}catch(s){return s.message}}function F(t){const r=["creation_date","provided_name","uuid","version"],s=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path"],n=[...r,...s],a={};for(const[d,h]of Object.entries(t))if(d==="index"){const j=h,c={};for(const[g,f]of Object.entries(j))n.includes(g)||(c[g]=f);Object.keys(c).length>0&&(a[d]=c)}else n.includes(d)||(a[d]=h);return a}function Pe(){const{id:t,indexName:r}=fe(),s=xe(),n=ye(),{resolvedTheme:a}=je(),[d,h]=be(),j=d.get("tab")||"settings",[c,g]=m.useState(""),[f,_]=m.useState(""),[C,b]=m.useState(null),[k,x]=m.useState(null),[I,u]=m.useState(null),[q,z]=m.useState(!1),[L,N]=m.useState(!1),{data:S,isLoading:W,error:X}=U({queryKey:["cluster",t,"index",r,"settings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const o=(await R.proxyRequest(t,"GET",`/${r}/_settings`))[r];return o==null?void 0:o.settings},enabled:!!t&&!!r}),{data:v,isLoading:ee,error:se}=U({queryKey:["cluster",t,"index",r,"mappings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const o=(await R.proxyRequest(t,"GET",`/${r}/_mapping`))[r];return o==null?void 0:o.mappings},enabled:!!t&&!!r});m.useEffect(()=>{if(S){const i=F(S);g(JSON.stringify(i,null,2)),z(!1)}},[S]),m.useEffect(()=>{v&&(_(JSON.stringify(v,null,2)),N(!1))},[v]);const M=_e({mutationFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const i=[];if(q){const o=Y(c,"Settings");if(o)throw b(o),new Error(`Invalid settings JSON: ${o}`);const O=JSON.parse(c),de=F(O);i.push(R.proxyRequest(t,"PUT",`/${r}/_settings`,de))}if(L){const o=Y(f,"Mappings");if(o)throw x(o),new Error(`Invalid mappings JSON: ${o}`);const O=JSON.parse(f);i.push(R.proxyRequest(t,"PUT",`/${r}/_mapping`,O))}await Promise.all(i)},onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",t,"index",r]}),n.invalidateQueries({queryKey:["cluster",t,"indices"]});const i=[];q&&i.push("settings"),L&&i.push("mappings"),Ee.show({title:"Success",message:`Index ${i.join(" and ")} updated successfully`,color:"green",icon:e.jsx(Ce,{size:16})}),z(!1),N(!1),u(null)},onError:i=>{const o=V(i);u(o.message)}}),te=i=>{g(i||""),b(null),u(null),z(!0)},re=i=>{_(i||""),x(null),u(null),N(!0)},ne=()=>{b(null),x(null),u(null),M.mutate()},ie=()=>{if(S){const i=F(S);g(JSON.stringify(i,null,2)),z(!1)}v&&(_(JSON.stringify(v,null,2)),N(!1)),b(null),x(null),u(null)},ae=i=>{i&&h({tab:i})},oe=W||ee,D=X||se,K=q||L;if(!t||!r)return e.jsx(T,{size:"xl",children:e.jsx(w,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(oe)return e.jsxs(T,{size:"xl",py:"md",children:[e.jsxs(A,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(p,{height:32,width:200,mb:"xs"}),e.jsx(p,{height:20,width:150})]}),e.jsx(p,{height:36,width:120})]}),e.jsxs(E,{gap:"md",children:[e.jsx(p,{height:48,width:"100%"}),e.jsx(B,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(p,{height:400})})]})]});if(D){const i=V(D);return e.jsxs(T,{size:"xl",py:"md",children:[e.jsx(w,{icon:e.jsx(J,{size:16}),title:"Error Loading Index",color:"red",children:i.message}),e.jsx($,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(T,{size:"xl",py:"md",children:[e.jsxs(A,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Se,{order:1,children:"Edit Index"}),e.jsx(l,{size:"sm",c:"dimmed",children:r})]}),e.jsx($,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(E,{gap:"md",children:[e.jsxs(y,{value:j,onChange:ae,children:[e.jsxs(y.List,{children:[e.jsx(y.Tab,{value:"settings",leftSection:e.jsx(ve,{size:16}),children:"Settings"}),e.jsx(y.Tab,{value:"mappings",leftSection:e.jsx(we,{size:16}),children:"Mappings"})]}),e.jsxs(y.Panel,{value:"settings",pt:"md",children:[e.jsx(w,{icon:e.jsx(Q,{size:16}),color:"blue",mb:"md",children:e.jsxs(l,{size:"sm",children:[e.jsx("strong",{children:"Note:"})," Static and read-only settings are automatically filtered from this editor. These include system-managed fields (creation_date, uuid, version) and static settings that require the index to be closed before modification (number_of_shards, codec, sort, etc.)."]})}),e.jsx(B,{shadow:"sm",padding:"lg",children:e.jsx(E,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(G,{height:"500px",defaultLanguage:"json",value:c,onChange:te,theme:a==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),C&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:C})]})})})]}),e.jsx(y.Panel,{value:"mappings",pt:"md",children:e.jsxs(E,{gap:"md",children:[e.jsx(w,{icon:e.jsx(Q,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(l,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(B,{shadow:"sm",padding:"lg",children:e.jsx(E,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(G,{height:"500px",defaultLanguage:"json",value:f,onChange:re,theme:a==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),k&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:k})]})})})]})})]}),I&&e.jsx(w,{icon:e.jsx(J,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>u(null),children:e.jsx(l,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:I})}),e.jsxs(A,{justify:"flex-end",children:[e.jsx($,{variant:"default",onClick:ie,disabled:!K||M.isPending,children:"Reset"}),e.jsx($,{onClick:ne,loading:M.isPending,disabled:!K,children:M.isPending?"Saving...":"Save Changes"})]})]})]})}export{Pe as IndexEdit};
