import{u as W,j as e,T as Q,B as P,g as X,f as Y,a as J,b as Z,r as N,c as ee,d as M,e as B,h as se,i as re,k as ne,S as C,A as _,I as H,G as R,C as E,l as v,m as L,U as te,n as le}from"./index-BJS5LSe9.js";import{u as ae}from"./accessibility-DUuhqyim.js";import{T as D}from"./Title-COdzo1JG.js";import{G as S}from"./Grid-BE9vb8z-.js";import{C as k}from"./Card-DIQsyELt.js";import{S as w}from"./Skeleton-BQFBrVvt.js";import{T as x}from"./Table-CwSYgXSE.js";import{B as oe}from"./Badge-Dj231pfv.js";function ie({size:l,thickness:i,sum:n,value:c,root:h,offset:d}){const r=(l*.9-i*2)/2,a=Math.PI*r*2/100,t=h||c===void 0?`${(100-n)*a}, ${n*a}`:`${c*a}, ${(100-c)*a}`;return{strokeWidth:Number.isNaN(i)?12:i,cx:l/2||0,cy:l/2||0,r:r||0,transform:h?`scale(1, -1) translate(0, -${l})`:void 0,strokeDasharray:t,strokeDashoffset:h?0:d||0}}function G({size:l,value:i,offset:n,sum:c,thickness:h,root:d,color:r,lineRoundCaps:a,tooltip:t,getStyles:u,display:o,...m}){const j=W();return e.jsx(Q.Floating,{disabled:!t,label:t,children:e.jsx(P,{component:"circle",...m,...u("curve"),__vars:{"--curve-color":r?X(r,j):void 0},fill:"none",strokeLinecap:a?"round":"butt",...ie({sum:c,size:l,thickness:h,value:i,offset:n,root:d})})})}G.displayName="@mantine/core/Curve";function ce({size:l,thickness:i,sections:n,renderRoundedLineCaps:c,rootColor:h}){const d=n.reduce((o,m)=>o+m.value,0),r=Math.PI*((l*.9-i*2)/2)*2;let a=r;const t=[],u=[];for(let o=0;o<n.length;o+=1)t.push({sum:d,offset:a,data:n[o],root:!1}),a-=n[o].value/100*r;if(t.push({sum:d,offset:a,data:{color:h},root:!0}),u.push({...t[t.length-1],lineRoundCaps:!1}),t.length>2){u.push({...t[0],lineRoundCaps:c}),u.push({...t[t.length-2],lineRoundCaps:c});for(let o=1;o<=t.length-3;o+=1)u.push({...t[o],lineRoundCaps:!1})}else u.push({...t[0],lineRoundCaps:c});return u}var U={root:"m_b32e4812",svg:"m_d43b5134",curve:"m_b1ca1fbf",label:"m_b23f9dc4"};function de(l,i){return Math.min(l||12,(i||120)/4)}const he={size:120,thickness:12},ue=ee((l,{size:i,thickness:n,transitionDuration:c})=>({root:{"--rp-size":M(i),"--rp-label-offset":M(n*2),"--rp-transition-duration":c?`${c}ms`:void 0}})),I=Y((l,i)=>{const n=J("RingProgress",he,l),{classNames:c,className:h,style:d,styles:r,unstyled:a,vars:t,label:u,sections:o,size:m,thickness:j,roundCaps:b,rootColor:$,transitionDuration:g,...s}=n,f=Z({name:"RingProgress",classes:U,props:n,className:h,style:d,classNames:c,styles:r,unstyled:a,vars:t,varsResolver:ue}),y=de(j,m),p=ce({size:m,thickness:y,sections:o,renderRoundedLineCaps:b,rootColor:$}).map(({data:z,sum:V,root:A,lineRoundCaps:F,offset:q},K)=>N.createElement(G,{...z,key:K,size:m,thickness:y,sum:V,offset:q,color:z==null?void 0:z.color,root:A,lineRoundCaps:F,getStyles:f}));return e.jsxs(P,{...f("root"),size:m,ref:i,...s,children:[e.jsx("svg",{...f("svg"),children:p}),u&&e.jsx("div",{...f("label"),children:u})]})});I.classes=U;I.displayName="@mantine/core/RingProgress";var me=B("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),xe=B("selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);function ge(l){switch(l){case"green":return"green";case"yellow":return"yellow";case"red":return"red";case"unreachable":return"gray";default:return"gray"}}function O(l){switch(l){case"green":return 3;case"yellow":return 2;case"red":return 1;case"unreachable":return 0;default:return 0}}function fe(l,i,n){return n?[...l].sort((h,d)=>{let r,a;return i==="health"?(r=O(h.health),a=O(d.health)):(r=h[i],a=d[i]),typeof r=="string"&&typeof a=="string"?n==="asc"?r.localeCompare(a):a.localeCompare(r):typeof r=="number"&&typeof a=="number"?n==="asc"?r-a:a-r:0}):l}function T({column:l,currentColumn:i,direction:n,onSort:c,children:h}){const d=i===l,r=d?`Sorted ${n==="asc"?"ascending":"descending"}`:"Not sorted";return e.jsx(x.Th,{children:e.jsxs(te,{onClick:()=>c(l),style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},"aria-label":`Sort by ${h}, ${r}`,children:[e.jsx(v,{fw:500,children:h}),d&&n==="asc"&&e.jsx(me,{size:14,"aria-hidden":"true"}),d&&n==="desc"&&e.jsx(le,{size:14,"aria-hidden":"true"}),!d&&e.jsx(xe,{size:14,opacity:.5,"aria-hidden":"true"})]})})}function ke(){const l=se(),i=re(),{announce:n,announceError:c}=ae(),[h,d]=N.useState([]),[r,a]=N.useState(null),[t,u]=N.useState(null),{data:o,isLoading:m,error:j}=ne({queryKey:["clusters"],queryFn:()=>L.getClusters(),refetchInterval:i});N.useEffect(()=>{m?n("Loading clusters"):j?c("Failed to load cluster list"):o&&n(`Loaded ${o.length} cluster${o.length!==1?"s":""}`)},[m,j,o,n,c]),N.useEffect(()=>{if(!o||o.length===0){d([]);return}(async()=>{const f=await Promise.all(o.map(async y=>{try{const p=await L.getClusterStats(y.id);return{id:y.id,name:y.name,health:p.health,nodes:p.numberOfNodes,shards:p.activeShards,indices:p.numberOfIndices,documents:p.numberOfDocuments}}catch(p){return{id:y.id,name:y.name,health:"unreachable",nodes:0,shards:0,indices:0,documents:0,error:p instanceof Error?p.message:"Unknown error"}}}));d(f)})()},[o]);const b=s=>{r===s?t==="asc"?(u("desc"),n(`Sorted by ${s} descending`)):t==="desc"&&(u(null),a(null),n("Sort removed")):(a(s),u("asc"),n(`Sorted by ${s} ascending`))},$=s=>{l(`/cluster/${s}`)},g=fe(h,r,t);return m?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(D,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsxs(S,{children:[e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(w,{height:120,radius:"md"})})}),e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(w,{height:120,radius:"md"})})}),e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(w,{height:120,radius:"md"})})})]}),e.jsxs(C,{gap:"xs",children:[e.jsx(w,{height:40,radius:"sm"}),e.jsx(w,{height:60,radius:"sm"}),e.jsx(w,{height:60,radius:"sm"}),e.jsx(w,{height:60,radius:"sm"})]})]}):j?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(D,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(_,{icon:e.jsx(H,{size:16}),title:"Error loading clusters",color:"red",children:j instanceof Error?j.message:"Failed to load cluster list"})]}):!o||o.length===0?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(D,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(_,{icon:e.jsx(H,{size:16}),title:"No clusters configured",color:"blue",children:"No Elasticsearch or OpenSearch clusters are configured. Please check your configuration file."})]}):e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(R,{justify:"space-between",wrap:"wrap",children:e.jsx(D,{order:1,className:"text-responsive-xl",children:"Dashboard"})}),e.jsxs(S,{children:[e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(R,{justify:"center",children:e.jsx(I,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="green").length/g.length*100,color:"green"}],label:e.jsx(E,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(v,{size:"xl",fw:700,children:g.filter(s=>s.health==="green").length}),e.jsx(v,{size:"xs",c:"dimmed",children:"Green"})]})})})})})}),e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(R,{justify:"center",children:e.jsx(I,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="yellow").length/g.length*100,color:"yellow"}],label:e.jsx(E,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(v,{size:"xl",fw:700,children:g.filter(s=>s.health==="yellow").length}),e.jsx(v,{size:"xs",c:"dimmed",children:"Yellow"})]})})})})})}),e.jsx(S.Col,{span:{base:12,sm:4},children:e.jsx(k,{shadow:"sm",padding:"lg",children:e.jsx(R,{justify:"center",children:e.jsx(I,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="red").length/g.length*100,color:"red"}],label:e.jsx(E,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(v,{size:"xl",fw:700,children:g.filter(s=>s.health==="red").length}),e.jsx(v,{size:"xs",c:"dimmed",children:"Red"})]})})})})})})]}),e.jsx(P,{style:{overflowX:"auto"},children:e.jsxs(x,{highlightOnHover:!0,striped:!0,role:"table","aria-label":"Cluster overview table",style:{minWidth:"600px"},children:[e.jsx(x.Thead,{children:e.jsxs(x.Tr,{children:[e.jsx(T,{column:"name",currentColumn:r,direction:t,onSort:b,children:"Cluster Name"}),e.jsx(T,{column:"health",currentColumn:r,direction:t,onSort:b,children:"Health"}),e.jsx(T,{column:"nodes",currentColumn:r,direction:t,onSort:b,children:"Nodes"}),e.jsx(T,{column:"shards",currentColumn:r,direction:t,onSort:b,children:"Shards"}),e.jsx(T,{column:"indices",currentColumn:r,direction:t,onSort:b,children:"Indices"}),e.jsx(T,{column:"documents",currentColumn:r,direction:t,onSort:b,children:"Documents"})]})}),e.jsx(x.Tbody,{children:g.map(s=>e.jsxs(x.Tr,{onClick:()=>$(s.id),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),$(s.id))},"aria-label":`View details for cluster ${s.name}`,children:[e.jsxs(x.Td,{children:[e.jsx(v,{fw:500,children:s.name}),s.error&&e.jsx(v,{size:"xs",c:"dimmed",role:"alert",children:s.error})]}),e.jsx(x.Td,{children:e.jsx(oe,{color:ge(s.health),variant:"filled","aria-label":`Health status: ${s.health}`,children:s.health})}),e.jsx(x.Td,{children:s.nodes}),e.jsx(x.Td,{children:s.shards}),e.jsx(x.Td,{children:s.indices}),e.jsx(x.Td,{children:s.documents.toLocaleString()})]},s.id))})]})})]})}export{ke as Dashboard};
