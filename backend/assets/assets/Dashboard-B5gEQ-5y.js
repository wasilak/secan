import{c as N,u as L,a as z,r as y,b as H,j as e,S,T as C,C as O,L as U,d as b,A as I,I as D,G as A,e as n,f as k,U as R,g as V}from"./index-BoVBWD-O.js";import{u as B}from"./accessibility-CpaNjtbb.js";import{B as F}from"./Badge-dUYDxRyA.js";var M=N("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),q=N("selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);function G(a){switch(a){case"green":return"green";case"yellow":return"yellow";case"red":return"red";case"unreachable":return"gray";default:return"gray"}}function E(a){switch(a){case"green":return 3;case"yellow":return 2;case"red":return 1;case"unreachable":return 0;default:return 0}}function K(a,u,t){return t?[...a].sort((h,l)=>{let s,o;return u==="health"?(s=E(h.health),o=E(l.health)):(s=h[u],o=l[u]),typeof s=="string"&&typeof o=="string"?t==="asc"?s.localeCompare(o):o.localeCompare(s):typeof s=="number"&&typeof o=="number"?t==="asc"?s-o:o-s:0}):a}function x({column:a,currentColumn:u,direction:t,onSort:f,children:h}){const l=u===a,s=l?`Sorted ${t==="asc"?"ascending":"descending"}`:"Not sorted";return e.jsx(n.Th,{children:e.jsxs(R,{onClick:()=>f(a),style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},"aria-label":`Sort by ${h}, ${s}`,children:[e.jsx(b,{fw:500,children:h}),l&&t==="asc"&&e.jsx(M,{size:14,"aria-hidden":"true"}),l&&t==="desc"&&e.jsx(V,{size:14,"aria-hidden":"true"}),!l&&e.jsx(q,{size:14,opacity:.5,"aria-hidden":"true"})]})})}function X(){const a=L(),u=z(),{announce:t,announceError:f}=B(),[h,l]=y.useState([]),[s,o]=y.useState(null),[c,v]=y.useState(null),{data:i,isLoading:w,error:g}=H({queryKey:["clusters"],queryFn:()=>k.getClusters(),refetchInterval:u});y.useEffect(()=>{w?t("Loading clusters"):g?f("Failed to load cluster list"):i&&t(`Loaded ${i.length} cluster${i.length!==1?"s":""}`)},[w,g,i,t,f]),y.useEffect(()=>{if(!i||i.length===0){l([]);return}(async()=>{const p=await Promise.all(i.map(async j=>{try{const d=await k.getClusterStats(j.id);return{id:j.id,name:j.name,health:d.health,nodes:d.numberOfNodes,shards:d.activeShards,indices:d.numberOfIndices,documents:d.numberOfDocuments}}catch(d){return{id:j.id,name:j.name,health:"unreachable",nodes:0,shards:0,indices:0,documents:0,error:d instanceof Error?d.message:"Unknown error"}}}));l(p)})()},[i]);const m=r=>{s===r?c==="asc"?(v("desc"),t(`Sorted by ${r} descending`)):c==="desc"&&(v(null),o(null),t("Sort removed")):(o(r),v("asc"),t(`Sorted by ${r} ascending`))},T=r=>{a(`/cluster/${r}`)},$=K(h,s,c);return w?e.jsxs(S,{gap:"md",p:"md",children:[e.jsx(C,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(O,{h:200,children:e.jsxs(S,{align:"center",gap:"md",children:[e.jsx(U,{size:"lg"}),e.jsx(b,{c:"dimmed",children:"Loading clusters..."})]})})]}):g?e.jsxs(S,{gap:"md",p:"md",children:[e.jsx(C,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(I,{icon:e.jsx(D,{size:16}),title:"Error loading clusters",color:"red",children:g instanceof Error?g.message:"Failed to load cluster list"})]}):!i||i.length===0?e.jsxs(S,{gap:"md",p:"md",children:[e.jsx(C,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(I,{icon:e.jsx(D,{size:16}),title:"No clusters configured",color:"blue",children:"No Elasticsearch or OpenSearch clusters are configured. Please check your configuration file."})]}):e.jsxs(S,{gap:"md",p:"md",children:[e.jsx(A,{justify:"space-between",wrap:"wrap",children:e.jsx(C,{order:1,className:"text-responsive-xl",children:"Dashboard"})}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(n,{highlightOnHover:!0,striped:!0,role:"table","aria-label":"Cluster overview table",style:{minWidth:"600px"},children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(x,{column:"name",currentColumn:s,direction:c,onSort:m,children:"Cluster Name"}),e.jsx(x,{column:"health",currentColumn:s,direction:c,onSort:m,children:"Health"}),e.jsx(x,{column:"nodes",currentColumn:s,direction:c,onSort:m,children:"Nodes"}),e.jsx(x,{column:"shards",currentColumn:s,direction:c,onSort:m,children:"Shards"}),e.jsx(x,{column:"indices",currentColumn:s,direction:c,onSort:m,children:"Indices"}),e.jsx(x,{column:"documents",currentColumn:s,direction:c,onSort:m,children:"Documents"})]})}),e.jsx(n.Tbody,{children:$.map(r=>e.jsxs(n.Tr,{onClick:()=>T(r.id),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),T(r.id))},"aria-label":`View details for cluster ${r.name}`,children:[e.jsxs(n.Td,{children:[e.jsx(b,{fw:500,children:r.name}),r.error&&e.jsx(b,{size:"xs",c:"dimmed",role:"alert",children:r.error})]}),e.jsx(n.Td,{children:e.jsx(F,{color:G(r.health),variant:"filled","aria-label":`Health status: ${r.health}`,children:r.health})}),e.jsx(n.Td,{children:r.nodes}),e.jsx(n.Td,{children:r.shards}),e.jsx(n.Td,{children:r.indices}),e.jsx(n.Td,{children:r.documents.toLocaleString()})]},r.id))})]})})]})}export{X as Dashboard};
