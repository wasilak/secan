import{O as K,r as n,b as P,j as e,A as b,I as C,G as x,T as L,d as r,J as M,S as m,ae as S,Q,e as t,af as H,L as Y,E as N,f as v}from"./index-BowZsXkX.js";import{u as Z}from"./useMutation-DabcCJzP.js";import{C as U}from"./Container-DabZTcok.js";import{B as _}from"./Button-DVKpOCXJ.js";import{C as A}from"./Card-CBHGju0x.js";import{T as V}from"./Textarea-CN82MreQ.js";import{A as p}from"./Accordion-DWLnSSsG.js";import{T as F}from"./TextInput-f_LPQEHf.js";import{B as $}from"./Badge-i5KzbEI-.js";import"./get-safe-id-Bp3H8K0-.js";const W=["standard","simple","whitespace","stop","keyword","pattern","language","fingerprint"];function oe(){const{id:l}=K(),[g,w]=n.useState(""),[k,I]=n.useState("standard"),[u,E]=n.useState(!1),[i,O]=n.useState(""),[f,y]=n.useState(""),[a,R]=n.useState(""),[d,q]=n.useState(""),[o,B]=n.useState(""),{data:z}=P({queryKey:["cluster",l,"indices"],queryFn:()=>v.getIndices(l),enabled:!!l&&u}),{data:T}=P({queryKey:["cluster",l,"index",i,"fields"],queryFn:()=>v.getIndexFields(l,i),enabled:!!l&&!!i&&u}),c=Z({mutationFn:s=>v.analyzeText(l,s),onError:s=>{N.show({title:"Error",message:`Failed to analyze text: ${s.message}`,color:"red"})}}),D=()=>{if(!g.trim()){N.show({title:"Error",message:"Please enter text to analyze",color:"red"});return}const s={text:g};u&&i&&f?(s.index=i,s.field=f):a||d||o?(a&&(s.tokenizer=a),d&&(s.filter=d.split(",").map(h=>h.trim()).filter(Boolean)),o&&(s.charFilter=o.split(",").map(h=>h.trim()).filter(Boolean))):s.analyzer=k,c.mutate(s)},G=()=>{w(""),I("standard"),E(!1),O(""),y(""),R(""),q(""),B(""),c.reset()};return l?e.jsxs(U,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(L,{order:2,children:"Text Analysis"}),e.jsx(r,{size:"sm",c:"dimmed",children:"Test and debug search analysis chains"})]}),e.jsx(_,{leftSection:e.jsx(M,{size:16}),variant:"light",onClick:G,children:"Reset"})]}),e.jsxs(m,{gap:"md",children:[e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsx(V,{label:"Text to Analyze",placeholder:"Enter text to analyze...",value:g,onChange:s=>w(s.currentTarget.value),minRows:4,maxRows:8,required:!0}),e.jsxs(x,{grow:!0,align:"flex-start",children:[e.jsx(S,{label:"Analyzer",placeholder:"Select analyzer",value:k,onChange:s=>I(s||"standard"),data:W,disabled:u||!!a}),e.jsx(S,{label:"Use Field Analyzer",placeholder:"Select index",value:i,onChange:s=>{O(s||""),y(""),E(!!s)},data:(z==null?void 0:z.map(s=>({value:s.name,label:s.name})))||[],searchable:!0,clearable:!0,disabled:!!a}),i&&e.jsx(S,{label:"Field",placeholder:"Select field",value:f,onChange:s=>y(s||""),data:(T==null?void 0:T.fields.filter(s=>s.analyzer||s.type==="text").map(s=>({value:s.name,label:`${s.name} (${s.analyzer||"default"})`})))||[],searchable:!0,clearable:!0})]}),e.jsx(p,{variant:"contained",children:e.jsxs(p.Item,{value:"custom",children:[e.jsx(p.Control,{children:e.jsx(r,{size:"sm",fw:500,children:"Custom Analyzer Definition"})}),e.jsx(p.Panel,{children:e.jsxs(m,{gap:"sm",children:[e.jsx(b,{icon:e.jsx(C,{size:16}),color:"blue",variant:"light",children:e.jsx(r,{size:"sm",children:"Define a custom analyzer by specifying tokenizer and filters. This will override the selected analyzer."})}),e.jsx(F,{label:"Tokenizer",placeholder:"e.g., standard, whitespace, keyword",value:a,onChange:s=>R(s.currentTarget.value)}),e.jsx(F,{label:"Token Filters (comma-separated)",placeholder:"e.g., lowercase, stop, snowball",value:d,onChange:s=>q(s.currentTarget.value)}),e.jsx(F,{label:"Character Filters (comma-separated)",placeholder:"e.g., html_strip, mapping",value:o,onChange:s=>B(s.currentTarget.value)})]})})]})}),e.jsx(x,{justify:"flex-end",children:e.jsx(_,{leftSection:e.jsx(Q,{size:16}),onClick:D,loading:c.isPending,children:"Analyze"})})]})}),c.data&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(L,{order:3,children:"Analysis Results"}),e.jsxs($,{size:"lg",variant:"light",children:[c.data.tokens.length," tokens"]})]}),(a||d||o)&&e.jsx(b,{icon:e.jsx(C,{size:16}),color:"blue",variant:"light",children:e.jsxs(m,{gap:"xs",children:[e.jsx(r,{size:"sm",fw:500,children:"Analyzer Chain:"}),o&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Char Filters:"})," ",o]}),a&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Tokenizer:"})," ",a]}),d&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Token Filters:"})," ",d]})]})}),e.jsxs(t,{striped:!0,highlightOnHover:!0,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Position"}),e.jsx(t.Th,{children:"Token"}),e.jsx(t.Th,{children:"Type"}),e.jsx(t.Th,{children:"Start Offset"}),e.jsx(t.Th,{children:"End Offset"}),e.jsx(t.Th,{children:"Attributes"})]})}),e.jsx(t.Tbody,{children:c.data.tokens.map((s,h)=>e.jsxs(t.Tr,{children:[e.jsx(t.Td,{children:e.jsx($,{variant:"light",children:s.position})}),e.jsx(t.Td,{children:e.jsx(H,{children:s.token})}),e.jsx(t.Td,{children:e.jsx(r,{size:"sm",c:"dimmed",children:s.type})}),e.jsx(t.Td,{children:s.startOffset}),e.jsx(t.Td,{children:s.endOffset}),e.jsx(t.Td,{children:Object.entries(s).filter(([j])=>!["token","startOffset","endOffset","type","position","positionLength"].includes(j)).map(([j,J])=>e.jsxs(r,{size:"xs",c:"dimmed",children:[j,": ",JSON.stringify(J)]},j))})]},h))})]})]})}),c.isPending&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(x,{justify:"center",children:[e.jsx(Y,{size:"lg"}),e.jsx(r,{children:"Analyzing text..."})]})})]})]}):e.jsx(U,{size:"xl",children:e.jsx(b,{icon:e.jsx(C,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{oe as TextAnalysisPage};
