import{e as J,O as Q,r as i,k as F,j as e,A as b,I as y,G as o,l as u,L as X,S as I,a1 as Y,a3 as L,Y as M,X as R,J as N,m as v}from"./index-DvANkIt0.js";import{u as U}from"./useMutation-KhlDFPKq.js";import{C as O}from"./Container-CLpVDR5E.js";import{T as B}from"./Title-Dlj-9FS2.js";import{B as T}from"./Button-BlELzrpy.js";import{C as A}from"./Card-CQsUkA7X.js";import{A as g}from"./Accordion-Cu4ONKoD.js";import{C as W}from"./Code-Cc9PITHw.js";import{B as _}from"./Badge-BXjqEzT9.js";import{T as Z}from"./TextInput-BNE3QKoz.js";import{T as l}from"./Table-CbenSVNe.js";import{I as ee,a as se}from"./IconSortDescending-CBF0bmDO.js";import"./get-safe-id-Bp3H8K0-.js";var te=J("help","IconHelp",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 17l0 .01",key:"svg-1"}],["path",{d:"M12 13.5a1.5 1.5 0 0 1 1 -1.5a2.6 2.6 0 1 0 -3 -4",key:"svg-2"}]]);const re={aliases:"Show alias information",allocation:"Show shard allocation across nodes",count:"Show document counts",fielddata:"Show fielddata memory usage",health:"Show cluster health",indices:"Show index information",master:"Show master node",nodeattrs:"Show node attributes",nodes:"Show node information",pending_tasks:"Show pending cluster tasks",plugins:"Show installed plugins",recovery:"Show index recovery information",repositories:"Show snapshot repositories",segments:"Show segment information",shards:"Show shard information",snapshots:"Show snapshots",tasks:"Show running tasks",templates:"Show index templates",thread_pool:"Show thread pool statistics"};function ge(){const{id:a}=Q(),[r,z]=i.useState(""),[c,E]=i.useState(""),[d,k]=i.useState(null),[p,f]=i.useState("asc"),[x,S]=i.useState(!1),{data:C}=F({queryKey:["cluster",a,"cat-endpoints"],queryFn:()=>v.getCatEndpoints(a),enabled:!!a}),t=U({mutationFn:s=>v.executeCatApi(a,s),onError:s=>{N.show({title:"Error",message:`Failed to execute Cat API: ${s.message}`,color:"red"})}}),{data:P}=F({queryKey:["cluster",a,"cat-help",r],queryFn:()=>v.getCatApiHelp(a,r),enabled:!!a&&!!r&&x}),$=()=>{if(!r){N.show({title:"Error",message:"Please select a Cat API endpoint",color:"red"});return}t.mutate(r)},G=()=>{z(""),E(""),k(null),f("asc"),S(!1),t.reset()},K=()=>{S(!x)},V=s=>{d===s?f(p==="asc"?"desc":"asc"):(k(s),f("asc"))},H=i.useMemo(()=>!t.data||t.data.length===0?[]:Object.keys(t.data[0]),[t.data]),w=i.useMemo(()=>{if(!t.data)return[];let s=[...t.data];if(c.trim()){const m=c.toLowerCase();s=s.filter(n=>Object.values(n).some(h=>String(h).toLowerCase().includes(m)))}return d&&s.sort((m,n)=>{const h=m[d],j=n[d];if(typeof h=="number"&&typeof j=="number")return p==="asc"?h-j:j-h;const q=String(h).toLowerCase(),D=String(j).toLowerCase();return p==="asc"?q.localeCompare(D):D.localeCompare(q)}),s},[t.data,c,d,p]);return a?e.jsxs(O,{size:"xl",py:"md",children:[e.jsxs(o,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(B,{order:2,children:"Cat API"}),e.jsx(u,{size:"sm",c:"dimmed",children:"Access Elasticsearch Cat APIs for compact, human-readable cluster information"})]}),e.jsx(T,{leftSection:e.jsx(X,{size:16}),variant:"light",onClick:G,children:"Reset"})]}),e.jsxs(I,{gap:"md",children:[e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(I,{gap:"md",children:[e.jsx(Y,{label:"Cat API Endpoint",placeholder:"Select an endpoint",value:r,onChange:s=>{z(s||""),t.reset(),S(!1)},data:(C==null?void 0:C.map(s=>({value:s,label:`${s} - ${re[s]||"No description"}`})))||[],searchable:!0,required:!0}),e.jsxs(o,{justify:"space-between",children:[e.jsx(T,{leftSection:e.jsx(te,{size:16}),variant:"light",onClick:K,disabled:!r,children:x?"Hide Help":"Show Help"}),e.jsx(T,{leftSection:e.jsx(L,{size:16}),onClick:$,loading:t.isPending,disabled:!r,children:"Execute"})]}),x&&r&&e.jsx(g,{variant:"contained",children:e.jsxs(g.Item,{value:"help",children:[e.jsx(g.Control,{children:e.jsxs(u,{size:"sm",fw:500,children:["Help for ",r]})}),e.jsx(g.Panel,{children:P?e.jsx(M,{h:200,children:e.jsx(W,{block:!0,children:P})}):e.jsxs(o,{justify:"center",children:[e.jsx(R,{size:"sm"}),e.jsx(u,{size:"sm",children:"Loading help text..."})]})})]})})]})}),t.data&&t.data.length>0&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(I,{gap:"md",children:[e.jsxs(o,{justify:"space-between",children:[e.jsxs(o,{children:[e.jsx(B,{order:3,children:"Results"}),e.jsxs(_,{size:"lg",variant:"light",children:[w.length," rows"]})]}),e.jsx(Z,{placeholder:"Filter results...",value:c,onChange:s=>E(s.currentTarget.value),w:300,leftSection:e.jsx(L,{size:16})})]}),e.jsx(M,{children:e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsx(l.Tr,{children:H.map(s=>e.jsx(l.Th,{onClick:()=>V(s),style:{cursor:"pointer",userSelect:"none"},children:e.jsxs(o,{gap:"xs",children:[e.jsx(u,{size:"sm",fw:500,children:s}),d===s&&(p==="asc"?e.jsx(ee,{size:14}):e.jsx(se,{size:14}))]})},s))})}),e.jsx(l.Tbody,{children:w.map((s,m)=>e.jsx(l.Tr,{children:H.map(n=>e.jsx(l.Td,{children:typeof s[n]=="number"?e.jsx(_,{variant:"light",children:s[n]}):e.jsx(u,{size:"sm",children:String(s[n])})},n))},m))})]})}),w.length===0&&c&&e.jsxs(b,{icon:e.jsx(y,{size:16}),color:"blue",variant:"light",children:['No results match the filter "',c,'"']})]})}),t.data&&t.data.length===0&&e.jsx(b,{icon:e.jsx(y,{size:16}),color:"blue",variant:"light",children:"No data returned from the Cat API endpoint"}),t.isPending&&e.jsx(A,{shadow:"sm",padding:"lg",children:e.jsxs(o,{justify:"center",children:[e.jsx(R,{size:"lg"}),e.jsx(u,{children:"Executing Cat API request..."})]})})]})]}):e.jsx(O,{size:"xl",children:e.jsx(b,{icon:e.jsx(y,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{ge as CatApiPage};
