import{V as A,h as y,i as B,k as I,j as e,A as p,I as u,G as x,$ as N,l as T,m as s,S as c,a6 as C,a0 as M,n as r,o as S}from"./index-CwzioJkk.js";import{u as L}from"./useWatermarks-LJzADwcD.js";import{C as j}from"./Container-Bv7ARc2U.js";import{B as U}from"./Button-ArqycEcV.js";import{I as F}from"./IconArrowLeft-CMizUwKK.js";import{B as q}from"./Badge-DWwZZuc-.js";import{G as o}from"./Grid-CYpQqY9L.js";import{C as a}from"./Card-8DsUvoCZ.js";function g(n){if(n===0)return"0 B";const d=1024,t=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(n)/Math.log(d));return`${(n/Math.pow(d,l)).toFixed(2)} ${t[l]}`}function b(n){return Math.round(n)}function K(){var f,v,w;const{id:n,nodeId:d}=A(),t=y(),l=B(),{getColor:m}=L(n),{data:i,isLoading:P,error:z}=I({queryKey:["cluster",n,"node",d,"stats"],queryFn:()=>S.getNodeStats(n,d),refetchInterval:l,enabled:!!n&&!!d});return!n||!d?e.jsx(j,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Cluster ID and Node ID are required"})}):P?e.jsx(j,{size:"xl",children:e.jsx(x,{justify:"center",mt:"xl",children:e.jsx(N,{size:"lg"})})}):z?e.jsx(j,{size:"xl",children:e.jsxs(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:["Failed to load node statistics: ",z.message]})}):i?e.jsxs(j,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(x,{gap:"xs",mb:"xs",children:e.jsx(U,{variant:"subtle",leftSection:e.jsx(F,{size:16}),onClick:()=>t(`/cluster/${n}`),children:"Back to Cluster"})}),e.jsx(T,{order:1,children:i.name}),e.jsxs(s,{size:"sm",c:"dimmed",children:["Node ID: ",i.id]}),i.ip&&e.jsxs(s,{size:"sm",c:"dimmed",children:["IP: ",i.ip]})]}),e.jsx(x,{children:i.roles.map(h=>e.jsx(q,{size:"lg",variant:"light",children:h},h))})]}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"Elasticsearch Version"}),e.jsx(s,{size:"lg",fw:700,children:i.version})]})})}),e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"JVM Version"}),e.jsx(s,{size:"lg",fw:700,children:i.jvmVersion})]})})}),i.uptime&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"Uptime"}),e.jsx(s,{size:"lg",fw:700,children:i.uptime})]})})}),i.cpuPercent!==void 0&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"CPU Usage"}),e.jsxs(s,{size:"lg",fw:700,children:[i.cpuPercent,"%"]})]})})})]}),i.loadAverage&&i.loadAverage.length>0&&e.jsx(a,{shadow:"sm",padding:"lg",mb:"md",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Load Average"}),e.jsxs(x,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"1 min"}),e.jsx(s,{size:"lg",fw:700,children:((f=i.loadAverage[0])==null?void 0:f.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"5 min"}),e.jsx(s,{size:"lg",fw:700,children:((v=i.loadAverage[1])==null?void 0:v.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"15 min"}),e.jsx(s,{size:"lg",fw:700,children:((w=i.loadAverage[2])==null?void 0:w.toFixed(2))||"N/A"})]})]})]})}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Heap Memory Usage"}),e.jsx(C,{value:i.heapPercent,color:m(i.heapPercent),size:"sm",radius:"xs"}),e.jsxs(s,{size:"xs",c:"dimmed",children:[g(i.heapUsed)," / ",g(i.heapMax)," (",b(i.heapPercent),"%)"]})]})})}),e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Disk Usage"}),e.jsx(C,{value:i.diskPercent,color:m(i.diskPercent),size:"sm",radius:"xs"}),e.jsxs(s,{size:"xs",c:"dimmed",children:[g(i.diskUsed)," / ",g(i.diskTotal)," (",b(i.diskPercent),"%)"]})]})})})]}),e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"md",children:[e.jsx(T,{order:3,children:"Thread Pool Statistics"}),e.jsx(s,{size:"sm",c:"dimmed",children:"Thread pool statistics show the current state of various thread pools in the node. Queue sizes indicate pending work, and rejected counts show when pools are overloaded."}),e.jsx(M,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Pool Name"}),e.jsx(r.Th,{children:"Threads"}),e.jsx(r.Th,{children:"Active"}),e.jsx(r.Th,{children:"Queue"}),e.jsx(r.Th,{children:"Largest"}),e.jsx(r.Th,{children:"Completed"}),e.jsx(r.Th,{children:"Rejected"})]})}),e.jsx(r.Tbody,{children:Object.entries(i.threadPools).map(([h,k])=>e.jsx(D,{poolName:h,stats:k},h))})]})}),Object.keys(i.threadPools).length===0&&e.jsx(s,{c:"dimmed",ta:"center",py:"xl",children:"No thread pool statistics available"})]})})]}):e.jsx(j,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Node statistics not found"})})}function D({poolName:n,stats:d}){const t=d.queue>100,l=d.rejected>0,m=l?"var(--mantine-color-red-light)":t?"var(--mantine-color-yellow-light)":void 0;return e.jsxs(r.Tr,{style:{backgroundColor:m},children:[e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:500,children:n})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.threads})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.active})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:t?700:void 0,c:t?"yellow":void 0,children:d.queue})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.largest})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.completed.toLocaleString()})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:l?700:void 0,c:l?"red":void 0,children:d.rejected.toLocaleString()})})]})}export{K as NodeDetail};
