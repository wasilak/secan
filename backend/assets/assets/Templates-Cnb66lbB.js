import{q as N,h as w,r as O,b as A,j as e,A as P,I as S,G as j,L as E,T as M,d as m,w as C,S as z,v as F,e as t,l as J,n as l,f as y,p as k}from"./index-YMbInTd0.js";import{u as q}from"./useMutation-eYy5jBRY.js";import{C as u}from"./Container-CW6hI4Fd.js";import{B as g}from"./Button-D3Lq9Mp4.js";import{C as _}from"./Card-CD-BRk3u.js";import{B as I}from"./Badge-CeNsrh4N.js";import{I as L}from"./IconTrash-CN_fkyRA.js";import{u as B}from"./use-form-C8iZJxEY.js";import{T as v}from"./TextInput-DynJ5RHm.js";import{S as Q}from"./Switch-Dh8iBi-Y.js";import{N as f}from"./NumberInput-DTE-bb3C.js";import{T as a}from"./Tabs-D5fpt5IL.js";import{T as b}from"./Textarea-CVFpPu6v.js";import"./InputsGroupFieldset-B_bhj5rY.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";function ne(){const{id:o}=N(),d=w(),[p,c]=O.useState(!1),{data:i,isLoading:x,error:h}=A({queryKey:["cluster",o,"templates"],queryFn:()=>y.getTemplates(o),enabled:!!o}),s=q({mutationFn:({name:r,composable:n})=>y.deleteTemplate(o,r,n),onSuccess:()=>{d.invalidateQueries({queryKey:["cluster",o,"templates"]}),l.show({title:"Success",message:"Template deleted successfully",color:"green"})},onError:r=>{l.show({title:"Error",message:`Failed to delete template: ${r.message}`,color:"red"})}});return o?x?e.jsx(u,{size:"xl",children:e.jsx(j,{justify:"center",mt:"xl",children:e.jsx(E,{size:"lg"})})}):h?e.jsx(u,{size:"xl",children:e.jsxs(P,{icon:e.jsx(S,{size:16}),title:"Error",color:"red",children:["Failed to load templates: ",h.message]})}):e.jsxs(u,{size:"xl",py:"md",children:[e.jsxs(j,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(M,{order:2,children:"Index Templates"}),e.jsx(m,{size:"sm",c:"dimmed",children:"Manage index templates for consistent settings across indices"})]}),e.jsx(g,{leftSection:e.jsx(C,{size:16}),onClick:()=>c(!0),children:"Create Template"})]}),e.jsx(_,{shadow:"sm",padding:"lg",children:!i||i.length===0?e.jsxs(z,{gap:"md",align:"center",py:"xl",children:[e.jsx(m,{c:"dimmed",children:"No templates found"}),e.jsx(g,{leftSection:e.jsx(C,{size:16}),onClick:()=>c(!0),children:"Create Template"})]}):e.jsx(F,{children:e.jsxs(t,{striped:!0,highlightOnHover:!0,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Name"}),e.jsx(t.Th,{children:"Type"}),e.jsx(t.Th,{children:"Index Patterns"}),e.jsx(t.Th,{children:"Priority/Order"}),e.jsx(t.Th,{children:"Version"}),e.jsx(t.Th,{children:"Actions"})]})}),e.jsx(t.Tbody,{children:i.map(r=>e.jsxs(t.Tr,{children:[e.jsx(t.Td,{children:e.jsx(m,{size:"sm",fw:500,children:r.name})}),e.jsx(t.Td,{children:e.jsx(I,{size:"sm",variant:"light",color:r.composable?"blue":"gray",children:r.composable?"Composable":"Legacy"})}),e.jsx(t.Td,{children:e.jsx(j,{gap:"xs",children:r.indexPatterns.map(n=>e.jsx(I,{size:"sm",variant:"outline",children:n},n))})}),e.jsx(t.Td,{children:e.jsx(m,{size:"sm",children:r.priority!==void 0?r.priority:r.order!==void 0?r.order:"N/A"})}),e.jsx(t.Td,{children:e.jsx(m,{size:"sm",children:r.version||"N/A"})}),e.jsx(t.Td,{children:e.jsx(J,{color:"red",variant:"subtle",onClick:()=>{confirm(`Delete template "${r.name}"?`)&&s.mutate({name:r.name,composable:r.composable||!1})},loading:s.isPending,children:e.jsx(L,{size:16})})})]},r.name))})]})})}),e.jsx(R,{opened:p,onClose:()=>c(!1),clusterId:o})]}):e.jsx(u,{size:"xl",children:e.jsx(P,{icon:e.jsx(S,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function R({opened:o,onClose:d,clusterId:p}){const c=w(),i=B({initialValues:{name:"",indexPatterns:[],indexPatternsText:"",priority:void 0,order:void 0,version:void 0,settings:void 0,settingsText:"",mappings:void 0,mappingsText:"",aliases:void 0,aliasesText:"",composable:!0},validate:{name:s=>s?s.startsWith("_")||s.startsWith("-")||s.startsWith("+")?"Template name cannot start with _, -, or +":null:"Template name is required",indexPatternsText:s=>s?null:"At least one index pattern is required"}}),x=q({mutationFn:s=>y.createTemplate(p,s),onSuccess:()=>{c.invalidateQueries({queryKey:["cluster",p,"templates"]}),l.show({title:"Success",message:"Template created successfully",color:"green"}),i.reset(),d()},onError:s=>{l.show({title:"Error",message:`Failed to create template: ${s.message}`,color:"red"})}}),h=i.onSubmit(s=>{try{const r=s.indexPatternsText.split(",").map(T=>T.trim()).filter(T=>T.length>0);if(r.length===0){l.show({title:"Error",message:"At least one index pattern is required",color:"red"});return}const n={name:s.name,indexPatterns:r,composable:s.composable};s.composable&&s.priority!==void 0&&(n.priority=s.priority),!s.composable&&s.order!==void 0&&(n.order=s.order),s.version!==void 0&&(n.version=s.version),s.settingsText&&(n.settings=JSON.parse(s.settingsText)),s.mappingsText&&(n.mappings=JSON.parse(s.mappingsText)),s.aliasesText&&(n.aliases=JSON.parse(s.aliasesText)),x.mutate(n)}catch(r){l.show({title:"Error",message:`Invalid JSON: ${r.message}`,color:"red"})}});return e.jsx(k,{opened:o,onClose:d,title:"Create Template",size:"xl",children:e.jsx("form",{onSubmit:h,children:e.jsxs(z,{gap:"md",children:[e.jsx(v,{label:"Template Name",placeholder:"my-template",required:!0,...i.getInputProps("name")}),e.jsx(Q,{label:"Composable Template",description:"Use composable template format (Elasticsearch 7.8+)",...i.getInputProps("composable",{type:"checkbox"})}),e.jsx(v,{label:"Index Patterns",placeholder:"logs-*, metrics-*",description:"Comma-separated list of index patterns",required:!0,...i.getInputProps("indexPatternsText")}),i.values.composable?e.jsx(f,{label:"Priority",placeholder:"100",description:"Higher priority templates override lower priority ones",min:0,...i.getInputProps("priority")}):e.jsx(f,{label:"Order",placeholder:"0",description:"Higher order templates override lower order ones",min:0,...i.getInputProps("order")}),e.jsx(f,{label:"Version",placeholder:"1",description:"Optional version number",min:1,...i.getInputProps("version")}),e.jsxs(a,{defaultValue:"settings",children:[e.jsxs(a.List,{children:[e.jsx(a.Tab,{value:"settings",children:"Settings"}),e.jsx(a.Tab,{value:"mappings",children:"Mappings"}),e.jsx(a.Tab,{value:"aliases",children:"Aliases"})]}),e.jsx(a.Panel,{value:"settings",pt:"md",children:e.jsx(b,{label:"Settings (JSON)",placeholder:'{"number_of_shards": 1, "number_of_replicas": 1}',minRows:6,...i.getInputProps("settingsText")})}),e.jsx(a.Panel,{value:"mappings",pt:"md",children:e.jsx(b,{label:"Mappings (JSON)",placeholder:'{"properties": {"field1": {"type": "text"}}}',minRows:6,...i.getInputProps("mappingsText")})}),e.jsx(a.Panel,{value:"aliases",pt:"md",children:e.jsx(b,{label:"Aliases (JSON)",placeholder:'{"my-alias": {}}',minRows:6,...i.getInputProps("aliasesText")})})]}),e.jsxs(j,{justify:"flex-end",mt:"md",children:[e.jsx(g,{variant:"subtle",onClick:d,children:"Cancel"}),e.jsx(g,{type:"submit",loading:x.isPending,children:"Create Template"})]})]})})})}export{ne as Templates};
