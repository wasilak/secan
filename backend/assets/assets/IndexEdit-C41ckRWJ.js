import{i as de,k as le,l as ce,j as s,B as ue,n as pe,o as ge,a1 as P,c as me,K as he,u as fe,y as xe,a0 as ye,N as je,r as u,b as U,A as M,I as J,G as A,S as w,T as Se,d as p,R as be,V as ve,Z as G,D as we,f as R}from"./index-C4Gs3_hh.js";import{u as Ee}from"./useMutation-2uswMnry.js";import{C as $}from"./Container-C59Nx5C5.js";import{C as B}from"./Card-D9yBYRL9.js";import{B as T}from"./Button-C-XD6IT6.js";import{T as y}from"./Tabs-DBWs64CL.js";import{I as Ce}from"./IconCheck-BqPwVvsb.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";var Y={root:"m_18320242","skeleton-fade":"m_299c329c"};const _e={visible:!0,animate:!0},ke=pe((t,{width:r,height:e,radius:n,circle:a})=>({root:{"--skeleton-height":P(e),"--skeleton-width":a?P(e):P(r),"--skeleton-radius":a?"1000px":n===void 0?void 0:ge(n)}})),m=de((t,r)=>{const e=le("Skeleton",_e,t),{classNames:n,className:a,style:d,styles:h,unstyled:j,vars:l,width:g,height:f,circle:E,visible:C,radius:S,animate:_,mod:x,...k}=e,c=ce({name:"Skeleton",classes:Y,props:e,className:a,style:d,classNames:n,styles:h,unstyled:j,vars:l,varsResolver:ke});return s.jsx(ue,{ref:r,...c("root"),mod:[{visible:C,animate:_},x],...k})});m.classes=Y;m.displayName="@mantine/core/Skeleton";var Ie=me("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function Q(t){var r;if(console.error("Error occurred:",t),t&&typeof t=="object"&&"name"in t&&t.name==="ApiClientError"&&"message"in t&&"statusCode"in t){const e=t;if(e.error){const n=V(e.error);if(n)return{error:"elasticsearch_error",message:n,statusCode:e.statusCode,details:e.error}}return{error:"api_error",message:e.message,statusCode:e.statusCode,details:e.error}}if(t&&typeof t=="object"&&"response"in t){const e=t.response;if(e!=null&&e.data){const n=V(e.data);return{error:e.data.error||"api_error",message:n||e.data.message||"An error occurred",details:e.data.details,statusCode:e.status,requestId:(r=e.headers)==null?void 0:r["x-request-id"]}}return{error:"http_error",message:`HTTP ${(e==null?void 0:e.status)||"Unknown"}: ${(e==null?void 0:e.statusText)||"Request failed"}`,statusCode:e==null?void 0:e.status}}if(t&&typeof t=="object"&&"message"in t){const e=t;return e.message.includes("Network")||e.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:e.message}:{error:"error",message:e.message,details:e.stack}}return typeof t=="string"?{error:"error",message:t}:{error:"unknown_error",message:"An unexpected error occurred",details:t}}function V(t){const r=t;if(r.error&&typeof r.error=="object"){const e=r.error;if(e.reason&&typeof e.reason=="string"){let n=`Elasticsearch: ${e.reason}`;if(e.type&&typeof e.type=="string"&&(n=`Elasticsearch (${e.type}): ${e.reason}`),e.root_cause&&Array.isArray(e.root_cause)&&e.root_cause.length>0){const a=e.root_cause[0];a.reason&&a.reason!==e.reason&&(n+=`
Root cause: ${a.reason}`)}return n}}if("details"in r&&r.details&&typeof r.details=="object"){const e=r.details;if(e.error&&typeof e.error=="object"){const n=e.error;if(n.reason&&typeof n.reason=="string"){let a=`Elasticsearch: ${n.reason}`;if(n.type&&typeof n.type=="string"&&(a=`Elasticsearch (${n.type}): ${n.reason}`),n.root_cause&&Array.isArray(n.root_cause)&&n.root_cause.length>0){const d=n.root_cause[0];d.reason&&d.reason!==n.reason&&(a+=`
Root cause: ${d.reason}`)}return a}}}return null}function H(t,r){if(!t.trim())return`${r} cannot be empty`;try{return JSON.parse(t),null}catch(e){return e.message}}function F(t){const r=["creation_date","provided_name","uuid","version"],e=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path"],n=[...r,...e],a={};for(const[d,h]of Object.entries(t))if(d==="index"){const j=h,l={};for(const[g,f]of Object.entries(j))n.includes(g)||(l[g]=f);Object.keys(l).length>0&&(a[d]=l)}else n.includes(d)||(a[d]=h);return a}function Pe(){const{id:t,indexName:r}=he(),e=fe(),n=xe(),{resolvedTheme:a}=ye(),[d,h]=je(),j=d.get("tab")||"settings",[l,g]=u.useState(""),[f,E]=u.useState(""),[C,S]=u.useState(null),[_,x]=u.useState(null),[k,c]=u.useState(null),[q,I]=u.useState(!1),[L,z]=u.useState(!1),{data:b,isLoading:Z,error:W}=U({queryKey:["cluster",t,"index",r,"settings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const o=(await R.proxyRequest(t,"GET",`/${r}/_settings`))[r];return o==null?void 0:o.settings},enabled:!!t&&!!r}),{data:v,isLoading:X,error:ee}=U({queryKey:["cluster",t,"index",r,"mappings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const o=(await R.proxyRequest(t,"GET",`/${r}/_mapping`))[r];return o==null?void 0:o.mappings},enabled:!!t&&!!r});u.useEffect(()=>{if(b){const i=F(b);g(JSON.stringify(i,null,2)),I(!1)}},[b]),u.useEffect(()=>{v&&(E(JSON.stringify(v,null,2)),z(!1))},[v]);const N=Ee({mutationFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const i=[];if(q){const o=H(l,"Settings");if(o)throw S(o),new Error(`Invalid settings JSON: ${o}`);const O=JSON.parse(l),oe=F(O);i.push(R.proxyRequest(t,"PUT",`/${r}/_settings`,oe))}if(L){const o=H(f,"Mappings");if(o)throw x(o),new Error(`Invalid mappings JSON: ${o}`);const O=JSON.parse(f);i.push(R.proxyRequest(t,"PUT",`/${r}/_mapping`,O))}await Promise.all(i)},onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",t,"index",r]}),n.invalidateQueries({queryKey:["cluster",t,"indices"]});const i=[];q&&i.push("settings"),L&&i.push("mappings"),we.show({title:"Success",message:`Index ${i.join(" and ")} updated successfully`,color:"green",icon:s.jsx(Ce,{size:16})}),I(!1),z(!1),c(null)},onError:i=>{const o=Q(i);c(o.message)}}),se=i=>{g(i||""),S(null),c(null),I(!0)},te=i=>{E(i||""),x(null),c(null),z(!0)},re=()=>{S(null),x(null),c(null),N.mutate()},ne=()=>{if(b){const i=F(b);g(JSON.stringify(i,null,2)),I(!1)}v&&(E(JSON.stringify(v,null,2)),z(!1)),S(null),x(null),c(null)},ie=i=>{i&&h({tab:i})},ae=Z||X,D=W||ee,K=q||L;if(!t||!r)return s.jsx($,{size:"xl",children:s.jsx(M,{icon:s.jsx(J,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(ae)return s.jsxs($,{size:"xl",py:"md",children:[s.jsxs(A,{justify:"space-between",mb:"md",children:[s.jsxs("div",{children:[s.jsx(m,{height:32,width:200,mb:"xs"}),s.jsx(m,{height:20,width:150})]}),s.jsx(m,{height:36,width:120})]}),s.jsxs(w,{gap:"md",children:[s.jsx(m,{height:48,width:"100%"}),s.jsx(B,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:s.jsx(m,{height:400})})]})]});if(D){const i=Q(D);return s.jsxs($,{size:"xl",py:"md",children:[s.jsx(M,{icon:s.jsx(J,{size:16}),title:"Error Loading Index",color:"red",children:i.message}),s.jsx(T,{variant:"default",onClick:()=>e(`/cluster/${t}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return s.jsxs($,{size:"xl",py:"md",children:[s.jsxs(A,{justify:"space-between",mb:"md",children:[s.jsxs("div",{children:[s.jsx(Se,{order:1,children:"Edit Index"}),s.jsx(p,{size:"sm",c:"dimmed",children:r})]}),s.jsx(T,{variant:"default",onClick:()=>e(`/cluster/${t}?tab=indices`),children:"Back to Indices"})]}),s.jsxs(w,{gap:"md",children:[s.jsxs(y,{value:j,onChange:ie,children:[s.jsxs(y.List,{children:[s.jsx(y.Tab,{value:"settings",leftSection:s.jsx(be,{size:16}),children:"Settings"}),s.jsx(y.Tab,{value:"mappings",leftSection:s.jsx(ve,{size:16}),children:"Mappings"})]}),s.jsx(y.Panel,{value:"settings",pt:"md",children:s.jsx(B,{shadow:"sm",padding:"lg",children:s.jsx(w,{gap:"md",children:s.jsxs("div",{children:[s.jsx(p,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),s.jsx(p,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the settings below. Static and read-only settings are automatically filtered."}),s.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:s.jsx(G,{height:"500px",defaultLanguage:"json",value:l,onChange:se,theme:a==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),C&&s.jsx(p,{size:"sm",c:"red",mt:"xs",children:C})]})})})}),s.jsx(y.Panel,{value:"mappings",pt:"md",children:s.jsxs(w,{gap:"md",children:[s.jsx(M,{icon:s.jsx(Ie,{size:16}),color:"yellow",title:"Mapping Restrictions",children:s.jsxs(p,{size:"sm",children:[s.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",s.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),s.jsx(B,{shadow:"sm",padding:"lg",children:s.jsx(w,{gap:"md",children:s.jsxs("div",{children:[s.jsx(p,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),s.jsx(p,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),s.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:s.jsx(G,{height:"500px",defaultLanguage:"json",value:f,onChange:te,theme:a==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),_&&s.jsx(p,{size:"sm",c:"red",mt:"xs",children:_})]})})})]})})]}),k&&s.jsx(M,{icon:s.jsx(J,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>c(null),children:s.jsx(p,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:k})}),s.jsxs(A,{justify:"flex-end",children:[s.jsx(T,{variant:"default",onClick:ne,disabled:!K||N.isPending,children:"Reset"}),s.jsx(T,{onClick:re,loading:N.isPending,disabled:!K,children:N.isPending?"Saving...":"Save Changes"})]})]})]})}export{Pe as IndexEdit};
