import{Z as fe,z as O,_ as q,j as e,$ as U,r as h,a0 as xe,i as ye,a1 as je,E as ve,K as we,a2 as Se,W as be,a3 as Ce,a4 as F,c as Ee,q as _e,u as ke,h as ze,Y as Me,s as Ie,b as V,A as N,I as J,G as P,S as _,T as Te,d as u,x as Ne,y as Pe,F as W,n as $e,f as $}from"./index-CPK0MYCZ.js";import{u as De}from"./useMutation-CDxTfcSO.js";import{C as D}from"./Container-StGwcjYs.js";import{C as B}from"./Card-VsFLtjtE.js";import{B as L}from"./Button-BPEoY144.js";import{T as S}from"./Tabs-vOD3BVvV.js";import{I as Le}from"./IconCheck-f9JcG006.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";const[qe,se]=fe("HoverCard component was not found in the tree"),Oe={};function te(t){const{children:r,onMouseEnter:s,onMouseLeave:n,...o}=O("HoverCardDropdown",Oe,t),i=se(),l=q(s,i.openDropdown),m=q(n,i.closeDropdown);return e.jsx(U.Dropdown,{onMouseEnter:l,onMouseLeave:m,...o,children:r})}te.displayName="@mantine/core/HoverCardDropdown";const Re={refProp:"ref"},re=h.forwardRef((t,r)=>{const{children:s,refProp:n,eventPropsWrapperName:o,...i}=O("HoverCardTarget",Re,t);if(!xe(s))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const l=se(),m=q(s.props.onMouseEnter,l.openDropdown),c=q(s.props.onMouseLeave,l.closeDropdown),p={onMouseEnter:m,onMouseLeave:c};return e.jsx(U.Target,{refProp:n,ref:r,...i,children:h.cloneElement(s,o?{[o]:p}:p)})});re.displayName="@mantine/core/HoverCardTarget";const He={openDelay:0,closeDelay:150,initiallyOpened:!1};function y(t){const{children:r,onOpen:s,onClose:n,openDelay:o,closeDelay:i,initiallyOpened:l,...m}=O("HoverCard",He,t),[c,{open:p,close:f}]=ye(l,{onClose:n,onOpen:s}),{openDropdown:j,closeDropdown:v}=je({open:p,close:f,openDelay:o,closeDelay:i});return e.jsx(qe,{value:{openDropdown:j,closeDropdown:v},children:e.jsx(U,{...m,opened:c,__staticSelector:"HoverCard",children:r})})}y.displayName="@mantine/core/HoverCard";y.Target=re;y.Dropdown=te;y.extend=t=>t;var ne={root:"m_18320242","skeleton-fade":"m_299c329c"};const Ae={visible:!0,animate:!0},Fe=be((t,{width:r,height:s,radius:n,circle:o})=>({root:{"--skeleton-height":F(s),"--skeleton-width":o?F(s):F(r),"--skeleton-radius":o?"1000px":n===void 0?void 0:Ce(n)}})),x=ve((t,r)=>{const s=O("Skeleton",Ae,t),{classNames:n,className:o,style:i,styles:l,unstyled:m,vars:c,width:p,height:f,circle:j,visible:v,radius:b,animate:k,mod:w,...z}=s,g=we({name:"Skeleton",classes:ne,props:s,className:o,style:i,classNames:n,styles:l,unstyled:m,vars:c,varsResolver:Fe});return e.jsx(Se,{ref:r,...g("root"),mod:[{visible:v,animate:k},w],...z})});x.classes=ne;x.displayName="@mantine/core/Skeleton";var Y=Ee("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function Z(t){var r;if(console.error("Error occurred:",t),t&&typeof t=="object"&&"name"in t&&t.name==="ApiClientError"&&"message"in t&&"statusCode"in t){const s=t;if(s.error){const n=X(s.error);if(n)return{error:"elasticsearch_error",message:n,statusCode:s.statusCode,details:s.error}}return{error:"api_error",message:s.message,statusCode:s.statusCode,details:s.error}}if(t&&typeof t=="object"&&"response"in t){const s=t.response;if(s!=null&&s.data){const n=X(s.data);return{error:s.data.error||"api_error",message:n||s.data.message||"An error occurred",details:s.data.details,statusCode:s.status,requestId:(r=s.headers)==null?void 0:r["x-request-id"]}}return{error:"http_error",message:`HTTP ${(s==null?void 0:s.status)||"Unknown"}: ${(s==null?void 0:s.statusText)||"Request failed"}`,statusCode:s==null?void 0:s.status}}if(t&&typeof t=="object"&&"message"in t){const s=t;return s.message.includes("Network")||s.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:s.message}:{error:"error",message:s.message,details:s.stack}}return typeof t=="string"?{error:"error",message:t}:{error:"unknown_error",message:"An unexpected error occurred",details:t}}function X(t){const r=t;if(r.error&&typeof r.error=="object"){const s=r.error;if(s.reason&&typeof s.reason=="string"){let n=`Elasticsearch: ${s.reason}`;if(s.type&&typeof s.type=="string"&&(n=`Elasticsearch (${s.type}): ${s.reason}`),s.root_cause&&Array.isArray(s.root_cause)&&s.root_cause.length>0){const o=s.root_cause[0];o.reason&&o.reason!==s.reason&&(n+=`
Root cause: ${o.reason}`)}return n}}if("details"in r&&r.details&&typeof r.details=="object"){const s=r.details;if(s.error&&typeof s.error=="object"){const n=s.error;if(n.reason&&typeof n.reason=="string"){let o=`Elasticsearch: ${n.reason}`;if(n.type&&typeof n.type=="string"&&(o=`Elasticsearch (${n.type}): ${n.reason}`),n.root_cause&&Array.isArray(n.root_cause)&&n.root_cause.length>0){const i=n.root_cause[0];i.reason&&i.reason!==n.reason&&(o+=`
Root cause: ${i.reason}`)}return o}}}return null}function ee(t,r){if(!t.trim())return`${r} cannot be empty`;try{return JSON.parse(t),null}catch(s){return s.message}}function K(t){const r=["creation_date","provided_name","uuid","version"],s=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],n=[...r,...s],o={};for(const[i,l]of Object.entries(t))if(i==="index"){const m=l,c={};for(const[p,f]of Object.entries(m))n.includes(p)||(c[p]=f);Object.keys(c).length>0&&(o[i]=c)}else n.includes(i)||(o[i]=l);return o}function Ze(){const{id:t,indexName:r}=_e(),s=ke(),n=ze(),{resolvedTheme:o}=Me(),[i,l]=Ie(),m=i.get("tab")||"settings",[c,p]=h.useState(""),[f,j]=h.useState(""),[v,b]=h.useState(null),[k,w]=h.useState(null),[z,g]=h.useState(null),[R,M]=h.useState(!1),[H,I]=h.useState(!1),{data:C,isLoading:oe,error:ae}=V({queryKey:["cluster",t,"index",r,"settings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await $.proxyRequest(t,"GET",`/${r}/_settings`))[r];return d==null?void 0:d.settings},enabled:!!t&&!!r}),{data:E,isLoading:ie,error:de}=V({queryKey:["cluster",t,"index",r,"mappings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await $.proxyRequest(t,"GET",`/${r}/_mapping`))[r];return d==null?void 0:d.mappings},enabled:!!t&&!!r});h.useEffect(()=>{if(C){const a=K(C);p(JSON.stringify(a,null,2)),M(!1)}},[C]),h.useEffect(()=>{E&&(j(JSON.stringify(E,null,2)),I(!1))},[E]);const T=De({mutationFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const a=[];if(R){const d=ee(c,"Settings");if(d)throw b(d),new Error(`Invalid settings JSON: ${d}`);const A=JSON.parse(c),ge=K(A);a.push($.proxyRequest(t,"PUT",`/${r}/_settings`,ge))}if(H){const d=ee(f,"Mappings");if(d)throw w(d),new Error(`Invalid mappings JSON: ${d}`);const A=JSON.parse(f);a.push($.proxyRequest(t,"PUT",`/${r}/_mapping`,A))}await Promise.all(a)},onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",t,"index",r]}),n.invalidateQueries({queryKey:["cluster",t,"indices"]});const a=[];R&&a.push("settings"),H&&a.push("mappings"),$e.show({title:"Success",message:`Index ${a.join(" and ")} updated successfully`,color:"green",icon:e.jsx(Le,{size:16})}),M(!1),I(!1),g(null)},onError:a=>{const d=Z(a);g(d.message)}}),le=a=>{p(a||""),b(null),g(null),M(!0)},ce=a=>{j(a||""),w(null),g(null),I(!0)},ue=()=>{b(null),w(null),g(null),T.mutate()},pe=()=>{if(C){const a=K(C);p(JSON.stringify(a,null,2)),M(!1)}E&&(j(JSON.stringify(E,null,2)),I(!1)),b(null),w(null),g(null)},me=a=>{a&&l({tab:a})},he=oe||ie,G=ae||de,Q=R||H;if(!t||!r)return e.jsx(D,{size:"xl",children:e.jsx(N,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(he)return e.jsxs(D,{size:"xl",py:"md",children:[e.jsxs(P,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(x,{height:32,width:200,mb:"xs"}),e.jsx(x,{height:20,width:150})]}),e.jsx(x,{height:36,width:120})]}),e.jsxs(_,{gap:"md",children:[e.jsx(x,{height:48,width:"100%"}),e.jsx(B,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(x,{height:400})})]})]});if(G){const a=Z(G);return e.jsxs(D,{size:"xl",py:"md",children:[e.jsx(N,{icon:e.jsx(J,{size:16}),title:"Error Loading Index",color:"red",children:a.message}),e.jsx(L,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(D,{size:"xl",py:"md",children:[e.jsxs(P,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Te,{order:1,children:"Edit Index"}),e.jsx(u,{size:"sm",c:"dimmed",children:r})]}),e.jsx(L,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(_,{gap:"md",children:[e.jsxs(S,{value:m,onChange:me,children:[e.jsxs(S.List,{children:[e.jsx(S.Tab,{value:"settings",leftSection:e.jsx(Ne,{size:16}),children:"Settings"}),e.jsx(S.Tab,{value:"mappings",leftSection:e.jsx(Pe,{size:16}),children:"Mappings"})]}),e.jsx(S.Panel,{value:"settings",pt:"md",children:e.jsx(B,{shadow:"sm",padding:"lg",children:e.jsx(_,{gap:"md",children:e.jsxs("div",{children:[e.jsxs(P,{gap:"xs",mb:"xs",children:[e.jsx(u,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(y,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(y.Target,{children:e.jsx(Y,{size:16,style:{cursor:"help",color:"var(--mantine-color-blue-6)"}})}),e.jsxs(y.Dropdown,{children:[e.jsx(u,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(u,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(u,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(u,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(u,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(W,{height:"500px",defaultLanguage:"json",value:c,onChange:le,theme:o==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),v&&e.jsx(u,{size:"sm",c:"red",mt:"xs",children:v})]})})})}),e.jsx(S.Panel,{value:"mappings",pt:"md",children:e.jsxs(_,{gap:"md",children:[e.jsx(N,{icon:e.jsx(Y,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(u,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(B,{shadow:"sm",padding:"lg",children:e.jsx(_,{gap:"md",children:e.jsxs("div",{children:[e.jsx(u,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(u,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(W,{height:"500px",defaultLanguage:"json",value:f,onChange:ce,theme:o==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),k&&e.jsx(u,{size:"sm",c:"red",mt:"xs",children:k})]})})})]})})]}),z&&e.jsx(N,{icon:e.jsx(J,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>g(null),children:e.jsx(u,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:z})}),e.jsxs(P,{justify:"flex-end",children:[e.jsx(L,{variant:"default",onClick:pe,disabled:!Q||T.isPending,children:"Reset"}),e.jsx(L,{onClick:ue,loading:T.isPending,disabled:!Q,children:T.isPending?"Saving...":"Save Changes"})]})]})]})}export{Ze as IndexEdit};
