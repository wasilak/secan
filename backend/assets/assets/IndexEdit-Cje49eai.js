import{a2 as Se,a as B,a3 as O,j as e,a4 as K,r as c,a5 as we,s as be,a6 as Ce,e as ae,z as Ee,h as _e,q as ze,a1 as Me,D as ke,o as b,k as Z,A as C,I as N,G as E,S as y,l as Ie,m as l,J as De,K as Le,R as ee,L as Te,F as Ne,N as Pe,t as $e}from"./index-CaOal3yg.js";import{u as qe}from"./useMutation-D-W2tDqy.js";import{C as P}from"./Container-DlXTErpz.js";import{S as _}from"./Skeleton-D-ifZ7On.js";import{C as $}from"./Card-C5m1WGBJ.js";import{B as q}from"./Button-DH36Z4D5.js";import{T as g}from"./Tabs-BLDKhHtM.js";import{I as Oe}from"./IconCheck-qw-jYb7W.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";const[Re,ie]=Se("HoverCard component was not found in the tree"),He={};function oe(t){const{children:r,onMouseEnter:s,onMouseLeave:n,...i}=B("HoverCardDropdown",He,t),o=ie(),u=O(s,o.openDropdown),p=O(n,o.closeDropdown);return e.jsx(K.Dropdown,{onMouseEnter:u,onMouseLeave:p,...i,children:r})}oe.displayName="@mantine/core/HoverCardDropdown";const Je={refProp:"ref"},de=c.forwardRef((t,r)=>{const{children:s,refProp:n,eventPropsWrapperName:i,...o}=B("HoverCardTarget",Je,t);if(!we(s))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const u=ie(),p=O(s.props.onMouseEnter,u.openDropdown),h=O(s.props.onMouseLeave,u.closeDropdown),m={onMouseEnter:p,onMouseLeave:h};return e.jsx(K.Target,{refProp:n,ref:r,...o,children:c.cloneElement(s,i?{[i]:m}:m)})});de.displayName="@mantine/core/HoverCardTarget";const Ae={openDelay:0,closeDelay:150,initiallyOpened:!1};function j(t){const{children:r,onOpen:s,onClose:n,openDelay:i,closeDelay:o,initiallyOpened:u,...p}=B("HoverCard",Ae,t),[h,{open:m,close:f}]=be(u,{onClose:n,onOpen:s}),{openDropdown:v,closeDropdown:z}=Ce({open:m,close:f,openDelay:i,closeDelay:o});return e.jsx(Re,{value:{openDropdown:v,closeDropdown:z},children:e.jsx(K,{...p,opened:h,__staticSelector:"HoverCard",children:r})})}j.displayName="@mantine/core/HoverCard";j.Target=de;j.Dropdown=oe;j.extend=t=>t;var Fe=ae("chart-bar","IconChartBar",[["path",{d:"M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20l14 0",key:"svg-3"}]]),se=ae("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function te(t){var r;if(console.error("Error occurred:",t),t&&typeof t=="object"&&"name"in t&&t.name==="ApiClientError"&&"message"in t&&"statusCode"in t){const s=t;if(s.error){const n=re(s.error);if(n)return{error:"elasticsearch_error",message:n,statusCode:s.statusCode,details:s.error}}return{error:"api_error",message:s.message,statusCode:s.statusCode,details:s.error}}if(t&&typeof t=="object"&&"response"in t){const s=t.response;if(s!=null&&s.data){const n=re(s.data);return{error:s.data.error||"api_error",message:n||s.data.message||"An error occurred",details:s.data.details,statusCode:s.status,requestId:(r=s.headers)==null?void 0:r["x-request-id"]}}return{error:"http_error",message:`HTTP ${(s==null?void 0:s.status)||"Unknown"}: ${(s==null?void 0:s.statusText)||"Request failed"}`,statusCode:s==null?void 0:s.status}}if(t&&typeof t=="object"&&"message"in t){const s=t;return s.message.includes("Network")||s.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:s.message}:{error:"error",message:s.message,details:s.stack}}return typeof t=="string"?{error:"error",message:t}:{error:"unknown_error",message:"An unexpected error occurred",details:t}}function re(t){const r=t;if(r.error&&typeof r.error=="object"){const s=r.error;if(s.reason&&typeof s.reason=="string"){let n=`Elasticsearch: ${s.reason}`;if(s.type&&typeof s.type=="string"&&(n=`Elasticsearch (${s.type}): ${s.reason}`),s.root_cause&&Array.isArray(s.root_cause)&&s.root_cause.length>0){const i=s.root_cause[0];i.reason&&i.reason!==s.reason&&(n+=`
Root cause: ${i.reason}`)}return n}}if("details"in r&&r.details&&typeof r.details=="object"){const s=r.details;if(s.error&&typeof s.error=="object"){const n=s.error;if(n.reason&&typeof n.reason=="string"){let i=`Elasticsearch: ${n.reason}`;if(n.type&&typeof n.type=="string"&&(i=`Elasticsearch (${n.type}): ${n.reason}`),n.root_cause&&Array.isArray(n.root_cause)&&n.root_cause.length>0){const o=n.root_cause[0];o.reason&&o.reason!==n.reason&&(i+=`
Root cause: ${o.reason}`)}return i}}}return null}function ne(t,r){if(!t.trim())return`${r} cannot be empty`;try{return JSON.parse(t),null}catch(s){return s.message}}function F(t){const r=["creation_date","provided_name","uuid","version"],s=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],n=[...r,...s],i={};for(const[o,u]of Object.entries(t))if(o==="index"){const p=u,h={};for(const[m,f]of Object.entries(p))n.includes(m)||(h[m]=f);Object.keys(h).length>0&&(i[o]=h)}else n.includes(o)||(i[o]=u);return i}function es(){const{id:t,indexName:r}=Ee(),s=_e(),n=ze(),{resolvedTheme:i}=Me(),[o,u]=ke(),p=o.get("tab")||"settings",[h,m]=c.useState(""),[f,v]=c.useState(""),[z,M]=c.useState(null),[G,k]=c.useState(null),[U,x]=c.useState(null),[R,I]=c.useState(!1),[H,D]=c.useState(!1),[L,le]=c.useState(null),[J,Q]=c.useState(!1),[V,W]=c.useState(null);c.useEffect(()=>{p==="stats"&&!L&&!J&&(Q(!0),W(null),b.proxyRequest(t,"GET",`/${r}/_stats`).then(a=>{le(a)}).catch(a=>{W(a instanceof Error?a.message:"Failed to fetch stats")}).finally(()=>{Q(!1)}))},[p,t,r,L,J]);const{data:S,isLoading:ce,error:ue}=Z({queryKey:["cluster",t,"index",r,"settings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await b.proxyRequest(t,"GET",`/${r}/_settings`))[r];return d==null?void 0:d.settings},enabled:!!t&&!!r}),{data:w,isLoading:pe,error:he}=Z({queryKey:["cluster",t,"index",r,"mappings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await b.proxyRequest(t,"GET",`/${r}/_mapping`))[r];return d==null?void 0:d.mappings},enabled:!!t&&!!r});c.useEffect(()=>{if(S){const a=F(S);m(JSON.stringify(a,null,2)),I(!1)}},[S]),c.useEffect(()=>{w&&(v(JSON.stringify(w,null,2)),D(!1))},[w]);const T=qe({mutationFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const a=[];if(R){const d=ne(h,"Settings");if(d)throw M(d),new Error(`Invalid settings JSON: ${d}`);const A=JSON.parse(h),ve=F(A);a.push(b.proxyRequest(t,"PUT",`/${r}/_settings`,ve))}if(H){const d=ne(f,"Mappings");if(d)throw k(d),new Error(`Invalid mappings JSON: ${d}`);const A=JSON.parse(f);a.push(b.proxyRequest(t,"PUT",`/${r}/_mapping`,A))}await Promise.all(a)},onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",t,"index",r]}),n.invalidateQueries({queryKey:["cluster",t,"indices"]});const a=[];R&&a.push("settings"),H&&a.push("mappings"),$e.show({title:"Success",message:`Index ${a.join(" and ")} updated successfully`,color:"green",icon:e.jsx(Oe,{size:16})}),I(!1),D(!1),x(null)},onError:a=>{const d=te(a);x(d.message)}}),me=a=>{m(a||""),M(null),x(null),I(!0)},ge=a=>{v(a||""),k(null),x(null),D(!0)},fe=()=>{M(null),k(null),x(null),T.mutate()},xe=()=>{if(S){const a=F(S);m(JSON.stringify(a,null,2)),I(!1)}w&&(v(JSON.stringify(w,null,2)),D(!1)),M(null),k(null),x(null)},je=a=>{a&&u({tab:a})},ye=ce||pe,Y=ue||he,X=R||H;if(!t||!r)return e.jsx(P,{size:"xl",children:e.jsx(C,{icon:e.jsx(N,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(ye)return e.jsxs(P,{size:"xl",py:"md",children:[e.jsxs(E,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(_,{height:32,width:200,mb:"xs"}),e.jsx(_,{height:20,width:150})]}),e.jsx(_,{height:36,width:120})]}),e.jsxs(y,{gap:"md",children:[e.jsx(_,{height:48,width:"100%"}),e.jsx($,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(_,{height:400})})]})]});if(Y){const a=te(Y);return e.jsxs(P,{size:"xl",py:"md",children:[e.jsx(C,{icon:e.jsx(N,{size:16}),title:"Error Loading Index",color:"red",children:a.message}),e.jsx(q,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(P,{size:"xl",py:"md",children:[e.jsxs(E,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Ie,{order:1,children:"Edit Index"}),e.jsx(l,{size:"sm",c:"dimmed",children:r})]}),e.jsx(q,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(y,{gap:"md",children:[e.jsxs(g,{value:p,onChange:je,children:[e.jsxs(g.List,{children:[e.jsx(g.Tab,{value:"settings",leftSection:e.jsx(De,{size:16}),children:"Settings"}),e.jsx(g.Tab,{value:"mappings",leftSection:e.jsx(Le,{size:16}),children:"Mappings"}),e.jsx(g.Tab,{value:"stats",leftSection:e.jsx(Fe,{size:16}),children:"Stats"})]}),e.jsx(g.Panel,{value:"settings",pt:"md",children:e.jsx($,{shadow:"sm",padding:"lg",children:e.jsx(y,{gap:"md",children:e.jsxs("div",{children:[e.jsxs(E,{gap:"xs",mb:"xs",children:[e.jsx(l,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(j,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(j.Target,{children:e.jsx(se,{size:16,style:{cursor:"help",color:"var(--mantine-color-blue-6)"}})}),e.jsxs(j.Dropdown,{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(l,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(l,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(l,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(ee,{height:"500px",defaultLanguage:"json",value:h,onChange:me,theme:i==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),z&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:z})]})})})}),e.jsx(g.Panel,{value:"mappings",pt:"md",children:e.jsxs(y,{gap:"md",children:[e.jsx(C,{icon:e.jsx(se,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(l,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx($,{shadow:"sm",padding:"lg",children:e.jsx(y,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(ee,{height:"500px",defaultLanguage:"json",value:f,onChange:ge,theme:i==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),G&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:G})]})})})]})}),e.jsx(g.Panel,{value:"stats",pt:"md",children:e.jsx($,{shadow:"sm",padding:"lg",children:e.jsx(y,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Statistics (Read-only)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Detailed statistics for this index"}),J?e.jsx(E,{justify:"center",py:"xl",children:e.jsx(Te,{})}):V?e.jsx(C,{icon:e.jsx(N,{size:16}),title:"Error",color:"red",children:V}):L?e.jsx(Ne,{h:500,children:e.jsx(Pe,{block:!0,children:JSON.stringify(L,null,2)})}):null]})})})})]}),U&&e.jsx(C,{icon:e.jsx(N,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>x(null),children:e.jsx(l,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:U})}),e.jsxs(E,{justify:"flex-end",children:[e.jsx(q,{variant:"default",onClick:xe,disabled:!X||T.isPending,children:"Reset"}),e.jsx(q,{onClick:fe,loading:T.isPending,disabled:!X,children:T.isPending?"Saving...":"Save Changes"})]})]})]})}export{es as IndexEdit};
