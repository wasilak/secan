import{c as k,K as z,y as T,r as F,b as q,j as e,A as g,I as b,G as c,L as v,T as I,d as a,Q as S,S as y,P as w,e as r,a5 as N,aa as O,F as A,D as d,f,J as E}from"./index-BZ5qcqgZ.js";import{u as R}from"./useMutation-BA-L8aGh.js";import{C as j}from"./Container-B0S22S8r.js";import{B as u}from"./Button-524yZMYQ.js";import{C as M}from"./Card-CCDhkaHB.js";import{B as P}from"./Badge-DoCvKydO.js";import{I as J}from"./IconTrash-CzwGVaIA.js";import{u as _}from"./use-form-CyjcXflp.js";import{T as D}from"./TextInput-DyYxnkZc.js";import{S as H}from"./Select-BRZk8aKB.js";import{T as L}from"./Textarea-BMLAt69a.js";import"./InputBase-8Fll-CCD.js";import"./OptionsDropdown-Do9fmn9K.js";var $=k("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]);function ie(){const{id:o}=z(),n=T(),[p,l]=F.useState(!1),{data:t,isLoading:h,error:m}=q({queryKey:["cluster",o,"repositories"],queryFn:()=>f.getRepositories(o),enabled:!!o}),x=R({mutationFn:s=>f.deleteRepository(o,s),onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",o,"repositories"]}),d.show({title:"Success",message:"Repository deleted successfully",color:"green"})},onError:s=>{d.show({title:"Error",message:`Failed to delete repository: ${s.message}`,color:"red"})}});return o?h?e.jsx(j,{size:"xl",children:e.jsx(c,{justify:"center",mt:"xl",children:e.jsx(v,{size:"lg"})})}):m?e.jsx(j,{size:"xl",children:e.jsxs(g,{icon:e.jsx(b,{size:16}),title:"Error",color:"red",children:["Failed to load repositories: ",m.message]})}):e.jsxs(j,{size:"xl",py:"md",children:[e.jsxs(c,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(I,{order:2,children:"Snapshot Repositories"}),e.jsx(a,{size:"sm",c:"dimmed",children:"Manage snapshot repositories for backup and restore operations"})]}),e.jsx(u,{leftSection:e.jsx(S,{size:16}),onClick:()=>l(!0),children:"Create Repository"})]}),e.jsx(M,{shadow:"sm",padding:"lg",children:!t||t.length===0?e.jsxs(y,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No repositories found"}),e.jsx(u,{leftSection:e.jsx(S,{size:16}),onClick:()=>l(!0),children:"Create Repository"})]}):e.jsx(w,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Name"}),e.jsx(r.Th,{children:"Type"}),e.jsx(r.Th,{children:"Settings"}),e.jsx(r.Th,{children:"Actions"})]})}),e.jsx(r.Tbody,{children:t.map(s=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:e.jsxs(c,{gap:"xs",children:[e.jsx($,{size:16}),e.jsx(a,{size:"sm",fw:500,children:s.name})]})}),e.jsx(r.Td,{children:e.jsx(P,{size:"sm",variant:"light",children:s.type.toUpperCase()})}),e.jsx(r.Td,{children:e.jsx(N,{block:!0,children:JSON.stringify(s.settings,null,2)})}),e.jsx(r.Td,{children:e.jsxs(c,{gap:"xs",children:[e.jsx(u,{component:O,to:`/cluster/${o}/snapshots/${s.name}`,size:"xs",variant:"light",children:"View Snapshots"}),e.jsx(A,{color:"red",variant:"subtle",onClick:()=>{confirm(`Delete repository "${s.name}"? This will not delete snapshots.`)&&x.mutate(s.name)},loading:x.isPending,children:e.jsx(J,{size:16})})]})})]},s.name))})]})})}),e.jsx(B,{opened:p,onClose:()=>l(!1),clusterId:o})]}):e.jsx(j,{size:"xl",children:e.jsx(g,{icon:e.jsx(b,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function B({opened:o,onClose:n,clusterId:p}){const l=T(),t=_({initialValues:{name:"",type:"fs",settings:{},settingsText:""},validate:{name:s=>s?s.startsWith("_")||s.startsWith("-")||s.startsWith("+")?"Repository name cannot start with _, -, or +":null:"Repository name is required",settingsText:s=>{if(!s)return"Settings are required";try{return JSON.parse(s),null}catch{return"Invalid JSON format"}}}}),h=R({mutationFn:s=>f.createRepository(p,s),onSuccess:()=>{l.invalidateQueries({queryKey:["cluster",p,"repositories"]}),d.show({title:"Success",message:"Repository created successfully",color:"green"}),t.reset(),n()},onError:s=>{d.show({title:"Error",message:`Failed to create repository: ${s.message}`,color:"red"})}}),m=t.onSubmit(s=>{try{const i=JSON.parse(s.settingsText),C={name:s.name,type:s.type,settings:i};h.mutate(C)}catch(i){d.show({title:"Error",message:`Invalid JSON: ${i.message}`,color:"red"})}}),x=s=>{if(!s)return;t.setFieldValue("type",s);let i={};switch(s){case"fs":i={location:"/mount/backups/my_backup"};break;case"s3":i={bucket:"my-bucket",region:"us-east-1",base_path:"snapshots"};break;case"azure":i={container:"my-container",base_path:"snapshots"};break;case"gcs":i={bucket:"my-bucket",base_path:"snapshots"};break;case"hdfs":i={uri:"hdfs://namenode:8020",path:"/snapshots"};break;case"url":i={url:"http://example.com/snapshots"};break}t.setFieldValue("settingsText",JSON.stringify(i,null,2))};return e.jsx(E,{opened:o,onClose:n,title:"Create Repository",size:"lg",children:e.jsx("form",{onSubmit:m,children:e.jsxs(y,{gap:"md",children:[e.jsx(D,{label:"Repository Name",placeholder:"my-backup-repo",required:!0,...t.getInputProps("name")}),e.jsx(H,{label:"Repository Type",description:"Select the storage backend for snapshots",required:!0,data:[{value:"fs",label:"Filesystem"},{value:"s3",label:"Amazon S3"},{value:"azure",label:"Azure Blob Storage"},{value:"gcs",label:"Google Cloud Storage"},{value:"hdfs",label:"HDFS"},{value:"url",label:"URL (Read-only)"}],value:t.values.type,onChange:x}),e.jsx(L,{label:"Settings (JSON)",description:"Repository-specific configuration",placeholder:'{"location": "/mount/backups/my_backup"}',required:!0,minRows:8,...t.getInputProps("settingsText")}),e.jsx(g,{color:"blue",title:"Repository Type Information",children:e.jsxs(y,{gap:"xs",children:[e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"Filesystem:"})," Requires shared filesystem accessible to all nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"S3/Azure/GCS:"})," Requires appropriate credentials and permissions"]}),e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"HDFS:"})," Requires HDFS plugin installed"]}),e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"URL:"})," Read-only repository for accessing snapshots via HTTP/HTTPS"]})]})}),e.jsxs(c,{justify:"flex-end",mt:"md",children:[e.jsx(u,{variant:"subtle",onClick:n,children:"Cancel"}),e.jsx(u,{type:"submit",loading:h.isPending,children:"Create Repository"})]})]})})})}export{ie as Repositories};
