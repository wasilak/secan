import{p as y,u as A,a as k,b as B,j as e,A as g,I as p,G as x,L as I,T as w,d as i,S as c,s as N,e as r,f as M}from"./index-BExQHbQo.js";import{C as j}from"./Container-bcxgs4j6.js";import{B as S}from"./Button-Du0cSXcd.js";import{I as L}from"./IconArrowLeft-BPMxFYGJ.js";import{B as U}from"./Badge-BkOEm2nW.js";import{G as o}from"./Grid-BV_YNeaO.js";import{C as a}from"./Card-Diy8fddq.js";import{P as T}from"./Progress-Dx_Gu-DF.js";import"./get-auto-contrast-value-Da6zqqWm.js";function m(n){if(n===0)return"0 B";const d=1024,t=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(n)/Math.log(d));return`${(n/Math.pow(d,l)).toFixed(2)} ${t[l]}`}function P(n){return Math.round(n)}function O(){var f,z,v;const{id:n,nodeId:d}=y(),t=A(),{preferences:l}=k(),{data:s,isLoading:b,error:u}=B({queryKey:["cluster",n,"node",d,"stats"],queryFn:()=>M.getNodeStats(n,d),refetchInterval:l.refreshInterval,enabled:!!n&&!!d});return!n||!d?e.jsx(j,{size:"xl",children:e.jsx(g,{icon:e.jsx(p,{size:16}),title:"Error",color:"red",children:"Cluster ID and Node ID are required"})}):b?e.jsx(j,{size:"xl",children:e.jsx(x,{justify:"center",mt:"xl",children:e.jsx(I,{size:"lg"})})}):u?e.jsx(j,{size:"xl",children:e.jsxs(g,{icon:e.jsx(p,{size:16}),title:"Error",color:"red",children:["Failed to load node statistics: ",u.message]})}):s?e.jsxs(j,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(x,{gap:"xs",mb:"xs",children:e.jsx(S,{variant:"subtle",leftSection:e.jsx(L,{size:16}),onClick:()=>t(`/cluster/${n}`),children:"Back to Cluster"})}),e.jsx(w,{order:1,children:s.name}),e.jsxs(i,{size:"sm",c:"dimmed",children:["Node ID: ",s.id]}),s.ip&&e.jsxs(i,{size:"sm",c:"dimmed",children:["IP: ",s.ip]})]}),e.jsx(x,{children:s.roles.map(h=>e.jsx(U,{size:"lg",variant:"light",children:h},h))})]}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Elasticsearch Version"}),e.jsx(i,{size:"lg",fw:700,children:s.version})]})})}),e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"JVM Version"}),e.jsx(i,{size:"lg",fw:700,children:s.jvmVersion})]})})}),s.uptime&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Uptime"}),e.jsx(i,{size:"lg",fw:700,children:s.uptime})]})})}),s.cpuPercent!==void 0&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"CPU Usage"}),e.jsxs(i,{size:"lg",fw:700,children:[s.cpuPercent,"%"]})]})})})]}),s.loadAverage&&s.loadAverage.length>0&&e.jsx(a,{shadow:"sm",padding:"lg",mb:"md",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Load Average"}),e.jsxs(x,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"1 min"}),e.jsx(i,{size:"lg",fw:700,children:((f=s.loadAverage[0])==null?void 0:f.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"5 min"}),e.jsx(i,{size:"lg",fw:700,children:((z=s.loadAverage[1])==null?void 0:z.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"15 min"}),e.jsx(i,{size:"lg",fw:700,children:((v=s.loadAverage[2])==null?void 0:v.toFixed(2))||"N/A"})]})]})]})}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Heap Memory Usage"}),e.jsx(T,{value:s.heapPercent,color:s.heapPercent>90?"red":s.heapPercent>75?"yellow":"blue",size:"lg"}),e.jsxs(i,{size:"xs",c:"dimmed",children:[m(s.heapUsed)," / ",m(s.heapMax)," (",P(s.heapPercent),"%)"]})]})})}),e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Disk Usage"}),e.jsx(T,{value:s.diskPercent,color:s.diskPercent>90?"red":s.diskPercent>75?"yellow":"blue",size:"lg"}),e.jsxs(i,{size:"xs",c:"dimmed",children:[m(s.diskUsed)," / ",m(s.diskTotal)," (",P(s.diskPercent),"%)"]})]})})})]}),e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"md",children:[e.jsx(w,{order:3,children:"Thread Pool Statistics"}),e.jsx(i,{size:"sm",c:"dimmed",children:"Thread pool statistics show the current state of various thread pools in the node. Queue sizes indicate pending work, and rejected counts show when pools are overloaded."}),e.jsx(N,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Pool Name"}),e.jsx(r.Th,{children:"Threads"}),e.jsx(r.Th,{children:"Active"}),e.jsx(r.Th,{children:"Queue"}),e.jsx(r.Th,{children:"Largest"}),e.jsx(r.Th,{children:"Completed"}),e.jsx(r.Th,{children:"Rejected"})]})}),e.jsx(r.Tbody,{children:Object.entries(s.threadPools).map(([h,C])=>e.jsx(F,{poolName:h,stats:C},h))})]})}),Object.keys(s.threadPools).length===0&&e.jsx(i,{c:"dimmed",ta:"center",py:"xl",children:"No thread pool statistics available"})]})})]}):e.jsx(j,{size:"xl",children:e.jsx(g,{icon:e.jsx(p,{size:16}),title:"Error",color:"red",children:"Node statistics not found"})})}function F({poolName:n,stats:d}){const t=d.queue>100,l=d.rejected>0,s=l?"red":t?"yellow":void 0;return e.jsxs(r.Tr,{style:{backgroundColor:s?`var(--mantine-color-${s}-light)`:void 0},children:[e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:500,children:n})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.threads})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.active})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:t?700:void 0,c:t?"yellow":void 0,children:d.queue})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.largest})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.completed.toLocaleString()})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:l?700:void 0,c:l?"red":void 0,children:d.rejected.toLocaleString()})})]})}export{O as NodeDetail};
