import{e as je,r as W,q as be,s as ke,t as y,o as F,j as e,M as f,T as _,v as Z,w as Ae,x as Ue,y as Se,S as z,m as l,G as g,z as ae,i as Oe,D as oe,k as re,A as ie,I as te,L as ce,l as Re,h as Ce,E as pe,F as de,n as a,H as $e,J as qe,K as Be,N as Ge}from"./index-BjLyXSH1.js";import{u as G}from"./useMutation-CYSyA9aA.js";import{u as Ee}from"./useWatermarks-CBWccONX.js";import{u as We}from"./accessibility-DJojhRdf.js";import{I as Ke}from"./IconDeviceFloppy-CUemf5Gr.js";import{I as Qe}from"./IconTrash-yRq_yrJR.js";import{T as he}from"./TextInput-AfnIcg50.js";import{B as ne}from"./Button-BkCnhTlu.js";import{N as He}from"./NumberInput-DwvogtAW.js";import{P as le}from"./Progress-9TG4ZgoQ.js";import{G as H}from"./Grid-EE9PgraM.js";import{C as X}from"./Card-CZDf-5xu.js";import{T as K}from"./Tabs-DWqkBdsc.js";import{I as Pe,a as Y,b as Fe,c as Ne,C as ue}from"./IconMinimize-kPc81Ou4.js";import{B as P}from"./Badge-DnvKuW5w.js";import{M as ge}from"./MultiSelect-DFOEwZm8.js";import{I as Ve,a as _e}from"./IconSortDescending-DXNU7eV4.js";import{S as Q}from"./Skeleton-C_ooSiCu.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./get-safe-id-Bp3H8K0-.js";import"./InputsGroupFieldset-B4cbASYd.js";var De=je("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Ze=je("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Je=je("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),Xe=je("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);function fe(r,i=300){const[b,x]=W.useState(r);return W.useEffect(()=>{const T=setTimeout(()=>{x(r)},i);return()=>{clearTimeout(T)}},[r,i]),b}function Ye({clusterId:r,index:i}){const b=be(),{announceSuccess:x,announceError:T}=We(),[S,{open:M,close:I}]=ke(!1),[n,{open:A,close:N}]=ke(!1),[v,E]=W.useState(""),[k,$]=W.useState(1),c=G({mutationFn:()=>F.openIndex(r,i.name),onMutate:()=>{y.show({id:`open-${i.name}`,title:"Opening index",message:`Opening index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`open-${i.name}`,title:"Success",message:`Index ${i.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),x(`Index ${i.name} opened successfully`),b.invalidateQueries({queryKey:["cluster",r,"indices"]})},onError:m=>{y.update({id:`open-${i.name}`,title:"Error",message:`Failed to open index: ${m.message}`,color:"red",loading:!1,autoClose:5e3}),T(`Failed to open index: ${m.message}`)}}),C=G({mutationFn:()=>F.closeIndex(r,i.name),onMutate:()=>{y.show({id:`close-${i.name}`,title:"Closing index",message:`Closing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`close-${i.name}`,title:"Success",message:`Index ${i.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),b.invalidateQueries({queryKey:["cluster",r,"indices"]})},onError:m=>{y.update({id:`close-${i.name}`,title:"Error",message:`Failed to close index: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),j=G({mutationFn:()=>F.deleteIndex(r,i.name),onMutate:()=>{y.show({id:`delete-${i.name}`,title:"Deleting index",message:`Deleting index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`delete-${i.name}`,title:"Success",message:`Index ${i.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),b.invalidateQueries({queryKey:["cluster",r,"indices"]}),I(),E("")},onError:m=>{y.update({id:`delete-${i.name}`,title:"Error",message:`Failed to delete index: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),D=G({mutationFn:m=>F.forceMergeIndex(r,i.name,m),onMutate:()=>{y.show({id:`forcemerge-${i.name}`,title:"Force merging index",message:`Force merging index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`forcemerge-${i.name}`,title:"Success",message:`Index ${i.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),N(),$(1)},onError:m=>{y.update({id:`forcemerge-${i.name}`,title:"Error",message:`Failed to force merge index: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),L=G({mutationFn:()=>F.clearCacheIndex(r,i.name),onMutate:()=>{y.show({id:`clearcache-${i.name}`,title:"Clearing cache",message:`Clearing cache for index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`clearcache-${i.name}`,title:"Success",message:`Cache cleared for index ${i.name}`,color:"green",loading:!1,autoClose:3e3})},onError:m=>{y.update({id:`clearcache-${i.name}`,title:"Error",message:`Failed to clear cache: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),o=G({mutationFn:()=>F.refreshIndex(r,i.name),onMutate:()=>{y.show({id:`refresh-${i.name}`,title:"Refreshing index",message:`Refreshing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`refresh-${i.name}`,title:"Success",message:`Index ${i.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:m=>{y.update({id:`refresh-${i.name}`,title:"Error",message:`Failed to refresh index: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),p=G({mutationFn:()=>F.flushIndex(r,i.name),onMutate:()=>{y.show({id:`flush-${i.name}`,title:"Flushing index",message:`Flushing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`flush-${i.name}`,title:"Success",message:`Index ${i.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:m=>{y.update({id:`flush-${i.name}`,title:"Error",message:`Failed to flush index: ${m.message}`,color:"red",loading:!1,autoClose:5e3})}}),O=()=>{v===i.name&&j.mutate()},B=()=>{const m=typeof k=="number"?k:parseInt(k,10);!isNaN(m)&&m>0&&D.mutate(m)};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{shadow:"md",width:200,children:[e.jsx(f.Target,{children:e.jsx(_,{label:"Index operations",children:e.jsx(Z,{variant:"subtle",color:"gray","aria-label":`Operations for index ${i.name}`,children:e.jsx(De,{size:16,"aria-hidden":"true"})})})}),e.jsxs(f.Dropdown,{children:[e.jsx(f.Label,{children:"Index Operations"}),i.status==="close"?e.jsx(f.Item,{leftSection:e.jsx(Xe,{size:14,"aria-hidden":"true"}),onClick:()=>c.mutate(),disabled:c.isPending,children:"Open Index"}):e.jsx(f.Item,{leftSection:e.jsx(Je,{size:14,"aria-hidden":"true"}),onClick:()=>C.mutate(),disabled:C.isPending,children:"Close Index"}),e.jsx(f.Item,{leftSection:e.jsx(Ae,{size:14,"aria-hidden":"true"}),onClick:()=>o.mutate(),disabled:o.isPending,children:"Refresh"}),e.jsx(f.Item,{leftSection:e.jsx(Ke,{size:14,"aria-hidden":"true"}),onClick:()=>p.mutate(),disabled:p.isPending,children:"Flush"}),e.jsx(f.Item,{leftSection:e.jsx(Ze,{size:14,"aria-hidden":"true"}),onClick:()=>L.mutate(),disabled:L.isPending,children:"Clear Cache"}),e.jsx(f.Item,{leftSection:e.jsx(Ue,{size:14,"aria-hidden":"true"}),onClick:A,children:"Force Merge"}),e.jsx(f.Divider,{}),e.jsx(f.Item,{leftSection:e.jsx(Qe,{size:14,"aria-hidden":"true"}),color:"red",onClick:M,children:"Delete Index"})]})]}),e.jsx(Se,{opened:S,onClose:()=>{I(),E("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(z,{gap:"md",children:[e.jsxs(l,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(l,{span:!0,fw:700,children:i.name}),"? This action cannot be undone."]}),e.jsx(l,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(he,{placeholder:i.name,value:v,onChange:m=>E(m.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(g,{justify:"flex-end",children:[e.jsx(ne,{variant:"default",onClick:()=>{I(),E("")},children:"Cancel"}),e.jsx(ne,{color:"red",onClick:O,disabled:v!==i.name||j.isPending,loading:j.isPending,"aria-label":`Delete index ${i.name}`,children:"Delete"})]})]})}),e.jsx(Se,{opened:n,onClose:()=>{N(),$(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(z,{gap:"md",children:[e.jsxs(l,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(l,{span:!0,fw:700,children:i.name})," to reduce the number of segments."]}),e.jsx(He,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:k,onChange:$,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(g,{justify:"flex-end",children:[e.jsx(ne,{variant:"default",onClick:()=>{N(),$(1)},children:"Cancel"}),e.jsx(ne,{onClick:B,disabled:D.isPending,loading:D.isPending,"aria-label":`Force merge index ${i.name}`,children:"Force Merge"})]})]})})]})}function we(r){switch(r){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function q(r){if(r===0)return"0 B";const i=1024,b=["B","KB","MB","GB","TB"],x=Math.floor(Math.log(r)/Math.log(i));return`${(r/Math.pow(i,x)).toFixed(2)} ${b[x]}`}function V(r,i){return i===0?0:Math.round(r/i*100)}function Me(r){switch(r){case"green":return"transparent";case"yellow":return"rgba(250, 176, 5, 0.15)";case"red":return"rgba(250, 82, 82, 0.15)";default:return"transparent"}}function zs(){var o;const{id:r}=ae(),i=Oe(),[b,x]=oe(),{getColor:T}=Ee(r),S=b.get("tab")||"overview",M=p=>{p&&x({tab:p})},I=p=>{x({tab:p})},{data:n,isLoading:A,error:N}=re({queryKey:["cluster",r,"stats"],queryFn:()=>F.getClusterStats(r),refetchInterval:i,enabled:!!r}),{data:v,isLoading:E,error:k}=re({queryKey:["cluster",r,"nodes"],queryFn:()=>F.getNodes(r),refetchInterval:i,enabled:!!r}),{data:$,isLoading:c,error:C}=re({queryKey:["cluster",r,"indices"],queryFn:()=>F.getIndices(r),refetchInterval:i,enabled:!!r}),{data:j,isLoading:D,error:L}=re({queryKey:["cluster",r,"shards"],queryFn:()=>F.getShards(r),refetchInterval:i,enabled:!!r});return r?A?e.jsx(z,{p:"md",children:e.jsx(g,{justify:"center",mt:"xl",children:e.jsx(ce,{size:"lg"})})}):N?e.jsx(z,{p:"md",children:e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",N.message]})}):e.jsxs(z,{gap:"md",p:"md",children:[e.jsx(g,{justify:"space-between",wrap:"wrap",children:e.jsxs("div",{children:[e.jsx(Re,{order:1,className:"text-responsive-xl",children:(n==null?void 0:n.clusterName)||r}),e.jsx(l,{size:"sm",c:"dimmed",children:"Cluster Overview"})]})}),e.jsx(le,{value:100,color:we((n==null?void 0:n.health)||"red"),size:"sm",radius:"xs","aria-label":`Cluster health: ${(n==null?void 0:n.health)||"unknown"}`}),e.jsxs(H,{children:[e.jsx(H.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>I("nodes"),children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(l,{size:"xl",fw:700,children:(n==null?void 0:n.numberOfNodes)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(H.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>I("indices"),children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(l,{size:"xl",fw:700,children:(n==null?void 0:n.numberOfIndices)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[((o=n==null?void 0:n.numberOfDocuments)==null?void 0:o.toLocaleString())||0," documents"]})]})})}),e.jsx(H.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>I("shards"),children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(l,{size:"xl",fw:700,children:(n==null?void 0:n.activeShards)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.activePrimaryShards)||0," primary"]})]})})}),e.jsx(H.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>I("shards"),children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(l,{size:"xl",fw:700,c:n!=null&&n.unassignedShards?"red":void 0,children:(n==null?void 0:n.unassignedShards)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.relocatingShards)||0," relocating"]})]})})})]}),((n==null?void 0:n.memoryTotal)||(n==null?void 0:n.diskTotal))&&e.jsxs(H,{children:[(n==null?void 0:n.memoryTotal)&&e.jsx(H.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(le,{value:V(n.memoryUsed||0,n.memoryTotal),color:T(V(n.memoryUsed||0,n.memoryTotal)),size:"sm",radius:"xs"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[q(n.memoryUsed||0)," / ",q(n.memoryTotal)," (",V(n.memoryUsed||0,n.memoryTotal),"%)"]})]})})}),(n==null?void 0:n.diskTotal)&&e.jsx(H.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(le,{value:V(n.diskUsed||0,n.diskTotal),color:T(V(n.diskUsed||0,n.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[q(n.diskUsed||0)," / ",q(n.diskTotal)," (",V(n.diskUsed||0,n.diskTotal),"%)"]})]})})})]}),e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(K,{value:S,onChange:M,children:[e.jsxs(K.List,{children:[e.jsx(K.Tab,{value:"overview",children:"Overview"}),e.jsxs(K.Tab,{value:"nodes",children:["Nodes (",(v==null?void 0:v.length)||0,")"]}),e.jsxs(K.Tab,{value:"indices",children:["Indices (",($==null?void 0:$.length)||0,")"]}),e.jsxs(K.Tab,{value:"shards",children:["Shards (",(j==null?void 0:j.length)||0,")"]})]}),e.jsx(K.Panel,{value:"overview",pt:"md",children:e.jsx(rs,{nodes:v,indices:$,shards:j,loading:E||c||D,error:k||C||L})}),e.jsx(K.Panel,{value:"nodes",pt:"md",children:e.jsx(es,{nodes:v,loading:E,error:k})}),e.jsx(K.Panel,{value:"indices",pt:"md",children:e.jsx(ss,{indices:$,loading:c,error:C})}),e.jsx(K.Panel,{value:"shards",pt:"md",children:e.jsx(ns,{shards:j,loading:D,error:L})})]})})]}):e.jsx(z,{p:"md",children:e.jsx(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function es({nodes:r,loading:i,error:b}){var $;const{id:x}=ae(),T=Ce(),[S,M]=oe(),{getColor:I}=Ee(x),n=S.get("nodesSearch")||"",A=(($=S.get("roles"))==null?void 0:$.split(",").filter(Boolean))||[],N=fe(n,300),v=(c,C)=>{const j=new URLSearchParams(S);c!==void 0&&(c?j.set("nodesSearch",c):j.delete("nodesSearch")),C!==void 0&&(C.length>0?j.set("roles",C.join(",")):j.delete("roles")),M(j)},E=Array.from(new Set((r==null?void 0:r.flatMap(c=>c.roles))||[])),k=r==null?void 0:r.filter(c=>{var D;const C=c.name.toLowerCase().includes(N.toLowerCase())||((D=c.ip)==null?void 0:D.toLowerCase().includes(N.toLowerCase())),j=A.length===0||A.some(L=>c.roles.includes(L));return C&&j});return i?e.jsx(g,{justify:"center",py:"xl",children:e.jsx(ce,{})}):b?e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",b.message]}):!r||r.length===0?e.jsx(l,{c:"dimmed",children:"No nodes found"}):e.jsxs(z,{gap:"md",children:[e.jsxs(g,{children:[e.jsx(he,{placeholder:"Search nodes...",leftSection:e.jsx(pe,{size:16}),value:n,onChange:c=>v(c.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(ge,{placeholder:"Filter by roles",data:E,value:A,onChange:c=>v(void 0,c),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),k&&k.length===0?e.jsx(l,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(de,{children:e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Name"}),e.jsx(a.Th,{children:"Roles"}),e.jsx(a.Th,{children:"Heap Usage"}),e.jsx(a.Th,{children:"Disk Usage"}),e.jsx(a.Th,{children:"CPU"})]})}),e.jsx(a.Tbody,{children:k==null?void 0:k.map(c=>e.jsxs(a.Tr,{style:{cursor:"pointer"},onClick:()=>T(`/cluster/${x}/nodes/${c.id}`),children:[e.jsxs(a.Td,{children:[e.jsx(l,{size:"sm",fw:500,children:c.name}),c.ip&&e.jsx(l,{size:"xs",c:"dimmed",children:c.ip})]}),e.jsx(a.Td,{children:e.jsx(g,{gap:"xs",children:c.roles.map(C=>e.jsx(P,{size:"sm",variant:"light",children:C},C))})}),e.jsx(a.Td,{children:e.jsxs(z,{gap:4,children:[e.jsx(le,{value:V(c.heapUsed,c.heapMax),color:I(V(c.heapUsed,c.heapMax)),size:"sm",radius:"xs"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[q(c.heapUsed)," / ",q(c.heapMax)]})]})}),e.jsx(a.Td,{children:e.jsxs(z,{gap:4,children:[e.jsx(le,{value:V(c.diskUsed,c.diskTotal),color:I(V(c.diskUsed,c.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[q(c.diskUsed)," / ",q(c.diskTotal)]})]})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:c.cpuPercent!==void 0?`${c.cpuPercent}%`:"N/A"})})]},c.id))})]})})]})}function ss({indices:r,loading:i,error:b}){var me,J;const{id:x}=ae(),T=Ce(),S=be(),[M,I]=oe(),n=M.get("indicesSearch")||"",A=((me=M.get("health"))==null?void 0:me.split(",").filter(Boolean))||[],N=((J=M.get("status"))==null?void 0:J.split(",").filter(Boolean))||[],v=M.get("expanded")==="true",E=M.get("sort")!=="desc",k=M.get("affected")==="true",$=fe(n,300),{data:c}=re({queryKey:["cluster",x,"shards"],queryFn:()=>F.getShards(x),enabled:!!x}),{data:C}=re({queryKey:["cluster",x,"settings"],queryFn:async()=>await F.proxyRequest(x,"GET","/_cluster/settings"),enabled:!!x}),j=(()=>{var xe,ve;if(!C)return!0;const t=C.transient,u=C.persistent,s=t==null?void 0:t.cluster,h=u==null?void 0:u.cluster,d=s==null?void 0:s.routing,R=h==null?void 0:h.routing,w=(xe=d==null?void 0:d.allocation)==null?void 0:xe.enable,se=(ve=R==null?void 0:R.allocation)==null?void 0:ve.enable;return(w||se||"all")==="all"})(),D=G({mutationFn:()=>F.proxyRequest(x,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{S.invalidateQueries({queryKey:["cluster",x,"settings"]}),y.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:t=>{y.show({title:"Error",message:`Failed to enable shard allocation: ${t.message}`,color:"red"})}}),L=G({mutationFn:t=>F.proxyRequest(x,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":t}}),onSuccess:()=>{S.invalidateQueries({queryKey:["cluster",x,"settings"]}),y.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:t=>{y.show({title:"Error",message:`Failed to disable shard allocation: ${t.message}`,color:"red"})}}),o=(t,u,s)=>{const h=new URLSearchParams(M);t!==void 0&&(t?h.set("indicesSearch",t):h.delete("indicesSearch")),u!==void 0&&(u.length>0?h.set("health",u.join(",")):h.delete("health")),s!==void 0&&(s.length>0?h.set("status",s.join(",")):h.delete("status")),I(h)},p=(t,u)=>{const s=new URLSearchParams(M);u===""||u===!1?s.delete(t):s.set(t,String(u)),I(s)},O=(c==null?void 0:c.reduce((t,u)=>(t[u.index]||(t[u.index]=[]),t[u.index].push(u),t),{}))||{},B=(c==null?void 0:c.filter(t=>t.state==="UNASSIGNED"))||[],m=B.reduce((t,u)=>(t[u.index]||(t[u.index]=[]),t[u.index].push(u),t),{}),ee=t=>(O[t]||[]).some(s=>s.state==="UNASSIGNED"||s.state==="RELOCATING"||s.state==="INITIALIZING");let U=r==null?void 0:r.filter(t=>{const u=t.name.toLowerCase().includes($.toLowerCase()),s=A.length===0||A.includes(t.health),h=N.length===0||N.includes(t.status),d=!k||ee(t.name);return u&&s&&h&&d});if(U&&(U=[...U].sort((t,u)=>E?t.name.localeCompare(u.name):u.name.localeCompare(t.name))),i)return e.jsx(g,{justify:"center",py:"xl",children:e.jsx(ce,{})});if(b)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",b.message]});if(!r||r.length===0)return e.jsxs(z,{gap:"md",align:"center",py:"xl",children:[e.jsx(l,{c:"dimmed",children:"No indices found"}),x&&e.jsx(ne,{leftSection:e.jsx($e,{size:16}),onClick:()=>T(`/cluster/${x}/indices/create`),children:"Create Index"})]});const ye=B.length>0;return e.jsxs(z,{gap:"md",children:[e.jsxs(g,{justify:"space-between",wrap:"wrap",children:[e.jsxs(g,{children:[j?e.jsxs(f,{shadow:"md",width:200,children:[e.jsx(f.Target,{children:e.jsx(_,{label:"Disable shard allocation",children:e.jsx(Z,{size:"lg",variant:"subtle",color:"green",loading:L.isPending,children:e.jsx(Pe,{size:20})})})}),e.jsxs(f.Dropdown,{children:[e.jsx(f.Label,{children:"Disable Allocation"}),e.jsx(f.Item,{onClick:()=>L.mutate("none"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"None (default)"})]})}),e.jsx(f.Item,{onClick:()=>L.mutate("primaries"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"Primaries only"})]})}),e.jsx(f.Item,{onClick:()=>L.mutate("new_primaries"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(_,{label:"Enable shard allocation",children:e.jsx(Z,{size:"lg",variant:"subtle",color:"red",onClick:()=>D.mutate(),loading:D.isPending,children:e.jsx(Y,{size:20})})}),e.jsx(_,{label:v?"Compress view":"Expand view",children:e.jsx(Z,{size:"lg",variant:"subtle",onClick:()=>p("expanded",!v),children:v?e.jsx(Fe,{size:20}):e.jsx(Ne,{size:20})})}),e.jsx(_,{label:E?"Sort descending":"Sort ascending",children:e.jsx(Z,{size:"lg",variant:"subtle",onClick:()=>p("sort",E?"desc":"asc"),children:E?e.jsx(Ve,{size:20}):e.jsx(_e,{size:20})})})]}),e.jsxs(g,{style:{flex:1},children:[e.jsx(he,{placeholder:"Search indices...",leftSection:e.jsx(pe,{size:16}),value:n,onChange:t=>o(t.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ge,{placeholder:"Health",data:["green","yellow","red"],value:A,onChange:t=>o(void 0,t,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(ge,{placeholder:"Status",data:["open","close"],value:N,onChange:t=>o(void 0,void 0,t),clearable:!0,style:{maxWidth:150}}),ye&&e.jsx(ue,{label:"Show only affected",checked:k,onChange:t=>p("affected",t.currentTarget.checked)})]}),x&&e.jsx(ne,{leftSection:e.jsx($e,{size:16}),onClick:()=>T(`/cluster/${x}/indices/create`),children:"Create Index"})]}),U&&U.length===0?e.jsx(l,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(de,{children:e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Name"}),e.jsx(a.Th,{children:"Health"}),e.jsx(a.Th,{children:"Status"}),e.jsx(a.Th,{children:"Documents"}),e.jsx(a.Th,{children:"Size"}),e.jsx(a.Th,{children:"Shards"}),v&&e.jsx(a.Th,{children:"Primaries"}),v&&e.jsx(a.Th,{children:"Replicas"}),e.jsx(a.Th,{children:"Unassigned"}),e.jsx(a.Th,{children:"Actions"})]})}),e.jsx(a.Tbody,{children:U==null?void 0:U.map(t=>{var h;const u=((h=m[t.name])==null?void 0:h.length)||0,s=u>0;return e.jsxs(a.Tr,{style:{cursor:"pointer",backgroundColor:s?"rgba(250, 82, 82, 0.1)":void 0},onClick:()=>T(`/cluster/${x}/indices/${encodeURIComponent(t.name)}/edit`),children:[e.jsx(a.Td,{children:e.jsxs(z,{gap:2,children:[e.jsx(l,{size:"sm",fw:500,style:{textDecoration:"underline"},children:t.name}),v&&ee(t.name)&&e.jsx(P,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",color:we(t.health),children:t.health})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",variant:"light",color:t.status==="open"?"green":"gray",children:t.status})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:t.docsCount.toLocaleString()})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:q(t.storeSize)})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:v?`${t.primaryShards+t.replicaShards}`:`${t.primaryShards}p / ${t.replicaShards}r`})}),v&&e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:t.primaryShards})}),v&&e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:t.replicaShards})}),e.jsx(a.Td,{children:u>0?e.jsx(P,{size:"sm",color:"red",variant:"filled",children:u}):e.jsx(l,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(a.Td,{onClick:d=>d.stopPropagation(),children:e.jsxs(g,{gap:"xs",children:[x&&e.jsx(Ye,{clusterId:x,index:t}),e.jsxs(f,{shadow:"md",width:200,children:[e.jsx(f.Target,{children:e.jsx(Z,{variant:"subtle",color:"gray",children:e.jsx(De,{size:16})})}),e.jsxs(f.Dropdown,{children:[e.jsx(f.Label,{children:"Index Management"}),e.jsx(f.Item,{leftSection:e.jsx(qe,{size:14}),onClick:d=>{d.stopPropagation(),T(`/cluster/${x}/indices/${encodeURIComponent(t.name)}/edit?tab=settings`)},children:"Settings"}),e.jsx(f.Item,{leftSection:e.jsx(Be,{size:14}),onClick:d=>{d.stopPropagation(),T(`/cluster/${x}/indices/${encodeURIComponent(t.name)}/edit?tab=mappings`)},children:"Mappings"})]})]})]})})]},t.name)})})]})})]})}function Le({shard:r,opened:i,onClose:b,clusterId:x}){const[T,S]=W.useState(null),[M,I]=W.useState(!1);return W.useEffect(()=>{i&&r?(I(!0),S(null),console.log("Fetching shard stats:",{clusterId:x,index:r.index,shard:r.shard}),F.getShardStats(x,r.index,r.shard).then(n=>{console.log("Received shard stats:",n),S(n)}).catch(n=>{console.error("Failed to fetch shard stats:",n),S(r)}).finally(()=>{I(!1)})):i||(S(null),I(!1))},[i,r==null?void 0:r.index,r==null?void 0:r.shard,x]),r?e.jsx(Se,{opened:i,onClose:b,title:e.jsxs(g,{gap:"xs",children:[e.jsx(l,{size:"lg",fw:600,children:"Shard Details:"}),e.jsx(P,{size:"lg",variant:"light",color:"blue",children:r.index}),e.jsx(l,{size:"lg",c:"dimmed",children:"/"}),e.jsxs(P,{size:"lg",variant:"filled",color:"cyan",children:["#",r.shard]}),e.jsx(P,{size:"lg",variant:r.primary?"filled":"light",color:r.primary?"green":"gray",children:r.primary?"Primary":"Replica"})]}),size:"80%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"}},children:e.jsx(de,{style:{flex:1},children:M?e.jsxs(z,{gap:"xs",children:[e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,width:"70%",radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,width:"50%",radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,radius:"xs"}),e.jsx(Q,{height:20,width:"80%",radius:"xs"})]}):e.jsx(Ge,{block:!0,children:JSON.stringify(T||r,null,2)})})}):null}function rs({nodes:r,indices:i,shards:b,loading:x,error:T}){const{id:S}=ae(),M=Ce(),I=be(),[n,A]=oe(),[N,v]=W.useState(null),[E,k]=W.useState(!1),$=n.get("overviewSearch")||"",c=n.get("showClosed")==="true",C=n.get("showSpecial")==="true",j=n.get("overviewExpanded")==="true",D=n.get("overviewAffected")==="true",L=fe($,300),o=s=>{v(s),k(!0)},p=(s,h)=>{const d=new URLSearchParams(n);h===""||h===!1?d.delete(s):d.set(s,String(h)),A(d)},{data:O}=re({queryKey:["cluster",S,"settings"],queryFn:async()=>await F.proxyRequest(S,"GET","/_cluster/settings"),enabled:!!S}),B=(()=>{var Te,Ie;if(!O)return!0;const s=O.transient,h=O.persistent,d=s==null?void 0:s.cluster,R=h==null?void 0:h.cluster,w=d==null?void 0:d.routing,se=R==null?void 0:R.routing,ze=(Te=w==null?void 0:w.allocation)==null?void 0:Te.enable,xe=(Ie=se==null?void 0:se.allocation)==null?void 0:Ie.enable;return(ze||xe||"all")==="all"})(),m=G({mutationFn:()=>F.proxyRequest(S,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{I.invalidateQueries({queryKey:["cluster",S,"settings"]}),y.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:s=>{y.show({title:"Error",message:`Failed to enable shard allocation: ${s.message}`,color:"red"})}}),ee=G({mutationFn:s=>F.proxyRequest(S,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":s}}),onSuccess:()=>{I.invalidateQueries({queryKey:["cluster",S,"settings"]}),y.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:s=>{y.show({title:"Error",message:`Failed to disable shard allocation: ${s.message}`,color:"red"})}});if(x)return e.jsx(g,{justify:"center",py:"xl",children:e.jsx(ce,{})});if(T)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",T.message]});if(!r||!i||!b||r.length===0||i.length===0)return e.jsx(z,{gap:"md",align:"center",py:"xl",children:e.jsx(l,{c:"dimmed",children:"No shard allocation data available"})});const U=b.filter(s=>s.state==="UNASSIGNED"),ye=U.reduce((s,h)=>(s[h.index]||(s[h.index]=[]),s[h.index].push(h),s),{}),me=s=>b.filter(d=>d.index===s).some(d=>d.state==="UNASSIGNED"||d.state==="RELOCATING"||d.state==="INITIALIZING");let J=i.filter(s=>{const h=s.name.toLowerCase().includes(L.toLowerCase()),d=c||s.status==="open",R=C||!s.name.startsWith("."),w=!D||me(s.name);return h&&d&&R&&w});const t=new Map;r.forEach(s=>{t.set(s.id,s.name),t.set(s.name,s.name),s.ip&&t.set(s.ip,s.name)});const u=new Map;return b.forEach(s=>{if(!s.node)return;const h=t.get(s.node);if(!h)return;u.has(h)||u.set(h,new Map);const d=u.get(h);d.has(s.index)||d.set(s.index,[]),d.get(s.index).push(s)}),e.jsxs(z,{gap:"md",children:[e.jsx(Le,{shard:N,opened:E,onClose:()=>k(!1),clusterId:S}),e.jsxs(g,{justify:"space-between",wrap:"wrap",children:[e.jsxs(g,{children:[B?e.jsxs(f,{shadow:"md",width:200,children:[e.jsx(f.Target,{children:e.jsx(_,{label:"Disable shard allocation",children:e.jsx(Z,{size:"lg",variant:"subtle",color:"green",loading:ee.isPending,children:e.jsx(Pe,{size:20})})})}),e.jsxs(f.Dropdown,{children:[e.jsx(f.Label,{children:"Disable Allocation"}),e.jsx(f.Item,{onClick:()=>ee.mutate("none"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"None (default)"})]})}),e.jsx(f.Item,{onClick:()=>ee.mutate("primaries"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"Primaries only"})]})}),e.jsx(f.Item,{onClick:()=>ee.mutate("new_primaries"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(Y,{size:14}),e.jsx(l,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(_,{label:"Enable shard allocation",children:e.jsx(Z,{size:"lg",variant:"subtle",color:"red",onClick:()=>m.mutate(),loading:m.isPending,children:e.jsx(Y,{size:20})})}),e.jsx(_,{label:j?"Compress view":"Expand view",children:e.jsx(Z,{size:"lg",variant:"subtle",onClick:()=>p("overviewExpanded",!j),children:j?e.jsx(Fe,{size:20}):e.jsx(Ne,{size:20})})})]}),e.jsxs(g,{style:{flex:1},children:[e.jsx(he,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(pe,{size:16}),value:$,onChange:s=>p("overviewSearch",s.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(g,{gap:"md",children:[e.jsxs(g,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-closed",checked:c,onChange:s=>p("showClosed",s.target.checked)}),e.jsxs(l,{size:"sm",component:"label",htmlFor:"overview-show-closed",style:{cursor:"pointer"},children:["closed (",i.filter(s=>s.status!=="open").length,")"]})]}),e.jsxs(g,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-special",checked:C,onChange:s=>p("showSpecial",s.target.checked)}),e.jsxs(l,{size:"sm",component:"label",htmlFor:"overview-show-special",style:{cursor:"pointer"},children:["special (",i.filter(s=>s.name.startsWith(".")).length,")"]})]}),U.length>0&&e.jsx(ue,{label:"Show only affected",checked:D,onChange:s=>p("overviewAffected",s.currentTarget.checked)}),e.jsxs(l,{size:"sm",c:"dimmed",children:[J.length," of ",i.length]})]})]})]}),e.jsxs(g,{gap:"md",children:[e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:r.length})," nodes"]}),e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:J.length})," indices"]}),e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:b.length})," shards"]}),U.length>0&&e.jsxs(P,{color:"red",variant:"filled",children:[U.length," unassigned"]})]}),e.jsx(de,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(a,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),J.map(s=>e.jsx(a.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(z,{gap:4,children:[e.jsx(l,{size:"xs",fw:500,truncate:"end",title:s.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:h=>{h.stopPropagation(),M(`/cluster/${S}/indices/${encodeURIComponent(s.name)}/edit`)},children:s.name}),e.jsxs(g,{gap:4,justify:"center",children:[e.jsxs(P,{size:"xs",color:we(s.health),variant:"dot",children:[s.primaryShards,"Ã—",s.replicaShards+1]}),e.jsx(l,{size:"xs",c:"dimmed",children:q(s.storeSize)})]})]})},s.name))]})}),e.jsxs(a.Tbody,{children:[U.length>0&&e.jsxs(a.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(a.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(z,{gap:2,children:[e.jsx(l,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(P,{size:"xs",color:"red",variant:"filled",children:U.length})]})}),J.map(s=>{const h=ye[s.name]||[];return e.jsx(a.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Me(s.health)},children:h.length>0?e.jsx(g,{gap:2,justify:"center",wrap:"wrap",children:h.map((d,R)=>e.jsx(_,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",d.shard]}),e.jsxs("div",{children:["Type: ",d.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",d.state]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:d.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)",cursor:"pointer"},onClick:()=>o(d),children:d.shard})},`unassigned-${d.index}-${d.shard}-${R}`))}):e.jsx(l,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${s.name}`)})]}),r.map(s=>{const h=u.get(s.name);return e.jsxs(a.Tr,{children:[e.jsx(a.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(z,{gap:4,children:[e.jsx(g,{gap:4,children:e.jsx(l,{size:"xs",fw:500,truncate:"end",title:s.name,children:s.name})}),e.jsx(l,{size:"xs",c:"dimmed",truncate:"end",title:s.ip,children:s.ip}),j&&e.jsxs(e.Fragment,{children:[e.jsx(g,{gap:4,wrap:"wrap",children:s.roles.map(d=>e.jsx(P,{size:"xs",variant:"light",color:"gray",children:d},d))}),e.jsxs(g,{gap:4,wrap:"wrap",children:[e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:s.id.substring(0,8)}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:s.roles.length}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:q(s.heapMax)}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:q(s.diskTotal)}),s.cpuPercent!==void 0&&e.jsxs(P,{size:"xs",color:"teal",variant:"filled",children:[s.cpuPercent,"%"]})]})]})]})}),J.map(d=>{const R=(h==null?void 0:h.get(d.name))||[];return e.jsx(a.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Me(d.health)},children:R.length>0?e.jsx(g,{gap:2,justify:"center",wrap:"wrap",children:R.map((w,se)=>e.jsx(_,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",w.shard]}),e.jsxs("div",{children:["Type: ",w.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",w.state]}),e.jsxs("div",{children:["Node: ",w.node||"N/A"]}),w.docs!==void 0&&w.docs!==null&&e.jsxs("div",{children:["Docs: ",w.docs.toLocaleString()]}),w.store!==void 0&&w.store!==null&&e.jsxs("div",{children:["Size: ",q(w.store)]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:w.state==="STARTED"?w.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":w.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:w.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)",cursor:"pointer"},onClick:()=>o(w),children:w.shard})},`${w.shard}-${w.primary}-${se}`))}):e.jsx(l,{size:"xs",c:"dimmed",children:"-"})},`${s.id}-${d.name}`)})]},s.id)})]})]})})})]})}function ns({shards:r,loading:i,error:b}){var L;const{id:x}=ae(),[T,S]=oe(),[M,I]=W.useState(!1),[n,A]=W.useState(null),N=T.get("shardsSearch")||"",v=((L=T.get("shardStates"))==null?void 0:L.split(",").filter(Boolean))||[],E=T.get("primaryOnly")==="true",k=T.get("replicaOnly")==="true",$=fe(N,300),c=o=>{A(o),I(!0)},C=(o,p,O,B)=>{const m=new URLSearchParams(T);o!==void 0&&(o?m.set("shardsSearch",o):m.delete("shardsSearch")),p!==void 0&&(p.length>0?m.set("shardStates",p.join(",")):m.delete("shardStates")),O!==void 0&&(O?(m.set("primaryOnly","true"),m.delete("replicaOnly")):m.delete("primaryOnly")),B!==void 0&&(B?(m.set("replicaOnly","true"),m.delete("primaryOnly")):m.delete("replicaOnly")),S(m)},j=r==null?void 0:r.filter(o=>{var m;const p=o.index.toLowerCase().includes($.toLowerCase())||((m=o.node)==null?void 0:m.toLowerCase().includes($.toLowerCase())),O=v.length===0||v.includes(o.state),B=!E&&!k||E&&o.primary||k&&!o.primary;return p&&O&&B});if(i)return e.jsx(g,{justify:"center",py:"xl",children:e.jsx(ce,{})});if(b)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",b.message]});if(!r||r.length===0)return e.jsx(l,{c:"dimmed",children:"No shards found"});const D=(j||[]).reduce((o,p)=>(o[p.state]||(o[p.state]=[]),o[p.state].push(p),o),{});return e.jsxs(z,{gap:"md",children:[e.jsxs(g,{wrap:"wrap",children:[e.jsx(he,{placeholder:"Search by index or node...",leftSection:e.jsx(pe,{size:16}),value:N,onChange:o=>C(o.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ge,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:v,onChange:o=>C(void 0,o,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(g,{gap:"md",children:[e.jsx(ue,{label:"Primary only",checked:E,onChange:o=>C(void 0,void 0,o.currentTarget.checked,void 0)}),e.jsx(ue,{label:"Replica only",checked:k,onChange:o=>C(void 0,void 0,void 0,o.currentTarget.checked)})]})]}),e.jsx(H,{children:Object.entries(D).map(([o,p])=>e.jsx(H.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"md",children:e.jsxs(z,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:o}),e.jsx(l,{size:"xl",fw:700,children:p.length})]})})},o))}),j&&j.length===0?e.jsx(l,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(de,{children:[e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Index"}),e.jsx(a.Th,{children:"Shard"}),e.jsx(a.Th,{children:"Type"}),e.jsx(a.Th,{children:"State"}),e.jsx(a.Th,{children:"Node"}),e.jsx(a.Th,{children:"Documents"}),e.jsx(a.Th,{children:"Size"})]})}),e.jsx(a.Tbody,{children:j==null?void 0:j.slice(0,100).map((o,p)=>{const O=o.state==="UNASSIGNED";return e.jsxs(a.Tr,{style:{backgroundColor:O?"rgba(250, 82, 82, 0.1)":void 0,cursor:"pointer"},onClick:()=>c(o),children:[e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:o.index})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:o.shard})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",variant:"light",color:o.primary?"blue":"gray",children:o.primary?"Primary":"Replica"})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",color:o.state==="STARTED"?"green":o.state==="UNASSIGNED"?"red":"yellow",children:o.state})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:o.node||"N/A"})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:o.docs!==void 0&&o.docs!==null?o.docs.toLocaleString():"N/A"})}),e.jsx(a.Td,{children:e.jsx(l,{size:"sm",children:o.store!==void 0&&o.store!==null?q(o.store):"N/A"})})]},`${o.index}-${o.shard}-${p}`)})})]}),j&&j.length>100&&e.jsxs(l,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",j.length," shards"]})]}),n&&e.jsx(Le,{opened:M,onClose:()=>{I(!1),A(null)},shard:n,clusterId:x})]})}export{zs as ClusterView};
