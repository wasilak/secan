import{c as F,K as T,u as J,y as O,a0 as R,r as l,b as L,j as e,A as d,I as h,G as j,L as B,T as U,d as t,S as M,Z as A,D,f as z}from"./index-Bt6cuxqh.js";import{u as P}from"./useMutation-CAENEphD.js";import{p as $}from"./errorHandling-NmYW95TT.js";import{C as x}from"./Container-DMjxdtNE.js";import{B as f}from"./Button-CJn9sQpo.js";import{C as K}from"./Card-Dwru4Zec.js";import{I as Q}from"./IconCheck-BmorQwo6.js";var G=F("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function _(s){if(!s.trim())return"Mappings cannot be empty";try{return JSON.parse(s),null}catch(n){return n.message}}function se(){const{id:s,indexName:n}=T(),I=J(),y=O(),{resolvedTheme:S}=R(),[g,m]=l.useState(""),[b,c]=l.useState(null),[w,a]=l.useState(null),[v,p]=l.useState(!1),{data:o,isLoading:E,error:C}=L({queryKey:["cluster",s,"index",n,"mappings"],queryFn:async()=>{if(!s||!n)throw new Error("Cluster ID and index name are required");const i=(await z.proxyRequest(s,"GET",`/${n}/_mapping`))[n];return i==null?void 0:i.mappings},enabled:!!s&&!!n});l.useEffect(()=>{o&&(m(JSON.stringify(o,null,2)),p(!1))},[o]);const u=P({mutationFn:async()=>{if(!s||!n)throw new Error("Cluster ID and index name are required");const r=_(g);if(r)throw c(r),new Error(`Invalid mappings JSON: ${r}`);const i=JSON.parse(g);await z.proxyRequest(s,"PUT",`/${n}/_mapping`,i)},onSuccess:()=>{y.invalidateQueries({queryKey:["cluster",s,"index",n,"mappings"]}),y.invalidateQueries({queryKey:["cluster",s,"indices"]}),D.show({title:"Success",message:`Mappings for index "${n}" updated successfully`,color:"green",icon:e.jsx(Q,{size:16})}),p(!1),a(null)},onError:r=>{const i=$(r);a(i.message)}}),k=r=>{m(r||""),c(null),a(null),p(!0)},N=()=>{c(null),a(null),u.mutate()},q=()=>{o&&(m(JSON.stringify(o,null,2)),c(null),a(null),p(!1))};return!s||!n?e.jsx(x,{size:"xl",children:e.jsx(d,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})}):E?e.jsx(x,{size:"xl",children:e.jsx(j,{justify:"center",mt:"xl",children:e.jsx(B,{size:"lg"})})}):C?e.jsx(x,{size:"xl",children:e.jsxs(d,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:["Failed to load index mappings: ",C.message]})}):e.jsxs(x,{size:"xl",py:"md",children:[e.jsxs(j,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(U,{order:1,children:"Index Mappings"}),e.jsx(t,{size:"sm",c:"dimmed",children:n})]}),e.jsx(f,{variant:"default",onClick:()=>I(`/cluster/${s}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(M,{gap:"md",children:[e.jsx(d,{icon:e.jsx(G,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(t,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted.",e.jsx("br",{}),"• You can only ",e.jsx("strong",{children:"add new fields"})," to the mappings",e.jsx("br",{}),'• Field types cannot be changed once set (e.g., cannot change from "text" to "keyword")',e.jsx("br",{}),"• Fields cannot be removed from mappings",e.jsx("br",{}),"• To change field types, you must reindex your data into a new index with the correct mappings"]})}),e.jsx(K,{shadow:"sm",padding:"lg",children:e.jsxs(M,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(t,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(t,{size:"xs",c:"dimmed",mb:"sm",children:'Add new fields to the mappings below and click "Update Mappings" to apply changes'}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(A,{height:"500px",defaultLanguage:"json",value:g,onChange:k,theme:S==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),b&&e.jsx(t,{size:"sm",c:"red",mt:"xs",children:b})]}),w&&e.jsx(d,{icon:e.jsx(h,{size:16}),title:"Failed to Update Mappings",color:"red",withCloseButton:!0,onClose:()=>a(null),children:e.jsx(t,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:w})}),e.jsx(d,{color:"blue",title:"Common Field Types",children:e.jsxs(t,{size:"sm",children:["• ",e.jsx("strong",{children:"text"}),": Full-text searchable fields (analyzed)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"keyword"}),": Exact-value fields (not analyzed, used for filtering, sorting, aggregations)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"integer, long, short, byte"}),": Numeric integer types",e.jsx("br",{}),"• ",e.jsx("strong",{children:"float, double"}),": Floating-point numeric types",e.jsx("br",{}),"• ",e.jsx("strong",{children:"boolean"}),": True/false values",e.jsx("br",{}),"• ",e.jsx("strong",{children:"date"}),": Date/time values",e.jsx("br",{}),"• ",e.jsx("strong",{children:"object"}),": JSON objects (nested fields)",e.jsx("br",{}),"• ",e.jsx("strong",{children:"nested"}),": Array of objects with independent querying"]})}),e.jsxs(j,{justify:"flex-end",children:[e.jsx(f,{variant:"default",onClick:q,disabled:!v||u.isPending,children:"Reset"}),e.jsx(f,{onClick:N,loading:u.isPending,disabled:!v,children:u.isPending?"Updating...":"Update Mappings"})]})]})})]})]})}export{se as IndexMappings};
