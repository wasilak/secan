import{q as k,u as y,a as I,b as B,j as e,A as p,I as u,G as j,L as N,T,d as s,S as c,v as M,e as r,f as S}from"./index-YMbInTd0.js";import{u as L}from"./useWatermarks-32bbN6kZ.js";import{C as m}from"./Container-CW6hI4Fd.js";import{B as U}from"./Button-D3Lq9Mp4.js";import{I as q}from"./IconArrowLeft-B3RrLo6d.js";import{B as F}from"./Badge-CeNsrh4N.js";import{G as o}from"./Grid-B2m7EQth.js";import{C as a}from"./Card-CD-BRk3u.js";import{P as C}from"./Progress-C_4MNyD3.js";import"./get-auto-contrast-value-Da6zqqWm.js";function g(n){if(n===0)return"0 B";const d=1024,t=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(n)/Math.log(d));return`${(n/Math.pow(d,l)).toFixed(2)} ${t[l]}`}function b(n){return Math.round(n)}function W(){var z,v,w;const{id:n,nodeId:d}=k(),t=y(),l=I(),{getColor:h}=L(n),{data:i,isLoading:P,error:f}=B({queryKey:["cluster",n,"node",d,"stats"],queryFn:()=>S.getNodeStats(n,d),refetchInterval:l,enabled:!!n&&!!d});return!n||!d?e.jsx(m,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Cluster ID and Node ID are required"})}):P?e.jsx(m,{size:"xl",children:e.jsx(j,{justify:"center",mt:"xl",children:e.jsx(N,{size:"lg"})})}):f?e.jsx(m,{size:"xl",children:e.jsxs(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:["Failed to load node statistics: ",f.message]})}):i?e.jsxs(m,{size:"xl",py:"md",children:[e.jsxs(j,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(j,{gap:"xs",mb:"xs",children:e.jsx(U,{variant:"subtle",leftSection:e.jsx(q,{size:16}),onClick:()=>t(`/cluster/${n}`),children:"Back to Cluster"})}),e.jsx(T,{order:1,children:i.name}),e.jsxs(s,{size:"sm",c:"dimmed",children:["Node ID: ",i.id]}),i.ip&&e.jsxs(s,{size:"sm",c:"dimmed",children:["IP: ",i.ip]})]}),e.jsx(j,{children:i.roles.map(x=>e.jsx(F,{size:"lg",variant:"light",children:x},x))})]}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"Elasticsearch Version"}),e.jsx(s,{size:"lg",fw:700,children:i.version})]})})}),e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"JVM Version"}),e.jsx(s,{size:"lg",fw:700,children:i.jvmVersion})]})})}),i.uptime&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"Uptime"}),e.jsx(s,{size:"lg",fw:700,children:i.uptime})]})})}),i.cpuPercent!==void 0&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",c:"dimmed",children:"CPU Usage"}),e.jsxs(s,{size:"lg",fw:700,children:[i.cpuPercent,"%"]})]})})})]}),i.loadAverage&&i.loadAverage.length>0&&e.jsx(a,{shadow:"sm",padding:"lg",mb:"md",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Load Average"}),e.jsxs(j,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"1 min"}),e.jsx(s,{size:"lg",fw:700,children:((z=i.loadAverage[0])==null?void 0:z.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"5 min"}),e.jsx(s,{size:"lg",fw:700,children:((v=i.loadAverage[1])==null?void 0:v.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(s,{size:"xs",c:"dimmed",children:"15 min"}),e.jsx(s,{size:"lg",fw:700,children:((w=i.loadAverage[2])==null?void 0:w.toFixed(2))||"N/A"})]})]})]})}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Heap Memory Usage"}),e.jsx(C,{value:i.heapPercent,color:h(i.heapPercent),size:"sm",radius:"xs"}),e.jsxs(s,{size:"xs",c:"dimmed",children:[g(i.heapUsed)," / ",g(i.heapMax)," (",b(i.heapPercent),"%)"]})]})})}),e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(s,{size:"sm",fw:500,children:"Disk Usage"}),e.jsx(C,{value:i.diskPercent,color:h(i.diskPercent),size:"sm",radius:"xs"}),e.jsxs(s,{size:"xs",c:"dimmed",children:[g(i.diskUsed)," / ",g(i.diskTotal)," (",b(i.diskPercent),"%)"]})]})})})]}),e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"md",children:[e.jsx(T,{order:3,children:"Thread Pool Statistics"}),e.jsx(s,{size:"sm",c:"dimmed",children:"Thread pool statistics show the current state of various thread pools in the node. Queue sizes indicate pending work, and rejected counts show when pools are overloaded."}),e.jsx(M,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Pool Name"}),e.jsx(r.Th,{children:"Threads"}),e.jsx(r.Th,{children:"Active"}),e.jsx(r.Th,{children:"Queue"}),e.jsx(r.Th,{children:"Largest"}),e.jsx(r.Th,{children:"Completed"}),e.jsx(r.Th,{children:"Rejected"})]})}),e.jsx(r.Tbody,{children:Object.entries(i.threadPools).map(([x,A])=>e.jsx(D,{poolName:x,stats:A},x))})]})}),Object.keys(i.threadPools).length===0&&e.jsx(s,{c:"dimmed",ta:"center",py:"xl",children:"No thread pool statistics available"})]})})]}):e.jsx(m,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Node statistics not found"})})}function D({poolName:n,stats:d}){const t=d.queue>100,l=d.rejected>0,h=l?"red":t?"yellow":void 0;return e.jsxs(r.Tr,{style:{backgroundColor:h?`var(--mantine-color-${h}-light)`:void 0},children:[e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:500,children:n})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.threads})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.active})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:t?700:void 0,c:t?"yellow":void 0,children:d.queue})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.largest})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",children:d.completed.toLocaleString()})}),e.jsx(r.Td,{children:e.jsx(s,{size:"sm",fw:l?700:void 0,c:l?"red":void 0,children:d.rejected.toLocaleString()})})]})}export{W as NodeDetail};
