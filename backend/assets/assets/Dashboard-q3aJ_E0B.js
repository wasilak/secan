import{u as K,j as e,T as W,B as H,g as Q,f as X,a as Y,b as J,r as w,c as Z,d as E,e as O,h as ee,i as se,k as re,S as C,l as I,C as z,L as ne,m as j,A as P,I as L,G as $,n as x,o as M,U as te,p as le}from"./index-BHNEvZQA.js";import{u as ae}from"./accessibility-BuzKzDBc.js";import{G as R}from"./Grid-DA96bHYB.js";import{C as D}from"./Card-141lmRa4.js";import{B as oe}from"./Badge-BVbCuTyy.js";function ie({size:l,thickness:i,sum:n,value:c,root:h,offset:d}){const r=(l*.9-i*2)/2,a=Math.PI*r*2/100,t=h||c===void 0?`${(100-n)*a}, ${n*a}`:`${c*a}, ${(100-c)*a}`;return{strokeWidth:Number.isNaN(i)?12:i,cx:l/2||0,cy:l/2||0,r:r||0,transform:h?`scale(1, -1) translate(0, -${l})`:void 0,strokeDasharray:t,strokeDashoffset:h?0:d||0}}function B({size:l,value:i,offset:n,sum:c,thickness:h,root:d,color:r,lineRoundCaps:a,tooltip:t,getStyles:u,display:o,...m}){const v=K();return e.jsx(W.Floating,{disabled:!t,label:t,children:e.jsx(H,{component:"circle",...m,...u("curve"),__vars:{"--curve-color":r?Q(r,v):void 0},fill:"none",strokeLinecap:a?"round":"butt",...ie({sum:c,size:l,thickness:h,value:i,offset:n,root:d})})})}B.displayName="@mantine/core/Curve";function ce({size:l,thickness:i,sections:n,renderRoundedLineCaps:c,rootColor:h}){const d=n.reduce((o,m)=>o+m.value,0),r=Math.PI*((l*.9-i*2)/2)*2;let a=r;const t=[],u=[];for(let o=0;o<n.length;o+=1)t.push({sum:d,offset:a,data:n[o],root:!1}),a-=n[o].value/100*r;if(t.push({sum:d,offset:a,data:{color:h},root:!0}),u.push({...t[t.length-1],lineRoundCaps:!1}),t.length>2){u.push({...t[0],lineRoundCaps:c}),u.push({...t[t.length-2],lineRoundCaps:c});for(let o=1;o<=t.length-3;o+=1)u.push({...t[o],lineRoundCaps:!1})}else u.push({...t[0],lineRoundCaps:c});return u}var G={root:"m_b32e4812",svg:"m_d43b5134",curve:"m_b1ca1fbf",label:"m_b23f9dc4"};function de(l,i){return Math.min(l||12,(i||120)/4)}const he={size:120,thickness:12},ue=Z((l,{size:i,thickness:n,transitionDuration:c})=>({root:{"--rp-size":E(i),"--rp-label-offset":E(n*2),"--rp-transition-duration":c?`${c}ms`:void 0}})),k=X((l,i)=>{const n=Y("RingProgress",he,l),{classNames:c,className:h,style:d,styles:r,unstyled:a,vars:t,label:u,sections:o,size:m,thickness:v,roundCaps:y,rootColor:T,transitionDuration:g,...s}=n,f=J({name:"RingProgress",classes:G,props:n,className:h,style:d,classNames:c,styles:r,unstyled:a,vars:t,varsResolver:ue}),b=de(v,m),p=ce({size:m,thickness:b,sections:o,renderRoundedLineCaps:y,rootColor:T}).map(({data:N,sum:U,root:V,lineRoundCaps:A,offset:F},q)=>w.createElement(B,{...N,key:q,size:m,thickness:b,sum:U,offset:F,color:N==null?void 0:N.color,root:V,lineRoundCaps:A,getStyles:f}));return e.jsxs(H,{...f("root"),size:m,ref:i,...s,children:[e.jsx("svg",{...f("svg"),children:p}),u&&e.jsx("div",{...f("label"),children:u})]})});k.classes=G;k.displayName="@mantine/core/RingProgress";var me=O("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),xe=O("selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);function ge(l){switch(l){case"green":return"green";case"yellow":return"yellow";case"red":return"red";case"unreachable":return"gray";default:return"gray"}}function _(l){switch(l){case"green":return 3;case"yellow":return 2;case"red":return 1;case"unreachable":return 0;default:return 0}}function fe(l,i,n){return n?[...l].sort((h,d)=>{let r,a;return i==="health"?(r=_(h.health),a=_(d.health)):(r=h[i],a=d[i]),typeof r=="string"&&typeof a=="string"?n==="asc"?r.localeCompare(a):a.localeCompare(r):typeof r=="number"&&typeof a=="number"?n==="asc"?r-a:a-r:0}):l}function S({column:l,currentColumn:i,direction:n,onSort:c,children:h}){const d=i===l,r=d?`Sorted ${n==="asc"?"ascending":"descending"}`:"Not sorted";return e.jsx(x.Th,{children:e.jsxs(te,{onClick:()=>c(l),style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},"aria-label":`Sort by ${h}, ${r}`,children:[e.jsx(j,{fw:500,children:h}),d&&n==="asc"&&e.jsx(me,{size:14,"aria-hidden":"true"}),d&&n==="desc"&&e.jsx(le,{size:14,"aria-hidden":"true"}),!d&&e.jsx(xe,{size:14,opacity:.5,"aria-hidden":"true"})]})})}function Ce(){const l=ee(),i=se(),{announce:n,announceError:c}=ae(),[h,d]=w.useState([]),[r,a]=w.useState(null),[t,u]=w.useState(null),{data:o,isLoading:m,error:v}=re({queryKey:["clusters"],queryFn:()=>M.getClusters(),refetchInterval:i});w.useEffect(()=>{m?n("Loading clusters"):v?c("Failed to load cluster list"):o&&n(`Loaded ${o.length} cluster${o.length!==1?"s":""}`)},[m,v,o,n,c]),w.useEffect(()=>{if(!o||o.length===0){d([]);return}(async()=>{const f=await Promise.all(o.map(async b=>{try{const p=await M.getClusterStats(b.id);return{id:b.id,name:b.name,health:p.health,nodes:p.numberOfNodes,shards:p.activeShards,indices:p.numberOfIndices,documents:p.numberOfDocuments}}catch(p){return{id:b.id,name:b.name,health:"unreachable",nodes:0,shards:0,indices:0,documents:0,error:p instanceof Error?p.message:"Unknown error"}}}));d(f)})()},[o]);const y=s=>{r===s?t==="asc"?(u("desc"),n(`Sorted by ${s} descending`)):t==="desc"&&(u(null),a(null),n("Sort removed")):(a(s),u("asc"),n(`Sorted by ${s} ascending`))},T=s=>{l(`/cluster/${s}`)},g=fe(h,r,t);return m?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(I,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(z,{h:200,children:e.jsxs(C,{align:"center",gap:"md",children:[e.jsx(ne,{size:"lg"}),e.jsx(j,{c:"dimmed",children:"Loading clusters..."})]})})]}):v?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(I,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(P,{icon:e.jsx(L,{size:16}),title:"Error loading clusters",color:"red",children:v instanceof Error?v.message:"Failed to load cluster list"})]}):!o||o.length===0?e.jsxs(C,{gap:"md",p:"md",children:[e.jsx(I,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsx(P,{icon:e.jsx(L,{size:16}),title:"No clusters configured",color:"blue",children:"No Elasticsearch or OpenSearch clusters are configured. Please check your configuration file."})]}):e.jsxs(C,{gap:"md",p:"md",children:[e.jsx($,{justify:"space-between",wrap:"wrap",children:e.jsx(I,{order:1,className:"text-responsive-xl",children:"Dashboard"})}),e.jsxs(R,{children:[e.jsx(R.Col,{span:{base:12,sm:4},children:e.jsx(D,{shadow:"sm",padding:"lg",children:e.jsx($,{justify:"center",children:e.jsx(k,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="green").length/g.length*100,color:"green"}],label:e.jsx(z,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(j,{size:"xl",fw:700,children:g.filter(s=>s.health==="green").length}),e.jsx(j,{size:"xs",c:"dimmed",children:"Green"})]})})})})})}),e.jsx(R.Col,{span:{base:12,sm:4},children:e.jsx(D,{shadow:"sm",padding:"lg",children:e.jsx($,{justify:"center",children:e.jsx(k,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="yellow").length/g.length*100,color:"yellow"}],label:e.jsx(z,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(j,{size:"xl",fw:700,children:g.filter(s=>s.health==="yellow").length}),e.jsx(j,{size:"xs",c:"dimmed",children:"Yellow"})]})})})})})}),e.jsx(R.Col,{span:{base:12,sm:4},children:e.jsx(D,{shadow:"sm",padding:"lg",children:e.jsx($,{justify:"center",children:e.jsx(k,{size:120,thickness:12,sections:[{value:g.filter(s=>s.health==="red").length/g.length*100,color:"red"}],label:e.jsx(z,{children:e.jsxs(C,{gap:0,align:"center",children:[e.jsx(j,{size:"xl",fw:700,children:g.filter(s=>s.health==="red").length}),e.jsx(j,{size:"xs",c:"dimmed",children:"Red"})]})})})})})})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(x,{highlightOnHover:!0,striped:!0,role:"table","aria-label":"Cluster overview table",style:{minWidth:"600px"},children:[e.jsx(x.Thead,{children:e.jsxs(x.Tr,{children:[e.jsx(S,{column:"name",currentColumn:r,direction:t,onSort:y,children:"Cluster Name"}),e.jsx(S,{column:"health",currentColumn:r,direction:t,onSort:y,children:"Health"}),e.jsx(S,{column:"nodes",currentColumn:r,direction:t,onSort:y,children:"Nodes"}),e.jsx(S,{column:"shards",currentColumn:r,direction:t,onSort:y,children:"Shards"}),e.jsx(S,{column:"indices",currentColumn:r,direction:t,onSort:y,children:"Indices"}),e.jsx(S,{column:"documents",currentColumn:r,direction:t,onSort:y,children:"Documents"})]})}),e.jsx(x.Tbody,{children:g.map(s=>e.jsxs(x.Tr,{onClick:()=>T(s.id),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),T(s.id))},"aria-label":`View details for cluster ${s.name}`,children:[e.jsxs(x.Td,{children:[e.jsx(j,{fw:500,children:s.name}),s.error&&e.jsx(j,{size:"xs",c:"dimmed",role:"alert",children:s.error})]}),e.jsx(x.Td,{children:e.jsx(oe,{color:ge(s.health),variant:"filled","aria-label":`Health status: ${s.health}`,children:s.health})}),e.jsx(x.Td,{children:s.nodes}),e.jsx(x.Td,{children:s.shards}),e.jsx(x.Td,{children:s.indices}),e.jsx(x.Td,{children:s.documents.toLocaleString()})]},s.id))})]})})]})}export{Ce as Dashboard};
