import{k as T,u as J,f as L,ah as O,r as l,a as _,j as e,G as m,L as F,T as R,b as r,S as b,n as C,e as I}from"./index-C8ymOacG.js";import{u as P}from"./useMutation-CRGTNYZI.js";import{F as $}from"./index-Bl4nw7jN.js";import{C as c}from"./Container-BQ_rK_nV.js";import{A as g,I as h}from"./IconAlertCircle-4m6fNDLv.js";import{B as f}from"./Button-oHua593b.js";import{I as B}from"./IconInfoCircle-C5TXJcBB.js";import{C as D}from"./Card-BpmUvWiF.js";import{I as M}from"./IconCheck-CQUlAqsc.js";function Q(s){if(!s.trim())return"Settings cannot be empty";try{return JSON.parse(s),null}catch(t){return t.message}}function Z(){const{id:s,indexName:t}=T(),v=J(),p=L(),{resolvedTheme:z}=O(),[u,x]=l.useState(""),[j,a]=l.useState(null),[y,o]=l.useState(!1),{data:n,isLoading:w,error:S}=_({queryKey:["cluster",s,"index",t,"settings"],queryFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");return await I.proxyRequest(s,"GET",`/${t}/_settings`)},enabled:!!s&&!!t});l.useEffect(()=>{n&&(x(JSON.stringify(n,null,2)),o(!1))},[n]);const d=P({mutationFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");const i=Q(u);if(i)throw a(i),new Error(`Invalid settings JSON: ${i}`);const N=JSON.parse(u);await I.proxyRequest(s,"PUT",`/${t}/_settings`,N)},onSuccess:()=>{p.invalidateQueries({queryKey:["cluster",s,"index",t,"settings"]}),p.invalidateQueries({queryKey:["cluster",s,"indices"]}),C.show({title:"Success",message:`Settings for index "${t}" updated successfully`,color:"green",icon:e.jsx(M,{size:16})}),o(!1)},onError:i=>{C.show({title:"Error",message:i.message||"Failed to update settings",color:"red",icon:e.jsx(h,{size:16})})}}),E=i=>{x(i||""),a(null),o(!0)},k=()=>{a(null),d.mutate()},q=()=>{n&&(x(JSON.stringify(n,null,2)),a(null),o(!1))};return!s||!t?e.jsx(c,{size:"xl",children:e.jsx(g,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})}):w?e.jsx(c,{size:"xl",children:e.jsx(m,{justify:"center",mt:"xl",children:e.jsx(F,{size:"lg"})})}):S?e.jsx(c,{size:"xl",children:e.jsxs(g,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:["Failed to load index settings: ",S.message]})}):e.jsxs(c,{size:"xl",py:"md",children:[e.jsxs(m,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(R,{order:1,children:"Index Settings"}),e.jsx(r,{size:"sm",c:"dimmed",children:t})]}),e.jsx(f,{variant:"default",onClick:()=>v(`/cluster/${s}/indices`),children:"Back to Indices"})]}),e.jsxs(b,{gap:"md",children:[e.jsx(g,{icon:e.jsx(B,{size:16}),color:"blue",title:"Settings Information",children:e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Dynamic settings"})," can be updated on an open index (e.g., number_of_replicas, refresh_interval).",e.jsx("br",{}),e.jsx("strong",{children:"Static settings"})," can only be set at index creation or on a closed index (e.g., number_of_shards, codec).",e.jsx("br",{}),"To update static settings, you must first close the index, update the settings, then reopen it."]})}),e.jsx(D,{shadow:"sm",padding:"lg",children:e.jsxs(b,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(r,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),e.jsx(r,{size:"xs",c:"dimmed",mb:"sm",children:'Edit the settings below and click "Update Settings" to apply changes'}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx($,{height:"500px",defaultLanguage:"json",value:u,onChange:E,theme:z==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),j&&e.jsx(r,{size:"sm",c:"red",mt:"xs",children:j})]}),e.jsxs(m,{justify:"flex-end",children:[e.jsx(f,{variant:"default",onClick:q,disabled:!y||d.isPending,children:"Reset"}),e.jsx(f,{onClick:k,loading:d.isPending,disabled:!y,children:d.isPending?"Updating...":"Update Settings"})]})]})})]})]})}export{Z as IndexSettings};
