import{q as ls,a as Le,s as Te,j as e,P as Fe,r as E,t as os,v as De,w as ds,e as xe,x as Ee,y as k,o as R,M as C,T as re,z as le,D as cs,E as hs,F as Ie,S as w,m as a,G as f,H as ge,h as Oe,J as us,K as pe,k as oe,A as Y,I as ne,B as ue,l as Ke,N as Qe,O as Je,Q as qe,L as je,R as fe,V as Ve,i as ms,W as Me,n as o,X as Ue}from"./index-DSx4aMbE.js";import{u as Z}from"./useMutation-DpGaIkJE.js";import{u as Ze}from"./useWatermarks-D-odUnnV.js";import{u as xs}from"./accessibility-CGpWXvne.js";import{I as gs}from"./IconDeviceFloppy-B5rfkQ9G.js";import{I as ps}from"./IconTrash-lr1WKkp0.js";import{T as Ce}from"./TextInput--5kjmcBM.js";import{B as te}from"./Button-DaorxvsC.js";import{N as js}from"./NumberInput-xgWHt6uH.js";import{C as ze}from"./Container-BzZy71Fn.js";import{S as J,I as Xe,a as de,b as Ye,c as es,C as me}from"./IconMinimize-BhNzwIVc.js";import{C as X}from"./Card-CxfmeINf.js";import{T as G}from"./Tabs-CxObaDUH.js";import{I as fs}from"./IconCheck-BodkNk19.js";import{P as be}from"./Progress-YZFbGNLG.js";import{G as ee}from"./Grid-DQVJTE0K.js";import{B}from"./Badge-BpWI3BpH.js";import{M as ke}from"./MultiSelect-BpsowOTn.js";import{I as ys,a as vs}from"./IconSortDescending-KBKnvXJs.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./InputsGroupFieldset-CSqBNSK3.js";import"./get-safe-id-Bp3H8K0-.js";const[Ss,ss]=ls("HoverCard component was not found in the tree"),bs={};function rs(s){const{children:n,onMouseEnter:t,onMouseLeave:c,...h}=Le("HoverCardDropdown",bs,s),j=ss(),y=Te(t,j.openDropdown),u=Te(c,j.closeDropdown);return e.jsx(Fe.Dropdown,{onMouseEnter:y,onMouseLeave:u,...h,children:n})}rs.displayName="@mantine/core/HoverCardDropdown";const Cs={refProp:"ref"},ns=E.forwardRef((s,n)=>{const{children:t,refProp:c,eventPropsWrapperName:h,...j}=Le("HoverCardTarget",Cs,s);if(!os(t))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const y=ss(),u=Te(t.props.onMouseEnter,y.openDropdown),v=Te(t.props.onMouseLeave,y.closeDropdown),M={onMouseEnter:u,onMouseLeave:v};return e.jsx(Fe.Target,{refProp:c,ref:n,...j,children:E.cloneElement(t,h?{[h]:M}:M)})});ns.displayName="@mantine/core/HoverCardTarget";const ws={openDelay:0,closeDelay:150,initiallyOpened:!1};function he(s){const{children:n,onOpen:t,onClose:c,openDelay:h,closeDelay:j,initiallyOpened:y,...u}=Le("HoverCard",ws,s),[v,{open:M,close:D}]=De(y,{onClose:c,onOpen:t}),{openDropdown:L,closeDropdown:z}=ds({open:M,close:D,openDelay:h,closeDelay:j});return e.jsx(Ss,{value:{openDropdown:L,closeDropdown:z},children:e.jsx(Fe,{...u,opened:v,__staticSelector:"HoverCard",children:n})})}he.displayName="@mantine/core/HoverCard";he.Target=ns;he.Dropdown=rs;he.extend=s=>s;var zs=xe("chart-bar","IconChartBar",[["path",{d:"M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20l14 0",key:"svg-3"}]]),ts=xe("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Ts=xe("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Is=xe("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),ks=xe("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]),_e=xe("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function $e(s,n=300){const[t,c]=E.useState(s);return E.useEffect(()=>{const h=setTimeout(()=>{c(s)},n);return()=>{clearTimeout(h)}},[s,n]),t}function Es({clusterId:s,index:n}){const t=Ee(),{announceSuccess:c,announceError:h}=xs(),[j,{open:y,close:u}]=De(!1),[v,{open:M,close:D}]=De(!1),[L,z]=E.useState(""),[$,A]=E.useState(1),x=Z({mutationFn:()=>R.openIndex(s,n.name),onMutate:()=>{k.show({id:`open-${n.name}`,title:"Opening index",message:`Opening index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`open-${n.name}`,title:"Success",message:`Index ${n.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),c(`Index ${n.name} opened successfully`),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:p=>{k.update({id:`open-${n.name}`,title:"Error",message:`Failed to open index: ${p.message}`,color:"red",loading:!1,autoClose:5e3}),h(`Failed to open index: ${p.message}`)}}),i=Z({mutationFn:()=>R.closeIndex(s,n.name),onMutate:()=>{k.show({id:`close-${n.name}`,title:"Closing index",message:`Closing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`close-${n.name}`,title:"Success",message:`Index ${n.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]})},onError:p=>{k.update({id:`close-${n.name}`,title:"Error",message:`Failed to close index: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),S=Z({mutationFn:()=>R.deleteIndex(s,n.name),onMutate:()=>{k.show({id:`delete-${n.name}`,title:"Deleting index",message:`Deleting index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`delete-${n.name}`,title:"Success",message:`Index ${n.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),t.invalidateQueries({queryKey:["cluster",s,"indices"]}),u(),z("")},onError:p=>{k.update({id:`delete-${n.name}`,title:"Error",message:`Failed to delete index: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),O=Z({mutationFn:p=>R.forceMergeIndex(s,n.name,p),onMutate:()=>{k.show({id:`forcemerge-${n.name}`,title:"Force merging index",message:`Force merging index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`forcemerge-${n.name}`,title:"Success",message:`Index ${n.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),D(),A(1)},onError:p=>{k.update({id:`forcemerge-${n.name}`,title:"Error",message:`Failed to force merge index: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),q=Z({mutationFn:()=>R.clearCacheIndex(s,n.name),onMutate:()=>{k.show({id:`clearcache-${n.name}`,title:"Clearing cache",message:`Clearing cache for index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`clearcache-${n.name}`,title:"Success",message:`Cache cleared for index ${n.name}`,color:"green",loading:!1,autoClose:3e3})},onError:p=>{k.update({id:`clearcache-${n.name}`,title:"Error",message:`Failed to clear cache: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),d=Z({mutationFn:()=>R.refreshIndex(s,n.name),onMutate:()=>{k.show({id:`refresh-${n.name}`,title:"Refreshing index",message:`Refreshing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`refresh-${n.name}`,title:"Success",message:`Index ${n.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:p=>{k.update({id:`refresh-${n.name}`,title:"Error",message:`Failed to refresh index: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),b=Z({mutationFn:()=>R.flushIndex(s,n.name),onMutate:()=>{k.show({id:`flush-${n.name}`,title:"Flushing index",message:`Flushing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{k.update({id:`flush-${n.name}`,title:"Success",message:`Index ${n.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:p=>{k.update({id:`flush-${n.name}`,title:"Error",message:`Failed to flush index: ${p.message}`,color:"red",loading:!1,autoClose:5e3})}}),P=()=>{L===n.name&&S.mutate()},H=()=>{const p=typeof $=="number"?$:parseInt($,10);!isNaN(p)&&p>0&&O.mutate(p)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Index operations",children:e.jsx(le,{variant:"subtle",color:"gray","aria-label":`Operations for index ${n.name}`,children:e.jsx(ts,{size:16,"aria-hidden":"true"})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Index Operations"}),n.status==="close"?e.jsx(C.Item,{leftSection:e.jsx(ks,{size:14,"aria-hidden":"true"}),onClick:()=>x.mutate(),disabled:x.isPending,children:"Open Index"}):e.jsx(C.Item,{leftSection:e.jsx(Is,{size:14,"aria-hidden":"true"}),onClick:()=>i.mutate(),disabled:i.isPending,children:"Close Index"}),e.jsx(C.Item,{leftSection:e.jsx(cs,{size:14,"aria-hidden":"true"}),onClick:()=>d.mutate(),disabled:d.isPending,children:"Refresh"}),e.jsx(C.Item,{leftSection:e.jsx(gs,{size:14,"aria-hidden":"true"}),onClick:()=>b.mutate(),disabled:b.isPending,children:"Flush"}),e.jsx(C.Item,{leftSection:e.jsx(Ts,{size:14,"aria-hidden":"true"}),onClick:()=>q.mutate(),disabled:q.isPending,children:"Clear Cache"}),e.jsx(C.Item,{leftSection:e.jsx(hs,{size:14,"aria-hidden":"true"}),onClick:M,children:"Force Merge"}),e.jsx(C.Divider,{}),e.jsx(C.Item,{leftSection:e.jsx(ps,{size:14,"aria-hidden":"true"}),color:"red",onClick:y,children:"Delete Index"})]})]}),e.jsx(Ie,{opened:j,onClose:()=>{u(),z("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(w,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(a,{span:!0,fw:700,children:n.name}),"? This action cannot be undone."]}),e.jsx(a,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(Ce,{placeholder:n.name,value:L,onChange:p=>z(p.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{u(),z("")},children:"Cancel"}),e.jsx(te,{color:"red",onClick:P,disabled:L!==n.name||S.isPending,loading:S.isPending,"aria-label":`Delete index ${n.name}`,children:"Delete"})]})]})}),e.jsx(Ie,{opened:v,onClose:()=>{D(),A(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(w,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(a,{span:!0,fw:700,children:n.name})," to reduce the number of segments."]}),e.jsx(js,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:$,onChange:A,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:()=>{D(),A(1)},children:"Cancel"}),e.jsx(te,{onClick:H,disabled:O.isPending,loading:O.isPending,"aria-label":`Force merge index ${n.name}`,children:"Force Merge"})]})]})})]})}function Be(s){var n;if(console.error("Error occurred:",s),s&&typeof s=="object"&&"name"in s&&s.name==="ApiClientError"&&"message"in s&&"statusCode"in s){const t=s;if(t.error){const c=He(t.error);if(c)return{error:"elasticsearch_error",message:c,statusCode:t.statusCode,details:t.error}}return{error:"api_error",message:t.message,statusCode:t.statusCode,details:t.error}}if(s&&typeof s=="object"&&"response"in s){const t=s.response;if(t!=null&&t.data){const c=He(t.data);return{error:t.data.error||"api_error",message:c||t.data.message||"An error occurred",details:t.data.details,statusCode:t.status,requestId:(n=t.headers)==null?void 0:n["x-request-id"]}}return{error:"http_error",message:`HTTP ${(t==null?void 0:t.status)||"Unknown"}: ${(t==null?void 0:t.statusText)||"Request failed"}`,statusCode:t==null?void 0:t.status}}if(s&&typeof s=="object"&&"message"in s){const t=s;return t.message.includes("Network")||t.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:t.message}:{error:"error",message:t.message,details:t.stack}}return typeof s=="string"?{error:"error",message:s}:{error:"unknown_error",message:"An unexpected error occurred",details:s}}function He(s){const n=s;if(n.error&&typeof n.error=="object"){const t=n.error;if(t.reason&&typeof t.reason=="string"){let c=`Elasticsearch: ${t.reason}`;if(t.type&&typeof t.type=="string"&&(c=`Elasticsearch (${t.type}): ${t.reason}`),t.root_cause&&Array.isArray(t.root_cause)&&t.root_cause.length>0){const h=t.root_cause[0];h.reason&&h.reason!==t.reason&&(c+=`
Root cause: ${h.reason}`)}return c}}if("details"in n&&n.details&&typeof n.details=="object"){const t=n.details;if(t.error&&typeof t.error=="object"){const c=t.error;if(c.reason&&typeof c.reason=="string"){let h=`Elasticsearch: ${c.reason}`;if(c.type&&typeof c.type=="string"&&(h=`Elasticsearch (${c.type}): ${c.reason}`),c.root_cause&&Array.isArray(c.root_cause)&&c.root_cause.length>0){const j=c.root_cause[0];j.reason&&j.reason!==c.reason&&(h+=`
Root cause: ${j.reason}`)}return h}}}return null}function Ge(s,n){if(!s.trim())return`${n} cannot be empty`;try{return JSON.parse(s),null}catch(t){return t.message}}function Ne(s){const n=["creation_date","provided_name","uuid","version"],t=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],c=[...n,...t],h={};for(const[j,y]of Object.entries(s))if(j==="index"){const u=y,v={};for(const[M,D]of Object.entries(u))c.includes(M)||(v[M]=D);Object.keys(v).length>0&&(h[j]=v)}else c.includes(j)||(h[j]=y);return h}function Ms(){const{id:s,indexName:n}=ge(),t=Oe(),c=Ee(),{resolvedTheme:h}=us(),[j,y]=pe(),u=j.get("index")||n,v=j.get("indexTab")||j.get("tab")||"settings",[M,D]=E.useState(""),[L,z]=E.useState(""),[$,A]=E.useState(null),[x,i]=E.useState(null),[S,O]=E.useState(null),[q,d]=E.useState(!1),[b,P]=E.useState(!1),[H,p]=E.useState(null),[W,Q]=E.useState(!1),[K,ie]=E.useState(null);E.useEffect(()=>{v==="stats"&&!H&&!W&&(Q(!0),ie(null),R.proxyRequest(s,"GET",`/${u}/_stats`).then(I=>{p(I)}).catch(I=>{ie(I instanceof Error?I.message:"Failed to fetch stats")}).finally(()=>{Q(!1)}))},[v,s,u,H,W]);const{data:F,isLoading:_,error:l}=oe({queryKey:["cluster",s,"index",u,"settings"],queryFn:async()=>{if(!s||!u)throw new Error("Cluster ID and index name are required");const U=(await R.proxyRequest(s,"GET",`/${u}/_settings`))[u];return U==null?void 0:U.settings},enabled:!!s&&!!u}),{data:r,isLoading:g,error:m}=oe({queryKey:["cluster",s,"index",u,"mappings"],queryFn:async()=>{if(!s||!u)throw new Error("Cluster ID and index name are required");const U=(await R.proxyRequest(s,"GET",`/${u}/_mapping`))[u];return U==null?void 0:U.mappings},enabled:!!s&&!!u});E.useEffect(()=>{if(F){const I=Ne(F);D(JSON.stringify(I,null,2)),d(!1)}},[F]),E.useEffect(()=>{r&&(z(JSON.stringify(r,null,2)),P(!1))},[r]);const N=Z({mutationFn:async()=>{if(!s||!u)throw new Error("Cluster ID and index name are required");const I=[];if(q){const U=Ge(M,"Settings");if(U)throw A(U),new Error(`Invalid settings JSON: ${U}`);const Pe=JSON.parse(M),as=Ne(Pe);I.push(R.proxyRequest(s,"PUT",`/${u}/_settings`,as))}if(b){const U=Ge(L,"Mappings");if(U)throw i(U),new Error(`Invalid mappings JSON: ${U}`);const Pe=JSON.parse(L);I.push(R.proxyRequest(s,"PUT",`/${u}/_mapping`,Pe))}await Promise.all(I)},onSuccess:()=>{c.invalidateQueries({queryKey:["cluster",s,"index",u]}),c.invalidateQueries({queryKey:["cluster",s,"indices"]});const I=[];q&&I.push("settings"),b&&I.push("mappings"),k.show({title:"Success",message:`Index ${I.join(" and ")} updated successfully`,color:"green",icon:e.jsx(fs,{size:16})}),d(!1),P(!1),O(null)},onError:I=>{const U=Be(I);O(U.message)}}),T=I=>{D(I||""),A(null),O(null),d(!0)},ae=I=>{z(I||""),i(null),O(null),P(!0)},ye=()=>{A(null),i(null),O(null),N.mutate()},we=()=>{if(F){const I=Ne(F);D(JSON.stringify(I,null,2)),d(!1)}r&&(z(JSON.stringify(r,null,2)),P(!1)),A(null),i(null),O(null)},ve=I=>{if(I){const U=new URLSearchParams(j);j.has("index")?U.set("indexTab",I):U.set("tab",I),y(U)}},ce=_||g,Se=l||m,Ae=q||b;if(!s||!u)return e.jsx(ze,{size:"xl",children:e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(ce)return e.jsxs(ze,{size:"xl",py:"md",children:[e.jsxs(f,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(J,{height:32,width:200,mb:"xs"}),e.jsx(J,{height:20,width:150})]}),e.jsx(J,{height:36,width:120})]}),e.jsxs(w,{gap:"md",children:[e.jsx(J,{height:48,width:"100%"}),e.jsx(X,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(J,{height:400})})]})]});if(Se){const I=Be(Se);return e.jsxs(ze,{size:"xl",py:"md",children:[e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error Loading Index",color:"red",children:I.message}),e.jsx(te,{variant:"default",onClick:()=>t(`/cluster/${s}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(ze,{size:"xl",py:"md",style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(f,{justify:"space-between",mb:"md",children:[e.jsxs(ue,{children:[e.jsx(Ke,{order:1,children:"Edit Index"}),e.jsx(a,{size:"sm",c:"dimmed",children:u})]}),!j.has("index")&&e.jsx(te,{variant:"default",onClick:()=>t(`/cluster/${s}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(w,{gap:"md",style:{flex:1,overflow:"auto"},children:[e.jsxs(G,{value:v,onChange:ve,children:[e.jsxs(G.List,{children:[e.jsx(G.Tab,{value:"settings",leftSection:e.jsx(Qe,{size:16}),children:"Settings"}),e.jsx(G.Tab,{value:"mappings",leftSection:e.jsx(Je,{size:16}),children:"Mappings"}),e.jsx(G.Tab,{value:"stats",leftSection:e.jsx(zs,{size:16}),children:"Stats"})]}),e.jsx(G.Panel,{value:"settings",pt:"md",children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs(ue,{children:[e.jsxs(f,{gap:"xs",mb:"xs",children:[e.jsx(a,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(he,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(he.Target,{children:e.jsx(ue,{component:"span",style:{cursor:"help"},c:"blue.6",children:e.jsx(_e,{size:16})})}),e.jsxs(he.Dropdown,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(a,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(a,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx(ue,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(qe,{height:"500px",defaultLanguage:"json",value:M,onChange:T,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),$&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:$})]})})})}),e.jsx(G.Panel,{value:"mappings",pt:"md",children:e.jsxs(w,{gap:"md",children:[e.jsx(Y,{icon:e.jsx(_e,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs(ue,{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx(ue,{style:{border:"1px solid var(--mantine-color-gray-4)",borderRadius:"var(--mantine-radius-sm)"},children:e.jsx(qe,{height:"500px",defaultLanguage:"json",value:L,onChange:ae,theme:h==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),x&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:x})]})})})]})}),e.jsx(G.Panel,{value:"stats",pt:"md",children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsx(w,{gap:"md",children:e.jsxs("div",{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Statistics (Read-only)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:"Detailed statistics for this index"}),W?e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})}):K?e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:K}):H?e.jsx(fe,{h:500,children:e.jsx(Ve,{block:!0,children:JSON.stringify(H,null,2)})}):null]})})})})]}),S&&e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>O(null),children:e.jsx(a,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:S})}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(te,{variant:"default",onClick:we,disabled:!Ae||N.isPending,children:"Reset"}),e.jsx(te,{onClick:ye,loading:N.isPending,disabled:!Ae,children:N.isPending?"Saving...":"Save Changes"})]})]})]})}function Re(s){switch(s){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function V(s){if(s===0)return"0 B";const n=1024,t=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(s)/Math.log(n));return`${(s/Math.pow(n,c)).toFixed(2)} ${t[c]}`}function se(s,n){return n===0?0:Math.round(s/n*100)}function We(s){switch(s){case"green":return"transparent";case"yellow":return"rgba(250, 176, 5, 0.15)";case"red":return"rgba(250, 82, 82, 0.15)";default:return"transparent"}}function nr(){var ie;const{id:s}=ge(),n=ms(),[t,c]=pe(),{getColor:h}=Ze(s),j=t.get("tab")||"overview",y=t.get("index"),u=t.get("indexTab"),[v,M]=E.useState(!1),[D,L]=E.useState(null);E.useEffect(()=>{y?(L(decodeURIComponent(y)),M(!0)):(M(!1),L(null))},[y]);const z=(F,_)=>{const l=new URLSearchParams(t);l.set("index",encodeURIComponent(F)),_?l.set("indexTab",_):l.delete("indexTab"),c(l)},$=()=>{const F=new URLSearchParams(t);F.delete("index"),F.delete("indexTab"),c(F)},A=F=>{if(F){const _=new URLSearchParams(t);_.set("tab",F),y&&_.set("index",y),u&&_.set("indexTab",u),c(_)}},x=F=>{const _=new URLSearchParams;_.set("tab",F),c(_)},{data:i,isLoading:S,error:O}=oe({queryKey:["cluster",s,"stats"],queryFn:()=>R.getClusterStats(s),refetchInterval:n,enabled:!!s}),{data:q,isLoading:d,error:b}=oe({queryKey:["cluster",s,"nodes"],queryFn:()=>R.getNodes(s),refetchInterval:n,enabled:!!s}),{data:P,isLoading:H,error:p}=oe({queryKey:["cluster",s,"indices"],queryFn:()=>R.getIndices(s),refetchInterval:n,enabled:!!s}),{data:W,isLoading:Q,error:K}=oe({queryKey:["cluster",s,"shards"],queryFn:()=>R.getShards(s),refetchInterval:n,enabled:!!s});return s?S?e.jsx(w,{p:"md",children:e.jsx(f,{justify:"center",mt:"xl",children:e.jsx(je,{size:"lg"})})}):O?e.jsx(w,{p:"md",children:e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",O.message]})}):e.jsxs(w,{gap:"md",p:"md",children:[e.jsx(f,{justify:"space-between",wrap:"wrap",children:e.jsxs("div",{children:[e.jsx(Ke,{order:1,className:"text-responsive-xl",children:(i==null?void 0:i.clusterName)||s}),e.jsx(a,{size:"sm",c:"dimmed",children:"Cluster Overview"})]})}),e.jsx(be,{value:100,color:Re((i==null?void 0:i.health)||"red"),size:"sm",radius:"xs","aria-label":`Cluster health: ${(i==null?void 0:i.health)||"unknown"}`}),e.jsxs(ee,{children:[e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>x("nodes"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfNodes)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>x("indices"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.numberOfIndices)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[((ie=i==null?void 0:i.numberOfDocuments)==null?void 0:ie.toLocaleString())||0," documents"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>x("shards"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(a,{size:"xl",fw:700,children:(i==null?void 0:i.activeShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.activePrimaryShards)||0," primary"]})]})})}),e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>x("shards"),children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(a,{size:"xl",fw:700,c:i!=null&&i.unassignedShards?"red":void 0,children:(i==null?void 0:i.unassignedShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(i==null?void 0:i.relocatingShards)||0," relocating"]})]})})})]}),((i==null?void 0:i.memoryTotal)||(i==null?void 0:i.diskTotal))&&e.jsxs(ee,{children:[(i==null?void 0:i.memoryTotal)&&e.jsx(ee.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(be,{value:se(i.memoryUsed||0,i.memoryTotal),color:h(se(i.memoryUsed||0,i.memoryTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(i.memoryUsed||0)," / ",V(i.memoryTotal)," (",se(i.memoryUsed||0,i.memoryTotal),"%)"]})]})})}),(i==null?void 0:i.diskTotal)&&e.jsx(ee.Col,{span:{base:12,md:6},children:e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(be,{value:se(i.diskUsed||0,i.diskTotal),color:h(se(i.diskUsed||0,i.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(i.diskUsed||0)," / ",V(i.diskTotal)," (",se(i.diskUsed||0,i.diskTotal),"%)"]})]})})})]}),e.jsx(X,{shadow:"sm",padding:"lg",children:e.jsxs(G,{value:j,onChange:A,children:[e.jsxs(G.List,{children:[e.jsx(G.Tab,{value:"overview",children:"Overview"}),e.jsxs(G.Tab,{value:"nodes",children:["Nodes (",(q==null?void 0:q.length)||0,")"]}),e.jsxs(G.Tab,{value:"indices",children:["Indices (",(P==null?void 0:P.length)||0,")"]}),e.jsxs(G.Tab,{value:"shards",children:["Shards (",(W==null?void 0:W.length)||0,")"]})]}),e.jsx(G.Panel,{value:"overview",pt:"md",children:e.jsx(Ns,{nodes:q,indices:P,shards:W,loading:d||H||Q,error:b||p||K,openIndexModal:z})}),e.jsx(G.Panel,{value:"nodes",pt:"md",children:e.jsx($s,{nodes:q,loading:d,error:b})}),e.jsx(G.Panel,{value:"indices",pt:"md",children:e.jsx(Ps,{indices:P,loading:H,error:p,openIndexModal:z})}),e.jsx(G.Panel,{value:"shards",pt:"md",children:e.jsx(Ds,{shards:W,loading:Q,error:K})})]})}),D&&e.jsx(Ie,{opened:v,onClose:$,size:"90%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column",padding:0},content:{display:"flex",flexDirection:"column"}},withCloseButton:!0,children:e.jsx("div",{style:{flex:1,overflow:"auto",padding:"var(--mantine-spacing-md)"},children:e.jsx(Ms,{})})})]}):e.jsx(w,{p:"md",children:e.jsx(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function $s({nodes:s,loading:n,error:t}){var A;const{id:c}=ge(),h=Oe(),[j,y]=pe(),{getColor:u}=Ze(c),v=j.get("nodesSearch")||"",M=((A=j.get("roles"))==null?void 0:A.split(",").filter(Boolean))||[],D=$e(v,300),L=(x,i)=>{const S=new URLSearchParams(j);x!==void 0&&(x?S.set("nodesSearch",x):S.delete("nodesSearch")),i!==void 0&&(i.length>0?S.set("roles",i.join(",")):S.delete("roles")),y(S)},z=Array.from(new Set((s==null?void 0:s.flatMap(x=>x.roles))||[])),$=s==null?void 0:s.filter(x=>{var O;const i=x.name.toLowerCase().includes(D.toLowerCase())||((O=x.ip)==null?void 0:O.toLowerCase().includes(D.toLowerCase())),S=M.length===0||M.some(q=>x.roles.includes(q));return i&&S});return n?e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})}):t?e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",t.message]}):!s||s.length===0?e.jsx(a,{c:"dimmed",children:"No nodes found"}):e.jsxs(w,{gap:"md",children:[e.jsxs(f,{children:[e.jsx(Ce,{placeholder:"Search nodes...",leftSection:e.jsx(Me,{size:16}),value:v,onChange:x=>L(x.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(ke,{placeholder:"Filter by roles",data:z,value:M,onChange:x=>L(void 0,x),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),$&&$.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(fe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Roles"}),e.jsx(o.Th,{children:"Heap Usage"}),e.jsx(o.Th,{children:"Disk Usage"}),e.jsx(o.Th,{children:"CPU"})]})}),e.jsx(o.Tbody,{children:$==null?void 0:$.map(x=>e.jsxs(o.Tr,{style:{cursor:"pointer"},onClick:()=>h(`/cluster/${c}/nodes/${x.id}`),children:[e.jsxs(o.Td,{children:[e.jsx(a,{size:"sm",fw:500,children:x.name}),x.ip&&e.jsx(a,{size:"xs",c:"dimmed",children:x.ip})]}),e.jsx(o.Td,{children:e.jsx(f,{gap:"xs",children:x.roles.map(i=>e.jsx(B,{size:"sm",variant:"light",children:i},i))})}),e.jsx(o.Td,{children:e.jsxs(w,{gap:4,children:[e.jsx(be,{value:se(x.heapUsed,x.heapMax),color:u(se(x.heapUsed,x.heapMax)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(x.heapUsed)," / ",V(x.heapMax)]})]})}),e.jsx(o.Td,{children:e.jsxs(w,{gap:4,children:[e.jsx(be,{value:se(x.diskUsed,x.diskTotal),color:u(se(x.diskUsed,x.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[V(x.diskUsed)," / ",V(x.diskTotal)]})]})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:x.cpuPercent!==void 0?`${x.cpuPercent}%`:"N/A"})})]},x.id))})]})})]})}function Ps({indices:s,loading:n,error:t,openIndexModal:c}){var F,_;const{id:h}=ge(),j=Oe(),y=Ee(),[u,v]=pe(),M=u.get("indicesSearch")||"",D=((F=u.get("health"))==null?void 0:F.split(",").filter(Boolean))||[],L=((_=u.get("status"))==null?void 0:_.split(",").filter(Boolean))||[],z=u.get("expanded")==="true",$=u.get("sort")!=="desc",A=u.get("affected")==="true",x=$e(M,300),{data:i}=oe({queryKey:["cluster",h,"shards"],queryFn:()=>R.getShards(h),enabled:!!h}),{data:S}=oe({queryKey:["cluster",h,"settings"],queryFn:async()=>await R.proxyRequest(h,"GET","/_cluster/settings"),enabled:!!h}),O=(()=>{var ve,ce;if(!S)return!0;const l=S.transient,r=S.persistent,g=l==null?void 0:l.cluster,m=r==null?void 0:r.cluster,N=g==null?void 0:g.routing,T=m==null?void 0:m.routing,ae=(ve=N==null?void 0:N.allocation)==null?void 0:ve.enable,ye=(ce=T==null?void 0:T.allocation)==null?void 0:ce.enable;return(ae||ye||"all")==="all"})(),q=Z({mutationFn:()=>R.proxyRequest(h,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{y.invalidateQueries({queryKey:["cluster",h,"settings"]}),k.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:l=>{k.show({title:"Error",message:`Failed to enable shard allocation: ${l.message}`,color:"red"})}}),d=Z({mutationFn:l=>R.proxyRequest(h,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":l}}),onSuccess:()=>{y.invalidateQueries({queryKey:["cluster",h,"settings"]}),k.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:l=>{k.show({title:"Error",message:`Failed to disable shard allocation: ${l.message}`,color:"red"})}}),b=(l,r,g)=>{const m=new URLSearchParams(u);l!==void 0&&(l?m.set("indicesSearch",l):m.delete("indicesSearch")),r!==void 0&&(r.length>0?m.set("health",r.join(",")):m.delete("health")),g!==void 0&&(g.length>0?m.set("status",g.join(",")):m.delete("status")),v(m)},P=(l,r)=>{const g=new URLSearchParams(u);r===""||r===!1?g.delete(l):g.set(l,String(r)),v(g)},H=(i==null?void 0:i.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}))||{},p=(i==null?void 0:i.filter(l=>l.state==="UNASSIGNED"))||[],W=p.reduce((l,r)=>(l[r.index]||(l[r.index]=[]),l[r.index].push(r),l),{}),Q=l=>(H[l]||[]).some(g=>g.state==="UNASSIGNED"||g.state==="RELOCATING"||g.state==="INITIALIZING");let K=s==null?void 0:s.filter(l=>{const r=l.name.toLowerCase().includes(x.toLowerCase()),g=D.length===0||D.includes(l.health),m=L.length===0||L.includes(l.status),N=!A||Q(l.name);return r&&g&&m&&N});if(K&&(K=[...K].sort((l,r)=>$?l.name.localeCompare(r.name):r.name.localeCompare(l.name))),n)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(t)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",t.message]});if(!s||s.length===0)return e.jsxs(w,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No indices found"}),h&&e.jsx(te,{leftSection:e.jsx(Ue,{size:16}),onClick:()=>j(`/cluster/${h}/indices/create`),children:"Create Index"})]});const ie=p.length>0;return e.jsxs(w,{gap:"md",children:[e.jsxs(f,{justify:"space-between",wrap:"wrap",children:[e.jsxs(f,{children:[O?e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:d.isPending,children:e.jsx(Xe,{size:20})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Disable Allocation"}),e.jsx(C.Item,{onClick:()=>d.mutate("none"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(C.Item,{onClick:()=>d.mutate("primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(C.Item,{onClick:()=>d.mutate("new_primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>q.mutate(),loading:q.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:z?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>P("expanded",!z),children:z?e.jsx(Ye,{size:20}):e.jsx(es,{size:20})})}),e.jsx(re,{label:$?"Sort descending":"Sort ascending",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>P("sort",$?"desc":"asc"),children:$?e.jsx(ys,{size:20}):e.jsx(vs,{size:20})})})]}),e.jsxs(f,{style:{flex:1},children:[e.jsx(Ce,{placeholder:"Search indices...",leftSection:e.jsx(Me,{size:16}),value:M,onChange:l=>b(l.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ke,{placeholder:"Health",data:["green","yellow","red"],value:D,onChange:l=>b(void 0,l,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(ke,{placeholder:"Status",data:["open","close"],value:L,onChange:l=>b(void 0,void 0,l),clearable:!0,style:{maxWidth:150}}),ie&&e.jsx(me,{label:"Show only affected",checked:A,onChange:l=>P("affected",l.currentTarget.checked),size:"sm"})]}),h&&e.jsx(te,{leftSection:e.jsx(Ue,{size:16}),onClick:()=>j(`/cluster/${h}/indices/create`),children:"Create Index"})]}),K&&K.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(fe,{children:e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Name"}),e.jsx(o.Th,{children:"Health"}),e.jsx(o.Th,{children:"Status"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"}),e.jsx(o.Th,{children:"Shards"}),z&&e.jsx(o.Th,{children:"Primaries"}),z&&e.jsx(o.Th,{children:"Replicas"}),e.jsx(o.Th,{children:"Unassigned"}),e.jsx(o.Th,{children:"Actions"})]})}),e.jsx(o.Tbody,{children:K==null?void 0:K.map(l=>{var m;const r=((m=W[l.name])==null?void 0:m.length)||0,g=r>0;return e.jsxs(o.Tr,{style:{cursor:"pointer",backgroundColor:g?"rgba(250, 82, 82, 0.1)":void 0},onClick:()=>c(l.name),children:[e.jsx(o.Td,{children:e.jsxs(w,{gap:2,children:[e.jsx(a,{size:"sm",fw:500,style:{textDecoration:"underline"},children:l.name}),z&&Q(l.name)&&e.jsx(B,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",color:Re(l.health),children:l.health})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",variant:"light",color:l.status==="open"?"green":"gray",children:l.status})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.docsCount.toLocaleString()})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:V(l.storeSize)})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:z?`${l.primaryShards+l.replicaShards}`:`${l.primaryShards}p / ${l.replicaShards}r`})}),z&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.primaryShards})}),z&&e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:l.replicaShards})}),e.jsx(o.Td,{children:r>0?e.jsx(B,{size:"sm",color:"red",variant:"filled",children:r}):e.jsx(a,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(o.Td,{onClick:N=>N.stopPropagation(),children:e.jsxs(f,{gap:"xs",children:[h&&e.jsx(Es,{clusterId:h,index:l}),e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(le,{variant:"subtle",color:"gray",children:e.jsx(ts,{size:16})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Index Management"}),e.jsx(C.Item,{leftSection:e.jsx(Qe,{size:14}),onClick:N=>{N.stopPropagation(),c(l.name,"settings")},children:"Settings"}),e.jsx(C.Item,{leftSection:e.jsx(Je,{size:14}),onClick:N=>{N.stopPropagation(),c(l.name,"mappings")},children:"Mappings"})]})]})]})})]},l.name)})})]})})]})}function is({shard:s,opened:n,onClose:t,clusterId:c}){const[h,j]=E.useState(null),[y,u]=E.useState(!1);return E.useEffect(()=>{n&&s?(u(!0),j(null),console.log("Fetching shard stats:",{clusterId:c,index:s.index,shard:s.shard}),R.getShardStats(c,s.index,s.shard).then(v=>{console.log("Received shard stats:",v),j(v)}).catch(v=>{console.error("Failed to fetch shard stats:",v),j(s)}).finally(()=>{u(!1)})):n||(j(null),u(!1))},[n,s==null?void 0:s.index,s==null?void 0:s.shard,c]),s?e.jsx(Ie,{opened:n,onClose:t,title:e.jsxs(f,{gap:"xs",children:[e.jsx(a,{size:"lg",fw:600,children:"Shard Details:"}),e.jsx(B,{size:"lg",variant:"light",color:"blue",children:s.index}),e.jsx(a,{size:"lg",c:"dimmed",children:"/"}),e.jsxs(B,{size:"lg",variant:"filled",color:"cyan",children:["#",s.shard]}),e.jsx(B,{size:"lg",variant:s.primary?"filled":"light",color:s.primary?"green":"gray",children:s.primary?"Primary":"Replica"})]}),size:"80%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"}},children:e.jsx(fe,{style:{flex:1},children:y?e.jsxs(w,{gap:"xs",children:[e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"70%",radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"50%",radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,radius:"xs"}),e.jsx(J,{height:20,width:"80%",radius:"xs"})]}):e.jsx(Ve,{block:!0,children:JSON.stringify(h||s,null,2)})})}):null}function Ns({nodes:s,indices:n,shards:t,loading:c,error:h,openIndexModal:j}){const{id:y}=ge(),u=Ee(),[v,M]=pe(),[D,L]=E.useState(null),[z,$]=E.useState(!1),A=v.get("overviewSearch")||"",x=v.get("showClosed")==="true",i=v.get("showSpecial")==="true",S=v.get("overviewExpanded")==="true",O=v.get("overviewAffected")==="true",q=$e(A,300),d=r=>{L(r),$(!0)},b=(r,g)=>{const m=new URLSearchParams(v);g===""||g===!1?m.delete(r):m.set(r,String(g)),M(m)},{data:P}=oe({queryKey:["cluster",y,"settings"],queryFn:async()=>await R.proxyRequest(y,"GET","/_cluster/settings"),enabled:!!y}),H=(()=>{var ce,Se;if(!P)return!0;const r=P.transient,g=P.persistent,m=r==null?void 0:r.cluster,N=g==null?void 0:g.cluster,T=m==null?void 0:m.routing,ae=N==null?void 0:N.routing,ye=(ce=T==null?void 0:T.allocation)==null?void 0:ce.enable,we=(Se=ae==null?void 0:ae.allocation)==null?void 0:Se.enable;return(ye||we||"all")==="all"})(),p=Z({mutationFn:()=>R.proxyRequest(y,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",y,"settings"]}),k.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:r=>{k.show({title:"Error",message:`Failed to enable shard allocation: ${r.message}`,color:"red"})}}),W=Z({mutationFn:r=>R.proxyRequest(y,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":r}}),onSuccess:()=>{u.invalidateQueries({queryKey:["cluster",y,"settings"]}),k.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:r=>{k.show({title:"Error",message:`Failed to disable shard allocation: ${r.message}`,color:"red"})}});if(c)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(h)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",h.message]});if(!s||!n||!t||s.length===0||n.length===0)return e.jsx(w,{gap:"md",align:"center",py:"xl",children:e.jsx(a,{c:"dimmed",children:"No shard allocation data available"})});const Q=t.filter(r=>r.state==="UNASSIGNED"),K=Q.reduce((r,g)=>(r[g.index]||(r[g.index]=[]),r[g.index].push(g),r),{}),ie=r=>t.filter(m=>m.index===r).some(m=>m.state==="UNASSIGNED"||m.state==="RELOCATING"||m.state==="INITIALIZING");let F=n.filter(r=>{const g=r.name.toLowerCase().includes(q.toLowerCase()),m=x||r.status==="open",N=i||!r.name.startsWith("."),T=!O||ie(r.name);return g&&m&&N&&T});const _=new Map;s.forEach(r=>{_.set(r.id,r.name),_.set(r.name,r.name),r.ip&&_.set(r.ip,r.name)});const l=new Map;return t.forEach(r=>{if(!r.node)return;const g=_.get(r.node);if(!g)return;l.has(g)||l.set(g,new Map);const m=l.get(g);m.has(r.index)||m.set(r.index,[]),m.get(r.index).push(r)}),e.jsxs(w,{gap:"md",children:[e.jsx(is,{shard:D,opened:z,onClose:()=>$(!1),clusterId:y}),e.jsxs(f,{justify:"space-between",wrap:"wrap",children:[e.jsxs(f,{children:[H?e.jsxs(C,{shadow:"md",width:200,children:[e.jsx(C.Target,{children:e.jsx(re,{label:"Disable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"green",loading:W.isPending,children:e.jsx(Xe,{size:20})})})}),e.jsxs(C.Dropdown,{children:[e.jsx(C.Label,{children:"Disable Allocation"}),e.jsx(C.Item,{onClick:()=>W.mutate("none"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(C.Item,{onClick:()=>W.mutate("primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(C.Item,{onClick:()=>W.mutate("new_primaries"),children:e.jsxs(f,{gap:"xs",children:[e.jsx(de,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(re,{label:"Enable shard allocation",children:e.jsx(le,{size:"lg",variant:"subtle",color:"red",onClick:()=>p.mutate(),loading:p.isPending,children:e.jsx(de,{size:20})})}),e.jsx(re,{label:S?"Compress view":"Expand view",children:e.jsx(le,{size:"lg",variant:"subtle",onClick:()=>b("overviewExpanded",!S),children:S?e.jsx(Ye,{size:20}):e.jsx(es,{size:20})})})]}),e.jsxs(f,{style:{flex:1},children:[e.jsx(Ce,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(Me,{size:16}),value:A,onChange:r=>b("overviewSearch",r.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(f,{gap:"md",children:[e.jsx(me,{label:`closed (${n.filter(r=>r.status!=="open").length})`,checked:x,onChange:r=>b("showClosed",r.currentTarget.checked),size:"sm"}),e.jsx(me,{label:`special (${n.filter(r=>r.name.startsWith(".")).length})`,checked:i,onChange:r=>b("showSpecial",r.currentTarget.checked),size:"sm"}),Q.length>0&&e.jsx(me,{label:"Show only affected",checked:O,onChange:r=>b("overviewAffected",r.currentTarget.checked),size:"sm"}),e.jsxs(a,{size:"sm",c:"dimmed",children:[F.length," of ",n.length]})]})]})]}),e.jsxs(f,{gap:"md",children:[e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:s.length})," nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:F.length})," indices"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:t.length})," shards"]}),Q.length>0&&e.jsxs(B,{color:"red",variant:"filled",children:[Q.length," unassigned"]})]}),e.jsx(fe,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(o,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),F.map(r=>e.jsx(o.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(w,{gap:4,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:g=>{g.stopPropagation(),j(r.name)},children:r.name}),e.jsxs(f,{gap:4,justify:"center",children:[e.jsxs(B,{size:"xs",color:Re(r.health),variant:"dot",children:[r.primaryShards,"Ã—",r.replicaShards+1]}),e.jsx(a,{size:"xs",c:"dimmed",children:V(r.storeSize)})]})]})},r.name))]})}),e.jsxs(o.Tbody,{children:[Q.length>0&&e.jsxs(o.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(w,{gap:2,children:[e.jsx(a,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(B,{size:"xs",color:"red",variant:"filled",children:Q.length})]})}),F.map(r=>{const g=K[r.name]||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:We(r.health)},children:g.length>0?e.jsx(f,{gap:2,justify:"center",wrap:"wrap",children:g.map((m,N)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",m.shard]}),e.jsxs("div",{children:["Type: ",m.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",m.state]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:m.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)",cursor:"pointer"},onClick:()=>d(m),children:m.shard})},`unassigned-${m.index}-${m.shard}-${N}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${r.name}`)})]}),s.map(r=>{const g=l.get(r.name);return e.jsxs(o.Tr,{children:[e.jsx(o.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(w,{gap:4,children:[e.jsx(f,{gap:4,children:e.jsx(a,{size:"xs",fw:500,truncate:"end",title:r.name,children:r.name})}),e.jsx(a,{size:"xs",c:"dimmed",truncate:"end",title:r.ip,children:r.ip}),S&&e.jsxs(e.Fragment,{children:[e.jsx(f,{gap:4,wrap:"wrap",children:r.roles.map(m=>e.jsx(B,{size:"xs",variant:"light",color:"gray",children:m},m))}),e.jsxs(f,{gap:4,wrap:"wrap",children:[e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:r.id.substring(0,8)}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:r.roles.length}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:V(r.heapMax)}),e.jsx(B,{size:"xs",color:"teal",variant:"filled",children:V(r.diskTotal)}),r.cpuPercent!==void 0&&e.jsxs(B,{size:"xs",color:"teal",variant:"filled",children:[r.cpuPercent,"%"]})]})]})]})}),F.map(m=>{const N=(g==null?void 0:g.get(m.name))||[];return e.jsx(o.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:We(m.health)},children:N.length>0?e.jsx(f,{gap:2,justify:"center",wrap:"wrap",children:N.map((T,ae)=>e.jsx(re,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",T.shard]}),e.jsxs("div",{children:["Type: ",T.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",T.state]}),e.jsxs("div",{children:["Node: ",T.node||"N/A"]}),T.docs!==void 0&&T.docs!==null&&e.jsxs("div",{children:["Docs: ",T.docs.toLocaleString()]}),T.store!==void 0&&T.store!==null&&e.jsxs("div",{children:["Size: ",V(T.store)]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:T.state==="STARTED"?T.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":T.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:T.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)",cursor:"pointer"},onClick:()=>d(T),children:T.shard})},`${T.shard}-${T.primary}-${ae}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`${r.id}-${m.name}`)})]},r.id)})]})]})})})]})}function Ds({shards:s,loading:n,error:t}){var q;const{id:c}=ge(),[h,j]=pe(),[y,u]=E.useState(!1),[v,M]=E.useState(null),D=h.get("shardsSearch")||"",L=((q=h.get("shardStates"))==null?void 0:q.split(",").filter(Boolean))||[],z=h.get("primaryOnly")==="true",$=h.get("replicaOnly")==="true",A=$e(D,300),x=d=>{M(d),u(!0)},i=(d,b,P,H)=>{const p=new URLSearchParams(h);d!==void 0&&(d?p.set("shardsSearch",d):p.delete("shardsSearch")),b!==void 0&&(b.length>0?p.set("shardStates",b.join(",")):p.delete("shardStates")),P!==void 0&&(P?(p.set("primaryOnly","true"),p.delete("replicaOnly")):p.delete("primaryOnly")),H!==void 0&&(H?(p.set("replicaOnly","true"),p.delete("primaryOnly")):p.delete("replicaOnly")),j(p)},S=s==null?void 0:s.filter(d=>{var p;const b=d.index.toLowerCase().includes(A.toLowerCase())||((p=d.node)==null?void 0:p.toLowerCase().includes(A.toLowerCase())),P=L.length===0||L.includes(d.state),H=!z&&!$||z&&d.primary||$&&!d.primary;return b&&P&&H});if(n)return e.jsx(f,{justify:"center",py:"xl",children:e.jsx(je,{})});if(t)return e.jsxs(Y,{icon:e.jsx(ne,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",t.message]});if(!s||s.length===0)return e.jsx(a,{c:"dimmed",children:"No shards found"});const O=(S||[]).reduce((d,b)=>(d[b.state]||(d[b.state]=[]),d[b.state].push(b),d),{});return e.jsxs(w,{gap:"md",children:[e.jsxs(f,{wrap:"wrap",children:[e.jsx(Ce,{placeholder:"Search by index or node...",leftSection:e.jsx(Me,{size:16}),value:D,onChange:d=>i(d.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ke,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:L,onChange:d=>i(void 0,d,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(f,{gap:"md",children:[e.jsx(me,{label:"Primary only",checked:z,onChange:d=>i(void 0,void 0,d.currentTarget.checked,void 0),size:"sm"}),e.jsx(me,{label:"Replica only",checked:$,onChange:d=>i(void 0,void 0,void 0,d.currentTarget.checked),size:"sm"})]})]}),e.jsx(ee,{children:Object.entries(O).map(([d,b])=>e.jsx(ee.Col,{span:{base:12,sm:6,md:3},children:e.jsx(X,{shadow:"sm",padding:"md",children:e.jsxs(w,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:d}),e.jsx(a,{size:"xl",fw:700,children:b.length})]})})},d))}),S&&S.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(fe,{children:[e.jsxs(o,{striped:!0,highlightOnHover:!0,children:[e.jsx(o.Thead,{children:e.jsxs(o.Tr,{children:[e.jsx(o.Th,{children:"Index"}),e.jsx(o.Th,{children:"Shard"}),e.jsx(o.Th,{children:"Type"}),e.jsx(o.Th,{children:"State"}),e.jsx(o.Th,{children:"Node"}),e.jsx(o.Th,{children:"Documents"}),e.jsx(o.Th,{children:"Size"})]})}),e.jsx(o.Tbody,{children:S==null?void 0:S.slice(0,100).map((d,b)=>{const P=d.state==="UNASSIGNED";return e.jsxs(o.Tr,{style:{backgroundColor:P?"rgba(250, 82, 82, 0.1)":void 0,cursor:"pointer"},onClick:()=>x(d),children:[e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.index})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.shard})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",variant:"light",color:d.primary?"blue":"gray",children:d.primary?"Primary":"Replica"})}),e.jsx(o.Td,{children:e.jsx(B,{size:"sm",color:d.state==="STARTED"?"green":d.state==="UNASSIGNED"?"red":"yellow",children:d.state})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.node||"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.docs!==void 0&&d.docs!==null?d.docs.toLocaleString():"N/A"})}),e.jsx(o.Td,{children:e.jsx(a,{size:"sm",children:d.store!==void 0&&d.store!==null?V(d.store):"N/A"})})]},`${d.index}-${d.shard}-${b}`)})})]}),S&&S.length>100&&e.jsxs(a,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",S.length," shards"]})]}),v&&e.jsx(is,{opened:y,onClose:()=>{u(!1),M(null)},shard:v,clusterId:c})]})}export{nr as ClusterView};
