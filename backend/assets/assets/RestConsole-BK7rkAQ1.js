import{r as o,B as G,D as J,j as e,E as _,c as B,q as $,f as W,n as j,T as Y,S as q,P as R,G as x,d as g,F as O,A as K,I as X,k as T,l as P,v as Q}from"./index-D-fyacXJ.js";import{C as V}from"./Container-DbmD-s40.js";import{G as z}from"./Grid-BLqJKU0R.js";import{B as Z}from"./Button-DMgc-dAd.js";import{B as M}from"./Badge-BWrmtSp2.js";import{I as ee}from"./IconTrash-B1pDCyZn.js";import{I as se}from"./IconClock-Dpze2eUg.js";const te={multiple:!1},D=o.forwardRef((l,r)=>{const{onChange:a,children:d,multiple:h,accept:n,name:t,form:u,resetRef:v,disabled:H,capture:w,inputProps:S,...m}=G("FileButton",te,l),f=o.useRef(null),I=()=>{var y;!H&&((y=f.current)==null||y.click())},k=y=>{a(h?Array.from(y.currentTarget.files):y.currentTarget.files[0]||null)};return J(v,()=>{f.current&&(f.current.value="")}),e.jsxs(e.Fragment,{children:[e.jsx("input",{style:{display:"none"},type:"file",accept:n,multiple:h,onChange:k,ref:_(r,f),name:t,form:u,capture:w,...S}),d({onClick:I,...m})]})});D.displayName="@mantine/core/FileButton";var re=B("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]),oe=B("player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]),ne=B("upload","IconUpload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);const b={theme:"system",refreshInterval:3e4,lastSelectedCluster:void 0,restConsoleHistory:[]},N="cerebro-preferences";function le(){const l=o.useCallback(()=>{try{const n=localStorage.getItem(N);if(!n)return{...b};const t=JSON.parse(n);return{theme:t.theme==="light"||t.theme==="dark"||t.theme==="system"?t.theme:b.theme,refreshInterval:typeof t.refreshInterval=="number"&&t.refreshInterval>0?t.refreshInterval:b.refreshInterval,lastSelectedCluster:typeof t.lastSelectedCluster=="string"?t.lastSelectedCluster:void 0,restConsoleHistory:Array.isArray(t.restConsoleHistory)?t.restConsoleHistory:b.restConsoleHistory}}catch(n){return console.error("Failed to load preferences from localStorage:",n),console.warn("Using default preferences due to corrupted data"),{...b}}},[]),[r,a]=o.useState(l);o.useEffect(()=>{try{localStorage.setItem(N,JSON.stringify(r))}catch(n){console.error("Failed to save preferences to localStorage:",n)}},[r]);const d=o.useCallback((n,t)=>{a(u=>({...u,[n]:t}))},[]),h=o.useCallback(()=>{a({...b})},[]);return{preferences:r,updatePreference:d,resetPreferences:h}}function ae(l){const r=l.trim().split(`
`);if(r.length===0)return null;const d=r[0].trim().split(/\s+/);if(d.length<2)return null;const h=d[0].toUpperCase(),n=d[1];if(!["GET","POST","PUT","DELETE","HEAD","PATCH"].includes(h))return null;const u=r.slice(1).join(`
`).trim();return{method:h,path:n,body:u||void 0}}function ie(l){try{return JSON.stringify(l,null,2)}catch{return String(l)}}function ye(){const{id:l}=$(),{preferences:r,updatePreference:a}=le(),[d,h]=o.useState("GET _cluster/health"),[n,t]=o.useState(""),[u,v]=o.useState(null),[H,w]=o.useState(!1),[S,m]=o.useState(null),f=100,I=o.useCallback(async()=>{if(!l)return;const s=ae(d);if(!s){m("Invalid request format. Use: METHOD endpoint");return}w(!0),m(null),t(""),v(null);try{let i;if(s.body)try{i=JSON.parse(s.body)}catch{m("Invalid JSON in request body"),w(!1);return}const p=await W.proxyRequest(l,s.method,s.path,i),c=ie(p);t(c),v(200);const F=[{timestamp:Date.now(),method:s.method,path:s.path,body:s.body,response:c},...r.restConsoleHistory].slice(0,f);a("restConsoleHistory",F),j.show({title:"Success",message:"Request executed successfully",color:"green"})}catch(i){const p=i,c=p.message||"Request failed";m(c),v(p.status||0),t(c),j.show({title:"Error",message:c,color:"red"})}finally{w(!1)}},[l,d,r.restConsoleHistory,a]),k=o.useCallback(s=>{const i=s.body?`${s.method} ${s.path}
${s.body}`:`${s.method} ${s.path}`;h(i),s.response&&t(s.response)},[]),A=o.useCallback(()=>{a("restConsoleHistory",[]),j.show({title:"History Cleared",message:"Request history has been cleared",color:"blue"})},[a]),y=o.useCallback(()=>{const s=JSON.stringify(r.restConsoleHistory,null,2),i=new Blob([s],{type:"application/json"}),p=URL.createObjectURL(i),c=document.createElement("a");c.href=p,c.download=`cerebro-rest-history-${Date.now()}.json`,c.click(),URL.revokeObjectURL(p),j.show({title:"Exported",message:"Request history exported successfully",color:"green"})},[r.restConsoleHistory]),U=o.useCallback(s=>{if(!s)return;const i=new FileReader;i.onload=p=>{var c;try{const E=(c=p.target)==null?void 0:c.result,C=JSON.parse(E);if(!Array.isArray(C))throw new Error("Invalid format: expected array");const L=[...C,...r.restConsoleHistory].slice(0,f);a("restConsoleHistory",L),j.show({title:"Imported",message:`Imported ${C.length} requests`,color:"green"})}catch(E){const C=E;j.show({title:"Import Failed",message:C.message||"Failed to import history",color:"red"})}},i.readAsText(s)},[r.restConsoleHistory,a]);return e.jsxs(V,{size:"xl",py:"md",children:[e.jsxs(Y,{order:2,mb:"md",children:["REST Console - Cluster: ",l]}),e.jsxs(z,{gutter:"md",children:[e.jsx(z.Col,{span:{base:12,md:8},children:e.jsxs(q,{gap:"md",children:[e.jsxs(R,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"xs",children:[e.jsx(g,{fw:500,children:"Request"}),e.jsx(Z,{leftSection:e.jsx(oe,{size:16}),onClick:I,loading:H,size:"sm",children:"Execute"})]}),e.jsx(g,{size:"xs",c:"dimmed",mb:"xs",children:"Format: METHOD endpoint (e.g., GET _cluster/health)"}),e.jsx(O,{height:"200px",defaultLanguage:"plaintext",value:d,onChange:s=>h(s||""),theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:"on"}})]}),S&&e.jsx(K,{icon:e.jsx(X,{size:16}),title:"Error",color:"red",withCloseButton:!0,onClose:()=>m(null),children:S}),e.jsxs(R,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsx(x,{justify:"space-between",mb:"xs",children:e.jsxs(x,{gap:"xs",children:[e.jsx(g,{fw:500,children:"Response"}),u!==null&&e.jsx(M,{color:u>=200&&u<300?"green":"red",variant:"light",children:u})]})}),e.jsx(O,{height:"400px",defaultLanguage:"json",value:n,theme:"vs-dark",options:{readOnly:!0,minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,wordWrap:"on"}})]})]})}),e.jsx(z.Col,{span:{base:12,md:4},children:e.jsxs(R,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsx(g,{fw:500,children:"History"}),e.jsxs(x,{gap:"xs",children:[e.jsx(D,{onChange:U,accept:"application/json",children:s=>e.jsx(T,{label:"Import",children:e.jsx(P,{...s,variant:"subtle",size:"sm",children:e.jsx(ne,{size:16})})})}),e.jsx(T,{label:"Export",children:e.jsx(P,{onClick:y,variant:"subtle",size:"sm",disabled:r.restConsoleHistory.length===0,children:e.jsx(re,{size:16})})}),e.jsx(T,{label:"Clear History",children:e.jsx(P,{onClick:A,variant:"subtle",size:"sm",color:"red",disabled:r.restConsoleHistory.length===0,children:e.jsx(ee,{size:16})})})]})]}),e.jsx(Q,{h:600,children:e.jsx(q,{gap:"xs",children:r.restConsoleHistory.length===0?e.jsx(g,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No history yet"}):r.restConsoleHistory.map((s,i)=>e.jsxs(R,{p:"xs",withBorder:!0,style:{cursor:"pointer"},onClick:()=>k(s),children:[e.jsxs(x,{justify:"space-between",gap:"xs",children:[e.jsx(M,{size:"sm",variant:"light",children:s.method}),e.jsxs(x,{gap:4,children:[e.jsx(se,{size:12}),e.jsx(g,{size:"xs",c:"dimmed",children:new Date(s.timestamp).toLocaleTimeString()})]})]}),e.jsx(g,{size:"sm",mt:4,lineClamp:1,children:s.path})]},i))})})]})})]})]})}export{ye as RestConsole};
