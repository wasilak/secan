import{a2 as be,a as J,a3 as H,j as e,a4 as Q,r as c,a5 as Ce,s as Ee,a6 as _e,f as ke,b as ze,B as Me,c as Ie,a7 as De,d as G,e as ie,z as Le,h as Ne,q as Te,a1 as Pe,D as $e,o as k,k as ee,A as z,I as $,G as M,S as b,l as Re,m as l,J as qe,K as Oe,R as se,L as He,F as Je,N as Ae,t as Be}from"./index-BWtpBJiN.js";import{u as Fe}from"./useMutation-ZfgUOSQB.js";import{C as R}from"./Container-rg9Qyubq.js";import{C as q}from"./Card-CcgJzK8Q.js";import{B as O}from"./Button-CwQH4MVC.js";import{T as x}from"./Tabs-Cy4XtI3A.js";import{I as Ke}from"./IconCheck-BAJYZCpp.js";import"./get-safe-id-Bp3H8K0-.js";import"./get-auto-contrast-value-Da6zqqWm.js";const[Ge,oe]=be("HoverCard component was not found in the tree"),Ue={};function de(t){const{children:r,onMouseEnter:s,onMouseLeave:n,...i}=J("HoverCardDropdown",Ue,t),o=oe(),u=H(s,o.openDropdown),p=H(n,o.closeDropdown);return e.jsx(Q.Dropdown,{onMouseEnter:u,onMouseLeave:p,...i,children:r})}de.displayName="@mantine/core/HoverCardDropdown";const Qe={refProp:"ref"},le=c.forwardRef((t,r)=>{const{children:s,refProp:n,eventPropsWrapperName:i,...o}=J("HoverCardTarget",Qe,t);if(!Ce(s))throw new Error("HoverCard.Target component children should be an element or a component that accepts ref. Fragments, strings, numbers and other primitive values are not supported");const u=oe(),p=H(s.props.onMouseEnter,u.openDropdown),h=H(s.props.onMouseLeave,u.closeDropdown),m={onMouseEnter:p,onMouseLeave:h};return e.jsx(Q.Target,{refProp:n,ref:r,...o,children:c.cloneElement(s,i?{[i]:m}:m)})});le.displayName="@mantine/core/HoverCardTarget";const Ve={openDelay:0,closeDelay:150,initiallyOpened:!1};function j(t){const{children:r,onOpen:s,onClose:n,openDelay:i,closeDelay:o,initiallyOpened:u,...p}=J("HoverCard",Ve,t),[h,{open:m,close:f}]=Ee(u,{onClose:n,onOpen:s}),{openDropdown:v,closeDropdown:S}=_e({open:m,close:f,openDelay:i,closeDelay:o});return e.jsx(Ge,{value:{openDropdown:v,closeDropdown:S},children:e.jsx(Q,{...p,opened:h,__staticSelector:"HoverCard",children:r})})}j.displayName="@mantine/core/HoverCard";j.Target=le;j.Dropdown=de;j.extend=t=>t;var ce={root:"m_18320242","skeleton-fade":"m_299c329c"};const We={visible:!0,animate:!0},Ye=Ie((t,{width:r,height:s,radius:n,circle:i})=>({root:{"--skeleton-height":G(s),"--skeleton-width":i?G(s):G(r),"--skeleton-radius":i?"1000px":n===void 0?void 0:De(n)}})),y=ke((t,r)=>{const s=J("Skeleton",We,t),{classNames:n,className:i,style:o,styles:u,unstyled:p,vars:h,width:m,height:f,circle:v,visible:S,radius:C,animate:I,mod:w,...D}=s,g=ze({name:"Skeleton",classes:ce,props:s,className:i,style:o,classNames:n,styles:u,unstyled:p,vars:h,varsResolver:Ye});return e.jsx(Me,{ref:r,...g("root"),mod:[{visible:S,animate:I},w],...D})});y.classes=ce;y.displayName="@mantine/core/Skeleton";var Xe=ie("chart-bar","IconChartBar",[["path",{d:"M3 12m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v6a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M9 8m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-1"}],["path",{d:"M15 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-2"}],["path",{d:"M4 20l14 0",key:"svg-3"}]]),te=ie("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);function re(t){var r;if(console.error("Error occurred:",t),t&&typeof t=="object"&&"name"in t&&t.name==="ApiClientError"&&"message"in t&&"statusCode"in t){const s=t;if(s.error){const n=ne(s.error);if(n)return{error:"elasticsearch_error",message:n,statusCode:s.statusCode,details:s.error}}return{error:"api_error",message:s.message,statusCode:s.statusCode,details:s.error}}if(t&&typeof t=="object"&&"response"in t){const s=t.response;if(s!=null&&s.data){const n=ne(s.data);return{error:s.data.error||"api_error",message:n||s.data.message||"An error occurred",details:s.data.details,statusCode:s.status,requestId:(r=s.headers)==null?void 0:r["x-request-id"]}}return{error:"http_error",message:`HTTP ${(s==null?void 0:s.status)||"Unknown"}: ${(s==null?void 0:s.statusText)||"Request failed"}`,statusCode:s==null?void 0:s.status}}if(t&&typeof t=="object"&&"message"in t){const s=t;return s.message.includes("Network")||s.message.includes("fetch")?{error:"network_error",message:"Network error. Please check your connection.",details:s.message}:{error:"error",message:s.message,details:s.stack}}return typeof t=="string"?{error:"error",message:t}:{error:"unknown_error",message:"An unexpected error occurred",details:t}}function ne(t){const r=t;if(r.error&&typeof r.error=="object"){const s=r.error;if(s.reason&&typeof s.reason=="string"){let n=`Elasticsearch: ${s.reason}`;if(s.type&&typeof s.type=="string"&&(n=`Elasticsearch (${s.type}): ${s.reason}`),s.root_cause&&Array.isArray(s.root_cause)&&s.root_cause.length>0){const i=s.root_cause[0];i.reason&&i.reason!==s.reason&&(n+=`
Root cause: ${i.reason}`)}return n}}if("details"in r&&r.details&&typeof r.details=="object"){const s=r.details;if(s.error&&typeof s.error=="object"){const n=s.error;if(n.reason&&typeof n.reason=="string"){let i=`Elasticsearch: ${n.reason}`;if(n.type&&typeof n.type=="string"&&(i=`Elasticsearch (${n.type}): ${n.reason}`),n.root_cause&&Array.isArray(n.root_cause)&&n.root_cause.length>0){const o=n.root_cause[0];o.reason&&o.reason!==n.reason&&(i+=`
Root cause: ${o.reason}`)}return i}}}return null}function ae(t,r){if(!t.trim())return`${r} cannot be empty`;try{return JSON.parse(t),null}catch(s){return s.message}}function U(t){const r=["creation_date","provided_name","uuid","version"],s=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path","analysis","similarity","mapping"],n=[...r,...s],i={};for(const[o,u]of Object.entries(t))if(o==="index"){const p=u,h={};for(const[m,f]of Object.entries(p))n.includes(m)||(h[m]=f);Object.keys(h).length>0&&(i[o]=h)}else n.includes(o)||(i[o]=u);return i}function ds(){const{id:t,indexName:r}=Le(),s=Ne(),n=Te(),{resolvedTheme:i}=Pe(),[o,u]=$e(),p=o.get("tab")||"settings",[h,m]=c.useState(""),[f,v]=c.useState(""),[S,C]=c.useState(null),[I,w]=c.useState(null),[D,g]=c.useState(null),[A,L]=c.useState(!1),[B,N]=c.useState(!1),[T,ue]=c.useState(null),[F,V]=c.useState(!1),[W,Y]=c.useState(null);c.useEffect(()=>{p==="stats"&&!T&&!F&&(V(!0),Y(null),k.proxyRequest(t,"GET",`/${r}/_stats`).then(a=>{ue(a)}).catch(a=>{Y(a instanceof Error?a.message:"Failed to fetch stats")}).finally(()=>{V(!1)}))},[p,t,r,T,F]);const{data:E,isLoading:pe,error:he}=ee({queryKey:["cluster",t,"index",r,"settings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await k.proxyRequest(t,"GET",`/${r}/_settings`))[r];return d==null?void 0:d.settings},enabled:!!t&&!!r}),{data:_,isLoading:me,error:ge}=ee({queryKey:["cluster",t,"index",r,"mappings"],queryFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const d=(await k.proxyRequest(t,"GET",`/${r}/_mapping`))[r];return d==null?void 0:d.mappings},enabled:!!t&&!!r});c.useEffect(()=>{if(E){const a=U(E);m(JSON.stringify(a,null,2)),L(!1)}},[E]),c.useEffect(()=>{_&&(v(JSON.stringify(_,null,2)),N(!1))},[_]);const P=Fe({mutationFn:async()=>{if(!t||!r)throw new Error("Cluster ID and index name are required");const a=[];if(A){const d=ae(h,"Settings");if(d)throw C(d),new Error(`Invalid settings JSON: ${d}`);const K=JSON.parse(h),we=U(K);a.push(k.proxyRequest(t,"PUT",`/${r}/_settings`,we))}if(B){const d=ae(f,"Mappings");if(d)throw w(d),new Error(`Invalid mappings JSON: ${d}`);const K=JSON.parse(f);a.push(k.proxyRequest(t,"PUT",`/${r}/_mapping`,K))}await Promise.all(a)},onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",t,"index",r]}),n.invalidateQueries({queryKey:["cluster",t,"indices"]});const a=[];A&&a.push("settings"),B&&a.push("mappings"),Be.show({title:"Success",message:`Index ${a.join(" and ")} updated successfully`,color:"green",icon:e.jsx(Ke,{size:16})}),L(!1),N(!1),g(null)},onError:a=>{const d=re(a);g(d.message)}}),fe=a=>{m(a||""),C(null),g(null),L(!0)},xe=a=>{v(a||""),w(null),g(null),N(!0)},ye=()=>{C(null),w(null),g(null),P.mutate()},je=()=>{if(E){const a=U(E);m(JSON.stringify(a,null,2)),L(!1)}_&&(v(JSON.stringify(_,null,2)),N(!1)),C(null),w(null),g(null)},ve=a=>{a&&u({tab:a})},Se=pe||me,X=he||ge,Z=A||B;if(!t||!r)return e.jsx(R,{size:"xl",children:e.jsx(z,{icon:e.jsx($,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(Se)return e.jsxs(R,{size:"xl",py:"md",children:[e.jsxs(M,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(y,{height:32,width:200,mb:"xs"}),e.jsx(y,{height:20,width:150})]}),e.jsx(y,{height:36,width:120})]}),e.jsxs(b,{gap:"md",children:[e.jsx(y,{height:48,width:"100%"}),e.jsx(q,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:e.jsx(y,{height:400})})]})]});if(X){const a=re(X);return e.jsxs(R,{size:"xl",py:"md",children:[e.jsx(z,{icon:e.jsx($,{size:16}),title:"Error Loading Index",color:"red",children:a.message}),e.jsx(O,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(R,{size:"xl",py:"md",children:[e.jsxs(M,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Re,{order:1,children:"Edit Index"}),e.jsx(l,{size:"sm",c:"dimmed",children:r})]}),e.jsx(O,{variant:"default",onClick:()=>s(`/cluster/${t}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(b,{gap:"md",children:[e.jsxs(x,{value:p,onChange:ve,children:[e.jsxs(x.List,{children:[e.jsx(x.Tab,{value:"settings",leftSection:e.jsx(qe,{size:16}),children:"Settings"}),e.jsx(x.Tab,{value:"mappings",leftSection:e.jsx(Oe,{size:16}),children:"Mappings"}),e.jsx(x.Tab,{value:"stats",leftSection:e.jsx(Xe,{size:16}),children:"Stats"})]}),e.jsx(x.Panel,{value:"settings",pt:"md",children:e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsx(b,{gap:"md",children:e.jsxs("div",{children:[e.jsxs(M,{gap:"xs",mb:"xs",children:[e.jsx(l,{size:"sm",fw:500,children:"Index Settings (JSON)"}),e.jsxs(j,{width:320,shadow:"md",withArrow:!0,children:[e.jsx(j.Target,{children:e.jsx(te,{size:16,style:{cursor:"help",color:"var(--mantine-color-blue-6)"}})}),e.jsxs(j.Dropdown,{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Filtered Settings"}),e.jsx(l,{size:"xs",children:"Static and read-only settings are automatically filtered from this editor."}),e.jsxs(l,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"System-managed (never modifiable):"}),e.jsx("br",{}),"creation_date, uuid, version, provided_name"]}),e.jsxs(l,{size:"xs",mt:"xs",children:[e.jsx("strong",{children:"Static (require closed index):"}),e.jsx("br",{}),"number_of_shards, codec, sort, store, routing_path, analysis (analyzers, tokenizers, filters), similarity, mapping, and others"]})]})]})]}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Edit the dynamic settings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(se,{height:"500px",defaultLanguage:"json",value:h,onChange:fe,theme:i==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),S&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:S})]})})})}),e.jsx(x.Panel,{value:"mappings",pt:"md",children:e.jsxs(b,{gap:"md",children:[e.jsx(z,{icon:e.jsx(te,{size:16}),color:"yellow",title:"Mapping Restrictions",children:e.jsxs(l,{size:"sm",children:[e.jsx("strong",{children:"Important:"})," Existing field mappings cannot be changed or deleted. You can only ",e.jsx("strong",{children:"add new fields"}),". To change field types, you must reindex your data."]})}),e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsx(b,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Mappings (JSON)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Add new fields to the mappings below"}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(se,{height:"500px",defaultLanguage:"json",value:f,onChange:xe,theme:i==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),I&&e.jsx(l,{size:"sm",c:"red",mt:"xs",children:I})]})})})]})}),e.jsx(x.Panel,{value:"stats",pt:"md",children:e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsx(b,{gap:"md",children:e.jsxs("div",{children:[e.jsx(l,{size:"sm",fw:500,mb:"xs",children:"Index Statistics (Read-only)"}),e.jsx(l,{size:"xs",c:"dimmed",mb:"sm",children:"Detailed statistics for this index"}),F?e.jsx(M,{justify:"center",py:"xl",children:e.jsx(He,{})}):W?e.jsx(z,{icon:e.jsx($,{size:16}),title:"Error",color:"red",children:W}):T?e.jsx(Je,{h:500,children:e.jsx(Ae,{block:!0,children:JSON.stringify(T,null,2)})}):null]})})})})]}),D&&e.jsx(z,{icon:e.jsx($,{size:16}),title:"Failed to Update Index",color:"red",withCloseButton:!0,onClose:()=>g(null),children:e.jsx(l,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:D})}),e.jsxs(M,{justify:"flex-end",children:[e.jsx(O,{variant:"default",onClick:je,disabled:!Z||P.isPending,children:"Reset"}),e.jsx(O,{onClick:ye,loading:P.isPending,disabled:!Z,children:P.isPending?"Saving...":"Save Changes"})]})]})]})}export{ds as IndexEdit};
