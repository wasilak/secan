import{i as G,k as V,l as Z,j as e,B as H,n as W,o as X,a1 as N,K as Y,u as ee,y as se,a0 as te,r as p,b as ie,A as O,I as B,G as R,S as q,T as ne,d as j,Z as re,D as ae,f as L}from"./index-Bt6cuxqh.js";import{u as de}from"./useMutation-CAENEphD.js";import{p as U}from"./errorHandling-NmYW95TT.js";import{C as w}from"./Container-DMjxdtNE.js";import{C as F}from"./Card-Dwru4Zec.js";import{B as v}from"./Button-CJn9sQpo.js";import{I as oe}from"./IconCheck-BmorQwo6.js";var $={root:"m_18320242","skeleton-fade":"m_299c329c"};const le={visible:!0,animate:!0},ce=W((s,{width:t,height:a,radius:d,circle:l})=>({root:{"--skeleton-height":N(a),"--skeleton-width":l?N(a):N(t),"--skeleton-radius":l?"1000px":d===void 0?void 0:X(d)}})),r=G((s,t)=>{const a=V("Skeleton",le,s),{classNames:d,className:l,style:x,styles:g,unstyled:y,vars:c,width:k,height:o,circle:_,visible:u,radius:m,animate:C,mod:S,...f}=a,h=Z({name:"Skeleton",classes:$,props:a,className:l,style:x,classNames:d,styles:g,unstyled:y,vars:c,varsResolver:ce});return e.jsx(H,{ref:t,...h("root"),mod:[{visible:u,animate:C},S],...f})});r.classes=$;r.displayName="@mantine/core/Skeleton";function ue(s){if(!s.trim())return"Settings cannot be empty";try{return JSON.parse(s),null}catch(t){return t.message}}function ye(){const{id:s,indexName:t}=Y(),a=ee(),d=se(),{resolvedTheme:l}=te(),[x,g]=p.useState(""),[y,c]=p.useState(null),[k,o]=p.useState(null),[_,u]=p.useState(!1),{data:m,isLoading:C,error:S}=ie({queryKey:["cluster",s,"index",t,"settings"],queryFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");const n=(await L.proxyRequest(s,"GET",`/${t}/_settings`))[t];return n==null?void 0:n.settings},enabled:!!s&&!!t}),f=i=>{const n=["creation_date","provided_name","uuid","version"],E=["number_of_shards","number_of_routing_shards","codec","mode","routing_partition_size","soft_deletes","load_fixed_bitset_filters_eagerly","shard","sort","store","time_series","routing_path"],J=[...n,...E],I={};for(const[b,P]of Object.entries(i))if(b==="index"){const Q=P,z={};for(const[T,A]of Object.entries(Q))J.includes(T)||(z[T]=A);Object.keys(z).length>0&&(I[b]=z)}else J.includes(b)||(I[b]=P);return I};p.useEffect(()=>{if(m){const i=f(m);g(JSON.stringify(i,null,2)),u(!1)}},[m]);const h=de({mutationFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");const i=ue(x);if(i)throw c(i),new Error(`Invalid settings JSON: ${i}`);const n=JSON.parse(x),E=f(n);await L.proxyRequest(s,"PUT",`/${t}/_settings`,E)},onSuccess:()=>{d.invalidateQueries({queryKey:["cluster",s,"index",t,"settings"]}),d.invalidateQueries({queryKey:["cluster",s,"indices"]}),ae.show({title:"Success",message:`Settings for index "${t}" updated successfully`,color:"green",icon:e.jsx(oe,{size:16})}),u(!1),o(null)},onError:i=>{const n=U(i);o(n.message)}}),D=i=>{g(i||""),c(null),o(null),u(!0)},K=()=>{c(null),o(null),h.mutate()},M=()=>{if(m){const i=f(m);g(JSON.stringify(i,null,2)),c(null),o(null),u(!1)}};if(!s||!t)return e.jsx(w,{size:"xl",children:e.jsx(O,{icon:e.jsx(B,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})});if(C)return e.jsxs(w,{size:"xl",py:"md",children:[e.jsxs(R,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(r,{height:32,width:200,mb:"xs"}),e.jsx(r,{height:20,width:150})]}),e.jsx(r,{height:36,width:120})]}),e.jsxs(q,{gap:"md",children:[e.jsxs(F,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(r,{height:24,width:150,mb:"md"}),e.jsx(r,{height:400})]}),e.jsxs(F,{shadow:"sm",padding:"md",radius:"md",withBorder:!0,children:[e.jsx(r,{height:20,width:"100%",mb:"xs"}),e.jsx(r,{height:20,width:"90%"})]})]})]});if(S){const i=U(S);return e.jsxs(w,{size:"xl",py:"md",children:[e.jsx(O,{icon:e.jsx(B,{size:16}),title:"Error Loading Settings",color:"red",children:i.message}),e.jsx(v,{variant:"default",onClick:()=>a(`/cluster/${s}?tab=indices`),mt:"md",children:"Back to Indices"})]})}return e.jsxs(w,{size:"xl",py:"md",children:[e.jsxs(R,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(ne,{order:1,children:"Index Settings"}),e.jsx(j,{size:"sm",c:"dimmed",children:t})]}),e.jsx(v,{variant:"default",onClick:()=>a(`/cluster/${s}?tab=indices`),children:"Back to Indices"})]}),e.jsx(q,{gap:"md",children:e.jsx(F,{shadow:"sm",padding:"lg",children:e.jsxs(q,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(j,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),e.jsx(j,{size:"xs",c:"dimmed",mb:"sm",children:'Edit the settings below and click "Update Settings" to apply changes'}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(re,{height:"500px",defaultLanguage:"json",value:x,onChange:D,theme:l==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),y&&e.jsx(j,{size:"sm",c:"red",mt:"xs",children:y})]}),k&&e.jsx(O,{icon:e.jsx(B,{size:16}),title:"Failed to Update Settings",color:"red",withCloseButton:!0,onClose:()=>o(null),children:e.jsx(j,{size:"sm",style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:k})}),e.jsxs(R,{justify:"flex-end",children:[e.jsx(v,{variant:"default",onClick:M,disabled:!_||h.isPending,children:"Reset"}),e.jsx(v,{onClick:K,loading:h.isPending,disabled:!_,children:h.isPending?"Updating...":"Update Settings"})]})]})})})]})}export{ye as IndexSettings};
