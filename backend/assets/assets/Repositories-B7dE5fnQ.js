import{e as k,z,q as T,r as q,k as v,j as e,A as g,I as b,G as c,L as F,l as I,m as n,H as S,S as y,F as w,n as r,N,aj as O,v as A,t as d,o as f,y as E,ab as M}from"./index-CaOal3yg.js";import{u as R}from"./useMutation-D-W2tDqy.js";import{C as j}from"./Container-DlXTErpz.js";import{B as u}from"./Button-DH36Z4D5.js";import{C as P}from"./Card-C5m1WGBJ.js";import{B as H}from"./Badge-CUj_ZLy-.js";import{I as J}from"./IconTrash-BQm4pDmp.js";import{u as _}from"./use-form-BOl6UsLH.js";import{T as L}from"./TextInput-BGnuG8Zd.js";import{T as $}from"./Textarea-MP4ysI4z.js";var B=k("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]);function se(){const{id:o}=z(),a=T(),[h,l]=q.useState(!1),{data:t,isLoading:p,error:m}=v({queryKey:["cluster",o,"repositories"],queryFn:()=>f.getRepositories(o),enabled:!!o}),x=R({mutationFn:s=>f.deleteRepository(o,s),onSuccess:()=>{a.invalidateQueries({queryKey:["cluster",o,"repositories"]}),d.show({title:"Success",message:"Repository deleted successfully",color:"green"})},onError:s=>{d.show({title:"Error",message:`Failed to delete repository: ${s.message}`,color:"red"})}});return o?p?e.jsx(j,{size:"xl",children:e.jsx(c,{justify:"center",mt:"xl",children:e.jsx(F,{size:"lg"})})}):m?e.jsx(j,{size:"xl",children:e.jsxs(g,{icon:e.jsx(b,{size:16}),title:"Error",color:"red",children:["Failed to load repositories: ",m.message]})}):e.jsxs(j,{size:"xl",py:"md",children:[e.jsxs(c,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(I,{order:2,children:"Snapshot Repositories"}),e.jsx(n,{size:"sm",c:"dimmed",children:"Manage snapshot repositories for backup and restore operations"})]}),e.jsx(u,{leftSection:e.jsx(S,{size:16}),onClick:()=>l(!0),children:"Create Repository"})]}),e.jsx(P,{shadow:"sm",padding:"lg",children:!t||t.length===0?e.jsxs(y,{gap:"md",align:"center",py:"xl",children:[e.jsx(n,{c:"dimmed",children:"No repositories found"}),e.jsx(u,{leftSection:e.jsx(S,{size:16}),onClick:()=>l(!0),children:"Create Repository"})]}):e.jsx(w,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Name"}),e.jsx(r.Th,{children:"Type"}),e.jsx(r.Th,{children:"Settings"}),e.jsx(r.Th,{children:"Actions"})]})}),e.jsx(r.Tbody,{children:t.map(s=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:e.jsxs(c,{gap:"xs",children:[e.jsx(B,{size:16}),e.jsx(n,{size:"sm",fw:500,children:s.name})]})}),e.jsx(r.Td,{children:e.jsx(H,{size:"sm",variant:"light",children:s.type.toUpperCase()})}),e.jsx(r.Td,{children:e.jsx(N,{block:!0,children:JSON.stringify(s.settings,null,2)})}),e.jsx(r.Td,{children:e.jsxs(c,{gap:"xs",children:[e.jsx(u,{component:O,to:`/cluster/${o}/snapshots/${s.name}`,size:"xs",variant:"light",children:"View Snapshots"}),e.jsx(A,{color:"red",variant:"subtle",onClick:()=>{confirm(`Delete repository "${s.name}"? This will not delete snapshots.`)&&x.mutate(s.name)},loading:x.isPending,children:e.jsx(J,{size:16})})]})})]},s.name))})]})})}),e.jsx(D,{opened:h,onClose:()=>l(!1),clusterId:o})]}):e.jsx(j,{size:"xl",children:e.jsx(g,{icon:e.jsx(b,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function D({opened:o,onClose:a,clusterId:h}){const l=T(),t=_({initialValues:{name:"",type:"fs",settings:{},settingsText:""},validate:{name:s=>s?s.startsWith("_")||s.startsWith("-")||s.startsWith("+")?"Repository name cannot start with _, -, or +":null:"Repository name is required",settingsText:s=>{if(!s)return"Settings are required";try{return JSON.parse(s),null}catch{return"Invalid JSON format"}}}}),p=R({mutationFn:s=>f.createRepository(h,s),onSuccess:()=>{l.invalidateQueries({queryKey:["cluster",h,"repositories"]}),d.show({title:"Success",message:"Repository created successfully",color:"green"}),t.reset(),a()},onError:s=>{d.show({title:"Error",message:`Failed to create repository: ${s.message}`,color:"red"})}}),m=t.onSubmit(s=>{try{const i=JSON.parse(s.settingsText),C={name:s.name,type:s.type,settings:i};p.mutate(C)}catch(i){d.show({title:"Error",message:`Invalid JSON: ${i.message}`,color:"red"})}}),x=s=>{if(!s)return;t.setFieldValue("type",s);let i={};switch(s){case"fs":i={location:"/mount/backups/my_backup"};break;case"s3":i={bucket:"my-bucket",region:"us-east-1",base_path:"snapshots"};break;case"azure":i={container:"my-container",base_path:"snapshots"};break;case"gcs":i={bucket:"my-bucket",base_path:"snapshots"};break;case"hdfs":i={uri:"hdfs://namenode:8020",path:"/snapshots"};break;case"url":i={url:"http://example.com/snapshots"};break}t.setFieldValue("settingsText",JSON.stringify(i,null,2))};return e.jsx(E,{opened:o,onClose:a,title:"Create Repository",size:"lg",children:e.jsx("form",{onSubmit:m,children:e.jsxs(y,{gap:"md",children:[e.jsx(L,{label:"Repository Name",placeholder:"my-backup-repo",required:!0,...t.getInputProps("name")}),e.jsx(M,{label:"Repository Type",description:"Select the storage backend for snapshots",required:!0,data:[{value:"fs",label:"Filesystem"},{value:"s3",label:"Amazon S3"},{value:"azure",label:"Azure Blob Storage"},{value:"gcs",label:"Google Cloud Storage"},{value:"hdfs",label:"HDFS"},{value:"url",label:"URL (Read-only)"}],value:t.values.type,onChange:x}),e.jsx($,{label:"Settings (JSON)",description:"Repository-specific configuration",placeholder:'{"location": "/mount/backups/my_backup"}',required:!0,minRows:8,...t.getInputProps("settingsText")}),e.jsx(g,{color:"blue",title:"Repository Type Information",children:e.jsxs(y,{gap:"xs",children:[e.jsxs(n,{size:"sm",children:[e.jsx("strong",{children:"Filesystem:"})," Requires shared filesystem accessible to all nodes"]}),e.jsxs(n,{size:"sm",children:[e.jsx("strong",{children:"S3/Azure/GCS:"})," Requires appropriate credentials and permissions"]}),e.jsxs(n,{size:"sm",children:[e.jsx("strong",{children:"HDFS:"})," Requires HDFS plugin installed"]}),e.jsxs(n,{size:"sm",children:[e.jsx("strong",{children:"URL:"})," Read-only repository for accessing snapshots via HTTP/HTTPS"]})]})}),e.jsxs(c,{justify:"flex-end",mt:"md",children:[e.jsx(u,{variant:"subtle",onClick:a,children:"Cancel"}),e.jsx(u,{type:"submit",loading:p.isPending,children:"Create Repository"})]})]})})})}export{se as Repositories};
