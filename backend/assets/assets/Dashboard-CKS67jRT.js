import{c as N,u as H,a as A,r as b,b as U,j as e,T as v,C as R,S as V,L as B,d as y,A as T,I as z,G as k,e as n,f as D,U as F,g as M}from"./index-kxfVuSGr.js";import{u as O}from"./accessibility-pO9lj66H.js";import{C}from"./Container-Bd9RJg8g.js";import{I as P}from"./IconRefresh-CTy5wmOu.js";import{B as q}from"./Badge-Dg5TQ3hP.js";var G=N("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),K=N("selector","IconSelector",[["path",{d:"M8 9l4 -4l4 4",key:"svg-0"}],["path",{d:"M16 15l-4 4l-4 -4",key:"svg-1"}]]);function Q(a){switch(a){case"green":return"green";case"yellow":return"yellow";case"red":return"red";case"unreachable":return"gray";default:return"gray"}}function E(a){switch(a){case"green":return 3;case"yellow":return 2;case"red":return 1;case"unreachable":return 0;default:return 0}}function W(a,l,t){return t?[...a].sort((h,i)=>{let s,o;return l==="health"?(s=E(h.health),o=E(i.health)):(s=h[l],o=i[l]),typeof s=="string"&&typeof o=="string"?t==="asc"?s.localeCompare(o):o.localeCompare(s):typeof s=="number"&&typeof o=="number"?t==="asc"?s-o:o-s:0}):a}function x({column:a,currentColumn:l,direction:t,onSort:f,children:h}){const i=l===a,s=i?`Sorted ${t==="asc"?"ascending":"descending"}`:"Not sorted";return e.jsx(n.Th,{children:e.jsxs(F,{onClick:()=>f(a),style:{display:"flex",alignItems:"center",gap:"4px",width:"100%"},"aria-label":`Sort by ${h}, ${s}`,children:[e.jsx(y,{fw:500,children:h}),i&&t==="asc"&&e.jsx(G,{size:14,"aria-hidden":"true"}),i&&t==="desc"&&e.jsx(M,{size:14,"aria-hidden":"true"}),!i&&e.jsx(K,{size:14,opacity:.5,"aria-hidden":"true"})]})})}function ee(){const a=H(),{preferences:l}=A(),{announce:t,announceError:f}=O(),[h,i]=b.useState([]),[s,o]=b.useState(null),[d,S]=b.useState(null),{data:c,isLoading:I,error:j}=U({queryKey:["clusters"],queryFn:()=>D.getClusters(),refetchInterval:l.refreshInterval});b.useEffect(()=>{I?t("Loading clusters"):j?f("Failed to load cluster list"):c&&t(`Loaded ${c.length} cluster${c.length!==1?"s":""}`)},[I,j,c,t,f]),b.useEffect(()=>{if(!c||c.length===0){i([]);return}const r=async()=>{const L=await Promise.all(c.map(async g=>{try{const m=await D.getClusterHealth(g.id);return{id:g.id,name:g.name,health:m.status,nodes:m.numberOfNodes,shards:m.activeShards,indices:0,documents:0}}catch(m){return{id:g.id,name:g.name,health:"unreachable",nodes:0,shards:0,indices:0,documents:0,error:m instanceof Error?m.message:"Unknown error"}}}));i(L)};r();const p=setInterval(r,l.refreshInterval);return()=>clearInterval(p)},[c,l.refreshInterval]);const u=r=>{s===r?d==="asc"?(S("desc"),t(`Sorted by ${r} descending`)):d==="desc"&&(S(null),o(null),t("Sort removed")):(o(r),S("asc"),t(`Sorted by ${r} ascending`))},w=r=>{a(`/cluster/${r}`)},$=W(h,s,d);return I?e.jsxs(C,{size:"xl",px:{base:"xs",sm:"md"},children:[e.jsx(v,{order:1,mb:"md",className:"text-responsive-xl",children:"Dashboard"}),e.jsx(R,{h:200,children:e.jsxs(V,{align:"center",gap:"md",children:[e.jsx(B,{size:"lg"}),e.jsx(y,{c:"dimmed",children:"Loading clusters..."})]})})]}):j?e.jsxs(C,{size:"xl",px:{base:"xs",sm:"md"},children:[e.jsx(v,{order:1,mb:"md",className:"text-responsive-xl",children:"Dashboard"}),e.jsx(T,{icon:e.jsx(z,{size:16}),title:"Error loading clusters",color:"red",children:j instanceof Error?j.message:"Failed to load cluster list"})]}):!c||c.length===0?e.jsxs(C,{size:"xl",px:{base:"xs",sm:"md"},children:[e.jsx(v,{order:1,mb:"md",className:"text-responsive-xl",children:"Dashboard"}),e.jsx(T,{icon:e.jsx(z,{size:16}),title:"No clusters configured",color:"blue",children:"No Elasticsearch or OpenSearch clusters are configured. Please check your configuration file."})]}):e.jsxs(C,{size:"xl",px:{base:"xs",sm:"md"},children:[e.jsxs(k,{justify:"space-between",mb:"md",wrap:"wrap",children:[e.jsx(v,{order:1,className:"text-responsive-xl",children:"Dashboard"}),e.jsxs(k,{gap:"xs",children:[e.jsx(P,{size:16,"aria-hidden":"true"}),e.jsxs(y,{size:"sm",c:"dimmed","aria-live":"polite",children:["Auto-refresh: ",l.refreshInterval/1e3,"s"]})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(n,{highlightOnHover:!0,striped:!0,role:"table","aria-label":"Cluster overview table",style:{minWidth:"600px"},children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(x,{column:"name",currentColumn:s,direction:d,onSort:u,children:"Cluster Name"}),e.jsx(x,{column:"health",currentColumn:s,direction:d,onSort:u,children:"Health"}),e.jsx(x,{column:"nodes",currentColumn:s,direction:d,onSort:u,children:"Nodes"}),e.jsx(x,{column:"shards",currentColumn:s,direction:d,onSort:u,children:"Shards"}),e.jsx(x,{column:"indices",currentColumn:s,direction:d,onSort:u,children:"Indices"}),e.jsx(x,{column:"documents",currentColumn:s,direction:d,onSort:u,children:"Documents"})]})}),e.jsx(n.Tbody,{children:$.map(r=>e.jsxs(n.Tr,{onClick:()=>w(r.id),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),w(r.id))},"aria-label":`View details for cluster ${r.name}`,children:[e.jsxs(n.Td,{children:[e.jsx(y,{fw:500,children:r.name}),r.error&&e.jsx(y,{size:"xs",c:"dimmed",role:"alert",children:r.error})]}),e.jsx(n.Td,{children:e.jsx(q,{color:Q(r.health),variant:"filled","aria-label":`Health status: ${r.health}`,children:r.health})}),e.jsx(n.Td,{children:r.nodes}),e.jsx(n.Td,{children:r.shards}),e.jsx(n.Td,{children:r.indices}),e.jsx(n.Td,{children:r.documents.toLocaleString()})]},r.id))})]})})]})}export{ee as Dashboard};
