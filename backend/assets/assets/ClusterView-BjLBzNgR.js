import{c as ue,r as ce,h as fe,i as we,n as b,f as N,j as e,M as j,k as R,l as G,m as ye,o as Pe,p as ze,S as C,d as t,G as h,q as xe,a as Fe,s as ne,b as X,A as ee,I as se,L as ie,T as Ie,u as ve,t as ge,v as je,e as a,w as Te,x as Ne,y as Le}from"./index-DFlknjux.js";import{u as B}from"./useMutation-B0I5yKTY.js";import{u as Ae}from"./accessibility-B7KYFZs_.js";import{I as Ue}from"./IconDeviceFloppy-CmSPByBZ.js";import{I as De}from"./IconTrash-BOC-WJk8.js";import{T as le}from"./TextInput-Del6pFtW.js";import{B as Y}from"./Button-DRu4GsPL.js";import{N as qe}from"./NumberInput-Ba3UbCkg.js";import{B as P}from"./Badge-BauO-09y.js";import{G as Q}from"./Grid-BU2Z-ZW7.js";import{C as V}from"./Card-CO58kGMW.js";import{P as de}from"./Progress-BJ8MJYiR.js";import{T as W}from"./Tabs-DrH94HKA.js";import{I as ke,a as _,b as $e,c as Me,C as he}from"./IconMinimize-CHHiYJ8L.js";import{M as me}from"./MultiSelect-DzwU7c14.js";import{I as Oe,a as Re}from"./IconSortDescending-C23HkE87.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./get-safe-id-Bp3H8K0-.js";import"./InputsGroupFieldset-Dv-ypGoR.js";var Ee=ue("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Be=ue("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Ge=ue("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),Ke=ue("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);function pe(o,l=300){const[w,d]=ce.useState(o);return ce.useEffect(()=>{const E=setTimeout(()=>{d(o)},l);return()=>{clearTimeout(E)}},[o,l]),w}function We({clusterId:o,index:l}){const w=fe(),{announceSuccess:d,announceError:E}=Ae(),[v,{open:k,close:n}]=we(!1),[$,{open:A,close:z}]=we(!1),[p,T]=ce.useState(""),[I,s]=ce.useState(1),m=B({mutationFn:()=>N.openIndex(o,l.name),onMutate:()=>{b.show({id:`open-${l.name}`,title:"Opening index",message:`Opening index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`open-${l.name}`,title:"Success",message:`Index ${l.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),d(`Index ${l.name} opened successfully`),w.invalidateQueries({queryKey:["cluster",o,"indices"]})},onError:f=>{b.update({id:`open-${l.name}`,title:"Error",message:`Failed to open index: ${f.message}`,color:"red",loading:!1,autoClose:5e3}),E(`Failed to open index: ${f.message}`)}}),x=B({mutationFn:()=>N.closeIndex(o,l.name),onMutate:()=>{b.show({id:`close-${l.name}`,title:"Closing index",message:`Closing index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`close-${l.name}`,title:"Success",message:`Index ${l.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),w.invalidateQueries({queryKey:["cluster",o,"indices"]})},onError:f=>{b.update({id:`close-${l.name}`,title:"Error",message:`Failed to close index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),M=B({mutationFn:()=>N.deleteIndex(o,l.name),onMutate:()=>{b.show({id:`delete-${l.name}`,title:"Deleting index",message:`Deleting index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`delete-${l.name}`,title:"Success",message:`Index ${l.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),w.invalidateQueries({queryKey:["cluster",o,"indices"]}),n(),T("")},onError:f=>{b.update({id:`delete-${l.name}`,title:"Error",message:`Failed to delete index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),S=B({mutationFn:f=>N.forceMergeIndex(o,l.name,f),onMutate:()=>{b.show({id:`forcemerge-${l.name}`,title:"Force merging index",message:`Force merging index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`forcemerge-${l.name}`,title:"Success",message:`Index ${l.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),z(),s(1)},onError:f=>{b.update({id:`forcemerge-${l.name}`,title:"Error",message:`Failed to force merge index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),D=B({mutationFn:()=>N.clearCacheIndex(o,l.name),onMutate:()=>{b.show({id:`clearcache-${l.name}`,title:"Clearing cache",message:`Clearing cache for index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`clearcache-${l.name}`,title:"Success",message:`Cache cleared for index ${l.name}`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{b.update({id:`clearcache-${l.name}`,title:"Error",message:`Failed to clear cache: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),U=B({mutationFn:()=>N.refreshIndex(o,l.name),onMutate:()=>{b.show({id:`refresh-${l.name}`,title:"Refreshing index",message:`Refreshing index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`refresh-${l.name}`,title:"Success",message:`Index ${l.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{b.update({id:`refresh-${l.name}`,title:"Error",message:`Failed to refresh index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),F=B({mutationFn:()=>N.flushIndex(o,l.name),onMutate:()=>{b.show({id:`flush-${l.name}`,title:"Flushing index",message:`Flushing index ${l.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{b.update({id:`flush-${l.name}`,title:"Success",message:`Index ${l.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{b.update({id:`flush-${l.name}`,title:"Error",message:`Failed to flush index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),re=()=>{p===l.name&&M.mutate()},K=()=>{const f=typeof I=="number"?I:parseInt(I,10);!isNaN(f)&&f>0&&S.mutate(f)};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(R,{label:"Index operations",children:e.jsx(G,{variant:"subtle",color:"gray","aria-label":`Operations for index ${l.name}`,children:e.jsx(Ee,{size:16,"aria-hidden":"true"})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Index Operations"}),l.status==="close"?e.jsx(j.Item,{leftSection:e.jsx(Ke,{size:14,"aria-hidden":"true"}),onClick:()=>m.mutate(),disabled:m.isPending,children:"Open Index"}):e.jsx(j.Item,{leftSection:e.jsx(Ge,{size:14,"aria-hidden":"true"}),onClick:()=>x.mutate(),disabled:x.isPending,children:"Close Index"}),e.jsx(j.Item,{leftSection:e.jsx(ye,{size:14,"aria-hidden":"true"}),onClick:()=>U.mutate(),disabled:U.isPending,children:"Refresh"}),e.jsx(j.Item,{leftSection:e.jsx(Ue,{size:14,"aria-hidden":"true"}),onClick:()=>F.mutate(),disabled:F.isPending,children:"Flush"}),e.jsx(j.Item,{leftSection:e.jsx(Be,{size:14,"aria-hidden":"true"}),onClick:()=>D.mutate(),disabled:D.isPending,children:"Clear Cache"}),e.jsx(j.Item,{leftSection:e.jsx(Pe,{size:14,"aria-hidden":"true"}),onClick:A,children:"Force Merge"}),e.jsx(j.Divider,{}),e.jsx(j.Item,{leftSection:e.jsx(De,{size:14,"aria-hidden":"true"}),color:"red",onClick:k,children:"Delete Index"})]})]}),e.jsx(ze,{opened:v,onClose:()=>{n(),T("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(C,{gap:"md",children:[e.jsxs(t,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(t,{span:!0,fw:700,children:l.name}),"? This action cannot be undone."]}),e.jsx(t,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(le,{placeholder:l.name,value:p,onChange:f=>T(f.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(h,{justify:"flex-end",children:[e.jsx(Y,{variant:"default",onClick:()=>{n(),T("")},children:"Cancel"}),e.jsx(Y,{color:"red",onClick:re,disabled:p!==l.name||M.isPending,loading:M.isPending,"aria-label":`Delete index ${l.name}`,children:"Delete"})]})]})}),e.jsx(ze,{opened:$,onClose:()=>{z(),s(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(C,{gap:"md",children:[e.jsxs(t,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(t,{span:!0,fw:700,children:l.name})," to reduce the number of segments."]}),e.jsx(qe,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:I,onChange:s,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(h,{justify:"flex-end",children:[e.jsx(Y,{variant:"default",onClick:()=>{z(),s(1)},children:"Cancel"}),e.jsx(Y,{onClick:K,disabled:S.isPending,loading:S.isPending,"aria-label":`Force merge index ${l.name}`,children:"Force Merge"})]})]})})]})}function be(o){switch(o){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function O(o){if(o===0)return"0 B";const l=1024,w=["B","KB","MB","GB","TB"],d=Math.floor(Math.log(o)/Math.log(l));return`${(o/Math.pow(l,d)).toFixed(2)} ${w[d]}`}function H(o,l){return l===0?0:Math.round(o/l*100)}function js(){var D,U;const{id:o}=xe(),l=Fe(),[w,d]=ne(),E=w.get("tab")||"overview",v=F=>{F&&d({tab:F})},k=F=>{d({tab:F})},{data:n,isLoading:$,error:A}=X({queryKey:["cluster",o,"stats"],queryFn:()=>N.getClusterStats(o),refetchInterval:l,enabled:!!o}),{data:z,isLoading:p,error:T}=X({queryKey:["cluster",o,"nodes"],queryFn:()=>N.getNodes(o),refetchInterval:l,enabled:!!o}),{data:I,isLoading:s,error:m}=X({queryKey:["cluster",o,"indices"],queryFn:()=>N.getIndices(o),refetchInterval:l,enabled:!!o}),{data:x,isLoading:M,error:S}=X({queryKey:["cluster",o,"shards"],queryFn:()=>N.getShards(o),refetchInterval:l,enabled:!!o});return o?$?e.jsx(C,{p:"md",children:e.jsx(h,{justify:"center",mt:"xl",children:e.jsx(ie,{size:"lg"})})}):A?e.jsx(C,{p:"md",children:e.jsxs(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",A.message]})}):e.jsxs(C,{gap:"md",p:"md",children:[e.jsxs(h,{justify:"space-between",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(Ie,{order:1,className:"text-responsive-xl",children:(n==null?void 0:n.clusterName)||o}),e.jsx(t,{size:"sm",c:"dimmed",children:"Cluster Overview"})]}),e.jsx(h,{children:e.jsx(P,{size:"lg",color:be((n==null?void 0:n.health)||"red"),children:((D=n==null?void 0:n.health)==null?void 0:D.toUpperCase())||"UNKNOWN"})})]}),e.jsxs(Q,{children:[e.jsx(Q.Col,{span:{base:12,sm:6,md:3},children:e.jsx(V,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>k("nodes"),children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(t,{size:"xl",fw:700,children:(n==null?void 0:n.numberOfNodes)||0}),e.jsxs(t,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(Q.Col,{span:{base:12,sm:6,md:3},children:e.jsx(V,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>k("indices"),children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(t,{size:"xl",fw:700,children:(n==null?void 0:n.numberOfIndices)||0}),e.jsxs(t,{size:"xs",c:"dimmed",children:[((U=n==null?void 0:n.numberOfDocuments)==null?void 0:U.toLocaleString())||0," documents"]})]})})}),e.jsx(Q.Col,{span:{base:12,sm:6,md:3},children:e.jsx(V,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>k("shards"),children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(t,{size:"xl",fw:700,children:(n==null?void 0:n.activeShards)||0}),e.jsxs(t,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.activePrimaryShards)||0," primary"]})]})})}),e.jsx(Q.Col,{span:{base:12,sm:6,md:3},children:e.jsx(V,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>k("shards"),children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(t,{size:"xl",fw:700,c:n!=null&&n.unassignedShards?"red":void 0,children:(n==null?void 0:n.unassignedShards)||0}),e.jsxs(t,{size:"xs",c:"dimmed",children:[(n==null?void 0:n.relocatingShards)||0," relocating"]})]})})})]}),((n==null?void 0:n.memoryTotal)||(n==null?void 0:n.diskTotal))&&e.jsxs(Q,{children:[(n==null?void 0:n.memoryTotal)&&e.jsx(Q.Col,{span:{base:12,md:6},children:e.jsx(V,{shadow:"sm",padding:"lg",children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(de,{value:H(n.memoryUsed||0,n.memoryTotal),color:H(n.memoryUsed||0,n.memoryTotal)>90?"red":"blue",size:"lg"}),e.jsxs(t,{size:"xs",c:"dimmed",children:[O(n.memoryUsed||0)," / ",O(n.memoryTotal)," (",H(n.memoryUsed||0,n.memoryTotal),"%)"]})]})})}),(n==null?void 0:n.diskTotal)&&e.jsx(Q.Col,{span:{base:12,md:6},children:e.jsx(V,{shadow:"sm",padding:"lg",children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(de,{value:H(n.diskUsed||0,n.diskTotal),color:H(n.diskUsed||0,n.diskTotal)>90?"red":"blue",size:"lg"}),e.jsxs(t,{size:"xs",c:"dimmed",children:[O(n.diskUsed||0)," / ",O(n.diskTotal)," (",H(n.diskUsed||0,n.diskTotal),"%)"]})]})})})]}),e.jsx(V,{shadow:"sm",padding:"lg",children:e.jsxs(W,{value:E,onChange:v,children:[e.jsxs(W.List,{children:[e.jsx(W.Tab,{value:"overview",children:"Overview"}),e.jsxs(W.Tab,{value:"nodes",children:["Nodes (",(z==null?void 0:z.length)||0,")"]}),e.jsxs(W.Tab,{value:"indices",children:["Indices (",(I==null?void 0:I.length)||0,")"]}),e.jsxs(W.Tab,{value:"shards",children:["Shards (",(x==null?void 0:x.length)||0,")"]})]}),e.jsx(W.Panel,{value:"overview",pt:"md",children:e.jsx(He,{nodes:z,indices:I,shards:x,loading:p||s||M,error:T||m||S})}),e.jsx(W.Panel,{value:"nodes",pt:"md",children:e.jsx(Qe,{nodes:z,loading:p,error:T})}),e.jsx(W.Panel,{value:"indices",pt:"md",children:e.jsx(Ve,{indices:I,loading:s,error:m})}),e.jsx(W.Panel,{value:"shards",pt:"md",children:e.jsx(_e,{shards:x,loading:M,error:S})})]})})]}):e.jsx(C,{p:"md",children:e.jsx(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function Qe({nodes:o,loading:l,error:w}){var I;const{id:d}=xe(),E=ve(),[v,k]=ne(),n=v.get("nodesSearch")||"",$=((I=v.get("roles"))==null?void 0:I.split(",").filter(Boolean))||[],A=pe(n,300),z=(s,m)=>{const x=new URLSearchParams(v);s!==void 0&&(s?x.set("nodesSearch",s):x.delete("nodesSearch")),m!==void 0&&(m.length>0?x.set("roles",m.join(",")):x.delete("roles")),k(x)},p=Array.from(new Set((o==null?void 0:o.flatMap(s=>s.roles))||[])),T=o==null?void 0:o.filter(s=>{var M;const m=s.name.toLowerCase().includes(A.toLowerCase())||((M=s.ip)==null?void 0:M.toLowerCase().includes(A.toLowerCase())),x=$.length===0||$.some(S=>s.roles.includes(S));return m&&x});return l?e.jsx(h,{justify:"center",py:"xl",children:e.jsx(ie,{})}):w?e.jsxs(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",w.message]}):!o||o.length===0?e.jsx(t,{c:"dimmed",children:"No nodes found"}):e.jsxs(C,{gap:"md",children:[e.jsxs(h,{children:[e.jsx(le,{placeholder:"Search nodes...",leftSection:e.jsx(ge,{size:16}),value:n,onChange:s=>z(s.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(me,{placeholder:"Filter by roles",data:p,value:$,onChange:s=>z(void 0,s),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),T&&T.length===0?e.jsx(t,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(je,{children:e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Name"}),e.jsx(a.Th,{children:"Roles"}),e.jsx(a.Th,{children:"Heap Usage"}),e.jsx(a.Th,{children:"Disk Usage"}),e.jsx(a.Th,{children:"CPU"})]})}),e.jsx(a.Tbody,{children:T==null?void 0:T.map(s=>e.jsxs(a.Tr,{style:{cursor:"pointer"},onClick:()=>E(`/cluster/${d}/nodes/${s.id}`),children:[e.jsxs(a.Td,{children:[e.jsx(t,{size:"sm",fw:500,children:s.name}),s.ip&&e.jsx(t,{size:"xs",c:"dimmed",children:s.ip})]}),e.jsx(a.Td,{children:e.jsx(h,{gap:"xs",children:s.roles.map(m=>e.jsx(P,{size:"sm",variant:"light",children:m},m))})}),e.jsx(a.Td,{children:e.jsxs(C,{gap:4,children:[e.jsx(de,{value:H(s.heapUsed,s.heapMax),color:H(s.heapUsed,s.heapMax)>90?"red":"blue",size:"sm"}),e.jsxs(t,{size:"xs",c:"dimmed",children:[O(s.heapUsed)," / ",O(s.heapMax)]})]})}),e.jsx(a.Td,{children:e.jsxs(C,{gap:4,children:[e.jsx(de,{value:H(s.diskUsed,s.diskTotal),color:H(s.diskUsed,s.diskTotal)>90?"red":"blue",size:"sm"}),e.jsxs(t,{size:"xs",c:"dimmed",children:[O(s.diskUsed)," / ",O(s.diskTotal)]})]})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:s.cpuPercent!==void 0?`${s.cpuPercent}%`:"N/A"})})]},s.id))})]})})]})}function Ve({indices:o,loading:l,error:w}){var g,u;const{id:d}=xe(),E=ve(),v=fe(),[k,n]=ne(),$=k.get("indicesSearch")||"",A=((g=k.get("health"))==null?void 0:g.split(",").filter(Boolean))||[],z=((u=k.get("status"))==null?void 0:u.split(",").filter(Boolean))||[],p=k.get("expanded")==="true",T=k.get("sort")!=="desc",I=k.get("affected")==="true",s=pe($,300),{data:m}=X({queryKey:["cluster",d,"shards"],queryFn:()=>N.getShards(d),enabled:!!d}),{data:x}=X({queryKey:["cluster",d,"settings"],queryFn:async()=>await N.proxyRequest(d,"GET","/_cluster/settings"),enabled:!!d}),M=(()=>{var Se,Ce;if(!x)return!0;const r=x.transient,c=x.persistent,y=r==null?void 0:r.cluster,L=c==null?void 0:c.cluster,J=y==null?void 0:y.routing,te=L==null?void 0:L.routing,ae=(Se=J==null?void 0:J.allocation)==null?void 0:Se.enable,oe=(Ce=te==null?void 0:te.allocation)==null?void 0:Ce.enable;return(ae||oe||"all")==="all"})(),S=B({mutationFn:()=>N.proxyRequest(d,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{v.invalidateQueries({queryKey:["cluster",d,"settings"]}),b.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:r=>{b.show({title:"Error",message:`Failed to enable shard allocation: ${r.message}`,color:"red"})}}),D=B({mutationFn:r=>N.proxyRequest(d,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":r}}),onSuccess:()=>{v.invalidateQueries({queryKey:["cluster",d,"settings"]}),b.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:r=>{b.show({title:"Error",message:`Failed to disable shard allocation: ${r.message}`,color:"red"})}}),U=(r,c,y)=>{const L=new URLSearchParams(k);r!==void 0&&(r?L.set("indicesSearch",r):L.delete("indicesSearch")),c!==void 0&&(c.length>0?L.set("health",c.join(",")):L.delete("health")),y!==void 0&&(y.length>0?L.set("status",y.join(",")):L.delete("status")),n(L)},F=(r,c)=>{const y=new URLSearchParams(k);c===""||c===!1?y.delete(r):y.set(r,String(c)),n(y)},re=(m==null?void 0:m.reduce((r,c)=>(r[c.index]||(r[c.index]=[]),r[c.index].push(c),r),{}))||{},K=(m==null?void 0:m.filter(r=>r.state==="UNASSIGNED"))||[],f=K.reduce((r,c)=>(r[c.index]||(r[c.index]=[]),r[c.index].push(c),r),{}),Z=r=>(re[r]||[]).some(y=>y.state==="UNASSIGNED"||y.state==="RELOCATING"||y.state==="INITIALIZING");let q=o==null?void 0:o.filter(r=>{const c=r.name.toLowerCase().includes(s.toLowerCase()),y=A.length===0||A.includes(r.health),L=z.length===0||z.includes(r.status),J=!I||Z(r.name);return c&&y&&L&&J});if(q&&(q=[...q].sort((r,c)=>T?r.name.localeCompare(c.name):c.name.localeCompare(r.name))),l)return e.jsx(h,{justify:"center",py:"xl",children:e.jsx(ie,{})});if(w)return e.jsxs(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",w.message]});if(!o||o.length===0)return e.jsxs(C,{gap:"md",align:"center",py:"xl",children:[e.jsx(t,{c:"dimmed",children:"No indices found"}),d&&e.jsx(Y,{leftSection:e.jsx(Te,{size:16}),onClick:()=>E(`/cluster/${d}/indices/create`),children:"Create Index"})]});const i=K.length>0;return e.jsxs(C,{gap:"md",children:[e.jsxs(h,{justify:"space-between",wrap:"wrap",children:[e.jsxs(h,{children:[M?e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(R,{label:"Disable shard allocation",children:e.jsx(G,{size:"lg",variant:"subtle",color:"green",loading:D.isPending,children:e.jsx(ke,{size:20})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Disable Allocation"}),e.jsx(j.Item,{onClick:()=>D.mutate("none"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"None (default)"})]})}),e.jsx(j.Item,{onClick:()=>D.mutate("primaries"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"Primaries only"})]})}),e.jsx(j.Item,{onClick:()=>D.mutate("new_primaries"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(R,{label:"Enable shard allocation",children:e.jsx(G,{size:"lg",variant:"subtle",color:"red",onClick:()=>S.mutate(),loading:S.isPending,children:e.jsx(_,{size:20})})}),e.jsx(R,{label:p?"Compress view":"Expand view",children:e.jsx(G,{size:"lg",variant:"subtle",onClick:()=>F("expanded",!p),children:p?e.jsx($e,{size:20}):e.jsx(Me,{size:20})})}),e.jsx(R,{label:T?"Sort descending":"Sort ascending",children:e.jsx(G,{size:"lg",variant:"subtle",onClick:()=>F("sort",T?"desc":"asc"),children:T?e.jsx(Oe,{size:20}):e.jsx(Re,{size:20})})}),e.jsx(R,{label:"Refresh data",children:e.jsx(G,{size:"lg",variant:"subtle",onClick:()=>{v.invalidateQueries({queryKey:["cluster",d,"indices"]}),v.invalidateQueries({queryKey:["cluster",d,"shards"]}),v.invalidateQueries({queryKey:["cluster",d,"settings"]})},children:e.jsx(ye,{size:20})})})]}),e.jsxs(h,{style:{flex:1},children:[e.jsx(le,{placeholder:"Search indices...",leftSection:e.jsx(ge,{size:16}),value:$,onChange:r=>U(r.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(me,{placeholder:"Health",data:["green","yellow","red"],value:A,onChange:r=>U(void 0,r,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(me,{placeholder:"Status",data:["open","close"],value:z,onChange:r=>U(void 0,void 0,r),clearable:!0,style:{maxWidth:150}}),i&&e.jsx(he,{label:"Show only affected",checked:I,onChange:r=>F("affected",r.currentTarget.checked)})]}),d&&e.jsx(Y,{leftSection:e.jsx(Te,{size:16}),onClick:()=>E(`/cluster/${d}/indices/create`),children:"Create Index"})]}),K.length>0&&e.jsxs(V,{shadow:"sm",padding:"lg",style:{backgroundColor:"var(--mantine-color-red-0)",border:"2px solid var(--mantine-color-red-3)"},children:[e.jsxs(h,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Ie,{order:4,children:"Unassigned Shards"}),e.jsxs(t,{size:"sm",c:"dimmed",children:[K.length," shard",K.length>1?"s":""," not allocated to any node"]})]}),e.jsx(P,{size:"lg",color:"red",variant:"filled",children:K.length})]}),e.jsx(C,{gap:"md",children:Object.entries(f).filter(([r])=>!(s&&!r.toLowerCase().includes(s.toLowerCase()))).sort(([r],[c])=>T?r.localeCompare(c):c.localeCompare(r)).map(([r,c])=>e.jsx(V,{shadow:"xs",padding:"sm",withBorder:!0,style:{backgroundColor:"white"},children:e.jsxs(C,{gap:"xs",children:[e.jsxs(h,{justify:"space-between",children:[e.jsx(t,{size:"sm",fw:500,style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>E(`/cluster/${d}/indices/${encodeURIComponent(r)}/edit`),children:r}),e.jsxs(P,{size:"sm",color:"red",variant:"light",children:[c.length," unassigned"]})]}),e.jsx(h,{gap:"xs",children:c.map((y,L)=>e.jsx(R,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",y.shard]}),e.jsxs("div",{children:["Type: ",y.primary?"Primary":"Replica"]}),e.jsx("div",{children:"State: UNASSIGNED"})]}),children:e.jsx(P,{size:"lg",variant:y.primary?"filled":"light",color:"red",children:y.shard})},`unassigned-${y.index}-${y.shard}-${L}`))})]})},r))})]}),q&&q.length===0?e.jsx(t,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(je,{children:e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Name"}),e.jsx(a.Th,{children:"Health"}),e.jsx(a.Th,{children:"Status"}),e.jsx(a.Th,{children:"Documents"}),e.jsx(a.Th,{children:"Size"}),e.jsx(a.Th,{children:"Shards"}),p&&e.jsx(a.Th,{children:"Primaries"}),p&&e.jsx(a.Th,{children:"Replicas"}),e.jsx(a.Th,{children:"Actions"})]})}),e.jsx(a.Tbody,{children:q==null?void 0:q.map(r=>e.jsxs(a.Tr,{style:{cursor:"pointer"},onClick:()=>E(`/cluster/${d}/indices/${encodeURIComponent(r.name)}/edit`),children:[e.jsx(a.Td,{children:e.jsxs(C,{gap:2,children:[e.jsx(t,{size:"sm",fw:500,style:{textDecoration:"underline"},children:r.name}),p&&Z(r.name)&&e.jsx(P,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",color:be(r.health),children:r.health})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",variant:"light",color:r.status==="open"?"green":"gray",children:r.status})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:r.docsCount.toLocaleString()})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:O(r.storeSize)})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:p?`${r.primaryShards+r.replicaShards}`:`${r.primaryShards}p / ${r.replicaShards}r`})}),p&&e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:r.primaryShards})}),p&&e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:r.replicaShards})}),e.jsx(a.Td,{onClick:c=>c.stopPropagation(),children:e.jsxs(h,{gap:"xs",children:[d&&e.jsx(We,{clusterId:d,index:r}),e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(G,{variant:"subtle",color:"gray",children:e.jsx(Ee,{size:16})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Index Management"}),e.jsx(j.Item,{leftSection:e.jsx(Ne,{size:14}),onClick:c=>{c.stopPropagation(),E(`/cluster/${d}/indices/${encodeURIComponent(r.name)}/edit?tab=settings`)},children:"Settings"}),e.jsx(j.Item,{leftSection:e.jsx(Le,{size:14}),onClick:c=>{c.stopPropagation(),E(`/cluster/${d}/indices/${encodeURIComponent(r.name)}/edit?tab=mappings`)},children:"Mappings"})]})]})]})})]},r.name))})]})})]})}function He({nodes:o,indices:l,shards:w,loading:d,error:E}){const{id:v}=xe(),k=ve(),n=fe(),[$,A]=ne(),z=$.get("overviewSearch")||"",p=$.get("showClosed")==="true",T=$.get("showSpecial")==="true",I=$.get("overviewExpanded")==="true",s=$.get("overviewAffected")==="true",m=pe(z,300),x=(i,g)=>{const u=new URLSearchParams($);g===""||g===!1?u.delete(i):u.set(i,String(g)),A(u)},{data:M}=X({queryKey:["cluster",v,"settings"],queryFn:async()=>await N.proxyRequest(v,"GET","/_cluster/settings"),enabled:!!v}),S=(()=>{var ae,oe;if(!M)return!0;const i=M.transient,g=M.persistent,u=i==null?void 0:i.cluster,r=g==null?void 0:g.cluster,c=u==null?void 0:u.routing,y=r==null?void 0:r.routing,L=(ae=c==null?void 0:c.allocation)==null?void 0:ae.enable,J=(oe=y==null?void 0:y.allocation)==null?void 0:oe.enable;return(L||J||"all")==="all"})(),D=B({mutationFn:()=>N.proxyRequest(v,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",v,"settings"]}),b.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:i=>{b.show({title:"Error",message:`Failed to enable shard allocation: ${i.message}`,color:"red"})}}),U=B({mutationFn:i=>N.proxyRequest(v,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":i}}),onSuccess:()=>{n.invalidateQueries({queryKey:["cluster",v,"settings"]}),b.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:i=>{b.show({title:"Error",message:`Failed to disable shard allocation: ${i.message}`,color:"red"})}});if(d)return e.jsx(h,{justify:"center",py:"xl",children:e.jsx(ie,{})});if(E)return e.jsxs(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",E.message]});if(!o||!l||!w||o.length===0||l.length===0)return e.jsx(C,{gap:"md",align:"center",py:"xl",children:e.jsx(t,{c:"dimmed",children:"No shard allocation data available"})});const F=w.filter(i=>i.state==="UNASSIGNED"),re=F.reduce((i,g)=>(i[g.index]||(i[g.index]=[]),i[g.index].push(g),i),{}),K=i=>w.filter(u=>u.index===i).some(u=>u.state==="UNASSIGNED"||u.state==="RELOCATING"||u.state==="INITIALIZING");let f=l.filter(i=>{const g=i.name.toLowerCase().includes(m.toLowerCase()),u=p||i.status==="open",r=T||!i.name.startsWith("."),c=!s||K(i.name);return g&&u&&r&&c});const Z=new Map;o.forEach(i=>{Z.set(i.id,i.name),Z.set(i.name,i.name),i.ip&&Z.set(i.ip,i.name)});const q=new Map;return w.forEach(i=>{if(!i.node)return;const g=Z.get(i.node);if(!g)return;q.has(g)||q.set(g,new Map);const u=q.get(g);u.has(i.index)||u.set(i.index,[]),u.get(i.index).push(i)}),e.jsxs(C,{gap:"md",children:[e.jsxs(h,{justify:"space-between",wrap:"wrap",children:[e.jsxs(h,{children:[S?e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(R,{label:"Disable shard allocation",children:e.jsx(G,{size:"lg",variant:"subtle",color:"green",loading:U.isPending,children:e.jsx(ke,{size:20})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Disable Allocation"}),e.jsx(j.Item,{onClick:()=>U.mutate("none"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"None (default)"})]})}),e.jsx(j.Item,{onClick:()=>U.mutate("primaries"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"Primaries only"})]})}),e.jsx(j.Item,{onClick:()=>U.mutate("new_primaries"),children:e.jsxs(h,{gap:"xs",children:[e.jsx(_,{size:14}),e.jsx(t,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(R,{label:"Enable shard allocation",children:e.jsx(G,{size:"lg",variant:"subtle",color:"red",onClick:()=>D.mutate(),loading:D.isPending,children:e.jsx(_,{size:20})})}),e.jsx(R,{label:I?"Compress view":"Expand view",children:e.jsx(G,{size:"lg",variant:"subtle",onClick:()=>x("overviewExpanded",!I),children:I?e.jsx($e,{size:20}):e.jsx(Me,{size:20})})}),e.jsx(R,{label:"Refresh data",children:e.jsx(G,{size:"lg",variant:"subtle",onClick:()=>{n.invalidateQueries({queryKey:["cluster",v,"shards"]}),n.invalidateQueries({queryKey:["cluster",v,"nodes"]}),n.invalidateQueries({queryKey:["cluster",v,"indices"]}),n.invalidateQueries({queryKey:["cluster",v,"settings"]})},children:e.jsx(ye,{size:20})})})]}),e.jsxs(h,{style:{flex:1},children:[e.jsx(le,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(ge,{size:16}),value:z,onChange:i=>x("overviewSearch",i.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(h,{gap:"md",children:[e.jsxs(h,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-closed",checked:p,onChange:i=>x("showClosed",i.target.checked)}),e.jsxs(t,{size:"sm",component:"label",htmlFor:"overview-show-closed",style:{cursor:"pointer"},children:["closed (",l.filter(i=>i.status!=="open").length,")"]})]}),e.jsxs(h,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-special",checked:T,onChange:i=>x("showSpecial",i.target.checked)}),e.jsxs(t,{size:"sm",component:"label",htmlFor:"overview-show-special",style:{cursor:"pointer"},children:["special (",l.filter(i=>i.name.startsWith(".")).length,")"]})]}),F.length>0&&e.jsx(he,{label:"Show only affected",checked:s,onChange:i=>x("overviewAffected",i.currentTarget.checked)}),e.jsxs(t,{size:"sm",c:"dimmed",children:[f.length," of ",l.length]})]})]})]}),e.jsxs(h,{gap:"md",children:[e.jsxs(t,{size:"sm",children:[e.jsx(t,{component:"span",fw:700,children:o.length})," nodes"]}),e.jsxs(t,{size:"sm",children:[e.jsx(t,{component:"span",fw:700,children:f.length})," indices"]}),e.jsxs(t,{size:"sm",children:[e.jsx(t,{component:"span",fw:700,children:w.length})," shards"]}),F.length>0&&e.jsxs(P,{color:"red",variant:"filled",children:[F.length," unassigned"]})]}),e.jsx(je,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(a,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),f.map(i=>e.jsx(a.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(C,{gap:4,children:[e.jsx(t,{size:"xs",fw:500,truncate:"end",title:i.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:g=>{g.stopPropagation(),k(`/cluster/${v}/indices/${encodeURIComponent(i.name)}/edit`)},children:i.name}),e.jsxs(h,{gap:4,justify:"center",children:[e.jsxs(P,{size:"xs",color:be(i.health),variant:"dot",children:[i.primaryShards,"Ã—",i.replicaShards+1]}),e.jsx(t,{size:"xs",c:"dimmed",children:O(i.storeSize)})]})]})},i.name))]})}),e.jsxs(a.Tbody,{children:[F.length>0&&e.jsxs(a.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(a.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(C,{gap:2,children:[e.jsx(t,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(P,{size:"xs",color:"red",variant:"filled",children:F.length})]})}),f.map(i=>{const g=re[i.name]||[];return e.jsx(a.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:"var(--mantine-color-red-0)"},children:g.length>0?e.jsx(h,{gap:2,justify:"center",wrap:"wrap",children:g.map((u,r)=>e.jsx(R,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",u.shard]}),e.jsxs("div",{children:["Type: ",u.primary?"Primary":"Replica"]}),e.jsx("div",{children:"State: UNASSIGNED"})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:u.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)"},children:u.shard})},`unassigned-${u.index}-${u.shard}-${r}`))}):e.jsx(t,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${i.name}`)})]}),o.map(i=>{const g=q.get(i.name);return e.jsxs(a.Tr,{children:[e.jsx(a.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(C,{gap:4,children:[e.jsx(h,{gap:4,children:e.jsx(t,{size:"xs",fw:500,truncate:"end",title:i.name,children:i.name})}),e.jsx(t,{size:"xs",c:"dimmed",truncate:"end",title:i.ip,children:i.ip}),I&&e.jsxs(e.Fragment,{children:[e.jsx(h,{gap:4,wrap:"wrap",children:i.roles.map(u=>e.jsx(P,{size:"xs",variant:"light",color:"gray",children:u},u))}),e.jsxs(h,{gap:4,wrap:"wrap",children:[e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:i.id.substring(0,8)}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:i.roles.length}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:O(i.heapMax)}),e.jsx(P,{size:"xs",color:"teal",variant:"filled",children:O(i.diskTotal)}),i.cpuPercent!==void 0&&e.jsxs(P,{size:"xs",color:"teal",variant:"filled",children:[i.cpuPercent,"%"]})]})]})]})}),f.map(u=>{const r=(g==null?void 0:g.get(u.name))||[];return e.jsx(a.Td,{style:{padding:"4px",textAlign:"center"},children:r.length>0?e.jsx(h,{gap:2,justify:"center",wrap:"wrap",children:r.map((c,y)=>e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:c.state==="STARTED"?c.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":c.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:c.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)"},title:`Shard ${c.shard} (${c.primary?"Primary":"Replica"}) - ${c.state}`,children:c.shard},`${c.shard}-${c.primary}-${y}`))}):e.jsx(t,{size:"xs",c:"dimmed",children:"-"})},`${i.id}-${u.name}`)})]},i.id)})]})]})})})]})}function _e({shards:o,loading:l,error:w}){var I;const[d,E]=ne(),v=d.get("shardsSearch")||"",k=((I=d.get("shardStates"))==null?void 0:I.split(",").filter(Boolean))||[],n=d.get("primaryOnly")==="true",$=d.get("replicaOnly")==="true",A=pe(v,300),z=(s,m,x,M)=>{const S=new URLSearchParams(d);s!==void 0&&(s?S.set("shardsSearch",s):S.delete("shardsSearch")),m!==void 0&&(m.length>0?S.set("shardStates",m.join(",")):S.delete("shardStates")),x!==void 0&&(x?(S.set("primaryOnly","true"),S.delete("replicaOnly")):S.delete("primaryOnly")),M!==void 0&&(M?(S.set("replicaOnly","true"),S.delete("primaryOnly")):S.delete("replicaOnly")),E(S)},p=o==null?void 0:o.filter(s=>{var S;const m=s.index.toLowerCase().includes(A.toLowerCase())||((S=s.node)==null?void 0:S.toLowerCase().includes(A.toLowerCase())),x=k.length===0||k.includes(s.state),M=!n&&!$||n&&s.primary||$&&!s.primary;return m&&x&&M});if(l)return e.jsx(h,{justify:"center",py:"xl",children:e.jsx(ie,{})});if(w)return e.jsxs(ee,{icon:e.jsx(se,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",w.message]});if(!o||o.length===0)return e.jsx(t,{c:"dimmed",children:"No shards found"});const T=(p||[]).reduce((s,m)=>(s[m.state]||(s[m.state]=[]),s[m.state].push(m),s),{});return e.jsxs(C,{gap:"md",children:[e.jsxs(h,{wrap:"wrap",children:[e.jsx(le,{placeholder:"Search by index or node...",leftSection:e.jsx(ge,{size:16}),value:v,onChange:s=>z(s.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(me,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:k,onChange:s=>z(void 0,s,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(h,{gap:"md",children:[e.jsx(he,{label:"Primary only",checked:n,onChange:s=>z(void 0,void 0,s.currentTarget.checked,void 0)}),e.jsx(he,{label:"Replica only",checked:$,onChange:s=>z(void 0,void 0,void 0,s.currentTarget.checked)})]})]}),e.jsx(Q,{children:Object.entries(T).map(([s,m])=>e.jsx(Q.Col,{span:{base:12,sm:6,md:3},children:e.jsx(V,{shadow:"sm",padding:"md",children:e.jsxs(C,{gap:"xs",children:[e.jsx(t,{size:"sm",c:"dimmed",children:s}),e.jsx(t,{size:"xl",fw:700,children:m.length})]})})},s))}),p&&p.length===0?e.jsx(t,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(je,{children:[e.jsxs(a,{striped:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Index"}),e.jsx(a.Th,{children:"Shard"}),e.jsx(a.Th,{children:"Type"}),e.jsx(a.Th,{children:"State"}),e.jsx(a.Th,{children:"Node"}),e.jsx(a.Th,{children:"Documents"}),e.jsx(a.Th,{children:"Size"})]})}),e.jsx(a.Tbody,{children:p==null?void 0:p.slice(0,100).map((s,m)=>{var x;return e.jsxs(a.Tr,{children:[e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:s.index})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:s.shard})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",variant:"light",color:s.primary?"blue":"gray",children:s.primary?"Primary":"Replica"})}),e.jsx(a.Td,{children:e.jsx(P,{size:"sm",color:s.state==="STARTED"?"green":s.state==="UNASSIGNED"?"red":"yellow",children:s.state})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:s.node||"N/A"})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:((x=s.docs)==null?void 0:x.toLocaleString())||"N/A"})}),e.jsx(a.Td,{children:e.jsx(t,{size:"sm",children:s.store?O(s.store):"N/A"})})]},`${s.index}-${s.shard}-${m}`)})})]}),p&&p.length>100&&e.jsxs(t,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",p.length," shards"]})]})]})}export{js as ClusterView};
