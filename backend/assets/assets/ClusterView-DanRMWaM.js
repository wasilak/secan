import{c as G,r as F,h as ae,i as Z,n as x,f as w,j as e,M as g,k as te,l as se,m as de,o as _,S as d,d as l,G as u,p as H,a as oe,b as Q,A as U,I as O,L as B,T as ce,q as V,s as q,e as n,u as re,t as ee,v as he,w as me}from"./index-BExQHbQo.js";import{u as P}from"./useMutation-D-paNpol.js";import{u as xe}from"./accessibility-Dn2DcQ1R.js";import{I as ue}from"./IconRefresh-CQ_6k7bl.js";import{I as je}from"./IconDeviceFloppy-hPYKUaZU.js";import{I as ge}from"./IconTrash-DKgZnZcf.js";import{T as K}from"./TextInput-CE3EhnGH.js";import{B as A}from"./Button-Du0cSXcd.js";import{N as pe}from"./NumberInput-DpVjScWu.js";import{B as E}from"./Badge-BkOEm2nW.js";import{G as M}from"./Grid-BV_YNeaO.js";import{C as L}from"./Card-Diy8fddq.js";import{P as W}from"./Progress-Dx_Gu-DF.js";import{T as $}from"./Tabs-CPm3CslG.js";import"./InputBase-B6iHbOyR.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./get-safe-id-Bp3H8K0-.js";var ne=G("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),fe=G("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),ye=G("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),Te=G("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);function J(i,r=300){const[o,c]=F.useState(i);return F.useEffect(()=>{const s=setTimeout(()=>{c(i)},r);return()=>{clearTimeout(s)}},[i,r]),o}function Se({clusterId:i,index:r}){const o=ae(),{announceSuccess:c,announceError:s}=xe(),[m,{open:C,close:p}]=Z(!1),[j,{open:a,close:f}]=Z(!1),[N,z]=F.useState(""),[T,S]=F.useState(1),t=P({mutationFn:()=>w.openIndex(i,r.name),onMutate:()=>{x.show({id:`open-${r.name}`,title:"Opening index",message:`Opening index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`open-${r.name}`,title:"Success",message:`Index ${r.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),c(`Index ${r.name} opened successfully`),o.invalidateQueries({queryKey:["cluster",i,"indices"]})},onError:h=>{x.update({id:`open-${r.name}`,title:"Error",message:`Failed to open index: ${h.message}`,color:"red",loading:!1,autoClose:5e3}),s(`Failed to open index: ${h.message}`)}}),y=P({mutationFn:()=>w.closeIndex(i,r.name),onMutate:()=>{x.show({id:`close-${r.name}`,title:"Closing index",message:`Closing index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`close-${r.name}`,title:"Success",message:`Index ${r.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),o.invalidateQueries({queryKey:["cluster",i,"indices"]})},onError:h=>{x.update({id:`close-${r.name}`,title:"Error",message:`Failed to close index: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),b=P({mutationFn:()=>w.deleteIndex(i,r.name),onMutate:()=>{x.show({id:`delete-${r.name}`,title:"Deleting index",message:`Deleting index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`delete-${r.name}`,title:"Success",message:`Index ${r.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),o.invalidateQueries({queryKey:["cluster",i,"indices"]}),p(),z("")},onError:h=>{x.update({id:`delete-${r.name}`,title:"Error",message:`Failed to delete index: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),D=P({mutationFn:h=>w.forceMergeIndex(i,r.name,h),onMutate:()=>{x.show({id:`forcemerge-${r.name}`,title:"Force merging index",message:`Force merging index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`forcemerge-${r.name}`,title:"Success",message:`Index ${r.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),f(),S(1)},onError:h=>{x.update({id:`forcemerge-${r.name}`,title:"Error",message:`Failed to force merge index: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),v=P({mutationFn:()=>w.clearCacheIndex(i,r.name),onMutate:()=>{x.show({id:`clearcache-${r.name}`,title:"Clearing cache",message:`Clearing cache for index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`clearcache-${r.name}`,title:"Success",message:`Cache cleared for index ${r.name}`,color:"green",loading:!1,autoClose:3e3})},onError:h=>{x.update({id:`clearcache-${r.name}`,title:"Error",message:`Failed to clear cache: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),R=P({mutationFn:()=>w.refreshIndex(i,r.name),onMutate:()=>{x.show({id:`refresh-${r.name}`,title:"Refreshing index",message:`Refreshing index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`refresh-${r.name}`,title:"Success",message:`Index ${r.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:h=>{x.update({id:`refresh-${r.name}`,title:"Error",message:`Failed to refresh index: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),Y=P({mutationFn:()=>w.flushIndex(i,r.name),onMutate:()=>{x.show({id:`flush-${r.name}`,title:"Flushing index",message:`Flushing index ${r.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{x.update({id:`flush-${r.name}`,title:"Success",message:`Index ${r.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:h=>{x.update({id:`flush-${r.name}`,title:"Error",message:`Failed to flush index: ${h.message}`,color:"red",loading:!1,autoClose:5e3})}}),ie=()=>{N===r.name&&b.mutate()},le=()=>{const h=typeof T=="number"?T:parseInt(T,10);!isNaN(h)&&h>0&&D.mutate(h)};return e.jsxs(e.Fragment,{children:[e.jsxs(g,{shadow:"md",width:200,children:[e.jsx(g.Target,{children:e.jsx(te,{label:"Index operations",children:e.jsx(se,{variant:"subtle",color:"gray","aria-label":`Operations for index ${r.name}`,children:e.jsx(ne,{size:16,"aria-hidden":"true"})})})}),e.jsxs(g.Dropdown,{children:[e.jsx(g.Label,{children:"Index Operations"}),r.status==="close"?e.jsx(g.Item,{leftSection:e.jsx(Te,{size:14,"aria-hidden":"true"}),onClick:()=>t.mutate(),disabled:t.isPending,children:"Open Index"}):e.jsx(g.Item,{leftSection:e.jsx(ye,{size:14,"aria-hidden":"true"}),onClick:()=>y.mutate(),disabled:y.isPending,children:"Close Index"}),e.jsx(g.Item,{leftSection:e.jsx(ue,{size:14,"aria-hidden":"true"}),onClick:()=>R.mutate(),disabled:R.isPending,children:"Refresh"}),e.jsx(g.Item,{leftSection:e.jsx(je,{size:14,"aria-hidden":"true"}),onClick:()=>Y.mutate(),disabled:Y.isPending,children:"Flush"}),e.jsx(g.Item,{leftSection:e.jsx(fe,{size:14,"aria-hidden":"true"}),onClick:()=>v.mutate(),disabled:v.isPending,children:"Clear Cache"}),e.jsx(g.Item,{leftSection:e.jsx(de,{size:14,"aria-hidden":"true"}),onClick:a,children:"Force Merge"}),e.jsx(g.Divider,{}),e.jsx(g.Item,{leftSection:e.jsx(ge,{size:14,"aria-hidden":"true"}),color:"red",onClick:C,children:"Delete Index"})]})]}),e.jsx(_,{opened:m,onClose:()=>{p(),z("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(d,{gap:"md",children:[e.jsxs(l,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(l,{span:!0,fw:700,children:r.name}),"? This action cannot be undone."]}),e.jsx(l,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(K,{placeholder:r.name,value:N,onChange:h=>z(h.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(u,{justify:"flex-end",children:[e.jsx(A,{variant:"default",onClick:()=>{p(),z("")},children:"Cancel"}),e.jsx(A,{color:"red",onClick:ie,disabled:N!==r.name||b.isPending,loading:b.isPending,"aria-label":`Delete index ${r.name}`,children:"Delete"})]})]})}),e.jsx(_,{opened:j,onClose:()=>{f(),S(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(d,{gap:"md",children:[e.jsxs(l,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(l,{span:!0,fw:700,children:r.name})," to reduce the number of segments."]}),e.jsx(pe,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:T,onChange:S,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(u,{justify:"flex-end",children:[e.jsx(A,{variant:"default",onClick:()=>{f(),S(1)},children:"Cancel"}),e.jsx(A,{onClick:le,disabled:D.isPending,loading:D.isPending,"aria-label":`Force merge index ${r.name}`,children:"Force Merge"})]})]})})]})}function X(i){switch(i){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function I(i){if(i===0)return"0 B";const r=1024,o=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(i)/Math.log(r));return`${(i/Math.pow(r,c)).toFixed(2)} ${o[c]}`}function k(i,r){return r===0?0:Math.round(i/r*100)}function Qe(){var y,b;const{id:i}=H(),{preferences:r}=oe(),[o,c]=F.useState("overview"),{data:s,isLoading:m,error:C}=Q({queryKey:["cluster",i,"stats"],queryFn:()=>w.getClusterStats(i),refetchInterval:r.refreshInterval,enabled:!!i}),{data:p,isLoading:j,error:a}=Q({queryKey:["cluster",i,"nodes"],queryFn:()=>w.getNodes(i),refetchInterval:r.refreshInterval,enabled:!!i}),{data:f,isLoading:N,error:z}=Q({queryKey:["cluster",i,"indices"],queryFn:()=>w.getIndices(i),refetchInterval:r.refreshInterval,enabled:!!i}),{data:T,isLoading:S,error:t}=Q({queryKey:["cluster",i,"shards"],queryFn:()=>w.getShards(i),refetchInterval:r.refreshInterval,enabled:!!i});return i?m?e.jsx(d,{p:"md",children:e.jsx(u,{justify:"center",mt:"xl",children:e.jsx(B,{size:"lg"})})}):C?e.jsx(d,{p:"md",children:e.jsxs(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",C.message]})}):e.jsxs(d,{gap:"md",p:"md",children:[e.jsxs(u,{justify:"space-between",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(ce,{order:1,className:"text-responsive-xl",children:(s==null?void 0:s.clusterName)||i}),e.jsx(l,{size:"sm",c:"dimmed",children:"Cluster Overview"})]}),e.jsx(u,{children:e.jsx(E,{size:"lg",color:X((s==null?void 0:s.health)||"red"),children:((y=s==null?void 0:s.health)==null?void 0:y.toUpperCase())||"UNKNOWN"})})]}),e.jsxs(M,{children:[e.jsx(M.Col,{span:{base:12,sm:6,md:3},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(l,{size:"xl",fw:700,children:(s==null?void 0:s.numberOfNodes)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(s==null?void 0:s.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(M.Col,{span:{base:12,sm:6,md:3},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(l,{size:"xl",fw:700,children:(s==null?void 0:s.numberOfIndices)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[((b=s==null?void 0:s.numberOfDocuments)==null?void 0:b.toLocaleString())||0," documents"]})]})})}),e.jsx(M.Col,{span:{base:12,sm:6,md:3},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(l,{size:"xl",fw:700,children:(s==null?void 0:s.activeShards)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(s==null?void 0:s.activePrimaryShards)||0," primary"]})]})})}),e.jsx(M.Col,{span:{base:12,sm:6,md:3},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(l,{size:"xl",fw:700,c:s!=null&&s.unassignedShards?"red":void 0,children:(s==null?void 0:s.unassignedShards)||0}),e.jsxs(l,{size:"xs",c:"dimmed",children:[(s==null?void 0:s.relocatingShards)||0," relocating"]})]})})})]}),((s==null?void 0:s.memoryTotal)||(s==null?void 0:s.diskTotal))&&e.jsxs(M,{children:[(s==null?void 0:s.memoryTotal)&&e.jsx(M.Col,{span:{base:12,md:6},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(W,{value:k(s.memoryUsed||0,s.memoryTotal),color:k(s.memoryUsed||0,s.memoryTotal)>90?"red":"blue",size:"lg"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[I(s.memoryUsed||0)," / ",I(s.memoryTotal)," (",k(s.memoryUsed||0,s.memoryTotal),"%)"]})]})})}),(s==null?void 0:s.diskTotal)&&e.jsx(M.Col,{span:{base:12,md:6},children:e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(W,{value:k(s.diskUsed||0,s.diskTotal),color:k(s.diskUsed||0,s.diskTotal)>90?"red":"blue",size:"lg"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[I(s.diskUsed||0)," / ",I(s.diskTotal)," (",k(s.diskUsed||0,s.diskTotal),"%)"]})]})})})]}),e.jsx(L,{shadow:"sm",padding:"lg",children:e.jsxs($,{value:o,onChange:c,children:[e.jsxs($.List,{children:[e.jsx($.Tab,{value:"overview",children:"Overview"}),e.jsxs($.Tab,{value:"nodes",children:["Nodes (",(p==null?void 0:p.length)||0,")"]}),e.jsxs($.Tab,{value:"indices",children:["Indices (",(f==null?void 0:f.length)||0,")"]}),e.jsxs($.Tab,{value:"shards",children:["Shards (",(T==null?void 0:T.length)||0,")"]})]}),e.jsx($.Panel,{value:"overview",pt:"md",children:e.jsx(ze,{nodes:p,indices:f,shards:T,loading:j||N||S,error:a||z||t})}),e.jsx($.Panel,{value:"nodes",pt:"md",children:e.jsx(Ce,{nodes:p,loading:j,error:a})}),e.jsx($.Panel,{value:"indices",pt:"md",children:e.jsx(ve,{indices:f,loading:N,error:z})}),e.jsx($.Panel,{value:"shards",pt:"md",children:e.jsx(be,{shards:T,loading:S,error:t})})]})})]}):e.jsx(d,{p:"md",children:e.jsx(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function Ce({nodes:i,loading:r,error:o}){const{id:c}=H(),s=re(),[m,C]=F.useState(""),p=J(m,300),j=i==null?void 0:i.filter(a=>{var f;return a.name.toLowerCase().includes(p.toLowerCase())||((f=a.ip)==null?void 0:f.toLowerCase().includes(p.toLowerCase()))});return r?e.jsx(u,{justify:"center",py:"xl",children:e.jsx(B,{})}):o?e.jsxs(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",o.message]}):!i||i.length===0?e.jsx(l,{c:"dimmed",children:"No nodes found"}):e.jsxs(d,{gap:"md",children:[e.jsx(K,{placeholder:"Search nodes...",leftSection:e.jsx(V,{size:16}),value:m,onChange:a=>C(a.currentTarget.value),style:{maxWidth:400}}),j&&j.length===0?e.jsx(l,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your search"}):e.jsx(q,{children:e.jsxs(n,{striped:!0,highlightOnHover:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{children:"Name"}),e.jsx(n.Th,{children:"Roles"}),e.jsx(n.Th,{children:"Heap Usage"}),e.jsx(n.Th,{children:"Disk Usage"}),e.jsx(n.Th,{children:"CPU"})]})}),e.jsx(n.Tbody,{children:j==null?void 0:j.map(a=>e.jsxs(n.Tr,{style:{cursor:"pointer"},onClick:()=>s(`/cluster/${c}/nodes/${a.id}`),children:[e.jsxs(n.Td,{children:[e.jsx(l,{size:"sm",fw:500,children:a.name}),a.ip&&e.jsx(l,{size:"xs",c:"dimmed",children:a.ip})]}),e.jsx(n.Td,{children:e.jsx(u,{gap:"xs",children:a.roles.map(f=>e.jsx(E,{size:"sm",variant:"light",children:f},f))})}),e.jsx(n.Td,{children:e.jsxs(d,{gap:4,children:[e.jsx(W,{value:k(a.heapUsed,a.heapMax),color:k(a.heapUsed,a.heapMax)>90?"red":"blue",size:"sm"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[I(a.heapUsed)," / ",I(a.heapMax)]})]})}),e.jsx(n.Td,{children:e.jsxs(d,{gap:4,children:[e.jsx(W,{value:k(a.diskUsed,a.diskTotal),color:k(a.diskUsed,a.diskTotal)>90?"red":"blue",size:"sm"}),e.jsxs(l,{size:"xs",c:"dimmed",children:[I(a.diskUsed)," / ",I(a.diskTotal)]})]})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:a.cpuPercent!==void 0?`${a.cpuPercent}%`:"N/A"})})]},a.id))})]})})]})}function ve({indices:i,loading:r,error:o}){const{id:c}=H(),s=re(),[m,C]=F.useState(""),p=J(m,300),j=i==null?void 0:i.filter(a=>a.name.toLowerCase().includes(p.toLowerCase()));return r?e.jsx(u,{justify:"center",py:"xl",children:e.jsx(B,{})}):o?e.jsxs(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",o.message]}):!i||i.length===0?e.jsxs(d,{gap:"md",align:"center",py:"xl",children:[e.jsx(l,{c:"dimmed",children:"No indices found"}),c&&e.jsx(A,{leftSection:e.jsx(ee,{size:16}),onClick:()=>s(`/cluster/${c}/indices/create`),children:"Create Index"})]}):e.jsxs(d,{gap:"md",children:[e.jsxs(u,{justify:"space-between",children:[e.jsx(K,{placeholder:"Search indices...",leftSection:e.jsx(V,{size:16}),value:m,onChange:a=>C(a.currentTarget.value),style:{flex:1,maxWidth:400}}),c&&e.jsx(A,{leftSection:e.jsx(ee,{size:16}),onClick:()=>s(`/cluster/${c}/indices/create`),children:"Create Index"})]}),j&&j.length===0?e.jsx(l,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your search"}):e.jsx(q,{children:e.jsxs(n,{striped:!0,highlightOnHover:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{children:"Name"}),e.jsx(n.Th,{children:"Health"}),e.jsx(n.Th,{children:"Status"}),e.jsx(n.Th,{children:"Documents"}),e.jsx(n.Th,{children:"Size"}),e.jsx(n.Th,{children:"Shards"}),e.jsx(n.Th,{children:"Actions"})]})}),e.jsx(n.Tbody,{children:j==null?void 0:j.map(a=>e.jsxs(n.Tr,{children:[e.jsx(n.Td,{children:e.jsx(l,{size:"sm",fw:500,children:a.name})}),e.jsx(n.Td,{children:e.jsx(E,{size:"sm",color:X(a.health),children:a.health})}),e.jsx(n.Td,{children:e.jsx(E,{size:"sm",variant:"light",color:a.status==="open"?"green":"gray",children:a.status})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:a.docsCount.toLocaleString()})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:I(a.storeSize)})}),e.jsx(n.Td,{children:e.jsxs(l,{size:"sm",children:[a.primaryShards,"p / ",a.replicaShards,"r"]})}),e.jsx(n.Td,{children:e.jsxs(u,{gap:"xs",children:[c&&e.jsx(Se,{clusterId:c,index:a}),e.jsxs(g,{shadow:"md",width:200,children:[e.jsx(g.Target,{children:e.jsx(se,{variant:"subtle",color:"gray",children:e.jsx(ne,{size:16})})}),e.jsxs(g.Dropdown,{children:[e.jsx(g.Label,{children:"Index Management"}),e.jsx(g.Item,{leftSection:e.jsx(he,{size:14}),onClick:()=>s(`/cluster/${c}/indices/${a.name}/settings`),children:"Settings"}),e.jsx(g.Item,{leftSection:e.jsx(me,{size:14}),onClick:()=>s(`/cluster/${c}/indices/${a.name}/mappings`),children:"Mappings"})]})]})]})})]},a.name))})]})})]})}function ze({nodes:i,indices:r,shards:o,loading:c,error:s}){const[m,C]=F.useState(""),[p,j]=F.useState(!1),[a,f]=F.useState(!1),N=J(m,300);if(c)return e.jsx(u,{justify:"center",py:"xl",children:e.jsx(B,{})});if(s)return e.jsxs(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",s.message]});if(!i||!r||!o||i.length===0||r.length===0)return e.jsx(d,{gap:"md",align:"center",py:"xl",children:e.jsx(l,{c:"dimmed",children:"No shard allocation data available"})});const z=r.filter(t=>{const y=t.name.toLowerCase().includes(N.toLowerCase()),b=p||t.status==="open",D=a||!t.name.startsWith(".");return y&&b&&D}),T=new Map;o.forEach(t=>{if(!t.node)return;T.has(t.node)||T.set(t.node,new Map);const y=T.get(t.node);y.has(t.index)||y.set(t.index,[]),y.get(t.index).push(t)});const S=o.filter(t=>t.state==="UNASSIGNED");return e.jsxs(d,{gap:"md",children:[e.jsxs(u,{justify:"space-between",wrap:"wrap",children:[e.jsx(K,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(V,{size:16}),value:m,onChange:t=>C(t.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(u,{gap:"md",children:[e.jsxs(u,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"show-closed",checked:p,onChange:t=>j(t.target.checked)}),e.jsxs(l,{size:"sm",component:"label",htmlFor:"show-closed",style:{cursor:"pointer"},children:["closed (",r.filter(t=>t.status!=="open").length,")"]})]}),e.jsxs(u,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"show-special",checked:a,onChange:t=>f(t.target.checked)}),e.jsxs(l,{size:"sm",component:"label",htmlFor:"show-special",style:{cursor:"pointer"},children:["special (",r.filter(t=>t.name.startsWith(".")).length,")"]})]}),e.jsxs(l,{size:"sm",c:"dimmed",children:[z.length," of ",r.length]})]})]}),e.jsxs(u,{gap:"md",children:[e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:i.length})," nodes"]}),e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:z.length})," indices"]}),e.jsxs(l,{size:"sm",children:[e.jsx(l,{component:"span",fw:700,children:o.length})," shards"]}),S.length>0&&e.jsxs(E,{color:"red",variant:"filled",children:[S.length," unassigned"]})]}),e.jsx(q,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(n,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{style:{minWidth:"150px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),z.map(t=>e.jsx(n.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(d,{gap:4,children:[e.jsx(l,{size:"xs",fw:500,truncate:"end",title:t.name,children:t.name}),e.jsxs(u,{gap:4,justify:"center",children:[e.jsxs(E,{size:"xs",color:X(t.health),variant:"dot",children:[t.primaryShards,"Ã—",t.replicaShards+1]}),e.jsx(l,{size:"xs",c:"dimmed",children:I(t.storeSize)})]})]})},t.name))]})}),e.jsx(n.Tbody,{children:i.map(t=>{const y=T.get(t.name);return e.jsxs(n.Tr,{children:[e.jsx(n.Td,{style:{position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(d,{gap:4,children:[e.jsx(l,{size:"sm",fw:500,truncate:"end",title:t.name,children:t.name}),e.jsx(l,{size:"xs",c:"dimmed",children:t.ip})]})}),z.map(b=>{const D=(y==null?void 0:y.get(b.name))||[];return e.jsx(n.Td,{style:{padding:"4px",textAlign:"center"},children:D.length>0?e.jsx(u,{gap:2,justify:"center",wrap:"wrap",children:D.map((v,R)=>e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:v.state==="STARTED"?v.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":v.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:v.primary?"1px solid var(--mantine-color-green-9)":"none"},title:`Shard ${v.shard} (${v.primary?"Primary":"Replica"}) - ${v.state}`,children:v.shard},`${v.shard}-${v.primary}-${R}`))}):e.jsx(l,{size:"xs",c:"dimmed",children:"-"})},`${t.id}-${b.name}`)})]},t.id)})})]})})}),S.length>0&&e.jsx(U,{icon:e.jsx(O,{size:16}),title:"Unassigned Shards",color:"yellow",children:e.jsxs(d,{gap:"xs",children:[e.jsxs(l,{size:"sm",children:["There are ",S.length," unassigned shards in this cluster."]}),e.jsxs(q,{h:200,children:[e.jsxs(n,{children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{children:"Index"}),e.jsx(n.Th,{children:"Shard"}),e.jsx(n.Th,{children:"Type"})]})}),e.jsx(n.Tbody,{children:S.slice(0,50).map((t,y)=>e.jsxs(n.Tr,{children:[e.jsx(n.Td,{children:t.index}),e.jsx(n.Td,{children:t.shard}),e.jsx(n.Td,{children:e.jsx(E,{size:"xs",variant:"light",children:t.primary?"Primary":"Replica"})})]},`unassigned-${y}`))})]}),S.length>50&&e.jsxs(l,{size:"xs",c:"dimmed",ta:"center",mt:"xs",children:["Showing first 50 of ",S.length," unassigned shards"]})]})]})})]})}function be({shards:i,loading:r,error:o}){if(r)return e.jsx(u,{justify:"center",py:"xl",children:e.jsx(B,{})});if(o)return e.jsxs(U,{icon:e.jsx(O,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",o.message]});if(!i||i.length===0)return e.jsx(l,{c:"dimmed",children:"No shards found"});const c=i.reduce((s,m)=>(s[m.state]||(s[m.state]=[]),s[m.state].push(m),s),{});return e.jsxs(d,{gap:"md",children:[e.jsx(M,{children:Object.entries(c).map(([s,m])=>e.jsx(M.Col,{span:{base:12,sm:6,md:3},children:e.jsx(L,{shadow:"sm",padding:"md",children:e.jsxs(d,{gap:"xs",children:[e.jsx(l,{size:"sm",c:"dimmed",children:s}),e.jsx(l,{size:"xl",fw:700,children:m.length})]})})},s))}),e.jsxs(q,{children:[e.jsxs(n,{striped:!0,highlightOnHover:!0,children:[e.jsx(n.Thead,{children:e.jsxs(n.Tr,{children:[e.jsx(n.Th,{children:"Index"}),e.jsx(n.Th,{children:"Shard"}),e.jsx(n.Th,{children:"Type"}),e.jsx(n.Th,{children:"State"}),e.jsx(n.Th,{children:"Node"}),e.jsx(n.Th,{children:"Documents"}),e.jsx(n.Th,{children:"Size"})]})}),e.jsx(n.Tbody,{children:i.slice(0,100).map((s,m)=>{var C;return e.jsxs(n.Tr,{children:[e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:s.index})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:s.shard})}),e.jsx(n.Td,{children:e.jsx(E,{size:"sm",variant:"light",color:s.primary?"blue":"gray",children:s.primary?"Primary":"Replica"})}),e.jsx(n.Td,{children:e.jsx(E,{size:"sm",color:s.state==="STARTED"?"green":s.state==="UNASSIGNED"?"red":"yellow",children:s.state})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:s.node||"N/A"})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:((C=s.docs)==null?void 0:C.toLocaleString())||"N/A"})}),e.jsx(n.Td,{children:e.jsx(l,{size:"sm",children:s.store?I(s.store):"N/A"})})]},`${s.index}-${s.shard}-${m}`)})})]}),i.length>100&&e.jsxs(l,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",i.length," shards"]})]})]})}export{Qe as ClusterView};
