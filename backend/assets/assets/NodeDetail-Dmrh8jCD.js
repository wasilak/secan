import{O as A,h as y,i as B,k as I,j as e,A as p,I as u,G as x,X as N,l as i,S as c,a2 as T,Y as M,m as S}from"./index-t_DKJJHX.js";import{u as L}from"./useWatermarks-PcnEG94h.js";import{C as m}from"./Container-B2DCW7ow.js";import{B as U}from"./Button-BjQmuLCB.js";import{I as F}from"./IconArrowLeft-BWCXN9nl.js";import{T as C}from"./Title-ClywU4KH.js";import{B as q}from"./Badge-B3QISO9x.js";import{G as o}from"./Grid-BysoFuvs.js";import{C as a}from"./Card-Cljo_TPy.js";import{T as r}from"./Table-g5_FJUe2.js";function g(n){if(n===0)return"0 B";const d=1024,t=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(n)/Math.log(d));return`${(n/Math.pow(d,l)).toFixed(2)} ${t[l]}`}function P(n){return Math.round(n)}function W(){var z,v,w;const{id:n,nodeId:d}=A(),t=y(),l=B(),{getColor:j}=L(n),{data:s,isLoading:b,error:f}=I({queryKey:["cluster",n,"node",d,"stats"],queryFn:()=>S.getNodeStats(n,d),refetchInterval:l,enabled:!!n&&!!d});return!n||!d?e.jsx(m,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Cluster ID and Node ID are required"})}):b?e.jsx(m,{size:"xl",children:e.jsx(x,{justify:"center",mt:"xl",children:e.jsx(N,{size:"lg"})})}):f?e.jsx(m,{size:"xl",children:e.jsxs(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:["Failed to load node statistics: ",f.message]})}):s?e.jsxs(m,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(x,{gap:"xs",mb:"xs",children:e.jsx(U,{variant:"subtle",leftSection:e.jsx(F,{size:16}),onClick:()=>t(`/cluster/${n}`),children:"Back to Cluster"})}),e.jsx(C,{order:1,children:s.name}),e.jsxs(i,{size:"sm",c:"dimmed",children:["Node ID: ",s.id]}),s.ip&&e.jsxs(i,{size:"sm",c:"dimmed",children:["IP: ",s.ip]})]}),s.roles&&s.roles.length>0&&e.jsx(x,{children:s.roles.map(h=>e.jsx(q,{size:"lg",variant:"light",children:h},h))})]}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Elasticsearch Version"}),e.jsx(i,{size:"lg",fw:700,children:s.version})]})})}),e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"JVM Version"}),e.jsx(i,{size:"lg",fw:700,children:s.jvmVersion})]})})}),s.uptime&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"Uptime"}),e.jsx(i,{size:"lg",fw:700,children:s.uptime})]})})}),s.cpuPercent!==void 0&&e.jsx(o.Col,{span:{base:12,sm:6,md:3},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",c:"dimmed",children:"CPU Usage"}),e.jsxs(i,{size:"lg",fw:700,children:[s.cpuPercent,"%"]})]})})})]}),s.loadAverage&&s.loadAverage.length>0&&e.jsx(a,{shadow:"sm",padding:"lg",mb:"md",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Load Average"}),e.jsxs(x,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"1 min"}),e.jsx(i,{size:"lg",fw:700,children:((z=s.loadAverage[0])==null?void 0:z.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"5 min"}),e.jsx(i,{size:"lg",fw:700,children:((v=s.loadAverage[1])==null?void 0:v.toFixed(2))||"N/A"})]}),e.jsxs("div",{children:[e.jsx(i,{size:"xs",c:"dimmed",children:"15 min"}),e.jsx(i,{size:"lg",fw:700,children:((w=s.loadAverage[2])==null?void 0:w.toFixed(2))||"N/A"})]})]})]})}),e.jsxs(o,{mb:"md",children:[e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Heap Memory Usage"}),e.jsx(T,{value:s.heapPercent,color:j(s.heapPercent),size:"sm",radius:"xs"}),e.jsxs(i,{size:"xs",c:"dimmed",children:[g(s.heapUsed)," / ",g(s.heapMax)," (",P(s.heapPercent),"%)"]})]})})}),e.jsx(o.Col,{span:{base:12,md:6},children:e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"xs",children:[e.jsx(i,{size:"sm",fw:500,children:"Disk Usage"}),e.jsx(T,{value:s.diskPercent,color:j(s.diskPercent),size:"sm",radius:"xs"}),e.jsxs(i,{size:"xs",c:"dimmed",children:[g(s.diskUsed)," / ",g(s.diskTotal)," (",P(s.diskPercent),"%)"]})]})})})]}),e.jsx(a,{shadow:"sm",padding:"lg",children:e.jsxs(c,{gap:"md",children:[e.jsx(C,{order:3,children:"Thread Pool Statistics"}),e.jsx(i,{size:"sm",c:"dimmed",children:"Thread pool statistics show the current state of various thread pools in the node. Queue sizes indicate pending work, and rejected counts show when pools are overloaded."}),s.threadPools&&Object.keys(s.threadPools).length>0?e.jsx(M,{children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Pool Name"}),e.jsx(r.Th,{children:"Threads"}),e.jsx(r.Th,{children:"Active"}),e.jsx(r.Th,{children:"Queue"}),e.jsx(r.Th,{children:"Largest"}),e.jsx(r.Th,{children:"Completed"}),e.jsx(r.Th,{children:"Rejected"})]})}),e.jsx(r.Tbody,{children:Object.entries(s.threadPools).map(([h,k])=>e.jsx(D,{poolName:h,stats:k},h))})]})}):e.jsx(i,{c:"dimmed",ta:"center",py:"xl",children:"No thread pool statistics available"})]})})]}):e.jsx(m,{size:"xl",children:e.jsx(p,{icon:e.jsx(u,{size:16}),title:"Error",color:"red",children:"Node statistics not found"})})}function D({poolName:n,stats:d}){const t=d.queue>100,l=d.rejected>0,j=l?"var(--mantine-color-red-light)":t?"var(--mantine-color-yellow-light)":void 0;return e.jsxs(r.Tr,{style:{backgroundColor:j},children:[e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:500,children:n})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.threads})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.active})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:t?700:void 0,c:t?"yellow":void 0,children:d.queue})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.largest})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",children:d.completed.toLocaleString()})}),e.jsx(r.Td,{children:e.jsx(i,{size:"sm",fw:l?700:void 0,c:l?"red":void 0,children:d.rejected.toLocaleString()})})]})}export{W as NodeDetail};
