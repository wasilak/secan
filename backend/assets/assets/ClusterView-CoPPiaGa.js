import{c as ie,r as H,h as ve,i as ye,n as j,f as N,j as e,M as p,k as K,l as Q,m as be,o as ke,p as Se,S as g,d as a,G as x,q as te,a as Me,s as ae,b as V,A as Z,I as J,L as Y,T as Te,u as me,t as le,v as oe,e as l,w as Ce,x as Fe,y as Ee}from"./index-BJgj4GeN.js";import{u as G}from"./useMutation-CdbZl848.js";import{u as Pe}from"./accessibility-UaZ-9lcl.js";import{I as Ne}from"./IconDeviceFloppy-SxlEjekF.js";import{I as Le}from"./IconTrash-Cwwd0hNG.js";import{T as ee}from"./TextInput-Cj_5onN6.js";import{B as _}from"./Button-BbEjM1lC.js";import{N as De}from"./NumberInput-CuB_tHPs.js";import{B as D}from"./Badge-BlwOPR9r.js";import{G as R}from"./Grid-7fpqbCEl.js";import{C as q}from"./Card-SZ8Dan-8.js";import{P as re}from"./Progress-D9rQDgl_.js";import{T as O}from"./Tabs-CcuhUpb8.js";import{M as ne}from"./MultiSelect-BrUiVN7O.js";import{I as Ue,a as se,b as Ae,c as Oe,C as he}from"./IconMinimize-BOtgsYhl.js";import{I as Re,a as qe}from"./IconSortDescending-Rst1D8jb.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./get-safe-id-Bp3H8K0-.js";import"./InputsGroupFieldset-DYAJZ7KR.js";var ze=ie("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),Be=ie("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Ge=ie("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),We=ie("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);function ce(o,n=300){const[S,c]=H.useState(o);return H.useEffect(()=>{const w=setTimeout(()=>{c(o)},n);return()=>{clearTimeout(w)}},[o,n]),S}function Ke({clusterId:o,index:n}){const S=ve(),{announceSuccess:c,announceError:w}=Pe(),[$,{open:C,close:r}]=ye(!1),[F,{open:M,close:v}]=ye(!1),[u,b]=H.useState(""),[z,s]=H.useState(1),d=G({mutationFn:()=>N.openIndex(o,n.name),onMutate:()=>{j.show({id:`open-${n.name}`,title:"Opening index",message:`Opening index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`open-${n.name}`,title:"Success",message:`Index ${n.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),c(`Index ${n.name} opened successfully`),S.invalidateQueries({queryKey:["cluster",o,"indices"]})},onError:f=>{j.update({id:`open-${n.name}`,title:"Error",message:`Failed to open index: ${f.message}`,color:"red",loading:!1,autoClose:5e3}),w(`Failed to open index: ${f.message}`)}}),m=G({mutationFn:()=>N.closeIndex(o,n.name),onMutate:()=>{j.show({id:`close-${n.name}`,title:"Closing index",message:`Closing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`close-${n.name}`,title:"Success",message:`Index ${n.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),S.invalidateQueries({queryKey:["cluster",o,"indices"]})},onError:f=>{j.update({id:`close-${n.name}`,title:"Error",message:`Failed to close index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),I=G({mutationFn:()=>N.deleteIndex(o,n.name),onMutate:()=>{j.show({id:`delete-${n.name}`,title:"Deleting index",message:`Deleting index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`delete-${n.name}`,title:"Success",message:`Index ${n.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),S.invalidateQueries({queryKey:["cluster",o,"indices"]}),r(),b("")},onError:f=>{j.update({id:`delete-${n.name}`,title:"Error",message:`Failed to delete index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),t=G({mutationFn:f=>N.forceMergeIndex(o,n.name,f),onMutate:()=>{j.show({id:`forcemerge-${n.name}`,title:"Force merging index",message:`Force merging index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`forcemerge-${n.name}`,title:"Success",message:`Index ${n.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),v(),s(1)},onError:f=>{j.update({id:`forcemerge-${n.name}`,title:"Error",message:`Failed to force merge index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),T=G({mutationFn:()=>N.clearCacheIndex(o,n.name),onMutate:()=>{j.show({id:`clearcache-${n.name}`,title:"Clearing cache",message:`Clearing cache for index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`clearcache-${n.name}`,title:"Success",message:`Cache cleared for index ${n.name}`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{j.update({id:`clearcache-${n.name}`,title:"Error",message:`Failed to clear cache: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),k=G({mutationFn:()=>N.refreshIndex(o,n.name),onMutate:()=>{j.show({id:`refresh-${n.name}`,title:"Refreshing index",message:`Refreshing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`refresh-${n.name}`,title:"Success",message:`Index ${n.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{j.update({id:`refresh-${n.name}`,title:"Error",message:`Failed to refresh index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),E=G({mutationFn:()=>N.flushIndex(o,n.name),onMutate:()=>{j.show({id:`flush-${n.name}`,title:"Flushing index",message:`Flushing index ${n.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{j.update({id:`flush-${n.name}`,title:"Success",message:`Index ${n.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:f=>{j.update({id:`flush-${n.name}`,title:"Error",message:`Failed to flush index: ${f.message}`,color:"red",loading:!1,autoClose:5e3})}}),L=()=>{u===n.name&&I.mutate()},A=()=>{const f=typeof z=="number"?z:parseInt(z,10);!isNaN(f)&&f>0&&t.mutate(f)};return e.jsxs(e.Fragment,{children:[e.jsxs(p,{shadow:"md",width:200,children:[e.jsx(p.Target,{children:e.jsx(K,{label:"Index operations",children:e.jsx(Q,{variant:"subtle",color:"gray","aria-label":`Operations for index ${n.name}`,children:e.jsx(ze,{size:16,"aria-hidden":"true"})})})}),e.jsxs(p.Dropdown,{children:[e.jsx(p.Label,{children:"Index Operations"}),n.status==="close"?e.jsx(p.Item,{leftSection:e.jsx(We,{size:14,"aria-hidden":"true"}),onClick:()=>d.mutate(),disabled:d.isPending,children:"Open Index"}):e.jsx(p.Item,{leftSection:e.jsx(Ge,{size:14,"aria-hidden":"true"}),onClick:()=>m.mutate(),disabled:m.isPending,children:"Close Index"}),e.jsx(p.Item,{leftSection:e.jsx(be,{size:14,"aria-hidden":"true"}),onClick:()=>k.mutate(),disabled:k.isPending,children:"Refresh"}),e.jsx(p.Item,{leftSection:e.jsx(Ne,{size:14,"aria-hidden":"true"}),onClick:()=>E.mutate(),disabled:E.isPending,children:"Flush"}),e.jsx(p.Item,{leftSection:e.jsx(Be,{size:14,"aria-hidden":"true"}),onClick:()=>T.mutate(),disabled:T.isPending,children:"Clear Cache"}),e.jsx(p.Item,{leftSection:e.jsx(ke,{size:14,"aria-hidden":"true"}),onClick:M,children:"Force Merge"}),e.jsx(p.Divider,{}),e.jsx(p.Item,{leftSection:e.jsx(Le,{size:14,"aria-hidden":"true"}),color:"red",onClick:C,children:"Delete Index"})]})]}),e.jsx(Se,{opened:$,onClose:()=>{r(),b("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(g,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(a,{span:!0,fw:700,children:n.name}),"? This action cannot be undone."]}),e.jsx(a,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(ee,{placeholder:n.name,value:u,onChange:f=>b(f.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(x,{justify:"flex-end",children:[e.jsx(_,{variant:"default",onClick:()=>{r(),b("")},children:"Cancel"}),e.jsx(_,{color:"red",onClick:L,disabled:u!==n.name||I.isPending,loading:I.isPending,"aria-label":`Delete index ${n.name}`,children:"Delete"})]})]})}),e.jsx(Se,{opened:F,onClose:()=>{v(),s(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(g,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(a,{span:!0,fw:700,children:n.name})," to reduce the number of segments."]}),e.jsx(De,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:z,onChange:s,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(x,{justify:"flex-end",children:[e.jsx(_,{variant:"default",onClick:()=>{v(),s(1)},children:"Cancel"}),e.jsx(_,{onClick:A,disabled:t.isPending,loading:t.isPending,"aria-label":`Force merge index ${n.name}`,children:"Force Merge"})]})]})})]})}function ue(o){switch(o){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function U(o){if(o===0)return"0 B";const n=1024,S=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(o)/Math.log(n));return`${(o/Math.pow(n,c)).toFixed(2)} ${S[c]}`}function B(o,n){return n===0?0:Math.round(o/n*100)}function js(){var T,k;const{id:o}=te(),n=Me(),[S,c]=ae(),w=S.get("tab")||"overview",$=E=>{E&&c({tab:E})},C=E=>{c({tab:E})},{data:r,isLoading:F,error:M}=V({queryKey:["cluster",o,"stats"],queryFn:()=>N.getClusterStats(o),refetchInterval:n,enabled:!!o}),{data:v,isLoading:u,error:b}=V({queryKey:["cluster",o,"nodes"],queryFn:()=>N.getNodes(o),refetchInterval:n,enabled:!!o}),{data:z,isLoading:s,error:d}=V({queryKey:["cluster",o,"indices"],queryFn:()=>N.getIndices(o),refetchInterval:n,enabled:!!o}),{data:m,isLoading:I,error:t}=V({queryKey:["cluster",o,"shards"],queryFn:()=>N.getShards(o),refetchInterval:n,enabled:!!o});return o?F?e.jsx(g,{p:"md",children:e.jsx(x,{justify:"center",mt:"xl",children:e.jsx(Y,{size:"lg"})})}):M?e.jsx(g,{p:"md",children:e.jsxs(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",M.message]})}):e.jsxs(g,{gap:"md",p:"md",children:[e.jsxs(x,{justify:"space-between",wrap:"wrap",children:[e.jsxs("div",{children:[e.jsx(Te,{order:1,className:"text-responsive-xl",children:(r==null?void 0:r.clusterName)||o}),e.jsx(a,{size:"sm",c:"dimmed",children:"Cluster Overview"})]}),e.jsx(x,{children:e.jsx(D,{size:"lg",color:ue((r==null?void 0:r.health)||"red"),children:((T=r==null?void 0:r.health)==null?void 0:T.toUpperCase())||"UNKNOWN"})})]}),e.jsxs(R,{children:[e.jsx(R.Col,{span:{base:12,sm:6,md:3},children:e.jsx(q,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>C("nodes"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.numberOfNodes)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(R.Col,{span:{base:12,sm:6,md:3},children:e.jsx(q,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>C("indices"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.numberOfIndices)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[((k=r==null?void 0:r.numberOfDocuments)==null?void 0:k.toLocaleString())||0," documents"]})]})})}),e.jsx(R.Col,{span:{base:12,sm:6,md:3},children:e.jsx(q,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>C("shards"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.activeShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.activePrimaryShards)||0," primary"]})]})})}),e.jsx(R.Col,{span:{base:12,sm:6,md:3},children:e.jsx(q,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>C("shards"),children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(a,{size:"xl",fw:700,c:r!=null&&r.unassignedShards?"red":void 0,children:(r==null?void 0:r.unassignedShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.relocatingShards)||0," relocating"]})]})})})]}),((r==null?void 0:r.memoryTotal)||(r==null?void 0:r.diskTotal))&&e.jsxs(R,{children:[(r==null?void 0:r.memoryTotal)&&e.jsx(R.Col,{span:{base:12,md:6},children:e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(re,{value:B(r.memoryUsed||0,r.memoryTotal),color:B(r.memoryUsed||0,r.memoryTotal)>90?"red":"blue",size:"lg"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[U(r.memoryUsed||0)," / ",U(r.memoryTotal)," (",B(r.memoryUsed||0,r.memoryTotal),"%)"]})]})})}),(r==null?void 0:r.diskTotal)&&e.jsx(R.Col,{span:{base:12,md:6},children:e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(re,{value:B(r.diskUsed||0,r.diskTotal),color:B(r.diskUsed||0,r.diskTotal)>90?"red":"blue",size:"lg"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[U(r.diskUsed||0)," / ",U(r.diskTotal)," (",B(r.diskUsed||0,r.diskTotal),"%)"]})]})})})]}),e.jsx(q,{shadow:"sm",padding:"lg",children:e.jsxs(O,{value:w,onChange:$,children:[e.jsxs(O.List,{children:[e.jsx(O.Tab,{value:"overview",children:"Overview"}),e.jsxs(O.Tab,{value:"nodes",children:["Nodes (",(v==null?void 0:v.length)||0,")"]}),e.jsxs(O.Tab,{value:"indices",children:["Indices (",(z==null?void 0:z.length)||0,")"]}),e.jsxs(O.Tab,{value:"shards",children:["Shards (",(m==null?void 0:m.length)||0,")"]})]}),e.jsx(O.Panel,{value:"overview",pt:"md",children:e.jsx(Ve,{nodes:v,indices:z,shards:m,loading:u||s||I,error:b||d||t})}),e.jsx(O.Panel,{value:"nodes",pt:"md",children:e.jsx(Qe,{nodes:v,loading:u,error:b})}),e.jsx(O.Panel,{value:"indices",pt:"md",children:e.jsx(He,{indices:z,loading:s,error:d})}),e.jsx(O.Panel,{value:"shards",pt:"md",children:e.jsx(_e,{shards:m,loading:I,error:t})})]})})]}):e.jsx(g,{p:"md",children:e.jsx(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function Qe({nodes:o,loading:n,error:S}){var z;const{id:c}=te(),w=me(),[$,C]=ae(),r=$.get("nodesSearch")||"",F=((z=$.get("roles"))==null?void 0:z.split(",").filter(Boolean))||[],M=ce(r,300),v=(s,d)=>{const m=new URLSearchParams($);s!==void 0&&(s?m.set("nodesSearch",s):m.delete("nodesSearch")),d!==void 0&&(d.length>0?m.set("roles",d.join(",")):m.delete("roles")),C(m)},u=Array.from(new Set((o==null?void 0:o.flatMap(s=>s.roles))||[])),b=o==null?void 0:o.filter(s=>{var I;const d=s.name.toLowerCase().includes(M.toLowerCase())||((I=s.ip)==null?void 0:I.toLowerCase().includes(M.toLowerCase())),m=F.length===0||F.some(t=>s.roles.includes(t));return d&&m});return n?e.jsx(x,{justify:"center",py:"xl",children:e.jsx(Y,{})}):S?e.jsxs(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",S.message]}):!o||o.length===0?e.jsx(a,{c:"dimmed",children:"No nodes found"}):e.jsxs(g,{gap:"md",children:[e.jsxs(x,{children:[e.jsx(ee,{placeholder:"Search nodes...",leftSection:e.jsx(le,{size:16}),value:r,onChange:s=>v(s.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(ne,{placeholder:"Filter by roles",data:u,value:F,onChange:s=>v(void 0,s),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),b&&b.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(oe,{children:e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Name"}),e.jsx(l.Th,{children:"Roles"}),e.jsx(l.Th,{children:"Heap Usage"}),e.jsx(l.Th,{children:"Disk Usage"}),e.jsx(l.Th,{children:"CPU"})]})}),e.jsx(l.Tbody,{children:b==null?void 0:b.map(s=>e.jsxs(l.Tr,{style:{cursor:"pointer"},onClick:()=>w(`/cluster/${c}/nodes/${s.id}`),children:[e.jsxs(l.Td,{children:[e.jsx(a,{size:"sm",fw:500,children:s.name}),s.ip&&e.jsx(a,{size:"xs",c:"dimmed",children:s.ip})]}),e.jsx(l.Td,{children:e.jsx(x,{gap:"xs",children:s.roles.map(d=>e.jsx(D,{size:"sm",variant:"light",children:d},d))})}),e.jsx(l.Td,{children:e.jsxs(g,{gap:4,children:[e.jsx(re,{value:B(s.heapUsed,s.heapMax),color:B(s.heapUsed,s.heapMax)>90?"red":"blue",size:"sm"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[U(s.heapUsed)," / ",U(s.heapMax)]})]})}),e.jsx(l.Td,{children:e.jsxs(g,{gap:4,children:[e.jsx(re,{value:B(s.diskUsed,s.diskTotal),color:B(s.diskUsed,s.diskTotal)>90?"red":"blue",size:"sm"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[U(s.diskUsed)," / ",U(s.diskTotal)]})]})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:s.cpuPercent!==void 0?`${s.cpuPercent}%`:"N/A"})})]},s.id))})]})})]})}function He({indices:o,loading:n,error:S}){var ge,je;const{id:c}=te(),w=me(),$=ve(),[C,r]=ae(),F=C.get("indicesSearch")||"",M=((ge=C.get("health"))==null?void 0:ge.split(",").filter(Boolean))||[],v=((je=C.get("status"))==null?void 0:je.split(",").filter(Boolean))||[],u=C.get("expanded")==="true",b=C.get("sort")!=="desc",z=C.get("affected")==="true",s=ce(F,300),{data:d}=V({queryKey:["cluster",c,"shards"],queryFn:()=>N.getShards(c),enabled:!!c}),{data:m}=V({queryKey:["cluster",c,"settings"],queryFn:async()=>await N.proxyRequest(c,"GET","/_cluster/settings"),enabled:!!c}),I=(()=>{var pe,fe;if(!m)return!0;const i=m.transient,h=m.persistent,y=i==null?void 0:i.cluster,P=h==null?void 0:h.cluster,X=y==null?void 0:y.routing,de=P==null?void 0:P.routing,Ie=(pe=X==null?void 0:X.allocation)==null?void 0:pe.enable,$e=(fe=de==null?void 0:de.allocation)==null?void 0:fe.enable;return(Ie||$e||"all")==="all"})(),t=G({mutationFn:()=>N.proxyRequest(c,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{$.invalidateQueries({queryKey:["cluster",c,"settings"]}),j.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:i=>{j.show({title:"Error",message:`Failed to enable shard allocation: ${i.message}`,color:"red"})}}),T=G({mutationFn:i=>N.proxyRequest(c,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":i}}),onSuccess:()=>{$.invalidateQueries({queryKey:["cluster",c,"settings"]}),j.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:i=>{j.show({title:"Error",message:`Failed to disable shard allocation: ${i.message}`,color:"red"})}}),k=(i,h,y)=>{const P=new URLSearchParams(C);i!==void 0&&(i?P.set("indicesSearch",i):P.delete("indicesSearch")),h!==void 0&&(h.length>0?P.set("health",h.join(",")):P.delete("health")),y!==void 0&&(y.length>0?P.set("status",y.join(",")):P.delete("status")),r(P)},E=(i,h)=>{const y=new URLSearchParams(C);h===""||h===!1?y.delete(i):y.set(i,String(h)),r(y)},L=(d==null?void 0:d.reduce((i,h)=>(i[h.index]||(i[h.index]=[]),i[h.index].push(h),i),{}))||{},A=(d==null?void 0:d.filter(i=>i.state==="UNASSIGNED"))||[],f=A.reduce((i,h)=>(i[h.index]||(i[h.index]=[]),i[h.index].push(h),i),{}),xe=i=>(L[i]||[]).some(y=>y.state==="UNASSIGNED"||y.state==="RELOCATING"||y.state==="INITIALIZING");let W=o==null?void 0:o.filter(i=>{const h=i.name.toLowerCase().includes(s.toLowerCase()),y=M.length===0||M.includes(i.health),P=v.length===0||v.includes(i.status),X=!z||xe(i.name);return h&&y&&P&&X});if(W&&(W=[...W].sort((i,h)=>b?i.name.localeCompare(h.name):h.name.localeCompare(i.name))),n)return e.jsx(x,{justify:"center",py:"xl",children:e.jsx(Y,{})});if(S)return e.jsxs(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",S.message]});if(!o||o.length===0)return e.jsxs(g,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No indices found"}),c&&e.jsx(_,{leftSection:e.jsx(Ce,{size:16}),onClick:()=>w(`/cluster/${c}/indices/create`),children:"Create Index"})]});const we=A.length>0;return e.jsxs(g,{gap:"md",children:[e.jsxs(x,{justify:"space-between",wrap:"wrap",children:[e.jsxs(x,{children:[I?e.jsxs(p,{shadow:"md",width:200,children:[e.jsx(p.Target,{children:e.jsx(K,{label:"Disable shard allocation",children:e.jsx(Q,{size:"lg",variant:"subtle",color:"green",loading:T.isPending,children:e.jsx(Ue,{size:20})})})}),e.jsxs(p.Dropdown,{children:[e.jsx(p.Label,{children:"Disable Allocation"}),e.jsx(p.Item,{onClick:()=>T.mutate("none"),children:e.jsxs(x,{gap:"xs",children:[e.jsx(se,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(p.Item,{onClick:()=>T.mutate("primaries"),children:e.jsxs(x,{gap:"xs",children:[e.jsx(se,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(p.Item,{onClick:()=>T.mutate("new_primaries"),children:e.jsxs(x,{gap:"xs",children:[e.jsx(se,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(K,{label:"Enable shard allocation",children:e.jsx(Q,{size:"lg",variant:"subtle",color:"red",onClick:()=>t.mutate(),loading:t.isPending,children:e.jsx(se,{size:20})})}),e.jsx(K,{label:u?"Compress view":"Expand view",children:e.jsx(Q,{size:"lg",variant:"subtle",onClick:()=>E("expanded",!u),children:u?e.jsx(Ae,{size:20}):e.jsx(Oe,{size:20})})}),e.jsx(K,{label:b?"Sort descending":"Sort ascending",children:e.jsx(Q,{size:"lg",variant:"subtle",onClick:()=>E("sort",b?"desc":"asc"),children:b?e.jsx(Re,{size:20}):e.jsx(qe,{size:20})})}),e.jsx(K,{label:"Refresh data",children:e.jsx(Q,{size:"lg",variant:"subtle",onClick:()=>{$.invalidateQueries({queryKey:["cluster",c,"indices"]}),$.invalidateQueries({queryKey:["cluster",c,"shards"]}),$.invalidateQueries({queryKey:["cluster",c,"settings"]})},children:e.jsx(be,{size:20})})})]}),e.jsxs(x,{style:{flex:1},children:[e.jsx(ee,{placeholder:"Search indices...",leftSection:e.jsx(le,{size:16}),value:F,onChange:i=>k(i.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ne,{placeholder:"Health",data:["green","yellow","red"],value:M,onChange:i=>k(void 0,i,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(ne,{placeholder:"Status",data:["open","close"],value:v,onChange:i=>k(void 0,void 0,i),clearable:!0,style:{maxWidth:150}}),we&&e.jsx(he,{label:"Show only affected",checked:z,onChange:i=>E("affected",i.currentTarget.checked)})]}),c&&e.jsx(_,{leftSection:e.jsx(Ce,{size:16}),onClick:()=>w(`/cluster/${c}/indices/create`),children:"Create Index"})]}),A.length>0&&e.jsxs(q,{shadow:"sm",padding:"lg",style:{backgroundColor:"var(--mantine-color-red-0)",border:"2px solid var(--mantine-color-red-3)"},children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(Te,{order:4,children:"Unassigned Shards"}),e.jsxs(a,{size:"sm",c:"dimmed",children:[A.length," shard",A.length>1?"s":""," not allocated to any node"]})]}),e.jsx(D,{size:"lg",color:"red",variant:"filled",children:A.length})]}),e.jsx(g,{gap:"md",children:Object.entries(f).filter(([i])=>!(s&&!i.toLowerCase().includes(s.toLowerCase()))).sort(([i],[h])=>b?i.localeCompare(h):h.localeCompare(i)).map(([i,h])=>e.jsx(q,{shadow:"xs",padding:"sm",withBorder:!0,style:{backgroundColor:"white"},children:e.jsxs(g,{gap:"xs",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(a,{size:"sm",fw:500,style:{cursor:"pointer",textDecoration:"underline"},onClick:()=>w(`/cluster/${c}/indices/${encodeURIComponent(i)}/edit`),children:i}),e.jsxs(D,{size:"sm",color:"red",variant:"light",children:[h.length," unassigned"]})]}),e.jsx(x,{gap:"xs",children:h.map((y,P)=>e.jsx(K,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",y.shard]}),e.jsxs("div",{children:["Type: ",y.primary?"Primary":"Replica"]}),e.jsx("div",{children:"State: UNASSIGNED"})]}),children:e.jsx(D,{size:"lg",variant:y.primary?"filled":"light",color:"red",children:y.shard})},`unassigned-${y.index}-${y.shard}-${P}`))})]})},i))})]}),W&&W.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(oe,{children:e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Name"}),e.jsx(l.Th,{children:"Health"}),e.jsx(l.Th,{children:"Status"}),e.jsx(l.Th,{children:"Documents"}),e.jsx(l.Th,{children:"Size"}),e.jsx(l.Th,{children:"Shards"}),u&&e.jsx(l.Th,{children:"Primaries"}),u&&e.jsx(l.Th,{children:"Replicas"}),e.jsx(l.Th,{children:"Actions"})]})}),e.jsx(l.Tbody,{children:W==null?void 0:W.map(i=>e.jsxs(l.Tr,{style:{cursor:"pointer"},onClick:()=>w(`/cluster/${c}/indices/${encodeURIComponent(i.name)}/edit`),children:[e.jsx(l.Td,{children:e.jsxs(g,{gap:2,children:[e.jsx(a,{size:"sm",fw:500,style:{textDecoration:"underline"},children:i.name}),u&&xe(i.name)&&e.jsx(D,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",color:ue(i.health),children:i.health})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",variant:"light",color:i.status==="open"?"green":"gray",children:i.status})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:i.docsCount.toLocaleString()})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:U(i.storeSize)})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:u?`${i.primaryShards+i.replicaShards}`:`${i.primaryShards}p / ${i.replicaShards}r`})}),u&&e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:i.primaryShards})}),u&&e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:i.replicaShards})}),e.jsx(l.Td,{onClick:h=>h.stopPropagation(),children:e.jsxs(x,{gap:"xs",children:[c&&e.jsx(Ke,{clusterId:c,index:i}),e.jsxs(p,{shadow:"md",width:200,children:[e.jsx(p.Target,{children:e.jsx(Q,{variant:"subtle",color:"gray",children:e.jsx(ze,{size:16})})}),e.jsxs(p.Dropdown,{children:[e.jsx(p.Label,{children:"Index Management"}),e.jsx(p.Item,{leftSection:e.jsx(Fe,{size:14}),onClick:h=>{h.stopPropagation(),w(`/cluster/${c}/indices/${encodeURIComponent(i.name)}/edit?tab=settings`)},children:"Settings"}),e.jsx(p.Item,{leftSection:e.jsx(Ee,{size:14}),onClick:h=>{h.stopPropagation(),w(`/cluster/${c}/indices/${encodeURIComponent(i.name)}/edit?tab=mappings`)},children:"Mappings"})]})]})]})})]},i.name))})]})})]})}function Ve({nodes:o,indices:n,shards:S,loading:c,error:w}){const{id:$}=te(),C=me(),[r,F]=H.useState(""),[M,v]=H.useState(!1),[u,b]=H.useState(!1),z=ce(r,300);if(c)return e.jsx(x,{justify:"center",py:"xl",children:e.jsx(Y,{})});if(w)return e.jsxs(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",w.message]});if(!o||!n||!S||o.length===0||n.length===0)return e.jsx(g,{gap:"md",align:"center",py:"xl",children:e.jsx(a,{c:"dimmed",children:"No shard allocation data available"})});const s=n.filter(t=>{const T=t.name.toLowerCase().includes(z.toLowerCase()),k=M||t.status==="open",E=u||!t.name.startsWith(".");return T&&k&&E}),d=new Map;o.forEach(t=>{d.set(t.id,t.name),d.set(t.name,t.name),t.ip&&d.set(t.ip,t.name)});const m=new Map;S.forEach(t=>{if(!t.node)return;const T=d.get(t.node);if(!T)return;m.has(T)||m.set(T,new Map);const k=m.get(T);k.has(t.index)||k.set(t.index,[]),k.get(t.index).push(t)});const I=S.filter(t=>t.state==="UNASSIGNED");return e.jsxs(g,{gap:"md",children:[e.jsxs(x,{justify:"space-between",wrap:"wrap",children:[e.jsx(ee,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(le,{size:16}),value:r,onChange:t=>F(t.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(x,{gap:"md",children:[e.jsxs(x,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"show-closed",checked:M,onChange:t=>v(t.target.checked)}),e.jsxs(a,{size:"sm",component:"label",htmlFor:"show-closed",style:{cursor:"pointer"},children:["closed (",n.filter(t=>t.status!=="open").length,")"]})]}),e.jsxs(x,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"show-special",checked:u,onChange:t=>b(t.target.checked)}),e.jsxs(a,{size:"sm",component:"label",htmlFor:"show-special",style:{cursor:"pointer"},children:["special (",n.filter(t=>t.name.startsWith(".")).length,")"]})]}),e.jsxs(a,{size:"sm",c:"dimmed",children:[s.length," of ",n.length]})]})]}),e.jsxs(x,{gap:"md",children:[e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:o.length})," nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:s.length})," indices"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:S.length})," shards"]}),I.length>0&&e.jsxs(D,{color:"red",variant:"filled",children:[I.length," unassigned"]})]}),e.jsx(oe,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(l,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),s.map(t=>e.jsx(l.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(g,{gap:4,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:t.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:T=>{T.stopPropagation(),C(`/cluster/${$}/indices/${encodeURIComponent(t.name)}/edit`)},children:t.name}),e.jsxs(x,{gap:4,justify:"center",children:[e.jsxs(D,{size:"xs",color:ue(t.health),variant:"dot",children:[t.primaryShards,"Ã—",t.replicaShards+1]}),e.jsx(a,{size:"xs",c:"dimmed",children:U(t.storeSize)})]})]})},t.name))]})}),e.jsx(l.Tbody,{children:o.map(t=>{const T=m.get(t.name);return e.jsxs(l.Tr,{children:[e.jsx(l.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(g,{gap:2,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:t.name,children:t.name}),e.jsx(a,{size:"xs",c:"dimmed",truncate:"end",title:t.ip,children:t.ip})]})}),s.map(k=>{const E=(T==null?void 0:T.get(k.name))||[];return e.jsx(l.Td,{style:{padding:"4px",textAlign:"center"},children:E.length>0?e.jsx(x,{gap:2,justify:"center",wrap:"wrap",children:E.map((L,A)=>e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:L.state==="STARTED"?L.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":L.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:L.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)"},title:`Shard ${L.shard} (${L.primary?"Primary":"Replica"}) - ${L.state}`,children:L.shard},`${L.shard}-${L.primary}-${A}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`${t.id}-${k.name}`)})]},t.id)})})]})})})]})}function _e({shards:o,loading:n,error:S}){var z;const[c,w]=ae(),$=c.get("shardsSearch")||"",C=((z=c.get("shardStates"))==null?void 0:z.split(",").filter(Boolean))||[],r=c.get("primaryOnly")==="true",F=c.get("replicaOnly")==="true",M=ce($,300),v=(s,d,m,I)=>{const t=new URLSearchParams(c);s!==void 0&&(s?t.set("shardsSearch",s):t.delete("shardsSearch")),d!==void 0&&(d.length>0?t.set("shardStates",d.join(",")):t.delete("shardStates")),m!==void 0&&(m?(t.set("primaryOnly","true"),t.delete("replicaOnly")):t.delete("primaryOnly")),I!==void 0&&(I?(t.set("replicaOnly","true"),t.delete("primaryOnly")):t.delete("replicaOnly")),w(t)},u=o==null?void 0:o.filter(s=>{var t;const d=s.index.toLowerCase().includes(M.toLowerCase())||((t=s.node)==null?void 0:t.toLowerCase().includes(M.toLowerCase())),m=C.length===0||C.includes(s.state),I=!r&&!F||r&&s.primary||F&&!s.primary;return d&&m&&I});if(n)return e.jsx(x,{justify:"center",py:"xl",children:e.jsx(Y,{})});if(S)return e.jsxs(Z,{icon:e.jsx(J,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",S.message]});if(!o||o.length===0)return e.jsx(a,{c:"dimmed",children:"No shards found"});const b=(u||[]).reduce((s,d)=>(s[d.state]||(s[d.state]=[]),s[d.state].push(d),s),{});return e.jsxs(g,{gap:"md",children:[e.jsxs(x,{wrap:"wrap",children:[e.jsx(ee,{placeholder:"Search by index or node...",leftSection:e.jsx(le,{size:16}),value:$,onChange:s=>v(s.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ne,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:C,onChange:s=>v(void 0,s,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(x,{gap:"md",children:[e.jsx(he,{label:"Primary only",checked:r,onChange:s=>v(void 0,void 0,s.currentTarget.checked,void 0)}),e.jsx(he,{label:"Replica only",checked:F,onChange:s=>v(void 0,void 0,void 0,s.currentTarget.checked)})]})]}),e.jsx(R,{children:Object.entries(b).map(([s,d])=>e.jsx(R.Col,{span:{base:12,sm:6,md:3},children:e.jsx(q,{shadow:"sm",padding:"md",children:e.jsxs(g,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:s}),e.jsx(a,{size:"xl",fw:700,children:d.length})]})})},s))}),u&&u.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(oe,{children:[e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Index"}),e.jsx(l.Th,{children:"Shard"}),e.jsx(l.Th,{children:"Type"}),e.jsx(l.Th,{children:"State"}),e.jsx(l.Th,{children:"Node"}),e.jsx(l.Th,{children:"Documents"}),e.jsx(l.Th,{children:"Size"})]})}),e.jsx(l.Tbody,{children:u==null?void 0:u.slice(0,100).map((s,d)=>{var m;return e.jsxs(l.Tr,{children:[e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:s.index})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:s.shard})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",variant:"light",color:s.primary?"blue":"gray",children:s.primary?"Primary":"Replica"})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",color:s.state==="STARTED"?"green":s.state==="UNASSIGNED"?"red":"yellow",children:s.state})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:s.node||"N/A"})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:((m=s.docs)==null?void 0:m.toLocaleString())||"N/A"})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:s.store?U(s.store):"N/A"})})]},`${s.index}-${s.shard}-${d}`)})})]}),u&&u.length>100&&e.jsxs(a,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",u.length," shards"]})]})]})}export{js as ClusterView};
