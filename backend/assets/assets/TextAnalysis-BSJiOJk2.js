import{k as M,r as i,a as P,j as e,G as x,T as L,b as r,S as m,l as H,d as t,al as J,L as Q,n as N,e as b}from"./index-CNRDdsta.js";import{u as Y}from"./useMutation-CaYU4g6S.js";import{C as U}from"./Container-BPUIqV2j.js";import{A as C,I as S}from"./IconAlertCircle-xt26jQrX.js";import{B as _}from"./Button-C40bJwZS.js";import{I as Z}from"./IconRefresh-R04wZp9t.js";import{C as v}from"./Card-C05VjDzn.js";import{T as V}from"./Textarea-DAl5I8Tv.js";import{S as A}from"./Select-8Lz1TFJ1.js";import{A as p}from"./Accordion-DE5VxHs0.js";import{T as F}from"./TextInput-BB78TaU7.js";import{B as $}from"./Badge-DuQCXH5x.js";import"./InputBase-CzYGjzOL.js";import"./OptionsDropdown-Cm1MnTQn.js";import"./get-safe-id-Bp3H8K0-.js";const W=["standard","simple","whitespace","stop","keyword","pattern","language","fingerprint"];function ue(){const{id:l}=M(),[g,w]=i.useState(""),[k,I]=i.useState("standard"),[u,E]=i.useState(!1),[n,O]=i.useState(""),[f,y]=i.useState(""),[a,R]=i.useState(""),[d,q]=i.useState(""),[o,B]=i.useState(""),{data:z}=P({queryKey:["cluster",l,"indices"],queryFn:()=>b.getIndices(l),enabled:!!l&&u}),{data:T}=P({queryKey:["cluster",l,"index",n,"fields"],queryFn:()=>b.getIndexFields(l,n),enabled:!!l&&!!n&&u}),c=Y({mutationFn:s=>b.analyzeText(l,s),onError:s=>{N.show({title:"Error",message:`Failed to analyze text: ${s.message}`,color:"red"})}}),D=()=>{if(!g.trim()){N.show({title:"Error",message:"Please enter text to analyze",color:"red"});return}const s={text:g};u&&n&&f?(s.index=n,s.field=f):a||d||o?(a&&(s.tokenizer=a),d&&(s.filter=d.split(",").map(h=>h.trim()).filter(Boolean)),o&&(s.charFilter=o.split(",").map(h=>h.trim()).filter(Boolean))):s.analyzer=k,c.mutate(s)},G=()=>{w(""),I("standard"),E(!1),O(""),y(""),R(""),q(""),B(""),c.reset()};return l?e.jsxs(U,{size:"xl",py:"md",children:[e.jsxs(x,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(L,{order:2,children:"Text Analysis"}),e.jsx(r,{size:"sm",c:"dimmed",children:"Test and debug search analysis chains"})]}),e.jsx(_,{leftSection:e.jsx(Z,{size:16}),variant:"light",onClick:G,children:"Reset"})]}),e.jsxs(m,{gap:"md",children:[e.jsx(v,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsx(V,{label:"Text to Analyze",placeholder:"Enter text to analyze...",value:g,onChange:s=>w(s.currentTarget.value),minRows:4,maxRows:8,required:!0}),e.jsxs(x,{grow:!0,align:"flex-start",children:[e.jsx(A,{label:"Analyzer",placeholder:"Select analyzer",value:k,onChange:s=>I(s||"standard"),data:W,disabled:u||!!a}),e.jsx(A,{label:"Use Field Analyzer",placeholder:"Select index",value:n,onChange:s=>{O(s||""),y(""),E(!!s)},data:(z==null?void 0:z.map(s=>({value:s.name,label:s.name})))||[],searchable:!0,clearable:!0,disabled:!!a}),n&&e.jsx(A,{label:"Field",placeholder:"Select field",value:f,onChange:s=>y(s||""),data:(T==null?void 0:T.fields.filter(s=>s.analyzer||s.type==="text").map(s=>({value:s.name,label:`${s.name} (${s.analyzer||"default"})`})))||[],searchable:!0,clearable:!0})]}),e.jsx(p,{variant:"contained",children:e.jsxs(p.Item,{value:"custom",children:[e.jsx(p.Control,{children:e.jsx(r,{size:"sm",fw:500,children:"Custom Analyzer Definition"})}),e.jsx(p.Panel,{children:e.jsxs(m,{gap:"sm",children:[e.jsx(C,{icon:e.jsx(S,{size:16}),color:"blue",variant:"light",children:e.jsx(r,{size:"sm",children:"Define a custom analyzer by specifying tokenizer and filters. This will override the selected analyzer."})}),e.jsx(F,{label:"Tokenizer",placeholder:"e.g., standard, whitespace, keyword",value:a,onChange:s=>R(s.currentTarget.value)}),e.jsx(F,{label:"Token Filters (comma-separated)",placeholder:"e.g., lowercase, stop, snowball",value:d,onChange:s=>q(s.currentTarget.value)}),e.jsx(F,{label:"Character Filters (comma-separated)",placeholder:"e.g., html_strip, mapping",value:o,onChange:s=>B(s.currentTarget.value)})]})})]})}),e.jsx(x,{justify:"flex-end",children:e.jsx(_,{leftSection:e.jsx(H,{size:16}),onClick:D,loading:c.isPending,children:"Analyze"})})]})}),c.data&&e.jsx(v,{shadow:"sm",padding:"lg",children:e.jsxs(m,{gap:"md",children:[e.jsxs(x,{justify:"space-between",children:[e.jsx(L,{order:3,children:"Analysis Results"}),e.jsxs($,{size:"lg",variant:"light",children:[c.data.tokens.length," tokens"]})]}),(a||d||o)&&e.jsx(C,{icon:e.jsx(S,{size:16}),color:"blue",variant:"light",children:e.jsxs(m,{gap:"xs",children:[e.jsx(r,{size:"sm",fw:500,children:"Analyzer Chain:"}),o&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Char Filters:"})," ",o]}),a&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Tokenizer:"})," ",a]}),d&&e.jsxs(r,{size:"sm",children:[e.jsx("strong",{children:"Token Filters:"})," ",d]})]})}),e.jsxs(t,{striped:!0,highlightOnHover:!0,children:[e.jsx(t.Thead,{children:e.jsxs(t.Tr,{children:[e.jsx(t.Th,{children:"Position"}),e.jsx(t.Th,{children:"Token"}),e.jsx(t.Th,{children:"Type"}),e.jsx(t.Th,{children:"Start Offset"}),e.jsx(t.Th,{children:"End Offset"}),e.jsx(t.Th,{children:"Attributes"})]})}),e.jsx(t.Tbody,{children:c.data.tokens.map((s,h)=>e.jsxs(t.Tr,{children:[e.jsx(t.Td,{children:e.jsx($,{variant:"light",children:s.position})}),e.jsx(t.Td,{children:e.jsx(J,{children:s.token})}),e.jsx(t.Td,{children:e.jsx(r,{size:"sm",c:"dimmed",children:s.type})}),e.jsx(t.Td,{children:s.startOffset}),e.jsx(t.Td,{children:s.endOffset}),e.jsx(t.Td,{children:Object.entries(s).filter(([j])=>!["token","startOffset","endOffset","type","position","positionLength"].includes(j)).map(([j,K])=>e.jsxs(r,{size:"xs",c:"dimmed",children:[j,": ",JSON.stringify(K)]},j))})]},h))})]})]})}),c.isPending&&e.jsx(v,{shadow:"sm",padding:"lg",children:e.jsxs(x,{justify:"center",children:[e.jsx(Q,{size:"lg"}),e.jsx(r,{children:"Analyzing text..."})]})})]})]}):e.jsx(U,{size:"xl",children:e.jsx(C,{icon:e.jsx(S,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}export{ue as TextAnalysisPage};
