import{e as ge,r as V,q as be,s as ke,t as y,o as E,j as e,M as j,T as Q,v as H,w as Le,x as Ae,y as Se,S as T,m as a,G as u,z as je,i as Ue,D as ae,k as se,A as ie,I as te,L as oe,l as Oe,h as Ce,E as pe,F as ce,n as l,H as $e,J as Re,K as qe,N as Be}from"./index-BHNEvZQA.js";import{u as q}from"./useMutation-BnLwzje5.js";import{u as Ee}from"./useWatermarks-wF0v6hun.js";import{u as Ge}from"./accessibility-BuzKzDBc.js";import{I as We}from"./IconDeviceFloppy-D_hhLs93.js";import{I as Ke}from"./IconTrash-DHKM6_n1.js";import{T as de}from"./TextInput-XUVk3GPU.js";import{B as ne}from"./Button-BGV1Haup.js";import{N as Qe}from"./NumberInput-BVU5XKMO.js";import{P as le}from"./Progress-LLlBJCcC.js";import{G as W}from"./Grid-DA96bHYB.js";import{C as Z}from"./Card-141lmRa4.js";import{T as B}from"./Tabs-C_RUcXKc.js";import{I as Fe,a as J,b as Pe,c as Ne,C as xe}from"./IconMinimize-4sjnkmGq.js";import{B as D}from"./Badge-BVbCuTyy.js";import{M as ue}from"./MultiSelect-DQIXbjtb.js";import{I as He,a as Ve}from"./IconSortDescending-pN-oEHQ4.js";import{S as G}from"./Skeleton-7_Z0T4Z-.js";import"./get-auto-contrast-value-Da6zqqWm.js";import"./get-safe-id-Bp3H8K0-.js";import"./InputsGroupFieldset-CLb8kycH.js";var De=ge("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),_e=ge("eraser","IconEraser",[["path",{d:"M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3",key:"svg-0"}],["path",{d:"M18 13.3l-6.3 -6.3",key:"svg-1"}]]),Ze=ge("folder-off","IconFolderOff",[["path",{d:"M8 4h1l3 3h7a2 2 0 0 1 2 2v8m-2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 1.189 -1.829",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),Je=ge("folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);function fe(n,i=300){const[C,m]=V.useState(n);return V.useEffect(()=>{const $=setTimeout(()=>{m(n)},i);return()=>{clearTimeout($)}},[n,i]),C}function Xe({clusterId:n,index:i}){const C=be(),{announceSuccess:m,announceError:$}=Ge(),[v,{open:I,close:z}]=ke(!1),[r,{open:N,close:M}]=ke(!1),[g,F]=V.useState(""),[k,c]=V.useState(1),o=q({mutationFn:()=>E.openIndex(n,i.name),onMutate:()=>{y.show({id:`open-${i.name}`,title:"Opening index",message:`Opening index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`open-${i.name}`,title:"Success",message:`Index ${i.name} opened successfully`,color:"green",loading:!1,autoClose:3e3}),m(`Index ${i.name} opened successfully`),C.invalidateQueries({queryKey:["cluster",n,"indices"]})},onError:b=>{y.update({id:`open-${i.name}`,title:"Error",message:`Failed to open index: ${b.message}`,color:"red",loading:!1,autoClose:5e3}),$(`Failed to open index: ${b.message}`)}}),S=q({mutationFn:()=>E.closeIndex(n,i.name),onMutate:()=>{y.show({id:`close-${i.name}`,title:"Closing index",message:`Closing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`close-${i.name}`,title:"Success",message:`Index ${i.name} closed successfully`,color:"green",loading:!1,autoClose:3e3}),C.invalidateQueries({queryKey:["cluster",n,"indices"]})},onError:b=>{y.update({id:`close-${i.name}`,title:"Error",message:`Failed to close index: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),f=q({mutationFn:()=>E.deleteIndex(n,i.name),onMutate:()=>{y.show({id:`delete-${i.name}`,title:"Deleting index",message:`Deleting index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`delete-${i.name}`,title:"Success",message:`Index ${i.name} deleted successfully`,color:"green",loading:!1,autoClose:3e3}),C.invalidateQueries({queryKey:["cluster",n,"indices"]}),z(),F("")},onError:b=>{y.update({id:`delete-${i.name}`,title:"Error",message:`Failed to delete index: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),p=q({mutationFn:b=>E.forceMergeIndex(n,i.name,b),onMutate:()=>{y.show({id:`forcemerge-${i.name}`,title:"Force merging index",message:`Force merging index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`forcemerge-${i.name}`,title:"Success",message:`Index ${i.name} force merged successfully`,color:"green",loading:!1,autoClose:3e3}),M(),c(1)},onError:b=>{y.update({id:`forcemerge-${i.name}`,title:"Error",message:`Failed to force merge index: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),A=q({mutationFn:()=>E.clearCacheIndex(n,i.name),onMutate:()=>{y.show({id:`clearcache-${i.name}`,title:"Clearing cache",message:`Clearing cache for index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`clearcache-${i.name}`,title:"Success",message:`Cache cleared for index ${i.name}`,color:"green",loading:!1,autoClose:3e3})},onError:b=>{y.update({id:`clearcache-${i.name}`,title:"Error",message:`Failed to clear cache: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),R=q({mutationFn:()=>E.refreshIndex(n,i.name),onMutate:()=>{y.show({id:`refresh-${i.name}`,title:"Refreshing index",message:`Refreshing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`refresh-${i.name}`,title:"Success",message:`Index ${i.name} refreshed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:b=>{y.update({id:`refresh-${i.name}`,title:"Error",message:`Failed to refresh index: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),P=q({mutationFn:()=>E.flushIndex(n,i.name),onMutate:()=>{y.show({id:`flush-${i.name}`,title:"Flushing index",message:`Flushing index ${i.name}...`,loading:!0,autoClose:!1})},onSuccess:()=>{y.update({id:`flush-${i.name}`,title:"Success",message:`Index ${i.name} flushed successfully`,color:"green",loading:!1,autoClose:3e3})},onError:b=>{y.update({id:`flush-${i.name}`,title:"Error",message:`Failed to flush index: ${b.message}`,color:"red",loading:!1,autoClose:5e3})}}),X=()=>{g===i.name&&f.mutate()},re=()=>{const b=typeof k=="number"?k:parseInt(k,10);!isNaN(b)&&b>0&&p.mutate(b)};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(Q,{label:"Index operations",children:e.jsx(H,{variant:"subtle",color:"gray","aria-label":`Operations for index ${i.name}`,children:e.jsx(De,{size:16,"aria-hidden":"true"})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Index Operations"}),i.status==="close"?e.jsx(j.Item,{leftSection:e.jsx(Je,{size:14,"aria-hidden":"true"}),onClick:()=>o.mutate(),disabled:o.isPending,children:"Open Index"}):e.jsx(j.Item,{leftSection:e.jsx(Ze,{size:14,"aria-hidden":"true"}),onClick:()=>S.mutate(),disabled:S.isPending,children:"Close Index"}),e.jsx(j.Item,{leftSection:e.jsx(Le,{size:14,"aria-hidden":"true"}),onClick:()=>R.mutate(),disabled:R.isPending,children:"Refresh"}),e.jsx(j.Item,{leftSection:e.jsx(We,{size:14,"aria-hidden":"true"}),onClick:()=>P.mutate(),disabled:P.isPending,children:"Flush"}),e.jsx(j.Item,{leftSection:e.jsx(_e,{size:14,"aria-hidden":"true"}),onClick:()=>A.mutate(),disabled:A.isPending,children:"Clear Cache"}),e.jsx(j.Item,{leftSection:e.jsx(Ae,{size:14,"aria-hidden":"true"}),onClick:N,children:"Force Merge"}),e.jsx(j.Divider,{}),e.jsx(j.Item,{leftSection:e.jsx(Ke,{size:14,"aria-hidden":"true"}),color:"red",onClick:I,children:"Delete Index"})]})]}),e.jsx(Se,{opened:v,onClose:()=>{z(),F("")},title:"Delete Index",centered:!0,"aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:e.jsxs(T,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"delete-modal-description",children:["Are you sure you want to delete index ",e.jsx(a,{span:!0,fw:700,children:i.name}),"? This action cannot be undone."]}),e.jsx(a,{size:"sm",c:"dimmed",children:"Type the index name to confirm:"}),e.jsx(de,{placeholder:i.name,value:g,onChange:b=>F(b.currentTarget.value),"data-autofocus":!0,"aria-label":"Confirm index name","aria-required":"true"}),e.jsxs(u,{justify:"flex-end",children:[e.jsx(ne,{variant:"default",onClick:()=>{z(),F("")},children:"Cancel"}),e.jsx(ne,{color:"red",onClick:X,disabled:g!==i.name||f.isPending,loading:f.isPending,"aria-label":`Delete index ${i.name}`,children:"Delete"})]})]})}),e.jsx(Se,{opened:r,onClose:()=>{M(),c(1)},title:"Force Merge Index",centered:!0,"aria-labelledby":"forcemerge-modal-title","aria-describedby":"forcemerge-modal-description",children:e.jsxs(T,{gap:"md",children:[e.jsxs(a,{size:"sm",id:"forcemerge-modal-description",children:["Force merge index ",e.jsx(a,{span:!0,fw:700,children:i.name})," to reduce the number of segments."]}),e.jsx(Qe,{label:"Maximum number of segments",description:"The number of segments to merge to. Set to 1 for a single segment.",placeholder:"1",value:k,onChange:c,min:1,max:100,"aria-label":"Maximum number of segments","aria-required":"true"}),e.jsxs(u,{justify:"flex-end",children:[e.jsx(ne,{variant:"default",onClick:()=>{M(),c(1)},children:"Cancel"}),e.jsx(ne,{onClick:re,disabled:p.isPending,loading:p.isPending,"aria-label":`Force merge index ${i.name}`,children:"Force Merge"})]})]})})]})}function we(n){switch(n){case"green":return"green";case"yellow":return"yellow";case"red":return"red";default:return"gray"}}function O(n){if(n===0)return"0 B";const i=1024,C=["B","KB","MB","GB","TB"],m=Math.floor(Math.log(n)/Math.log(i));return`${(n/Math.pow(i,m)).toFixed(2)} ${C[m]}`}function K(n,i){return i===0?0:Math.round(n/i*100)}function Me(n){switch(n){case"green":return"transparent";case"yellow":return"rgba(250, 176, 5, 0.15)";case"red":return"rgba(250, 82, 82, 0.15)";default:return"transparent"}}function Ts(){var R;const{id:n}=je(),i=Ue(),[C,m]=ae(),{getColor:$}=Ee(n),v=C.get("tab")||"overview",I=P=>{P&&m({tab:P})},z=P=>{m({tab:P})},{data:r,isLoading:N,error:M}=se({queryKey:["cluster",n,"stats"],queryFn:()=>E.getClusterStats(n),refetchInterval:i,enabled:!!n}),{data:g,isLoading:F,error:k}=se({queryKey:["cluster",n,"nodes"],queryFn:()=>E.getNodes(n),refetchInterval:i,enabled:!!n}),{data:c,isLoading:o,error:S}=se({queryKey:["cluster",n,"indices"],queryFn:()=>E.getIndices(n),refetchInterval:i,enabled:!!n}),{data:f,isLoading:p,error:A}=se({queryKey:["cluster",n,"shards"],queryFn:()=>E.getShards(n),refetchInterval:i,enabled:!!n});return n?N?e.jsx(T,{p:"md",children:e.jsx(u,{justify:"center",mt:"xl",children:e.jsx(oe,{size:"lg"})})}):M?e.jsx(T,{p:"md",children:e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load cluster information: ",M.message]})}):e.jsxs(T,{gap:"md",p:"md",children:[e.jsx(u,{justify:"space-between",wrap:"wrap",children:e.jsxs("div",{children:[e.jsx(Oe,{order:1,className:"text-responsive-xl",children:(r==null?void 0:r.clusterName)||n}),e.jsx(a,{size:"sm",c:"dimmed",children:"Cluster Overview"})]})}),e.jsx(le,{value:100,color:we((r==null?void 0:r.health)||"red"),size:"sm",radius:"xs","aria-label":`Cluster health: ${(r==null?void 0:r.health)||"unknown"}`}),e.jsxs(W,{children:[e.jsx(W.Col,{span:{base:12,sm:6,md:3},children:e.jsx(Z,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>z("nodes"),children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Nodes"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.numberOfNodes)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.numberOfDataNodes)||0," data nodes"]})]})})}),e.jsx(W.Col,{span:{base:12,sm:6,md:3},children:e.jsx(Z,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>z("indices"),children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Indices"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.numberOfIndices)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[((R=r==null?void 0:r.numberOfDocuments)==null?void 0:R.toLocaleString())||0," documents"]})]})})}),e.jsx(W.Col,{span:{base:12,sm:6,md:3},children:e.jsx(Z,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>z("shards"),children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Shards"}),e.jsx(a,{size:"xl",fw:700,children:(r==null?void 0:r.activeShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.activePrimaryShards)||0," primary"]})]})})}),e.jsx(W.Col,{span:{base:12,sm:6,md:3},children:e.jsx(Z,{shadow:"sm",padding:"lg",style:{cursor:"pointer"},onClick:()=>z("shards"),children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Unassigned"}),e.jsx(a,{size:"xl",fw:700,c:r!=null&&r.unassignedShards?"red":void 0,children:(r==null?void 0:r.unassignedShards)||0}),e.jsxs(a,{size:"xs",c:"dimmed",children:[(r==null?void 0:r.relocatingShards)||0," relocating"]})]})})})]}),((r==null?void 0:r.memoryTotal)||(r==null?void 0:r.diskTotal))&&e.jsxs(W,{children:[(r==null?void 0:r.memoryTotal)&&e.jsx(W.Col,{span:{base:12,md:6},children:e.jsx(Z,{shadow:"sm",padding:"lg",children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Memory Usage"}),e.jsx(le,{value:K(r.memoryUsed||0,r.memoryTotal),color:$(K(r.memoryUsed||0,r.memoryTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[O(r.memoryUsed||0)," / ",O(r.memoryTotal)," (",K(r.memoryUsed||0,r.memoryTotal),"%)"]})]})})}),(r==null?void 0:r.diskTotal)&&e.jsx(W.Col,{span:{base:12,md:6},children:e.jsx(Z,{shadow:"sm",padding:"lg",children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:"Disk Usage"}),e.jsx(le,{value:K(r.diskUsed||0,r.diskTotal),color:$(K(r.diskUsed||0,r.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[O(r.diskUsed||0)," / ",O(r.diskTotal)," (",K(r.diskUsed||0,r.diskTotal),"%)"]})]})})})]}),e.jsx(Z,{shadow:"sm",padding:"lg",children:e.jsxs(B,{value:v,onChange:I,children:[e.jsxs(B.List,{children:[e.jsx(B.Tab,{value:"overview",children:"Overview"}),e.jsxs(B.Tab,{value:"nodes",children:["Nodes (",(g==null?void 0:g.length)||0,")"]}),e.jsxs(B.Tab,{value:"indices",children:["Indices (",(c==null?void 0:c.length)||0,")"]}),e.jsxs(B.Tab,{value:"shards",children:["Shards (",(f==null?void 0:f.length)||0,")"]})]}),e.jsx(B.Panel,{value:"overview",pt:"md",children:e.jsx(rs,{nodes:g,indices:c,shards:f,loading:F||o||p,error:k||S||A})}),e.jsx(B.Panel,{value:"nodes",pt:"md",children:e.jsx(Ye,{nodes:g,loading:F,error:k})}),e.jsx(B.Panel,{value:"indices",pt:"md",children:e.jsx(es,{indices:c,loading:o,error:S})}),e.jsx(B.Panel,{value:"shards",pt:"md",children:e.jsx(ns,{shards:f,loading:p,error:A})})]})})]}):e.jsx(T,{p:"md",children:e.jsx(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:"Cluster ID is required"})})}function Ye({nodes:n,loading:i,error:C}){var c;const{id:m}=je(),$=Ce(),[v,I]=ae(),{getColor:z}=Ee(m),r=v.get("nodesSearch")||"",N=((c=v.get("roles"))==null?void 0:c.split(",").filter(Boolean))||[],M=fe(r,300),g=(o,S)=>{const f=new URLSearchParams(v);o!==void 0&&(o?f.set("nodesSearch",o):f.delete("nodesSearch")),S!==void 0&&(S.length>0?f.set("roles",S.join(",")):f.delete("roles")),I(f)},F=Array.from(new Set((n==null?void 0:n.flatMap(o=>o.roles))||[])),k=n==null?void 0:n.filter(o=>{var p;const S=o.name.toLowerCase().includes(M.toLowerCase())||((p=o.ip)==null?void 0:p.toLowerCase().includes(M.toLowerCase())),f=N.length===0||N.some(A=>o.roles.includes(A));return S&&f});return i?e.jsx(u,{justify:"center",py:"xl",children:e.jsx(oe,{})}):C?e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load nodes: ",C.message]}):!n||n.length===0?e.jsx(a,{c:"dimmed",children:"No nodes found"}):e.jsxs(T,{gap:"md",children:[e.jsxs(u,{children:[e.jsx(de,{placeholder:"Search nodes...",leftSection:e.jsx(pe,{size:16}),value:r,onChange:o=>g(o.currentTarget.value,void 0),style:{flex:1,maxWidth:400}}),e.jsx(ue,{placeholder:"Filter by roles",data:F,value:N,onChange:o=>g(void 0,o),clearable:!0,searchable:!0,style:{flex:1,maxWidth:300}})]}),k&&k.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No nodes match your filters"}):e.jsx(ce,{children:e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Name"}),e.jsx(l.Th,{children:"Roles"}),e.jsx(l.Th,{children:"Heap Usage"}),e.jsx(l.Th,{children:"Disk Usage"}),e.jsx(l.Th,{children:"CPU"})]})}),e.jsx(l.Tbody,{children:k==null?void 0:k.map(o=>e.jsxs(l.Tr,{style:{cursor:"pointer"},onClick:()=>$(`/cluster/${m}/nodes/${o.id}`),children:[e.jsxs(l.Td,{children:[e.jsx(a,{size:"sm",fw:500,children:o.name}),o.ip&&e.jsx(a,{size:"xs",c:"dimmed",children:o.ip})]}),e.jsx(l.Td,{children:e.jsx(u,{gap:"xs",children:o.roles.map(S=>e.jsx(D,{size:"sm",variant:"light",children:S},S))})}),e.jsx(l.Td,{children:e.jsxs(T,{gap:4,children:[e.jsx(le,{value:K(o.heapUsed,o.heapMax),color:z(K(o.heapUsed,o.heapMax)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[O(o.heapUsed)," / ",O(o.heapMax)]})]})}),e.jsx(l.Td,{children:e.jsxs(T,{gap:4,children:[e.jsx(le,{value:K(o.diskUsed,o.diskTotal),color:z(K(o.diskUsed,o.diskTotal)),size:"sm",radius:"xs"}),e.jsxs(a,{size:"xs",c:"dimmed",children:[O(o.diskUsed)," / ",O(o.diskTotal)]})]})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:o.cpuPercent!==void 0?`${o.cpuPercent}%`:"N/A"})})]},o.id))})]})})]})}function es({indices:n,loading:i,error:C}){var he,_;const{id:m}=je(),$=Ce(),v=be(),[I,z]=ae(),r=I.get("indicesSearch")||"",N=((he=I.get("health"))==null?void 0:he.split(",").filter(Boolean))||[],M=((_=I.get("status"))==null?void 0:_.split(",").filter(Boolean))||[],g=I.get("expanded")==="true",F=I.get("sort")!=="desc",k=I.get("affected")==="true",c=fe(r,300),{data:o}=se({queryKey:["cluster",m,"shards"],queryFn:()=>E.getShards(m),enabled:!!m}),{data:S}=se({queryKey:["cluster",m,"settings"],queryFn:async()=>await E.proxyRequest(m,"GET","/_cluster/settings"),enabled:!!m}),f=(()=>{var me,ve;if(!S)return!0;const t=S.transient,x=S.persistent,s=t==null?void 0:t.cluster,h=x==null?void 0:x.cluster,d=s==null?void 0:s.routing,U=h==null?void 0:h.routing,w=(me=d==null?void 0:d.allocation)==null?void 0:me.enable,ee=(ve=U==null?void 0:U.allocation)==null?void 0:ve.enable;return(w||ee||"all")==="all"})(),p=q({mutationFn:()=>E.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{v.invalidateQueries({queryKey:["cluster",m,"settings"]}),y.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:t=>{y.show({title:"Error",message:`Failed to enable shard allocation: ${t.message}`,color:"red"})}}),A=q({mutationFn:t=>E.proxyRequest(m,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":t}}),onSuccess:()=>{v.invalidateQueries({queryKey:["cluster",m,"settings"]}),y.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:t=>{y.show({title:"Error",message:`Failed to disable shard allocation: ${t.message}`,color:"red"})}}),R=(t,x,s)=>{const h=new URLSearchParams(I);t!==void 0&&(t?h.set("indicesSearch",t):h.delete("indicesSearch")),x!==void 0&&(x.length>0?h.set("health",x.join(",")):h.delete("health")),s!==void 0&&(s.length>0?h.set("status",s.join(",")):h.delete("status")),z(h)},P=(t,x)=>{const s=new URLSearchParams(I);x===""||x===!1?s.delete(t):s.set(t,String(x)),z(s)},X=(o==null?void 0:o.reduce((t,x)=>(t[x.index]||(t[x.index]=[]),t[x.index].push(x),t),{}))||{},re=(o==null?void 0:o.filter(t=>t.state==="UNASSIGNED"))||[],b=re.reduce((t,x)=>(t[x.index]||(t[x.index]=[]),t[x.index].push(x),t),{}),Y=t=>(X[t]||[]).some(s=>s.state==="UNASSIGNED"||s.state==="RELOCATING"||s.state==="INITIALIZING");let L=n==null?void 0:n.filter(t=>{const x=t.name.toLowerCase().includes(c.toLowerCase()),s=N.length===0||N.includes(t.health),h=M.length===0||M.includes(t.status),d=!k||Y(t.name);return x&&s&&h&&d});if(L&&(L=[...L].sort((t,x)=>F?t.name.localeCompare(x.name):x.name.localeCompare(t.name))),i)return e.jsx(u,{justify:"center",py:"xl",children:e.jsx(oe,{})});if(C)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load indices: ",C.message]});if(!n||n.length===0)return e.jsxs(T,{gap:"md",align:"center",py:"xl",children:[e.jsx(a,{c:"dimmed",children:"No indices found"}),m&&e.jsx(ne,{leftSection:e.jsx($e,{size:16}),onClick:()=>$(`/cluster/${m}/indices/create`),children:"Create Index"})]});const ye=re.length>0;return e.jsxs(T,{gap:"md",children:[e.jsxs(u,{justify:"space-between",wrap:"wrap",children:[e.jsxs(u,{children:[f?e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(Q,{label:"Disable shard allocation",children:e.jsx(H,{size:"lg",variant:"subtle",color:"green",loading:A.isPending,children:e.jsx(Fe,{size:20})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Disable Allocation"}),e.jsx(j.Item,{onClick:()=>A.mutate("none"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(j.Item,{onClick:()=>A.mutate("primaries"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(j.Item,{onClick:()=>A.mutate("new_primaries"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(Q,{label:"Enable shard allocation",children:e.jsx(H,{size:"lg",variant:"subtle",color:"red",onClick:()=>p.mutate(),loading:p.isPending,children:e.jsx(J,{size:20})})}),e.jsx(Q,{label:g?"Compress view":"Expand view",children:e.jsx(H,{size:"lg",variant:"subtle",onClick:()=>P("expanded",!g),children:g?e.jsx(Pe,{size:20}):e.jsx(Ne,{size:20})})}),e.jsx(Q,{label:F?"Sort descending":"Sort ascending",children:e.jsx(H,{size:"lg",variant:"subtle",onClick:()=>P("sort",F?"desc":"asc"),children:F?e.jsx(He,{size:20}):e.jsx(Ve,{size:20})})})]}),e.jsxs(u,{style:{flex:1},children:[e.jsx(de,{placeholder:"Search indices...",leftSection:e.jsx(pe,{size:16}),value:r,onChange:t=>R(t.currentTarget.value,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ue,{placeholder:"Health",data:["green","yellow","red"],value:N,onChange:t=>R(void 0,t,void 0),clearable:!0,style:{maxWidth:200}}),e.jsx(ue,{placeholder:"Status",data:["open","close"],value:M,onChange:t=>R(void 0,void 0,t),clearable:!0,style:{maxWidth:150}}),ye&&e.jsx(xe,{label:"Show only affected",checked:k,onChange:t=>P("affected",t.currentTarget.checked)})]}),m&&e.jsx(ne,{leftSection:e.jsx($e,{size:16}),onClick:()=>$(`/cluster/${m}/indices/create`),children:"Create Index"})]}),L&&L.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No indices match your filters"}):e.jsx(ce,{children:e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Name"}),e.jsx(l.Th,{children:"Health"}),e.jsx(l.Th,{children:"Status"}),e.jsx(l.Th,{children:"Documents"}),e.jsx(l.Th,{children:"Size"}),e.jsx(l.Th,{children:"Shards"}),g&&e.jsx(l.Th,{children:"Primaries"}),g&&e.jsx(l.Th,{children:"Replicas"}),e.jsx(l.Th,{children:"Unassigned"}),e.jsx(l.Th,{children:"Actions"})]})}),e.jsx(l.Tbody,{children:L==null?void 0:L.map(t=>{var h;const x=((h=b[t.name])==null?void 0:h.length)||0,s=x>0;return e.jsxs(l.Tr,{style:{cursor:"pointer",backgroundColor:s?"rgba(250, 82, 82, 0.1)":void 0},onClick:()=>$(`/cluster/${m}/indices/${encodeURIComponent(t.name)}/edit`),children:[e.jsx(l.Td,{children:e.jsxs(T,{gap:2,children:[e.jsx(a,{size:"sm",fw:500,style:{textDecoration:"underline"},children:t.name}),g&&Y(t.name)&&e.jsx(D,{size:"xs",color:"yellow",variant:"light",children:"Has Issues"})]})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",color:we(t.health),children:t.health})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",variant:"light",color:t.status==="open"?"green":"gray",children:t.status})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:t.docsCount.toLocaleString()})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:O(t.storeSize)})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:g?`${t.primaryShards+t.replicaShards}`:`${t.primaryShards}p / ${t.replicaShards}r`})}),g&&e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:t.primaryShards})}),g&&e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:t.replicaShards})}),e.jsx(l.Td,{children:x>0?e.jsx(D,{size:"sm",color:"red",variant:"filled",children:x}):e.jsx(a,{size:"sm",c:"dimmed",children:"-"})}),e.jsx(l.Td,{onClick:d=>d.stopPropagation(),children:e.jsxs(u,{gap:"xs",children:[m&&e.jsx(Xe,{clusterId:m,index:t}),e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(H,{variant:"subtle",color:"gray",children:e.jsx(De,{size:16})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Index Management"}),e.jsx(j.Item,{leftSection:e.jsx(Re,{size:14}),onClick:d=>{d.stopPropagation(),$(`/cluster/${m}/indices/${encodeURIComponent(t.name)}/edit?tab=settings`)},children:"Settings"}),e.jsx(j.Item,{leftSection:e.jsx(qe,{size:14}),onClick:d=>{d.stopPropagation(),$(`/cluster/${m}/indices/${encodeURIComponent(t.name)}/edit?tab=mappings`)},children:"Mappings"})]})]})]})})]},t.name)})})]})})]})}function ss({shard:n,opened:i,onClose:C,clusterId:m}){const[$,v]=V.useState(null),[I,z]=V.useState(!1);return V.useEffect(()=>{i&&n?(z(!0),v(null),console.log("Fetching shard stats:",{clusterId:m,index:n.index,shard:n.shard}),E.getShardStats(m,n.index,n.shard).then(r=>{console.log("Received shard stats:",r),v(r)}).catch(r=>{console.error("Failed to fetch shard stats:",r),v(n)}).finally(()=>{z(!1)})):i||(v(null),z(!1))},[i,n==null?void 0:n.index,n==null?void 0:n.shard,m]),n?e.jsx(Se,{opened:i,onClose:C,title:`Shard Details: ${n.index} / ${n.shard}`,size:"80%",fullScreen:!1,styles:{body:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"}},children:e.jsx(ce,{style:{flex:1},children:I?e.jsxs(T,{gap:"xs",children:[e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,width:"70%",radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,width:"50%",radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,radius:"xs"}),e.jsx(G,{height:20,width:"80%",radius:"xs"})]}):e.jsx(Be,{block:!0,children:JSON.stringify($||n,null,2)})})}):null}function rs({nodes:n,indices:i,shards:C,loading:m,error:$}){const{id:v}=je(),I=Ce(),z=be(),[r,N]=ae(),[M,g]=V.useState(null),[F,k]=V.useState(!1),c=r.get("overviewSearch")||"",o=r.get("showClosed")==="true",S=r.get("showSpecial")==="true",f=r.get("overviewExpanded")==="true",p=r.get("overviewAffected")==="true",A=fe(c,300),R=s=>{g(s),k(!0)},P=(s,h)=>{const d=new URLSearchParams(r);h===""||h===!1?d.delete(s):d.set(s,String(h)),N(d)},{data:X}=se({queryKey:["cluster",v,"settings"],queryFn:async()=>await E.proxyRequest(v,"GET","/_cluster/settings"),enabled:!!v}),re=(()=>{var ze,Ie;if(!X)return!0;const s=X.transient,h=X.persistent,d=s==null?void 0:s.cluster,U=h==null?void 0:h.cluster,w=d==null?void 0:d.routing,ee=U==null?void 0:U.routing,Te=(ze=w==null?void 0:w.allocation)==null?void 0:ze.enable,me=(Ie=ee==null?void 0:ee.allocation)==null?void 0:Ie.enable;return(Te||me||"all")==="all"})(),b=q({mutationFn:()=>E.proxyRequest(v,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":"all"}}),onSuccess:()=>{z.invalidateQueries({queryKey:["cluster",v,"settings"]}),y.show({title:"Success",message:"Shard allocation enabled",color:"green"})},onError:s=>{y.show({title:"Error",message:`Failed to enable shard allocation: ${s.message}`,color:"red"})}}),Y=q({mutationFn:s=>E.proxyRequest(v,"PUT","/_cluster/settings",{transient:{"cluster.routing.allocation.enable":s}}),onSuccess:()=>{z.invalidateQueries({queryKey:["cluster",v,"settings"]}),y.show({title:"Success",message:"Shard allocation disabled",color:"green"})},onError:s=>{y.show({title:"Error",message:`Failed to disable shard allocation: ${s.message}`,color:"red"})}});if(m)return e.jsx(u,{justify:"center",py:"xl",children:e.jsx(oe,{})});if($)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load shard allocation data: ",$.message]});if(!n||!i||!C||n.length===0||i.length===0)return e.jsx(T,{gap:"md",align:"center",py:"xl",children:e.jsx(a,{c:"dimmed",children:"No shard allocation data available"})});const L=C.filter(s=>s.state==="UNASSIGNED"),ye=L.reduce((s,h)=>(s[h.index]||(s[h.index]=[]),s[h.index].push(h),s),{}),he=s=>C.filter(d=>d.index===s).some(d=>d.state==="UNASSIGNED"||d.state==="RELOCATING"||d.state==="INITIALIZING");let _=i.filter(s=>{const h=s.name.toLowerCase().includes(A.toLowerCase()),d=o||s.status==="open",U=S||!s.name.startsWith("."),w=!p||he(s.name);return h&&d&&U&&w});const t=new Map;n.forEach(s=>{t.set(s.id,s.name),t.set(s.name,s.name),s.ip&&t.set(s.ip,s.name)});const x=new Map;return C.forEach(s=>{if(!s.node)return;const h=t.get(s.node);if(!h)return;x.has(h)||x.set(h,new Map);const d=x.get(h);d.has(s.index)||d.set(s.index,[]),d.get(s.index).push(s)}),e.jsxs(T,{gap:"md",children:[e.jsx(ss,{shard:M,opened:F,onClose:()=>k(!1),clusterId:v}),e.jsxs(u,{justify:"space-between",wrap:"wrap",children:[e.jsxs(u,{children:[re?e.jsxs(j,{shadow:"md",width:200,children:[e.jsx(j.Target,{children:e.jsx(Q,{label:"Disable shard allocation",children:e.jsx(H,{size:"lg",variant:"subtle",color:"green",loading:Y.isPending,children:e.jsx(Fe,{size:20})})})}),e.jsxs(j.Dropdown,{children:[e.jsx(j.Label,{children:"Disable Allocation"}),e.jsx(j.Item,{onClick:()=>Y.mutate("none"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"None (default)"})]})}),e.jsx(j.Item,{onClick:()=>Y.mutate("primaries"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"Primaries only"})]})}),e.jsx(j.Item,{onClick:()=>Y.mutate("new_primaries"),children:e.jsxs(u,{gap:"xs",children:[e.jsx(J,{size:14}),e.jsx(a,{size:"sm",children:"New primaries only"})]})})]})]}):e.jsx(Q,{label:"Enable shard allocation",children:e.jsx(H,{size:"lg",variant:"subtle",color:"red",onClick:()=>b.mutate(),loading:b.isPending,children:e.jsx(J,{size:20})})}),e.jsx(Q,{label:f?"Compress view":"Expand view",children:e.jsx(H,{size:"lg",variant:"subtle",onClick:()=>P("overviewExpanded",!f),children:f?e.jsx(Pe,{size:20}):e.jsx(Ne,{size:20})})})]}),e.jsxs(u,{style:{flex:1},children:[e.jsx(de,{placeholder:"Filter indices by name or alias...",leftSection:e.jsx(pe,{size:16}),value:c,onChange:s=>P("overviewSearch",s.currentTarget.value),style:{flex:1,maxWidth:400}}),e.jsxs(u,{gap:"md",children:[e.jsxs(u,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-closed",checked:o,onChange:s=>P("showClosed",s.target.checked)}),e.jsxs(a,{size:"sm",component:"label",htmlFor:"overview-show-closed",style:{cursor:"pointer"},children:["closed (",i.filter(s=>s.status!=="open").length,")"]})]}),e.jsxs(u,{gap:"xs",children:[e.jsx("input",{type:"checkbox",id:"overview-show-special",checked:S,onChange:s=>P("showSpecial",s.target.checked)}),e.jsxs(a,{size:"sm",component:"label",htmlFor:"overview-show-special",style:{cursor:"pointer"},children:["special (",i.filter(s=>s.name.startsWith(".")).length,")"]})]}),L.length>0&&e.jsx(xe,{label:"Show only affected",checked:p,onChange:s=>P("overviewAffected",s.currentTarget.checked)}),e.jsxs(a,{size:"sm",c:"dimmed",children:[_.length," of ",i.length]})]})]})]}),e.jsxs(u,{gap:"md",children:[e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:n.length})," nodes"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:_.length})," indices"]}),e.jsxs(a,{size:"sm",children:[e.jsx(a,{component:"span",fw:700,children:C.length})," shards"]}),L.length>0&&e.jsxs(D,{color:"red",variant:"filled",children:[L.length," unassigned"]})]}),e.jsx(ce,{children:e.jsx("div",{style:{minWidth:"800px"},children:e.jsxs(l,{striped:!0,withTableBorder:!0,withColumnBorders:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:"Node"}),_.map(s=>e.jsx(l.Th,{style:{minWidth:"120px",textAlign:"center"},children:e.jsxs(T,{gap:4,children:[e.jsx(a,{size:"xs",fw:500,truncate:"end",title:s.name,style:{cursor:"pointer",textDecoration:"underline"},onClick:h=>{h.stopPropagation(),I(`/cluster/${v}/indices/${encodeURIComponent(s.name)}/edit`)},children:s.name}),e.jsxs(u,{gap:4,justify:"center",children:[e.jsxs(D,{size:"xs",color:we(s.health),variant:"dot",children:[s.primaryShards,"Ã—",s.replicaShards+1]}),e.jsx(a,{size:"xs",c:"dimmed",children:O(s.storeSize)})]})]})},s.name))]})}),e.jsxs(l.Tbody,{children:[L.length>0&&e.jsxs(l.Tr,{style:{backgroundColor:"var(--mantine-color-red-0)"},children:[e.jsx(l.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-red-0)",zIndex:1},children:e.jsxs(T,{gap:2,children:[e.jsx(a,{size:"xs",fw:700,c:"red",children:"Unassigned"}),e.jsx(D,{size:"xs",color:"red",variant:"filled",children:L.length})]})}),_.map(s=>{const h=ye[s.name]||[];return e.jsx(l.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Me(s.health)},children:h.length>0?e.jsx(u,{gap:2,justify:"center",wrap:"wrap",children:h.map((d,U)=>e.jsx(Q,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",d.shard]}),e.jsxs("div",{children:["Type: ",d.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",d.state]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:d.primary?"2px solid var(--mantine-color-red-9)":"2px dashed var(--mantine-color-red-9)",cursor:"pointer"},onClick:()=>R(d),children:d.shard})},`unassigned-${d.index}-${d.shard}-${U}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`unassigned-${s.name}`)})]}),n.map(s=>{const h=x.get(s.name);return e.jsxs(l.Tr,{children:[e.jsx(l.Td,{style:{width:"120px",minWidth:"120px",maxWidth:"120px",position:"sticky",left:0,backgroundColor:"var(--mantine-color-body)",zIndex:1},children:e.jsxs(T,{gap:4,children:[e.jsx(u,{gap:4,children:e.jsx(a,{size:"xs",fw:500,truncate:"end",title:s.name,children:s.name})}),e.jsx(a,{size:"xs",c:"dimmed",truncate:"end",title:s.ip,children:s.ip}),f&&e.jsxs(e.Fragment,{children:[e.jsx(u,{gap:4,wrap:"wrap",children:s.roles.map(d=>e.jsx(D,{size:"xs",variant:"light",color:"gray",children:d},d))}),e.jsxs(u,{gap:4,wrap:"wrap",children:[e.jsx(D,{size:"xs",color:"teal",variant:"filled",children:s.id.substring(0,8)}),e.jsx(D,{size:"xs",color:"teal",variant:"filled",children:s.roles.length}),e.jsx(D,{size:"xs",color:"teal",variant:"filled",children:O(s.heapMax)}),e.jsx(D,{size:"xs",color:"teal",variant:"filled",children:O(s.diskTotal)}),s.cpuPercent!==void 0&&e.jsxs(D,{size:"xs",color:"teal",variant:"filled",children:[s.cpuPercent,"%"]})]})]})]})}),_.map(d=>{const U=(h==null?void 0:h.get(d.name))||[];return e.jsx(l.Td,{style:{padding:"4px",textAlign:"center",backgroundColor:Me(d.health)},children:U.length>0?e.jsx(u,{gap:2,justify:"center",wrap:"wrap",children:U.map((w,ee)=>e.jsx(Q,{label:e.jsxs("div",{children:[e.jsxs("div",{children:["Shard: ",w.shard]}),e.jsxs("div",{children:["Type: ",w.primary?"Primary":"Replica"]}),e.jsxs("div",{children:["State: ",w.state]}),e.jsxs("div",{children:["Node: ",w.node||"N/A"]}),w.docs!==void 0&&w.docs!==null&&e.jsxs("div",{children:["Docs: ",w.docs.toLocaleString()]}),w.store!==void 0&&w.store!==null&&e.jsxs("div",{children:["Size: ",O(w.store)]})]}),children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:w.state==="STARTED"?w.primary?"var(--mantine-color-green-6)":"var(--mantine-color-green-7)":w.state==="RELOCATING"?"var(--mantine-color-yellow-6)":"var(--mantine-color-red-6)",color:"white",fontSize:"10px",fontWeight:600,borderRadius:"2px",border:w.primary?"2px solid var(--mantine-color-green-9)":"2px dashed var(--mantine-color-green-9)",cursor:"pointer"},onClick:()=>R(w),children:w.shard})},`${w.shard}-${w.primary}-${ee}`))}):e.jsx(a,{size:"xs",c:"dimmed",children:"-"})},`${s.id}-${d.name}`)})]},s.id)})]})]})})})]})}function ns({shards:n,loading:i,error:C}){var k;const[m,$]=ae(),v=m.get("shardsSearch")||"",I=((k=m.get("shardStates"))==null?void 0:k.split(",").filter(Boolean))||[],z=m.get("primaryOnly")==="true",r=m.get("replicaOnly")==="true",N=fe(v,300),M=(c,o,S,f)=>{const p=new URLSearchParams(m);c!==void 0&&(c?p.set("shardsSearch",c):p.delete("shardsSearch")),o!==void 0&&(o.length>0?p.set("shardStates",o.join(",")):p.delete("shardStates")),S!==void 0&&(S?(p.set("primaryOnly","true"),p.delete("replicaOnly")):p.delete("primaryOnly")),f!==void 0&&(f?(p.set("replicaOnly","true"),p.delete("primaryOnly")):p.delete("replicaOnly")),$(p)},g=n==null?void 0:n.filter(c=>{var p;const o=c.index.toLowerCase().includes(N.toLowerCase())||((p=c.node)==null?void 0:p.toLowerCase().includes(N.toLowerCase())),S=I.length===0||I.includes(c.state),f=!z&&!r||z&&c.primary||r&&!c.primary;return o&&S&&f});if(i)return e.jsx(u,{justify:"center",py:"xl",children:e.jsx(oe,{})});if(C)return e.jsxs(ie,{icon:e.jsx(te,{size:16}),title:"Error",color:"red",children:["Failed to load shards: ",C.message]});if(!n||n.length===0)return e.jsx(a,{c:"dimmed",children:"No shards found"});const F=(g||[]).reduce((c,o)=>(c[o.state]||(c[o.state]=[]),c[o.state].push(o),c),{});return e.jsxs(T,{gap:"md",children:[e.jsxs(u,{wrap:"wrap",children:[e.jsx(de,{placeholder:"Search by index or node...",leftSection:e.jsx(pe,{size:16}),value:v,onChange:c=>M(c.currentTarget.value,void 0,void 0,void 0),style:{flex:1,maxWidth:300}}),e.jsx(ue,{placeholder:"State",data:["STARTED","INITIALIZING","RELOCATING","UNASSIGNED"],value:I,onChange:c=>M(void 0,c,void 0,void 0),clearable:!0,style:{maxWidth:250}}),e.jsxs(u,{gap:"md",children:[e.jsx(xe,{label:"Primary only",checked:z,onChange:c=>M(void 0,void 0,c.currentTarget.checked,void 0)}),e.jsx(xe,{label:"Replica only",checked:r,onChange:c=>M(void 0,void 0,void 0,c.currentTarget.checked)})]})]}),e.jsx(W,{children:Object.entries(F).map(([c,o])=>e.jsx(W.Col,{span:{base:12,sm:6,md:3},children:e.jsx(Z,{shadow:"sm",padding:"md",children:e.jsxs(T,{gap:"xs",children:[e.jsx(a,{size:"sm",c:"dimmed",children:c}),e.jsx(a,{size:"xl",fw:700,children:o.length})]})})},c))}),g&&g.length===0?e.jsx(a,{c:"dimmed",ta:"center",py:"xl",children:"No shards match your filters"}):e.jsxs(ce,{children:[e.jsxs(l,{striped:!0,highlightOnHover:!0,children:[e.jsx(l.Thead,{children:e.jsxs(l.Tr,{children:[e.jsx(l.Th,{children:"Index"}),e.jsx(l.Th,{children:"Shard"}),e.jsx(l.Th,{children:"Type"}),e.jsx(l.Th,{children:"State"}),e.jsx(l.Th,{children:"Node"}),e.jsx(l.Th,{children:"Documents"}),e.jsx(l.Th,{children:"Size"})]})}),e.jsx(l.Tbody,{children:g==null?void 0:g.slice(0,100).map((c,o)=>{const S=c.state==="UNASSIGNED";return e.jsxs(l.Tr,{style:{backgroundColor:S?"rgba(250, 82, 82, 0.1)":void 0},children:[e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:c.index})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:c.shard})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",variant:"light",color:c.primary?"blue":"gray",children:c.primary?"Primary":"Replica"})}),e.jsx(l.Td,{children:e.jsx(D,{size:"sm",color:c.state==="STARTED"?"green":c.state==="UNASSIGNED"?"red":"yellow",children:c.state})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:c.node||"N/A"})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:c.docs!==void 0&&c.docs!==null?c.docs.toLocaleString():"N/A"})}),e.jsx(l.Td,{children:e.jsx(a,{size:"sm",children:c.store!==void 0&&c.store!==null?O(c.store):"N/A"})})]},`${c.index}-${c.shard}-${o}`)})})]}),g&&g.length>100&&e.jsxs(a,{size:"sm",c:"dimmed",ta:"center",mt:"md",children:["Showing first 100 of ",g.length," shards"]})]})]})}export{Ts as ClusterView};
