import{K as T,u as J,y as L,a0 as O,r as c,b as _,j as e,A as g,I as h,G as f,L as R,T as F,d as a,S as C,Z as P,D as I,f as v}from"./index-BZ5qcqgZ.js";import{u as $}from"./useMutation-BA-L8aGh.js";import{C as u}from"./Container-B0S22S8r.js";import{B as p}from"./Button-524yZMYQ.js";import{I as B}from"./IconInfoCircle-5_awQKC8.js";import{C as D}from"./Card-CCDhkaHB.js";import{I as K}from"./IconCheck-Bwv-iVT5.js";function M(s){if(!s.trim())return"Settings cannot be empty";try{return JSON.parse(s),null}catch(t){return t.message}}function W(){const{id:s,indexName:t}=T(),z=J(),j=L(),{resolvedTheme:w}=O(),[x,m]=c.useState(""),[y,o]=c.useState(null),[S,d]=c.useState(!1),{data:i,isLoading:E,error:b}=_({queryKey:["cluster",s,"index",t,"settings"],queryFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");const r=(await v.proxyRequest(s,"GET",`/${t}/_settings`))[t];return r==null?void 0:r.settings},enabled:!!s&&!!t});c.useEffect(()=>{i&&(m(JSON.stringify(i,null,2)),d(!1))},[i]);const l=$({mutationFn:async()=>{if(!s||!t)throw new Error("Cluster ID and index name are required");const n=M(x);if(n)throw o(n),new Error(`Invalid settings JSON: ${n}`);const r=JSON.parse(x);await v.proxyRequest(s,"PUT",`/${t}/_settings`,r)},onSuccess:()=>{j.invalidateQueries({queryKey:["cluster",s,"index",t,"settings"]}),j.invalidateQueries({queryKey:["cluster",s,"indices"]}),I.show({title:"Success",message:`Settings for index "${t}" updated successfully`,color:"green",icon:e.jsx(K,{size:16})}),d(!1)},onError:n=>{I.show({title:"Error",message:n.message||"Failed to update settings",color:"red",icon:e.jsx(h,{size:16})})}}),q=n=>{m(n||""),o(null),d(!0)},N=()=>{o(null),l.mutate()},k=()=>{i&&(m(JSON.stringify(i,null,2)),o(null),d(!1))};return!s||!t?e.jsx(u,{size:"xl",children:e.jsx(g,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:"Cluster ID and index name are required"})}):E?e.jsx(u,{size:"xl",children:e.jsx(f,{justify:"center",mt:"xl",children:e.jsx(R,{size:"lg"})})}):b?e.jsx(u,{size:"xl",children:e.jsxs(g,{icon:e.jsx(h,{size:16}),title:"Error",color:"red",children:["Failed to load index settings: ",b.message]})}):e.jsxs(u,{size:"xl",py:"md",children:[e.jsxs(f,{justify:"space-between",mb:"md",children:[e.jsxs("div",{children:[e.jsx(F,{order:1,children:"Index Settings"}),e.jsx(a,{size:"sm",c:"dimmed",children:t})]}),e.jsx(p,{variant:"default",onClick:()=>z(`/cluster/${s}?tab=indices`),children:"Back to Indices"})]}),e.jsxs(C,{gap:"md",children:[e.jsx(g,{icon:e.jsx(B,{size:16}),color:"blue",title:"Settings Information",children:e.jsxs(a,{size:"sm",children:[e.jsx("strong",{children:"Dynamic settings"})," can be updated on an open index (e.g., number_of_replicas, refresh_interval).",e.jsx("br",{}),e.jsx("strong",{children:"Static settings"})," can only be set at index creation or on a closed index (e.g., number_of_shards, codec).",e.jsx("br",{}),"To update static settings, you must first close the index, update the settings, then reopen it."]})}),e.jsx(D,{shadow:"sm",padding:"lg",children:e.jsxs(C,{gap:"md",children:[e.jsxs("div",{children:[e.jsx(a,{size:"sm",fw:500,mb:"xs",children:"Index Settings (JSON)"}),e.jsx(a,{size:"xs",c:"dimmed",mb:"sm",children:'Edit the settings below and click "Update Settings" to apply changes'}),e.jsx("div",{style:{border:"1px solid #dee2e6",borderRadius:"4px"},children:e.jsx(P,{height:"500px",defaultLanguage:"json",value:x,onChange:q,theme:w==="dark"?"vs-dark":"light",options:{minimap:{enabled:!1},fontSize:14,lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0}})}),y&&e.jsx(a,{size:"sm",c:"red",mt:"xs",children:y})]}),e.jsxs(f,{justify:"flex-end",children:[e.jsx(p,{variant:"default",onClick:k,disabled:!S||l.isPending,children:"Reset"}),e.jsx(p,{onClick:N,loading:l.isPending,disabled:!S,children:l.isPending?"Updating...":"Update Settings"})]})]})})]})]})}export{W as IndexSettings};
